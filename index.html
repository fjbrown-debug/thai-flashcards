<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6b4423">
    <title>Thai Vocabulary Flashcards</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Load theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('thaiFlashcardsTheme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <style>
        :root {
            /* Light theme (default) */
            --bg-primary: #fdfbf7;
            --bg-secondary: #f5ebe0;
            --bg-card: #ffffff;
            --bg-card-back: linear-gradient(135deg, #8b6f47 0%, #6b4423 100%);
            --text-primary: #6b4423;
            --text-secondary: #666666;
            --text-muted: #999999;
            --accent-primary: #d4a373;
            --accent-secondary: #8b6f47;
            --border-color: rgba(212, 163, 115, 0.3);
            --shadow-color: rgba(107, 68, 35, 0.12);
            --shadow-strong: rgba(107, 68, 35, 0.2);
            --card-border: rgba(139, 111, 71, 0.1);
            --btn-bg: #ffffff;
            --btn-nav-bg: #f5ebe0;
            --progress-bg: #e0e0e0;
            --modal-backdrop: rgba(0, 0, 0, 0.5);
            --success-color: #22c55e;
            --error-color: #ef4444;
            --glow-success: rgba(34, 197, 94, 0.4);
            --glow-error: rgba(239, 68, 68, 0.4);
        }

        [data-theme="dark"] {
            --bg-primary: #121214;
            --bg-secondary: #1c1c1f;
            --bg-card: #242428;
            --bg-card-back: linear-gradient(135deg, #3a3a42 0%, #28282d 100%);
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent-primary: #5eead4;
            --accent-secondary: #14b8a6;
            --border-color: rgba(161, 161, 170, 0.2);
            --shadow-color: rgba(0, 0, 0, 0.4);
            --shadow-strong: rgba(0, 0, 0, 0.6);
            --card-border: rgba(161, 161, 170, 0.1);
            --btn-bg: #242428;
            --btn-nav-bg: #2e2e33;
            --progress-bg: #2e2e33;
            --modal-backdrop: rgba(0, 0, 0, 0.75);
            --success-color: #4ade80;
            --error-color: #f87171;
            --glow-success: rgba(74, 222, 128, 0.3);
            --glow-error: rgba(248, 113, 113, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* Main Menu Styles */
        .main-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .main-menu-content {
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .main-menu-header {
            margin-bottom: 32px;
        }

        .main-menu-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
        }

        .main-menu-icon img {
            width: 100%;
            height: 100%;
            border-radius: 20px;
            box-shadow: 0 4px 20px var(--shadow-color);
        }

        .main-menu h1 {
            font-size: 2em;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .main-menu-subtitle {
            color: var(--text-secondary);
            font-size: 1em;
        }

        .main-menu-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .main-menu-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 12px var(--shadow-color);
            border: 1px solid var(--border-color);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .main-menu-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--shadow-strong);
        }

        .main-menu-card:active {
            transform: scale(0.98);
        }

        .main-menu-card-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .main-menu-card-title {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .main-menu-card-desc {
            font-size: 0.85em;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .main-menu-footer {
            margin-top: 16px;
        }

        .main-menu-skip {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.9em;
            cursor: pointer;
            padding: 8px 16px;
            transition: color 0.2s;
        }

        .main-menu-skip:hover {
            color: var(--accent-primary);
        }

        .back-to-menu {
            position: absolute;
            top: 18px;
            left: 18px;
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: var(--text-secondary);
            padding: 5px;
        }

        .back-to-menu:hover {
            color: var(--text-primary);
        }

        .back-to-menu svg {
            width: 28px;
            height: 28px;
        }

        html {
            overflow-x: hidden;
            width: 100%;
        }

        body {
            font-family: 'Nunito', 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            touch-action: pan-y;
            overflow-x: hidden;
            width: 100%;
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 12px;
        }

        .header-icon {
            width: 64px;
            height: 64px;
            margin-bottom: 8px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
            border-radius: 12px;
        }
        
        .header-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        h1 {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-size: clamp(1.8em, 6vw, 2.5em);
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-size: clamp(0.75em, 3vw, 0.9em);
            padding: 0 10px;
        }

        .list-selector-container {
            text-align: center;
            margin-bottom: 15px;
        }

        .list-selector {
            padding: 12px 20px;
            font-size: clamp(0.9em, 3.5vw, 1em);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--btn-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            max-width: 100%;
            font-family: inherit;
        }

        .list-selector:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(212, 163, 115, 0.2);
        }

        .top-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: space-between;
        }

        .settings-btn, .stats-btn {
            padding: 10px 16px;
            background: var(--btn-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: clamp(0.85em, 3vw, 0.95em);
            font-weight: 500;
            transition: all 0.2s;
            flex: 1;
        }

        .settings-btn:active, .stats-btn:active {
            background: var(--bg-secondary);
            transform: scale(0.98);
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--btn-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.3em;
            z-index: 100;
            transition: all 0.3s;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .theme-toggle:active {
            transform: scale(0.9);
        }

        .session-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .session-btn {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            background: var(--btn-bg);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: clamp(0.8em, 2.8vw, 0.9em);
        }

        .session-btn:active {
            transform: scale(0.95);
            background: var(--bg-secondary);
        }

        .session-btn.primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border-color: transparent;
        }

        .session-btn.primary:disabled {
            background: var(--progress-bg);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .session-btn.primary:disabled:active {
            transform: none;
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: clamp(0.8em, 3vw, 0.9em);
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--progress-bg);
            border-radius: 10px;
            overflow: visible;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 10px;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 8px rgba(212, 163, 115, 0.4);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 50%);
            border-radius: 10px;
        }

        .progress-milestones {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            padding: 0 2px;
        }

        .milestone {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--progress-bg);
            transition: all 0.3s;
            position: relative;
        }

        .milestone.reached {
            background: var(--accent-primary);
            box-shadow: 0 0 8px var(--accent-primary);
            animation: milestonePulse 4s ease-in-out infinite;
        }

        @keyframes milestonePulse {
            0%, 100% { 
                box-shadow: 0 0 6px var(--accent-primary);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 12px var(--accent-primary), 0 0 20px var(--accent-primary);
                transform: scale(1.15);
            }
        }

        .milestone.reached::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            border: 2px solid var(--accent-primary);
            opacity: 0.5;
        }

        .card-container {
            perspective: 1000px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            border-radius: 24px;
        }

        .swipe-bar {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            border-radius: 24px;
            opacity: 0;
            transition: opacity 0.15s ease;
            pointer-events: none;
            z-index: 5;
        }

        .swipe-bar.left {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.95) 0%, rgba(239, 68, 68, 0) 50%);
        }

        .swipe-bar.right {
            background: linear-gradient(-90deg, rgba(34, 197, 94, 0.95) 0%, rgba(34, 197, 94, 0) 50%);
        }

        .swipe-bar.visible {
            opacity: 1;
        }

        .swipe-hint {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3em;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: none;
            z-index: 10;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .swipe-hint.left {
            left: 25px;
            color: white;
        }

        .swipe-hint.right {
            right: 25px;
            color: white;
        }

        .swipe-hint.visible {
            opacity: 1;
        }

        .swipe-hint.visible.left {
            transform: translateY(-50%) scale(1.2);
        }

        .swipe-hint.visible.right {
            transform: translateY(-50%) scale(1.2);
        }

        .card {
            width: 100%;
            min-height: clamp(280px, 50vh, 400px);
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            touch-action: none;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.swiping {
            transition: none;
        }

        /* Success/error feedback animations */
        .card.success-flash .card-face {
            animation: successPulse 0.4s ease;
        }

        .card.error-flash .card-face {
            animation: errorPulse 0.4s ease;
        }

        @keyframes successPulse {
            0%, 100% { box-shadow: 0 20px 60px var(--shadow-color); }
            50% { box-shadow: 0 0 40px var(--glow-success), 0 20px 60px var(--shadow-color); }
        }

        @keyframes errorPulse {
            0%, 100% { box-shadow: 0 20px 60px var(--shadow-color); }
            50% { box-shadow: 0 0 40px var(--glow-error), 0 20px 60px var(--shadow-color); }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            min-height: clamp(280px, 50vh, 400px);
            backface-visibility: hidden;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: clamp(20px, 8vw, 40px);
            box-shadow: 0 20px 60px var(--shadow-color), 0 8px 20px var(--shadow-color);
            transition: box-shadow 0.3s ease;
            overflow: hidden;
        }

        .card-front {
            background: var(--bg-card);
            border: 1px solid var(--card-border);
        }

        .card-back {
            background: var(--bg-card-back);
            transform: rotateY(180deg);
            position: relative;
            overflow: hidden;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            pointer-events: none;
        }

        .card-text {
            font-size: clamp(2em, 8vw, 3.5em);
            font-weight: 600;
            color: var(--text-primary);
            word-break: keep-all;
            overflow-wrap: normal;
            max-width: 100%;
            line-height: 1.4;
            text-align: center;
            padding: 0 10px;
            font-family: 'Sarabun', 'Nunito', sans-serif;
            min-height: 1.4em;
        }

        .card-text.medium { font-size: clamp(1.5em, 6vw, 2.2em); }
        .card-text.small { font-size: clamp(1.2em, 5vw, 1.6em); }
        .card-text.tiny { font-size: clamp(1em, 4vw, 1.2em); }
        .card-text.xtiny { font-size: clamp(0.9em, 3.5vw, 1em); }

        .card-back .card-text {
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        button {
            padding: clamp(12px, 3vw, 15px) clamp(16px, 4vw, 20px);
            border: none;
            border-radius: 14px;
            font-size: clamp(0.9em, 3.5vw, 1em);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            touch-action: manipulation;
            font-family: inherit;
        }

        button:active:not(:disabled) {
            transform: scale(0.95);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-nav { 
            background: var(--btn-nav-bg); 
            color: var(--text-primary); 
        }
        
        .btn-flip { 
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%); 
            color: white;
            box-shadow: 0 4px 15px rgba(212, 163, 115, 0.3);
        }
        
        .btn-action { 
            background: var(--btn-bg); 
            color: var(--text-primary); 
            border: 2px solid var(--border-color); 
        }

        .action-controls {
            display: flex;
            gap: 8px;
        }

        .sentence-example {
            margin-top: 15px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 14px;
            border: 1px solid var(--border-color);
            display: none;
        }

        .sentence-example.show {
            display: block;
        }

        .sentence-example-btn {
            background: var(--btn-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }

        .sentence-example-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .sentence-thai {
            font-size: 1.3em;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .sentence-roman {
            font-size: 0.95em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-style: italic;
        }

        .sentence-english {
            font-size: 1em;
            color: var(--text-secondary);
        }

        .sentence-word-highlight {
            color: var(--primary-color);
            font-weight: 600;
        }

        .sentence-speak-btn {
            margin-top: 12px;
            padding: 8px 12px;
            background: var(--btn-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .sentence-speak-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .score-display {
            text-align: center;
            margin-bottom: 15px;
            font-size: clamp(1em, 3.5vw, 1.1em);
            color: var(--text-secondary);
            background: var(--btn-bg);
            padding: 12px 16px;
            border-radius: 14px;
            border: 1px solid var(--border-color);
        }

        .score-number { font-weight: 700; font-size: 1.3em; }
        .score-correct { color: var(--success-color); }
        .score-incorrect { color: var(--error-color); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-backdrop);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            overflow: hidden;
        }

        .modal.open { display: flex; }

        .modal-content {
            background: var(--bg-card);
            border-radius: 24px;
            padding: clamp(16px, 4vw, 30px);
            max-width: 500px;
            width: 100%;
            max-height: calc(100vh - 30px);
            max-height: calc(100dvh - 30px);
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 25px 80px var(--shadow-strong);
            border: 1px solid var(--border-color);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: clamp(1.3em, 5vw, 1.6em);
            font-weight: 700;
        }

        .close-btn {
            background: var(--btn-nav-bg);
            border: none;
            font-size: 1.2em;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 12px;
            flex: none;
            border-radius: 10px;
            transition: all 0.2s;
        }

        .close-btn:active {
            transform: scale(0.9);
            background: var(--bg-secondary);
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section h3 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: clamp(1em, 4vw, 1.1em);
            font-weight: 600;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-label {
            display: block;
            padding: 12px 16px;
            background: var(--btn-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
            font-size: clamp(0.9em, 3.5vw, 1em);
            transition: all 0.2s;
        }

        .file-input-label:active {
            background: var(--bg-secondary);
        }

        #csvFileInput { position: absolute; left: -9999px; }

        .import-info {
            margin-top: 8px;
            font-size: clamp(0.75em, 3vw, 0.85em);
            color: var(--text-muted);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-box {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 14px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: clamp(1.5em, 6vw, 2em);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: clamp(0.8em, 3vw, 0.9em);
            color: var(--text-secondary);
        }

        .list-stat-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 14px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }

        .list-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .list-stat-name { font-weight: 600; color: var(--text-primary); font-size: 1em; }
        .list-stat-percent { font-size: 1.3em; font-weight: 700; color: var(--success-color); }

        .list-stat-bar {
            width: 100%;
            height: 8px;
            background: var(--progress-bg);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .list-stat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color) 0%, #22c55e 100%);
            transition: width 0.3s ease;
        }

        .list-stat-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .stat-detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-detail-value { font-weight: 600; color: var(--text-primary); }

        .mode-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            background: var(--btn-bg);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: clamp(0.85em, 3vw, 0.95em);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border-color: transparent;
        }

        .mode-btn:active { transform: scale(0.95); }

        .view-mode-toggle {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            padding: 4px;
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .view-mode-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: clamp(0.8em, 2.8vw, 0.85em);
        }

        .view-mode-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .view-mode-btn:active { transform: scale(0.95); }

        /* Options Button */
        .options-btn {
            background: var(--btn-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 10px 14px;
            font-size: 1.2em;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .options-btn:active { transform: scale(0.95); }

        /* Options Modal */
        .options-modal-content {
            max-width: 400px;
        }

        .menu-section {
            margin-bottom: 16px;
        }

        .menu-section-title {
            font-size: 0.75em;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            padding-left: 4px;
        }

        .menu-btn {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-secondary);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95em;
            font-weight: 500;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-btn:hover {
            background: var(--bg-card);
        }

        .menu-btn:active {
            transform: scale(0.98);
        }

        .menu-btn-danger {
            color: #dc2626;
        }

        .menu-btn-danger:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        [data-theme="dark"] .menu-btn-danger {
            color: #f87171;
        }

        [data-theme="dark"] .menu-btn-danger:hover {
            background: rgba(248, 113, 113, 0.1);
        }

        .option-group {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .menu-section .option-group:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .menu-section .option-group:first-of-type {
            padding-top: 0;
        }

        .option-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .option-hint {
            font-size: 0.8em;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .option-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .option-row .option-label {
            margin-bottom: 0;
        }

        .option-toggle-group {
            display: flex;
            gap: 6px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: 10px;
        }

        .option-toggle-btn {
            flex: 1;
            padding: 10px 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85em;
        }

        .option-toggle-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .option-toggle-btn:active { transform: scale(0.95); }

        /* Mixed List Size Controls */
        .mixed-list-size-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mixed-list-size-input {
            width: 80px;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1em;
            font-weight: 600;
            text-align: center;
        }

        .mixed-list-size-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn-reshuffle {
            flex: 1;
            padding: 10px 16px;
            border: none;
            background: var(--accent-primary);
            color: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
        }

        .btn-reshuffle:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-reshuffle:active {
            transform: scale(0.98);
        }

        .option-hint {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 6px;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--progress-bg);
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Mastery Indicator */
        .mastery-indicator {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
            opacity: 0.9;
        }

        .card.flipped .mastery-indicator {
            visibility: hidden;
        }

        .mastery-new {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .mastery-learning {
            background: #fef3c7;
            color: #92400e;
        }

        [data-theme="dark"] .mastery-learning {
            background: #422006;
            color: #fbbf24;
        }

        .mastery-mastered {
            background: #d1fae5;
            color: #065f46;
        }

        [data-theme="dark"] .mastery-mastered {
            background: #064e3b;
            color: #34d399;
        }

        .mastery-struggling {
            background: #fee2e2;
            color: #991b1b;
        }

        [data-theme="dark"] .mastery-struggling {
            background: #450a0a;
            color: #f87171;
        }

        /* Vocab List Modal */
        .vocab-list-modal-content {
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            max-height: 85dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .vocab-list-controls {
            flex-shrink: 0;
            padding-bottom: 5px;
        }

        .vocab-list-controls .list-selector {
            width: 100%;
        }

        .vocab-list-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px 0;
            -webkit-overflow-scrolling: touch;
            min-height: 0;
        }

        .vocab-list-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            gap: 12px;
            flex-wrap: wrap;
        }

        .vocab-list-item:last-child {
            border-bottom: none;
        }

        .vocab-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .vocab-status.new {
            background: var(--text-muted);
        }

        .vocab-status.learning {
            background: #f59e0b;
        }

        .vocab-status.mastered {
            background: #10b981;
        }

        .vocab-status.struggling {
            background: #ef4444;
        }

        .vocab-thai {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 60px;
            flex-shrink: 0;
        }

        .vocab-english {
            flex: 1;
            color: var(--text-secondary);
            font-size: 0.9em;
            min-width: 100px;
        }

        .vocab-roman {
            color: var(--text-muted);
            font-size: 0.8em;
            font-style: italic;
            width: 100%;
            padding-left: 22px;
            margin-top: -4px;
        }

        /* App Mode Toggle */
        .app-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .app-mode-btn {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--btn-bg);
            color: var(--text-primary);
        }

        .app-mode-btn:hover {
            border-color: var(--accent-primary);
        }

        .app-mode-btn:active {
            background: var(--bg-secondary);
            transform: scale(0.98);
        }

        .app-mode-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        /* Grammar Section */
        .grammar-section {
            padding: 10px 0;
        }

        .grammar-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .grammar-header h2 {
            color: var(--text-primary);
            margin: 0 0 5px 0;
            font-size: 1.4em;
        }

        .grammar-subtitle {
            color: var(--text-muted);
            font-size: 0.9em;
            margin: 0;
        }

        .grammar-lessons-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .grammar-lesson-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .grammar-lesson-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .grammar-lesson-card.completed {
            border-color: #10b981;
        }

        .lesson-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .lesson-card-title {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .lesson-card-thai {
            font-size: 1.2em;
            color: var(--accent-primary);
        }

        .lesson-card-desc {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .lesson-card-example {
            background: var(--progress-bg);
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.85em;
        }

        .lesson-card-example .thai {
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .lesson-card-example .english {
            color: var(--text-muted);
            font-style: italic;
        }

        .lesson-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            gap: 12px;
        }

        .lesson-card-status {
            font-size: 0.8em;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .lesson-card-status.completed {
            color: #10b981;
            font-weight: 600;
        }

        .lesson-card-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--accent-primary);
            color: white;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .lesson-card-btn:hover {
            transform: scale(1.05);
        }

        .lesson-card-btn.completed {
            background: #10b981;
        }

        [data-theme="dark"] .lesson-card-status.completed {
            color: #34d399;
        }

        /* Lesson View */
        .grammar-lesson-view {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .grammar-back-btn {
            background: none;
            border: none;
            color: var(--accent-primary);
            font-size: 0.95em;
            cursor: pointer;
            padding: 8px 0;
            margin-bottom: 15px;
        }

        .lesson-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            min-height: 350px;
        }

        .lesson-step {
            display: none;
        }

        .lesson-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .lesson-step-title {
            font-size: 0.85em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .lesson-structure {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }

        .lesson-structure-thai {
            font-size: 1.8em;
            color: var(--accent-primary);
            margin-bottom: 8px;
        }

        .lesson-structure-roman {
            font-size: 1em;
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 8px;
        }

        .lesson-structure-english {
            font-size: 1.1em;
            color: var(--text-secondary);
        }

        .lesson-explanation {
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 0.95em;
        }
        
        .lesson-explanation p {
            margin: 0 0 12px 0;
        }
        
        .lesson-explanation p:last-child {
            margin-bottom: 0;
        }
        
        .lesson-explanation strong {
            color: var(--text-primary);
        }
        
        .lesson-explanation em {
            font-style: italic;
            color: var(--primary-color);
        }

        .lesson-examples {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .example-card {
            background: var(--progress-bg);
            border-radius: 12px;
            padding: 16px;
        }

        .example-thai {
            font-size: 1.15em;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .example-thai .highlight {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .example-roman {
            font-size: 0.85em;
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 6px;
        }

        .example-english {
            color: var(--text-secondary);
            font-size: 0.95em;
        }

        /* Practice Section */
        .practice-prompt {
            text-align: center;
            margin-bottom: 20px;
        }

        .practice-prompt-english {
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .practice-prompt-hint {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .practice-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .practice-option {
            background: var(--progress-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 14px 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .practice-option:hover {
            border-color: var(--accent-primary);
        }

        .practice-option.selected {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .practice-option.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .practice-option.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .practice-feedback {
            text-align: center;
            padding: 16px;
            margin-top: 16px;
            border-radius: 12px;
            display: none;
        }

        .practice-feedback.show {
            display: block;
        }

        .practice-feedback.correct {
            background: rgba(16, 185, 129, 0.1);
            color: #065f46;
        }

        .practice-feedback.incorrect {
            background: rgba(239, 68, 68, 0.1);
            color: #991b1b;
        }

        [data-theme="dark"] .practice-feedback.correct {
            color: #34d399;
        }

        [data-theme="dark"] .practice-feedback.incorrect {
            color: #fca5a5;
        }

        .practice-check-btn {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }

        .practice-check-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Sentence Builder */
        .sentence-builder {
            margin-top: 16px;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 16px;
            background: var(--progress-bg);
            border-radius: 12px;
            min-height: 50px;
            margin-bottom: 12px;
        }

        .word-chip {
            background: var(--card-bg);
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1em;
            border: 2px solid transparent;
        }

        .word-chip:hover {
            border-color: var(--accent-primary);
        }

        .word-chip.used {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .sentence-target {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 16px;
            background: var(--card-bg);
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            min-height: 60px;
            align-items: center;
        }

        .sentence-target .word-chip {
            background: var(--accent-primary);
            color: white;
        }

        .sentence-placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        .lesson-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .lesson-progress {
            color: var(--text-muted);
            font-size: 0.9em;
        }

        /* Practice Mode Styles */
        .grammar-practice-view {
            animation: fadeIn 0.3s ease;
        }

        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .practice-title {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .practice-score {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--accent-primary);
            background: var(--progress-bg);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .practice-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--progress-bg);
            padding: 4px;
            border-radius: 12px;
        }

        .practice-mode-btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: var(--text-muted);
        }

        .practice-mode-btn.active {
            background: var(--card-bg);
            color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .practice-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            min-height: 300px;
        }

        .practice-question {
            text-align: center;
            margin-bottom: 24px;
        }

        .practice-english {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-style: italic;
        }

        .practice-sentence {
            font-size: 1.5em;
            color: var(--text-primary);
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .practice-sentence .blank {
            display: inline-block;
            min-width: 80px;
            height: 40px;
            border-bottom: 3px solid var(--accent-primary);
            margin: 0 4px;
            vertical-align: bottom;
            position: relative;
        }

        .practice-sentence .blank.filled {
            border-bottom-color: var(--accent-primary);
            cursor: pointer;
        }

        .practice-sentence .blank.correct {
            border-bottom-color: #10b981;
        }

        .practice-sentence .blank.incorrect {
            border-bottom-color: #ef4444;
        }

        .practice-sentence .blank .filled-word {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-primary);
            color: var(--bg-primary);
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.8em;
            white-space: nowrap;
            font-weight: 600;
        }

        .practice-sentence .blank.filled .filled-word {
            background: var(--accent-primary);
        }

        .practice-sentence .blank.correct .filled-word {
            background: #10b981;
            color: white;
        }

        .practice-sentence .blank.incorrect .filled-word {
            background: #ef4444;
            color: white;
        }

        .practice-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .practice-word-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .practice-word-option {
            background: var(--progress-bg);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .practice-word-option:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .practice-word-option.selected {
            background: var(--accent-primary);
            color: white;
        }

        .practice-word-option.used {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .practice-word-option.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .practice-word-option.wrong {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        /* Sentence Builder Practice */
        .build-target {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 20px;
            background: var(--progress-bg);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            min-height: 70px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            transition: all 0.2s;
        }

        .build-target.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .build-target.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .build-target .build-word {
            background: var(--accent-primary);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .build-target .build-word:hover {
            opacity: 0.8;
        }

        .build-placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        .build-word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .build-word-chip {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .build-word-chip:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .build-word-chip.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .practice-result {
            text-align: center;
            padding: 16px;
            margin-top: 20px;
            border-radius: 12px;
            font-weight: 600;
        }

        .practice-result.correct {
            background: rgba(16, 185, 129, 0.15);
            color: #065f46;
        }

        .practice-result.incorrect {
            background: rgba(239, 68, 68, 0.15);
            color: #991b1b;
        }

        [data-theme="dark"] .practice-result.correct {
            color: #34d399;
        }

        [data-theme="dark"] .practice-result.incorrect {
            color: #fca5a5;
        }

        /* Alphabet Section Styles */
        .alphabet-section {
            padding: 10px 0;
        }

        .alphabet-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .alphabet-header h2 {
            color: var(--text-primary);
            margin: 0 0 5px 0;
            font-size: 1.4em;
        }

        .alphabet-subtitle {
            color: var(--text-muted);
            font-size: 0.9em;
            margin: 0;
        }

        .alphabet-modes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .alphabet-mode-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .alphabet-mode-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .alphabet-mode-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .alphabet-mode-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .alphabet-mode-desc {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .alphabet-progress-overview {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px 20px;
            text-align: center;
        }

        .alphabet-progress-overview h3 {
            color: var(--text-primary);
            font-size: 1em;
            margin: 0 0 12px 0;
        }

        .alphabet-progress-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .alphabet-stat {
            display: flex;
            align-items: baseline;
            gap: 4px;
        }

        .alphabet-stat-num {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .alphabet-stat-label {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .alphabet-practice-view {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .alphabet-practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alphabet-practice-mode {
            font-weight: 600;
            color: var(--text-primary);
        }

        .alphabet-practice-score {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .alphabet-practice-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            min-height: 350px;
        }

        .alphabet-question {
            text-align: center;
            margin-bottom: 24px;
        }

        .alphabet-question-letter {
            font-size: 5em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .alphabet-question-prompt {
            font-size: 1em;
            color: var(--text-muted);
        }

        .alphabet-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .alphabet-option {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .alphabet-option:hover {
            border-color: var(--accent-primary);
            background: var(--bg-card);
        }

        .alphabet-option.selected {
            border-color: var(--accent-primary);
            background: var(--bg-card);
        }

        .alphabet-option.correct {
            border-color: var(--success-color);
            background: var(--glow-success);
        }

        .alphabet-option.incorrect {
            border-color: var(--error-color);
            background: var(--glow-error);
        }

        .alphabet-option.correct-answer {
            border-color: var(--success-color);
            border-width: 3px;
            background: var(--glow-success);
        }

        .alphabet-option-main {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .alphabet-option-sub {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .alphabet-feedback {
            text-align: center;
            margin-top: 16px;
            padding: 12px;
            border-radius: 12px;
        }

        .alphabet-feedback.correct {
            background: var(--glow-success);
            color: var(--success-color);
        }

        .alphabet-feedback.incorrect {
            background: var(--glow-error);
            color: var(--error-color);
        }

        .alphabet-feedback-detail {
            margin-top: 8px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        /* Class sorting specific styles */
        .class-options {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .class-option {
            flex: 1;
            max-width: 100px;
            padding: 16px 12px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .class-option.low {
            background: rgba(34, 197, 94, 0.15);
            color: #16a34a;
        }

        .class-option.mid {
            background: rgba(59, 130, 246, 0.15);
            color: #2563eb;
        }

        .class-option.high {
            background: rgba(249, 115, 22, 0.15);
            color: #ea580c;
        }

        .class-option:hover, .class-option.selected {
            transform: scale(1.05);
            border-color: currentColor;
        }

        .class-option.correct {
            border-color: var(--success-color);
            box-shadow: 0 0 20px var(--glow-success);
        }

        .class-option.incorrect {
            border-color: var(--error-color);
            opacity: 0.6;
        }

        .class-option-label {
            font-weight: 700;
            font-size: 1.1em;
        }

        /* Class Sorting View Styles */
        .class-sorting-view {
            display: flex;
            flex-direction: column;
            gap: 16px;
            height: 100%;
        }

        .sorting-card-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 180px;
        }

        .sorting-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px 40px;
            text-align: center;
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .sorting-card.correct-animation {
            transform: scale(0.8);
            opacity: 0;
        }

        .sorting-card.wrong-animation {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }

        .sorting-card-letter {
            font-size: 4em;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .sorting-card-roman {
            font-size: 1em;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .sorting-instruction {
            margin-top: 12px;
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .class-bins {
            display: flex;
            gap: 10px;
            padding: 0 10px;
        }

        .class-bin {
            flex: 1;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 3px solid transparent;
            min-height: 120px;
        }

        .class-bin:hover {
            transform: translateY(-2px);
        }

        .class-bin:active {
            transform: scale(0.98);
        }

        .class-bin.low {
            border-color: rgba(34, 197, 94, 0.3);
            background: rgba(34, 197, 94, 0.08);
        }

        .class-bin.mid {
            border-color: rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.08);
        }

        .class-bin.high {
            border-color: rgba(249, 115, 22, 0.3);
            background: rgba(249, 115, 22, 0.08);
        }

        .class-bin.pulse-correct {
            animation: pulse-green 0.4s ease;
        }

        .class-bin.pulse-incorrect {
            animation: pulse-red 0.4s ease;
        }

        @keyframes pulse-green {
            0%, 100% { box-shadow: none; }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.6); }
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: none; }
            50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.6); }
        }

        .class-bin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .class-bin-header-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .class-bin-label {
            font-weight: 700;
            font-size: 0.9em;
        }

        .class-bin.low .class-bin-label { color: #16a34a; }
        .class-bin.mid .class-bin-label { color: #2563eb; }
        .class-bin.high .class-bin-label { color: #ea580c; }

        .class-bin-count {
            background: var(--bg-secondary);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .class-bin-view-btn {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            font-size: 0.9em;
            opacity: 0.4;
            transition: opacity 0.2s;
            line-height: 1;
        }

        .class-bin-view-btn:hover {
            opacity: 1;
        }

        .class-bin-letters {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 1.1em;
            color: var(--text-primary);
            max-height: 60px;
            overflow: hidden;
        }

        .class-bin-expanded {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 100;
            padding: 20px;
            overflow-y: auto;
        }

        .class-bin-expanded-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .class-bin-expanded-header span {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .class-bin-expanded-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .expanded-letter-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
        }

        .expanded-letter-thai {
            font-size: 2em;
            font-weight: 600;
            color: var(--text-primary);
        }

        .expanded-letter-roman {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .sorting-complete {
            text-align: center;
            padding: 40px 20px;
        }

        .sorting-complete h3 {
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .sorting-complete p {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* Alphabet Chart Styles */
        .alphabet-chart-content {
            margin-top: 16px;
        }

        .alphabet-chart-section {
            margin-bottom: 24px;
        }

        .alphabet-chart-section h3 {
            color: var(--text-primary);
            font-size: 1.1em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alphabet-chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 8px;
        }

        .alphabet-chart-item {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 10px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .alphabet-chart-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .alphabet-chart-item.tappable:active {
            transform: scale(0.95);
            opacity: 0.8;
        }

        .alphabet-chart-item.low {
            border-left-color: #22c55e;
        }

        .alphabet-chart-item.mid {
            border-left-color: #3b82f6;
        }

        .alphabet-chart-item.high {
            border-left-color: #f97316;
        }

        .chart-item-thai {
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-item-roman {
            font-size: 0.75em;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .chart-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .chart-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .chart-legend-color.low { background: #22c55e; }
        .chart-legend-color.mid { background: #3b82f6; }
        .chart-legend-color.high { background: #f97316; }

        /* Chart Explainer and Summary */
        .chart-explainer {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .chart-explainer h3 {
            color: var(--text-primary);
            font-size: 1.1em;
            margin: 0 0 8px 0;
        }

        .chart-explainer p {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin: 0 0 12px 0;
            line-height: 1.5;
        }

        .class-summary {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .class-summary-item {
            padding: 10px 12px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .class-summary-item.mid { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .class-summary-item.high { border-color: #f97316; background: rgba(249, 115, 22, 0.1); }
        .class-summary-item.low { border-color: #22c55e; background: rgba(34, 197, 94, 0.1); }

        .class-summary-item strong {
            display: block;
            color: var(--text-primary);
            font-size: 0.9em;
            margin-bottom: 4px;
        }

        .class-summary-item span {
            display: block;
            font-size: 1.1em;
            color: var(--text-primary);
            letter-spacing: 2px;
        }

        .class-summary-item small {
            display: block;
            color: var(--text-muted);
            font-size: 0.8em;
            margin-top: 4px;
        }

        /* Vowel Grid */
        .vowel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .vowel-pair-label {
            grid-column: 1 / -1;
            font-size: 0.8em;
            color: var(--text-muted);
            text-align: center;
            padding: 8px 0 4px 0;
            border-top: 1px solid var(--border-color);
            margin-top: 8px;
        }

        .vowel-pair-label:first-child {
            border-top: none;
            margin-top: 0;
        }

        .vowel-item {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 10px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .vowel-item.tappable:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .vowel-item.tappable:active {
            transform: scale(0.95);
            opacity: 0.8;
        }

        .vowel-thai {
            display: block;
            font-size: 1.4em;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .vowel-sound {
            font-size: 0.75em;
            color: var(--text-muted);
        }

        /* Tone Marks Grid */
        .tone-marks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .tone-mark-item {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .tone-mark-thai {
            display: block;
            font-size: 2em;
            color: var(--accent-primary);
            margin-bottom: 6px;
        }

        .tone-mark-name {
            display: block;
            font-size: 0.8em;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .tone-mark-effect {
            font-size: 0.75em;
            color: var(--text-muted);
        }

        /* Writing Practice Section */
        .writing-section {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .writing-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .writing-header h2 {
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .writing-settings {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .writing-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .writing-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px var(--shadow-color);
            margin-bottom: 20px;
        }

        .writing-prompt {
            text-align: center;
            margin-bottom: 20px;
        }

        .writing-english {
            font-size: 1.5em;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .writing-romanization {
            font-size: 1.1em;
            color: var(--accent-primary);
            font-style: italic;
        }

        .writing-input-container {
            margin-bottom: 16px;
        }

        .writing-input {
            width: 100%;
            padding: 16px;
            font-size: 1.5em;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s;
        }

        .writing-input:focus {
            border-color: var(--accent-primary);
        }

        .writing-input.correct {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .writing-input.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .writing-feedback {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .writing-feedback.show {
            display: block;
        }

        .writing-feedback.correct {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .writing-feedback.incorrect {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .writing-answer {
            font-size: 1.3em;
            margin-top: 8px;
        }

        .writing-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .writing-btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .writing-btn-check {
            background: var(--accent-primary);
            color: white;
        }

        .writing-btn-skip {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .writing-btn-next {
            background: #22c55e;
            color: white;
        }

        .writing-score {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .writing-list-selector {
            margin-bottom: 20px;
        }

        /* Reading Practice Section */
        .reading-section {
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
        }

        .reading-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .reading-header h2 {
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .reading-levels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .reading-level-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .reading-level-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .reading-level-card.active {
            border-color: var(--accent-primary);
            background: rgba(74, 144, 226, 0.1);
        }

        .reading-level-icon {
            font-size: 1.8em;
            margin-bottom: 6px;
        }

        .reading-level-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95em;
        }

        .reading-level-desc {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .reading-story-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .reading-story-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .reading-story-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .reading-story-icon {
            font-size: 1.5em;
        }

        .reading-story-info {
            flex: 1;
        }

        .reading-story-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .reading-story-subtitle {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .reading-story-arrow {
            color: var(--text-muted);
        }

        /* Story View */
        .reading-story-container {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px var(--shadow-color);
        }

        .reading-story-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .reading-story-title-main {
            font-size: 1.4em;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .reading-story-title-english {
            font-size: 0.95em;
            color: var(--text-muted);
        }

        .reading-story-text {
            font-size: 1.25em;
            line-height: 2.2;
            color: var(--text-primary);
        }

        .reading-sentence {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .reading-sentence:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .reading-sentence.active {
            background: rgba(74, 144, 226, 0.15);
        }

        .reading-translation-box {
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-primary);
            padding: 12px 16px;
            margin: 16px 0;
            border-radius: 0 8px 8px 0;
            display: none;
        }

        .reading-translation-box.show {
            display: block;
        }

        .reading-translation-thai {
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .reading-translation-roman {
            font-size: 0.9em;
            color: var(--accent-primary);
            font-style: italic;
            margin-bottom: 6px;
        }

        .reading-translation-english {
            font-size: 0.95em;
            color: var(--text-secondary);
        }

        .reading-help-text {
            text-align: center;
            font-size: 0.85em;
            color: var(--text-muted);
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .reading-controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .reading-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .reading-back-btn {
            display: block;
            margin: 20px auto 0;
            padding: 12px 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .reading-back-btn:hover {
            background: var(--bg-card);
        }

        .reading-btn-reveal {
            display: block;
            width: 100%;
            margin-top: 16px;
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reading-btn-reveal:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .reading-btn-reveal.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .reading-full-translation {
            margin-top: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border-left: 4px solid var(--accent-primary);
        }

        .reading-full-translation h4 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1em;
        }

        .reading-full-translation #fullTranslationText {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 0.95em;
        }

        /* Tone Rules Table */
        .tone-rules-table {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
        }

        .tone-rules-header, .tone-rules-row {
            display: grid;
            grid-template-columns: 70px repeat(5, 1fr);
            text-align: center;
        }

        .tone-rules-header {
            background: var(--bg-secondary);
            font-weight: 600;
            font-size: 0.85em;
            color: var(--text-primary);
        }

        .tone-rules-header > div, .tone-rules-row > div {
            padding: 10px 6px;
            border-bottom: 1px solid var(--border-color);
        }

        .tone-rules-row > div {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .tone-rules-row:last-child > div {
            border-bottom: none;
        }

        .tone-rules-row.mid > div:first-child { color: #3b82f6; }
        .tone-rules-row.high > div:first-child { color: #f97316; }
        .tone-rules-row.low > div:first-child { color: #22c55e; }

        /* Alphabet Flashcard Styles */
        .alphabet-flashcard-view {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .alphabet-flashcard-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 280px;
            margin: 0 auto;
            width: 100%;
            max-width: 320px;
        }

        .alphabet-card {
            width: 100%;
            max-width: 280px;
            height: 260px;
            background: var(--card-bg);
            border-radius: 24px;
            cursor: pointer;
            box-shadow: 0 8px 40px var(--shadow-color);
            transition: transform 0.15s ease-out;
            perspective: 1000px;
            transform-style: preserve-3d;
            position: relative;
        }

        .alphabet-card.flipped {
            transform: rotateY(180deg);
        }

        .alphabet-card-front, .alphabet-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 24px;
            padding: 20px;
        }

        .alphabet-card-back {
            transform: rotateY(180deg);
            background: var(--card-bg);
        }

        .alphabet-card-letter {
            font-size: 7em;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .alphabet-card-letter-small {
            font-size: 3.5em;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 8px;
        }

        .alphabet-card-roman {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .alphabet-card-class {
            font-size: 0.85em;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .alphabet-card-class.low { background: rgba(34, 197, 94, 0.2); color: #16a34a; }
        .alphabet-card-class.mid { background: rgba(59, 130, 246, 0.2); color: #2563eb; }
        .alphabet-card-class.high { background: rgba(249, 115, 22, 0.2); color: #ea580c; }

        .alphabet-card-example {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .alphabet-flashcard-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Alphabet Audio Button */
        .alpha-audio-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--bg-secondary);
            border: none;
            cursor: pointer;
            z-index: 20;
            padding: 8px;
            opacity: 0.5;
            transition: all 0.2s;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
        }

        .alpha-audio-btn:hover { 
            opacity: 0.8; 
        }
        
        .alpha-audio-btn:active { 
            transform: scale(1.1); 
        }

        .sorting-audio-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--bg-secondary);
            border: none;
            cursor: pointer;
            z-index: 5;
            padding: 8px;
            opacity: 0.5;
            transition: all 0.2s;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
        }

        .sorting-audio-btn:hover { 
            opacity: 0.8; 
        }
        
        .sorting-audio-btn:active { 
            transform: scale(1.1); 
        }

        .sorting-card {
            position: relative;
        }

        .quiz-audio-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            background: var(--bg-secondary);
            border: none;
            cursor: pointer;
            padding: 6px;
            opacity: 0.5;
            transition: all 0.2s;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            margin-left: 10px;
            color: var(--text-primary);
        }

        .quiz-audio-btn:hover { 
            opacity: 0.8; 
        }
        
        .quiz-audio-btn:active { 
            transform: scale(1.1); 
        }

        .expanded-letter-audio {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--bg-secondary);
            border: none;
            cursor: pointer;
            padding: 4px;
            opacity: 0.5;
            transition: all 0.2s;
            border-radius: 50%;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
        }

        .expanded-letter-audio:hover { 
            opacity: 0.8; 
        }
        
        .expanded-letter-audio:active { 
            transform: scale(1.1); 
        }

        .expanded-letter-item {
            position: relative;
        }

        /* Clock Practice Styles */
        .clock-practice-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            padding: 20px;
        }
        
        .analog-clock {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 4px solid var(--accent-primary);
            position: relative;
            box-shadow: 0 4px 20px var(--shadow-color);
            margin: 0 auto;
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
        }
        
        .analog-clock.clock-correct-glow {
            border-color: var(--success-color);
            box-shadow: 0 0 40px var(--glow-success), 0 0 80px var(--glow-success);
        }
        
        .analog-clock.clock-incorrect-glow {
            border-color: var(--error-color);
            box-shadow: 0 0 40px var(--glow-error), 0 0 80px var(--glow-error);
        }
        
        .clock-face {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .clock-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--accent-primary);
            border-radius: 50%;
            z-index: 10;
        }
        
        .clock-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            border-radius: 4px;
        }
        
        .hour-hand {
            width: 4px;
            height: 50px;
            background: var(--text-primary);
            margin-left: -2px;
        }
        
        .minute-hand {
            width: 3px;
            height: 70px;
            background: var(--accent-primary);
            margin-left: -1.5px;
        }
        
        .clock-tick {
            position: absolute;
            top: 8px;
            left: 50%;
            width: 2px;
            height: 12px;
            background: var(--text-muted);
            transform-origin: center 82px;
        }
        
        .clock-tick.major {
            width: 3px;
            height: 16px;
            background: var(--text-primary);
            transform-origin: center 82px;
        }
        
        .clock-number {
            position: absolute;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .clock-practice-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 16px;
        }
        
        .clock-period-indicator {
            text-align: center;
            padding: 6px 16px;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .clock-time-display {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .clock-hint {
            color: var(--text-secondary);
            font-size: 0.95em;
            margin-bottom: 8px;
        }
        
        .clock-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
            max-width: 350px;
        }
        
        .clock-option {
            padding: 16px 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .clock-option:hover {
            border-color: var(--accent-primary);
            background: var(--bg-card);
        }
        
        .clock-option.selected {
            border-color: var(--accent-primary);
            background: var(--bg-card);
        }
        
        .clock-option.correct {
            border-color: var(--success-color);
            background: var(--glow-success);
        }
        
        .clock-option.incorrect {
            border-color: var(--error-color);
            background: var(--glow-error);
        }
        
        .clock-option.correct-answer {
            border-color: var(--success-color);
            border-width: 3px;
        }
        
        .clock-option-thai {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .clock-option-roman {
            font-size: 0.85em;
            color: var(--text-secondary);
        }
        
        .clock-score {
            font-size: 0.95em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .clock-feedback {
            text-align: center;
            padding: 12px 20px;
            border-radius: 12px;
            margin-top: 8px;
            font-weight: 500;
        }
        
        .clock-feedback.correct {
            background: rgba(16, 185, 129, 0.15);
            color: #065f46;
        }
        
        .clock-feedback.incorrect {
            background: rgba(239, 68, 68, 0.15);
            color: #991b1b;
        }
        
        [data-theme="dark"] .clock-feedback.correct {
            color: #34d399;
        }
        
        [data-theme="dark"] .clock-feedback.incorrect {
            color: #fca5a5;
        }
        
        .clock-hint {
            font-size: 0.85em;
            color: var(--text-muted);
            text-align: center;
            margin-top: 4px;
        }
        
        .clock-next-btn {
            margin-top: 16px;
        }
        
        .tap-to-continue {
            margin-top: 16px;
            font-size: 0.85em;
            color: var(--text-muted);
            text-align: center;
            animation: pulse-fade 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-fade {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .clock-practice-container.tap-to-advance {
            cursor: pointer;
        }
        
        /* Interactive Time Period List Styles */
        .time-periods-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .time-period-item {
            display: flex;
            flex-direction: column;
        }
        
        .time-period-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .time-period-row:hover {
            background: var(--bg-card);
        }
        
        .time-period-row.selected {
            background: var(--bg-card);
            border-radius: 10px 10px 0 0;
        }
        
        .time-period-row-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-period-row-emoji {
            font-size: 1.3em;
        }
        
        .time-period-row-hours {
            font-size: 0.95em;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .time-period-row-thai {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .time-period-detail {
            background: var(--bg-card);
            padding: 14px 16px;
            border-left: 4px solid;
            border-radius: 0 0 10px 10px;
            margin-top: -2px;
            animation: slideDown 0.2s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 300px; }
        }
        
        .time-period-pattern {
            font-size: 0.95em;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .time-period-examples {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .time-period-memory {
            font-size: 0.9em;
            color: var(--accent-primary);
            line-height: 1.5;
        }
        
        .time-period-note {
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--error-color);
            font-weight: 500;
        }

        .practice-correct-answer {
            margin-top: 12px;
            font-size: 1.2em;
            color: var(--text-primary);
        }

        .practice-nav {
            margin-top: 20px;
            text-align: center;
            position: sticky;
            bottom: 10px;
            background: var(--bg-primary);
            padding: 10px 0;
        }

        .practice-nav .btn-action {
            min-width: 200px;
        }
        
        .practice-result.clickable {
            cursor: pointer;
        }
        
        .practice-result .tap-hint {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 8px;
        }

        .practice-complete {
            text-align: center;
            padding: 40px 20px;
        }

        .practice-complete-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .practice-complete-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .practice-complete-score {
            font-size: 2em;
            color: var(--accent-primary);
            font-weight: 700;
            margin-bottom: 20px;
        }

        .practice-complete-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Romanization text */
        .romanization {
            font-size: 0.45em;
            color: var(--text-muted);
            margin-top: 8px;
            font-style: italic;
            font-family: 'Nunito', sans-serif;
            letter-spacing: 0.5px;
        }

        .card-back .romanization {
            color: rgba(255, 255, 255, 0.6);
        }

        .action-btn { width: 100%; margin-bottom: 10px; }

        .resume-modal-content { text-align: center; }

        .resume-modal-content p {
            margin-bottom: 20px;
            color: var(--text-secondary);
            font-size: 1em;
            line-height: 1.5;
        }

        .resume-modal-content .session-info {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 14px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .resume-modal-content .session-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .resume-modal-content .session-info-item:last-child { margin-bottom: 0; }
        .resume-modal-content .session-info-label { color: var(--text-secondary); }
        .resume-modal-content .session-info-value { font-weight: 600; color: var(--text-primary); }

        .resume-buttons { display: flex; gap: 10px; }
        .resume-buttons button { flex: 1; }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--text-primary);
            color: var(--bg-primary);
            padding: 14px 28px;
            border-radius: 14px;
            font-size: 0.95em;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            box-shadow: 0 10px 40px var(--shadow-strong);
        }

        .toast.show { 
            opacity: 1; 
            transform: translateX(-50%) translateY(0);
        }

        /* Success/error toast variants */
        .toast.success {
            background: var(--success-color);
            color: white;
        }

        .toast.error {
            background: var(--error-color);
            color: white;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .empty-state-title {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 0.95em;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .favorite-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--bg-secondary);
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 15;
            padding: 8px;
            opacity: 0.7;
            transition: all 0.2s;
            flex: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .favorite-btn:active { transform: scale(1.15); }
        .favorite-btn.active { 
            opacity: 1; 
            background: #fef3c7;
        }

        [data-theme="dark"] .favorite-btn.active {
            background: #3f3f46;
        }

        .audio-btn {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: var(--bg-secondary);
            border: none;
            font-size: 1.1em;
            cursor: pointer;
            z-index: 15;
            padding: 8px;
            opacity: 0.5;
            transition: all 0.2s;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .audio-btn:hover { opacity: 0.8; }
        .audio-btn:active { transform: scale(1.1); }
        .audio-btn.speaking {
            opacity: 1;
            background: var(--accent-primary);
            animation: pulse-audio 0.8s ease-in-out infinite;
        }

        @keyframes pulse-audio {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { padding: 0; }
            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
            .vocab-list-item {
                padding: 8px 10px;
                gap: 8px;
            }
            .vocab-thai {
                font-size: 1em;
                min-width: 50px;
            }
            .vocab-english {
                font-size: 0.85em;
                min-width: 80px;
            }
            .modal-content {
                padding: 15px;
                border-radius: 16px;
            }
            .modal-header h2 {
                font-size: 1.2em;
            }
        }

        @media (max-width: 360px) {
            body { padding: 8px; }
            .vocab-list-item {
                padding: 6px 8px;
                gap: 6px;
            }
            .vocab-thai {
                font-size: 0.95em;
            }
            .vocab-english {
                font-size: 0.8em;
            }
            .modal {
                padding: 10px;
            }
            .modal-content {
                padding: 12px;
                border-radius: 12px;
            }
        }

        @media (max-height: 600px) {
            .modal-content {
                max-height: calc(100vh - 20px);
                max-height: calc(100dvh - 20px);
            }
            .vocab-list-modal-content {
                max-height: calc(100vh - 20px);
                max-height: calc(100dvh - 20px);
            }
        }
    </style>
</head>
<body>
    <!-- Main Menu Screen -->
    <div class="main-menu" id="mainMenu">
        <div class="main-menu-content">
            <div class="main-menu-header">
                <div class="main-menu-icon"><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAQABAADASIAAhEBAxEB/8QAHQABAAAHAQEAAAAAAAAAAAAAAAIDBAUGBwgBCf/EAFoQAQABAwIDBAMJBw8KBAYDAAABAgMEBREGEiEHMUFRE2FxCBQiMkKBkaGxM1JicnSywRUWIyQ1NjdTc3Wis8LR4SUmJ0NUY4KDkvAXRGRlRVWEk6PShZXx/8QAGwEBAAIDAQEAAAAAAAAAAAAAAAECAwUGBAf/xAAzEQEAAgIBAwIFAgUEAgMAAAAAAQIDEQQFITESQRMiMlFxFDMjYYGR8AZCUqEksTTR8f/aAAwDAQACEQMRAD8A7FAVWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//2Q==" alt="Learn Thai" /></div>
                <h1>Learn Thai</h1>
                <p class="main-menu-subtitle">Master Thai vocabulary, grammar, and the alphabet</p>
            </div>
            
            <div class="main-menu-options">
                <div class="main-menu-card" onclick="startApp('flashcards')">
                    <div class="main-menu-card-icon"></div>
                    <div class="main-menu-card-title">Vocab Builder</div>
                    <div class="main-menu-card-desc">Learn 840+ words with spaced repetition flashcards</div>
                </div>
                
                <div class="main-menu-card" onclick="startApp('writing')">
                    <div class="main-menu-card-icon"></div>
                    <div class="main-menu-card-title">Writing Practice</div>
                    <div class="main-menu-card-desc">Type Thai words from English prompts</div>
                </div>
                
                <div class="main-menu-card" onclick="startApp('reading')">
                    <div class="main-menu-card-icon"></div>
                    <div class="main-menu-card-title">Reading Practice</div>
                    <div class="main-menu-card-desc">Read stories at beginner to advanced levels</div>
                </div>
                
                <div class="main-menu-card" onclick="startApp('grammar')">
                    <div class="main-menu-card-icon"></div>
                    <div class="main-menu-card-title">Lessons</div>
                    <div class="main-menu-card-desc">20 interactive grammar and culture lessons</div>
                </div>
                
                <div class="main-menu-card" onclick="startApp('alphabet')">
                    <div class="main-menu-card-icon"></div>
                    <div class="main-menu-card-title">Alphabet Trainer</div>
                    <div class="main-menu-card-desc">Master 44 consonants with flashcards and games</div>
                </div>
            </div>
            
            <div class="main-menu-footer">
                <button class="main-menu-skip" onclick="startApp('flashcards')">Continue to app </button>
            </div>
        </div>
    </div>

    <!-- Theme toggle button -->
    <button class="theme-toggle" id="themeToggle" title="Toggle dark mode"></button>
    
    <!-- Back to menu button -->
    <button class="back-to-menu" id="backToMenu" title="Back to menu" style="display: none;" onclick="showMainMenu()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5"></path>
            <path d="M12 19l-7-7 7-7"></path>
        </svg>
    </button>
    
    <div class="container" id="appContainer" style="display: none;">
        <div class="header">
            <div class="header-icon"><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAQABAADASIAAhEBAxEB/8QAHQABAAAHAQEAAAAAAAAAAAAAAAIDBAUGBwgBCf/EAFoQAQABAwIDBAMJBw8KBAYDAAABAgMEBREGEiEHMUFRE2FxCBQiMkKBkaGxM1JicnSywRUWIyQ1NjdTc3Wis8LR4SUmJ0NUY4KDkvAXRGRlRVWEk6PShZXx/8QAGwEBAAIDAQEAAAAAAAAAAAAAAAECAwUGBAf/xAAzEQEAAgIBAwIFAgUEAgMAAAAAAQIDEQQFITESQRMiMlFxFDMjYYGR8AZCUqEksTTR8f/aAAwDAQACEQMRAD8A7FAVWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//2Q==" alt="Learn Thai" /></div>
            <h1>Thai Vocabulary</h1>
        </div>
        <p class="subtitle">Tap to flip  Swipe right for   Swipe left for </p>

        <div class="list-selector-container">
            <select class="list-selector" id="listSelector">
                <option value="0">List 1: Core Vocabulary (200 words)</option>
            </select>
            <div id="listProgressDisplay" style="text-align: center; margin-top: 8px; font-size: 0.9em; color: var(--text-primary); font-weight: 500;"></div>
        </div>

        <div class="app-mode-toggle">
            <button class="app-mode-btn active" data-appmode="flashcards"> Vocab</button>
            <button class="app-mode-btn" data-appmode="grammar"> Lessons</button>
            <button class="app-mode-btn" data-appmode="alphabet"> Alphabet</button>
        </div>

        <div class="top-controls">
            <button class="options-btn" id="optionsBtn"></button>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" data-mode="all">All Cards</button>
            <button class="mode-btn" data-mode="review">To Review</button>
        </div>

        <div class="progress-container">
            <div class="progress-info">
                <span id="cardCounter">Card 1 of 200</span>
                <span id="progressPercent">1%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-milestones" id="progressMilestones">
                <div class="milestone" data-percent="0"></div>
                <div class="milestone" data-percent="25"></div>
                <div class="milestone" data-percent="50"></div>
                <div class="milestone" data-percent="75"></div>
                <div class="milestone" data-percent="100"></div>
            </div>
        </div>

        <div class="card-container">
            <button class="favorite-btn" id="favoriteBtn" title="Add to favorites"></button>
            <button class="audio-btn" id="audioBtn" title="Listen to pronunciation">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                </svg>
            </button>
            <div class="swipe-bar left" id="swipeBarLeft"></div>
            <div class="swipe-bar right" id="swipeBarRight"></div>
            <div class="swipe-hint left" id="swipeLeft"></div>
            <div class="swipe-hint right" id="swipeRight"></div>
            <div class="card" id="flashcard">
                <div class="card-face card-front">
                    <div class="mastery-indicator" id="masteryIndicator">New</div>
                    <div class="card-text" id="frontText"></div>
                    <div class="romanization" id="frontRomanization"></div>
                </div>
                <div class="card-face card-back">
                    <div class="card-text" id="backText"></div>
                    <div class="romanization" id="backRomanization"></div>
                </div>
            </div>
        </div>

        <div class="score-display">
            <span class="score-correct score-number" id="correctScore">0</span> correct  
            <span class="score-incorrect score-number" id="incorrectScore">0</span> incorrect
        </div>

        <div class="controls">
            <button class="btn-nav" id="prevBtn"> Prev</button>
            <button class="btn-flip" id="flipBtn">Flip</button>
            <button class="btn-nav" id="nextBtn">Next </button>
        </div>

        <div class="action-controls">
            <button class="btn-action" id="sentenceBtn"> Example</button>
        </div>

        <div class="sentence-example" id="sentenceExample">
            <div class="sentence-thai" id="sentenceThai"></div>
            <div class="sentence-roman" id="sentenceRoman"></div>
            <div class="sentence-english" id="sentenceEnglish"></div>
            <button class="sentence-speak-btn" id="sentenceSpeakBtn"></button>
        </div>

        <!-- Grammar Lessons Section -->
        <div class="grammar-section" id="grammarSection" style="display: none;">
            <div class="grammar-header">
                <h2>Thai Lessons</h2>
                <p class="grammar-subtitle">Learn sentence structures through examples and practice</p>
            </div>
            
            <div class="grammar-lessons-list" id="grammarLessonsList">
                <!-- Lessons will be populated by JS -->
            </div>
            
            <!-- Active Lesson View -->
            <div class="grammar-lesson-view" id="grammarLessonView" style="display: none;">
                <button class="grammar-back-btn" id="grammarBackBtn"> Back to Lessons</button>
                
                <div class="lesson-content" id="lessonContent">
                    <!-- Lesson content populated by JS -->
                </div>
                
                <div class="lesson-nav">
                    <button class="btn-nav" id="lessonPrevBtn"> Previous</button>
                    <span class="lesson-progress" id="lessonProgress">1 / 4</span>
                    <button class="btn-nav" id="lessonNextBtn">Next </button>
                </div>
            </div>
            
            <!-- Practice Mode View -->
            <div class="grammar-practice-view" id="grammarPracticeView" style="display: none;">
                <div class="practice-header">
                    <button class="grammar-back-btn" id="practiceBackBtn"> Back</button>
                    <div class="practice-title">Build Sentences</div>
                    <div class="practice-score" id="practiceScore">0 / 0</div>
                </div>
                
                <div class="practice-content" id="practiceContent">
                    <!-- Practice content populated by JS -->
                </div>
                
                <div class="practice-nav">
                    <button class="btn-action" id="practiceNextBtn">Next Question </button>
                </div>
            </div>
        </div>

        <!-- Alphabet Training Section -->
        <div class="alphabet-section" id="alphabetSection" style="display: none;">
            <div class="alphabet-header">
                <h2>Thai Alphabet</h2>
                <p class="alphabet-subtitle">Learn Thai consonants, vowels, and tone rules</p>
            </div>
            
            <!-- Alphabet Mode Selection -->
            <div class="alphabet-modes" id="alphabetModes">
                <div class="alphabet-mode-card" onclick="startAlphabetMode('recognize')">
                    <div class="alphabet-mode-icon"></div>
                    <div class="alphabet-mode-title">Recognition</div>
                    <div class="alphabet-mode-desc">See letter  pick the sound</div>
                </div>
                <div class="alphabet-mode-card" onclick="startAlphabetFlashcards()">
                    <div class="alphabet-mode-icon"></div>
                    <div class="alphabet-mode-title">Flashcards</div>
                    <div class="alphabet-mode-desc">Swipe to learn letters</div>
                </div>
                <div class="alphabet-mode-card" onclick="startClassSorting()">
                    <div class="alphabet-mode-icon"></div>
                    <div class="alphabet-mode-title">Tone Class</div>
                    <div class="alphabet-mode-desc">Sort into Low/Mid/High</div>
                </div>
                <div class="alphabet-mode-card" onclick="showAlphabetChart()">
                    <div class="alphabet-mode-icon"></div>
                    <div class="alphabet-mode-title">Reference</div>
                    <div class="alphabet-mode-desc">View full alphabet chart</div>
                </div>
            </div>
            
            <!-- Alphabet Progress Overview -->
            <div class="alphabet-progress-overview" id="alphabetProgressOverview">
                <h3>Your Progress</h3>
                <div class="alphabet-progress-stats">
                    <div class="alphabet-stat">
                        <span class="alphabet-stat-num" id="consonantsMastered">0</span>
                        <span class="alphabet-stat-label">/ 44 Consonants</span>
                    </div>
                </div>
            </div>
            
            <!-- Alphabet Flashcard View -->
            <div class="alphabet-flashcard-view" id="alphabetFlashcardView" style="display: none;">
                <div class="alphabet-practice-header">
                    <button class="grammar-back-btn" id="alphabetFlashcardBackBtn"> Back</button>
                    <div class="alphabet-practice-mode">Flashcards</div>
                    <div class="alphabet-practice-score" id="alphabetFlashcardScore">0 / 44</div>
                </div>
                
                <p class="subtitle" style="margin: 10px 0;">Tap to flip  Swipe right for   Swipe left for </p>
                
                <div class="alphabet-flashcard-wrapper">
                    <div class="swipe-bar left" id="alphaSwipeBarLeft"></div>
                    <div class="swipe-bar right" id="alphaSwipeBarRight"></div>
                    <div class="swipe-hint left" id="alphaSwipeLeft"></div>
                    <div class="swipe-hint right" id="alphaSwipeRight"></div>
                    <div class="alphabet-card" id="alphabetCard">
                        <button class="alpha-audio-btn" id="alphaFlashcardAudioBtn" onclick="event.stopPropagation(); speakCurrentAlphabetCard()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                            </svg>
                        </button>
                        <div class="alphabet-card-front" id="alphabetCardFront">
                            <div class="alphabet-card-letter" id="alphabetCardLetter"></div>
                        </div>
                        <div class="alphabet-card-back" id="alphabetCardBack">
                            <div class="alphabet-card-letter-small" id="alphabetCardLetterBack"></div>
                            <div class="alphabet-card-roman" id="alphabetCardRoman">g gi</div>
                            <div class="alphabet-card-class" id="alphabetCardClass">Mid Class</div>
                            <div class="alphabet-card-example" id="alphabetCardExample"> (chicken)</div>
                        </div>
                    </div>
                </div>
                
                <div class="score-display">
                    <span class="score-correct score-number" id="alphaCorrectScore">0</span> correct  
                    <span class="score-incorrect score-number" id="alphaIncorrectScore">0</span> incorrect
                </div>
                
                <div class="alphabet-flashcard-nav">
                    <button class="btn-nav" onclick="prevAlphabetFlashcard()"> Prev</button>
                    <span id="alphabetFlashcardCounter">1 / 44</span>
                    <button class="btn-nav" onclick="nextAlphabetFlashcard()">Next </button>
                </div>
            </div>
            
            <!-- Alphabet Practice View -->
            <div class="alphabet-practice-view" id="alphabetPracticeView" style="display: none;">
                <div class="alphabet-practice-header">
                    <button class="grammar-back-btn" id="alphabetBackBtn"> Back</button>
                    <div class="alphabet-practice-mode" id="alphabetPracticeMode">Recognition</div>
                    <div class="alphabet-practice-score" id="alphabetScore">0 / 0</div>
                </div>
                
                <div class="alphabet-practice-content" id="alphabetPracticeContent">
                    <!-- Practice content populated by JS -->
                </div>
            </div>
            
            <!-- Class Sorting View -->
            <div class="class-sorting-view" id="classSortingView" style="display: none;">
                <div class="alphabet-practice-header">
                    <button class="grammar-back-btn" id="classSortingBackBtn"> Back</button>
                    <div class="alphabet-practice-mode">Sort by Class</div>
                    <div class="alphabet-practice-score" id="classSortingRemaining">44 left</div>
                </div>
                
                <div class="sorting-card-area">
                    <div class="sorting-card" id="sortingCard">
                        <button class="sorting-audio-btn" onclick="event.stopPropagation(); speakCurrentSortingCard()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                            </svg>
                        </button>
                        <div class="sorting-card-letter" id="sortingCardLetter"></div>
                        <div class="sorting-card-roman" id="sortingCardRoman">g gi</div>
                    </div>
                    <div class="sorting-instruction">Tap the correct class bin</div>
                </div>
                
                <div class="class-bins">
                    <div class="class-bin low" onclick="sortToClass('low')">
                        <div class="class-bin-header">
                            <span class="class-bin-label">Low</span>
                            <div class="class-bin-header-right">
                                <span class="class-bin-count" id="lowBinCount">0</span>
                                <button class="class-bin-view-btn" onclick="event.stopPropagation(); expandBin('low')" title="View sorted"></button>
                            </div>
                        </div>
                        <div class="class-bin-letters" id="lowBinLetters"></div>
                    </div>
                    <div class="class-bin mid" onclick="sortToClass('mid')">
                        <div class="class-bin-header">
                            <span class="class-bin-label">Mid</span>
                            <div class="class-bin-header-right">
                                <span class="class-bin-count" id="midBinCount">0</span>
                                <button class="class-bin-view-btn" onclick="event.stopPropagation(); expandBin('mid')" title="View sorted"></button>
                            </div>
                        </div>
                        <div class="class-bin-letters" id="midBinLetters"></div>
                    </div>
                    <div class="class-bin high" onclick="sortToClass('high')">
                        <div class="class-bin-header">
                            <span class="class-bin-label">High</span>
                            <div class="class-bin-header-right">
                                <span class="class-bin-count" id="highBinCount">0</span>
                                <button class="class-bin-view-btn" onclick="event.stopPropagation(); expandBin('high')" title="View sorted"></button>
                            </div>
                        </div>
                        <div class="class-bin-letters" id="highBinLetters"></div>
                    </div>
                </div>
                
                <div class="class-bin-expanded" id="classBinExpanded" style="display: none;">
                    <div class="class-bin-expanded-header">
                        <span id="expandedBinTitle">Low Class</span>
                        <button class="close-btn" onclick="closeExpandedBin()"></button>
                    </div>
                    <div class="class-bin-expanded-content" id="expandedBinContent"></div>
                </div>
            </div>
            
            <!-- Alphabet Chart View -->
            <div class="alphabet-chart-view" id="alphabetChartView" style="display: none;">
                <button class="grammar-back-btn" id="alphabetChartBackBtn"> Back</button>
                <div class="alphabet-chart-content" id="alphabetChartContent">
                    <!-- Chart populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Writing Practice Section -->
    <div class="writing-section" id="writingSection" style="display: none;">
        <div class="writing-header">
            <h2> Writing Practice</h2>
            <p style="color: var(--text-muted);">Type the Thai word for the English prompt</p>
        </div>
        
        <div class="writing-list-selector">
            <select class="list-selector" id="writingListSelector" style="width: 100%;">
                <option value="0">All Vocabulary</option>
            </select>
        </div>
        
        <div class="writing-settings">
            <label class="writing-toggle">
                <input type="checkbox" id="writingShowRomanization" checked>
                <span>Show romanization hint</span>
            </label>
        </div>
        
        <div class="writing-card">
            <div class="writing-prompt">
                <div class="writing-english" id="writingEnglish">Loading...</div>
                <div class="writing-romanization" id="writingRomanization"></div>
            </div>
            
            <div class="writing-input-container">
                <input type="text" class="writing-input" id="writingInput" placeholder="..." autocomplete="off">
            </div>
            
            <div class="writing-feedback" id="writingFeedback">
                <div id="writingFeedbackText"></div>
                <div class="writing-answer" id="writingCorrectAnswer"></div>
            </div>
            
            <div class="writing-controls">
                <button class="writing-btn writing-btn-skip" id="writingSkipBtn">Skip</button>
                <button class="writing-btn writing-btn-check" id="writingCheckBtn">Check</button>
                <button class="writing-btn writing-btn-next" id="writingNextBtn" style="display: none;">Next </button>
            </div>
        </div>
        
        <div class="writing-score">
            Score: <span id="writingCorrect">0</span> / <span id="writingTotal">0</span>
        </div>
    </div>

    <!-- Reading Practice Section -->
    <div class="reading-section" id="readingSection" style="display: none;">
        <div class="reading-header">
            <h2> Reading Practice</h2>
            <p style="color: var(--text-muted);">Click any sentence to see its translation</p>
        </div>
        
        <div id="readingLevelSelect">
            <div class="reading-levels">
                <div class="reading-level-card active" data-level="beginner" onclick="selectReadingLevel('beginner', this)">
                    <div class="reading-level-icon"></div>
                    <div class="reading-level-title">Beginner</div>
                    <div class="reading-level-desc">Spaced words</div>
                </div>
                <div class="reading-level-card" data-level="intermediate" onclick="selectReadingLevel('intermediate', this)">
                    <div class="reading-level-icon"></div>
                    <div class="reading-level-title">Intermediate</div>
                    <div class="reading-level-desc">Spaced words</div>
                </div>
                <div class="reading-level-card" data-level="advanced" onclick="selectReadingLevel('advanced', this)">
                    <div class="reading-level-icon"></div>
                    <div class="reading-level-title">Advanced</div>
                    <div class="reading-level-desc">Natural text</div>
                </div>
            </div>
            
            <div class="reading-story-list" id="readingStoryList">
                <!-- Stories populated by JS -->
            </div>
        </div>
        
        <div id="readingStoryView" style="display: none;">
            <div class="reading-story-container">
                <div class="reading-story-header">
                    <div class="reading-story-title-main" id="storyTitleThai"></div>
                    <div class="reading-story-title-english" id="storyTitleEnglish"></div>
                </div>
                
                <div class="reading-story-text" id="readingStoryText">
                    <!-- Story text populated by JS -->
                </div>
                
                <div class="reading-translation-box" id="readingTranslationBox">
                    <div class="reading-translation-thai" id="transBoxThai"></div>
                    <div class="reading-translation-roman" id="transBoxRoman"></div>
                    <div class="reading-translation-english" id="transBoxEnglish"></div>
                </div>
                
                <div class="reading-help-text">
                     Click any sentence to see romanization and translation
                </div>
                
                <button class="reading-btn-reveal" id="revealStoryBtn" onclick="toggleRevealStory()"> Reveal Full Translation</button>
                
                <div class="reading-full-translation" id="readingFullTranslation" style="display: none;">
                    <h4>Full English Translation</h4>
                    <div id="fullTranslationText"></div>
                </div>
            </div>
            
            <button class="reading-back-btn" onclick="backToStoryList()"> Back to Stories</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" id="closeSettings"></button>
            </div>
            <div class="modal-section">
                <h3>Import Flashcards</h3>
                <div class="file-input-wrapper">
                    <input type="file" id="csvFileInput" accept=".csv" />
                    <label for="csvFileInput" class="file-input-label"> Choose CSV File</label>
                </div>
                <div class="import-info">CSV format: First column = Thai, Second column = English (with header row)</div>
            </div>
            <div class="modal-section">
                <h3>Data Management</h3>
                <button class="btn-action action-btn" id="exportBtn" onclick="exportProgress()"> Export Progress</button>
                <button class="btn-action action-btn" id="resetBtn" onclick="resetProgress()"> Reset All Progress</button>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Statistics</h2>
                <button class="close-btn" id="closeStats"></button>
            </div>
            <div class="modal-section">
                <h3>Current List Progress</h3>
                <div id="currentListStats"></div>
            </div>
            <div class="modal-section">
                <h3>All Lists</h3>
                <div id="allListsStats"></div>
            </div>
            <div class="modal-section">
                <h3>Session Stats</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="sessionCorrect">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="sessionIncorrect">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                </div>
            </div>
            <div class="modal-section" style="font-size: 0.85em; color: var(--text-secondary); line-height: 1.5;">
                <strong>Learning Algorithm:</strong> A word is marked as "learned" after getting it correct 3 times in a row. If not reviewed within 7 days, it needs to be relearned.
            </div>
        </div>
    </div>

    <!-- Resume Modal -->
    <div class="modal" id="resumeModal">
        <div class="modal-content resume-modal-content">
            <div class="modal-header" style="justify-content: center;">
                <h2>Session in Progress</h2>
            </div>
            <p>You have an unfinished session. Would you like to resume or start fresh?</p>
            <div class="session-info" id="sessionInfoDisplay">
                <div class="session-info-item">
                    <span class="session-info-label">List:</span>
                    <span class="session-info-value" id="resumeListName">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Progress:</span>
                    <span class="session-info-value" id="resumeProgress">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Correct:</span>
                    <span class="session-info-value score-correct" id="resumeCorrect">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Incorrect:</span>
                    <span class="session-info-value score-incorrect" id="resumeIncorrect">-</span>
                </div>
            </div>
            <div class="resume-buttons">
                <button class="btn-action" id="startFreshBtn" onclick="document.getElementById('resumeModal').classList.remove('open'); startFresh();">Start Fresh</button>
                <button class="btn-flip" id="resumeSessionBtn" onclick="document.getElementById('resumeModal').classList.remove('open'); resumeSession();">Resume</button>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="modal" id="completionModal">
        <div class="modal-content resume-modal-content">
            <div class="modal-header">
                <h2> List Complete!</h2>
                <button class="close-btn" id="closeCompletion"></button>
            </div>
            <p>Great job! You've finished all the cards in this list.</p>
            <div class="session-info">
                <div class="session-info-item">
                    <span class="session-info-label">Cards reviewed:</span>
                    <span class="session-info-value" id="completionTotal">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Correct:</span>
                    <span class="session-info-value score-correct" id="completionCorrect">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Incorrect:</span>
                    <span class="session-info-value score-incorrect" id="completionIncorrect">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Accuracy:</span>
                    <span class="session-info-value" id="completionAccuracy">-</span>
                </div>
            </div>
            <div class="resume-buttons" style="flex-direction: column; gap: 10px;">
                <button class="btn-flip" id="restartListBtn"> Start Again</button>
                <button class="btn-action" id="reviewHardestBtn"> Review Hardest Cards</button>
            </div>
        </div>
    </div>

    <!-- Options Panel -->
    <div class="modal" id="optionsModal">
        <div class="modal-content options-modal-content">
            <div class="modal-header">
                <h2>Menu</h2>
                <button class="close-btn" id="closeOptions"></button>
            </div>
            
            <!-- Study Settings Section -->
            <div class="menu-section">
                <div class="menu-section-title">Study Settings</div>
                
                <div class="option-group">
                    <div class="option-label">List Organization</div>
                    <div class="option-toggle-group">
                        <button class="option-toggle-btn active" data-view="themed">Themed</button>
                        <button class="option-toggle-btn" data-view="mixed">Mixed</button>
                    </div>
                </div>
                
                <div class="option-group" id="mixedListSizeGroup" style="display: none;">
                    <div class="option-label">Cards per Mixed List</div>
                    <div class="mixed-list-size-row">
                        <input type="number" id="mixedListSizeInput" class="mixed-list-size-input" min="10" max="500" value="200">
                        <button class="btn-reshuffle" id="reshuffleMixedBtn"> Reshuffle</button>
                    </div>
                    <div class="option-hint">Enter a number and click Reshuffle to reorganize mixed lists</div>
                </div>
                
                <div class="option-group">
                    <div class="option-label">Card Direction</div>
                    <div class="option-toggle-group">
                        <button class="option-toggle-btn active" data-direction="thai">Thai  English</button>
                        <button class="option-toggle-btn" data-direction="english">English  Thai</button>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-row">
                        <div class="option-label">Show Romanization</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="romanizationToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-row">
                        <div class="option-label">Auto-play Audio</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoPlayToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-row">
                        <div class="option-label">Dark Mode</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions Section -->
            <div class="menu-section">
                <div class="menu-section-title">Quick Actions</div>
                
                <div class="option-group">
                    <button class="menu-btn" id="viewVocabListBtn"> View Vocabulary List</button>
                </div>
                
                <div class="option-group">
                    <button class="menu-btn" id="viewStatsBtn"> View Progress & Stats</button>
                </div>
                
                <div class="option-group">
                    <button class="menu-btn" id="importExportBtn"> Import / Export Data</button>
                </div>
                
                <div class="option-group">
                    <button type="button" class="menu-btn menu-btn-danger" id="restoreDefaultsBtn"> Restore Default Settings</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Vocab List Modal -->
    <div class="modal" id="vocabListModal">
        <div class="modal-content vocab-list-modal-content">
            <div class="modal-header">
                <h2>Vocabulary List</h2>
                <button class="close-btn" id="closeVocabList"></button>
            </div>
            <div class="vocab-list-controls">
                <select id="vocabListFilter" class="list-selector" style="margin-bottom: 10px;">
                    <option value="all">All Words</option>
                    <option value="current">Current List</option>
                </select>
            </div>
            <div class="vocab-list-container" id="vocabListContainer"></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Reset Confirmation Modal -->
    <div class="modal" id="resetConfirmModal">
        <div class="modal-content" style="max-width: 340px; text-align: center;">
            <div style="font-size: 3em; margin-bottom: 16px;"></div>
            <h2 style="margin-bottom: 12px; color: #dc2626;">Complete Reset</h2>
            <p style="margin-bottom: 20px; color: var(--text-secondary); line-height: 1.5;">
                This will erase <strong>all</strong> learning progress, favorites, and settings.<br><br>
                <strong>This cannot be undone.</strong>
            </p>
            <div style="display: flex; gap: 12px;">
                <button class="btn-secondary" id="cancelResetBtn" style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-weight: 600; cursor: pointer;">Cancel</button>
                <button class="btn-danger" id="confirmResetBtn" style="flex: 1; padding: 12px; border-radius: 8px; border: none; background: #dc2626; color: white; font-weight: 600; cursor: pointer;">Reset Everything</button>
            </div>
        </div>
    </div>

    <script>
        // App settings
        let showRomanization = localStorage.getItem('thaiFlashcardsRomanization') === 'true';
        let smartReviewMode = localStorage.getItem('thaiFlashcardsSmartReview') === 'true';
        
        // Romanization lookup table (Thai to phonetic)
        const romanization = {
            // Animals & Nature
            "": "ma", "": "maew", "": "nk", "": "bplaa", "": "chang",
            "": "ling", "": "nguu", "": "wua", "": "mu", "": "gi",
            "": "bpt", "": "gp", "": "yung", "": "mt", "": "pi-sa",
            "": "dtn-mai", "": "dk-mai", "": "bai-mai", "": "ya",
            "": "bpa", "": "puu-ko", "": "me-nam", "": "t-lee",
            "": "g", "": "hat", "": "nam-dtk",
            
            // Food & Drinks
            "": "kao", "": "ki", "": "nom", "": "k-nm-bpang",
            "": "na", "": "gng", "": "bpuu", "": "mk",
            "": "pn-l-mai", "": "pk", "": "m-mang", "": "glay",
            "": "sm", "": "dtaeng-moo", "": "-ngn", "": "mang-kt",
            "": "t-rian", "": "lam-yai", "": "m-naao", "": "m-ka-tet",
            "": "dtaeng-gwaa", "": "g-lm", "": "kae-rt",
            "": "prk", "": "gr-tiam", "": "ha-hm",
            "": "gla", "": "nam-dtaan", "": "nam", "": "chaa",
            "": "gaa-fae", "": "bia", "": "lo", "": "nam-pn-l-mai",
            "": "nam-bplo", "": "nam-keng",
            
            // Cooking & Taste
            "": "tam-aa-han", "": "tt", "": "dtm", "": "nng",
            "": "yang", "": "p", "": "p-sm", "": "hn", "": "bprung",
            "": "san-p-sm", "": "sut", "": "wt-t-dp",
            "": "krang-tet", "": "krang-bprung",
            "": "rt-chat", "": "pt", "": "wan", "": "bprao",
            "": "kem", "": "km", "": "jt", "": "-ri",
            "": "mn", "": "hm", "": "grp", "": "nm",
            "": "keng", "": "nao", "": "st-mi", "": "sa",
            
            // Family & People
            "": "p", "": "me", "": "pi", "": "nng",
            "": "luk", "": "luk-chaai", "": "luk-sao",
            "": "bpu", "": "ya", "": "dtaa", "": "yaai",
            "": "lung", "": "bpa", "": "na", "": "aa",
            "": "sa-mii", "": "pan-r-yaa", "": "faen",
            "": "pan", "": "pan-ban", "": "kruu",
            "": "nk-rian", "": "m", "": "p-yaa-baan",
            "": "p-nk-ngaan", "": "jo-naai", "": "luk-ka",
            "": "pi-chaai", "": "pi-sao", "": "nng-chaai",
            "": "nng-sao", "": "bpu-ya", "": "dtaa-yaai",
            "": "lan", "": "pr",
            
            // Body & Health
            "": "ha", "": "pm", "": "na", "": "dtaa", "": "hu",
            "": "j-muk", "": "bpak", "": "fan", "": "ln",
            "": "k", "": "li", "": "ken", "": "m", "": "nu",
            "": "lng", "": "tng", "": "ka", "": "tao", "": "ko",
            "": "ha-jai", "": "lat", "": "gr-duk", "": "pu",
            "": "bpay", "": "bpat", "": "ai", "": "jaam", "": "ki",
            "": "jp", "": "bat-ple", "": "pe", "": "hai",
            "": "dtrat", "": "rk-sa", "": "yaa", "": "roong-p-yaa-baan",
            "": "k-gam-lang-gaai", "": "pk-pn",
            
            // Numbers & Time
            "": "nng", "": "sng", "": "sam", "": "si", "": "ha",
            "": "hk", "": "jt", "": "bpet", "": "go", "": "sp",
            "": "ri", "": "pan", "": "mn", "": "sen", "": "lan",
            "": "wan", "": "sp-daa", "": "dan", "": "bpii",
            "": "wan-ni", "": "prng-ni", "": "ma-waan",
            "": "chao", "": "bai", "": "yen", "": "kn",
            "": "tang", "": "tang-kn", "": "cha-moong",
            "": "naa-tii", "": "w-naa-tii", "": "naa-l-gaa",
            "": "wan-jan", "": "wan-ang-kaan", "": "wan-pt", "": "wan-p-r-ht",
            "": "wan-sk", "": "wan-so", "": "wan-aa-tt",
            "": "lew", "": "yang", "": "gam-lang", "": "j", "": "ki",
            "": "dtrong-wee-laa", "": "sai", "": "chi-wee-laa",
            "": "bpr-yt-wee-laa", "": "sa-wee-laa",
            
            // Colors & Descriptions
            "": "si", "": "si-daeng", "": "si-kao", "": "si-nam-ngn",
            "": "si-lang", "": "si-kao", "": "si-dam", "": "si-chom-puu",
            "": "si-mang", "": "si-tao", "": "si-sm", "": "si-fa",
            "": "say", "": "na-rk",
            "": "ch-lat", "": "s-at", "": "sk-g-bprk",
            "": "yi", "": "lk", "": "sung", "": "dta",
            "": "yaao", "": "sn", "": "gwang", "": "kep",
            "": "na", "": "baang", "": "go", "": "mi",
            "": "keng-raeng", "": "n-ae", "": "an", "": "pm",
            "": "paeng", "": "tuk", "": "nao", "": "rn",
            "": "rat-reo", "": "cha", "": "ngai", "": "yak",
            "": "mt", "": "s-wang", "": "ngap", "": "sang-dang",
            "": "s-dak", "": "yng-yak", "": "m-sm",
            "": "km-ka", "": "an-dt-raai", "": "bplt-pai",
            "": "rap-ri",
            
            // Emotions & Feelings
            "": "nay", "": "ba", "": "dtn-dtn",
            "": "gang-won", "": "pn-klaai", "": "bpr-lat-jai",
            "": "pt-wng", "": "puum-jai", "": "p-aai",
            "": "grot", "": "sa-jai", "": "dii-jai",
            "": "dtk-jai", "": "glua", "": "s-baai",
            "": "lam-bak", "": "s-nk", "": "na-ba",
            "": "na-glua", "": "hu", "": "m", "": "gr-hai",
            "": "kt-tng", "": "rk", "": "glat",
            "": "chp", "": "mi-chp", "": "wng", "": "cha",
            "": "sng-si", "": "sp-sn", "": "k-yn",
            "": "ki-gat", "": "ruay", "": "jon", "": "mii-ch-sang",
            
            // Basic Actions
            "": "dn", "": "wng", "": "gr-dot", "": "nng",
            "": "yn", "": "nn", "": "dtn", "": "dtn-nn",
            "": "glp", "": "maa", "": "bpai", "": "ko", "": "k",
            "": "kn", "": "long", "": "pan", "": "yt", "": "r",
            "": "rm", "": "jp", "": "bpt", "": "bpt", "": "chi",
            "": "s", "": "kai", "": "hi", "": "rp", "": "sng",
            "": "duu", "": "hn", "": "mng", "": "di-yin",
            "": "fang", "": "chim", "": "dom", "": "sm-pt",
            "": "kt", "": "ru-sk", "": "ko-jai", "": "jam",
            "": "lm", "": "rip", "": "la-cha", "": "reo",
            
            // Communication
            "": "put", "": "kui", "": "put-kui", "": "kui-gan",
            "": "lo", "": "-t-baai", "": "tam", "": "dtp",
            "": "bk", "": "chi-jaeng", "": "dtan", "": "sn-yaa",
            "": "goo-hk", "": "ne-nam", "": "dtt-dt",
            "": "bpr-gat", "": "an", "": "kan",
            "": "s-wt-dii", "": "kp-kun", "": "k-tot",
            "": "mi-bpen-rai", "": "chay-di-mi",
            "": "mi-ko-jai", "": "put-cha-cha",
            
            // Education & Learning
            "": "sn", "": "rian", "": "jt", "": "sk-sa",
            "": "sp", "": "dtk", "": "tp-tuan",
            "": "p-yaa-yaam", "": "fk-fn",
            "": "tam-ngaan-ban", "": "gaan-ban", "": "bp-rin-yaa",
            "": "wt-t-yaa-lai", "": "m-ha-wt-t-yaa-lai",
            "": "roong-rian", "": "hng-rian", "": "hng-s-mt",
            "": "s-nam-gii-laa", "": "nng-s",
            "": "bpak-gaa", "": "din-s", "": "gr-dat",
            "": "gan-grai", "": "gaao", "": "kwaam-ru",
            "": "bpr-sp-gaan",
            
            // Home & Furniture
            "": "ban", "": "hng", "": "hng-nn",
            "": "hng-krua", "": "hng-nam",
            "": "hng-nng-ln", "": "bpr-dtuu",
            "": "na-dtang", "": "pn", "": "p-nng",
            "": "lng-kaa", "": "ban-dai", "": "go-i",
            "": "dt", "": "dtiang", "": "dtu", "": "dtu-yen",
            "": "ae", "": "pt-lom", "": "gun-jae",
            "": "pa-hm", "": "mn", "": "ti-nn",
            "": "pa-bpuu-ti-nn", "": "gr-jk",
            "": "pa-cht-dtua",
            
            // Clothing & Accessories
            "": "sa", "": "gaang-geeng", "": "gr-bproong",
            "": "rng-tao", "": "tng-tao", "": "mak",
            "": "wen-dtaa", "": "gr-bpo", "": "rm",
            "": "wen", "": "si", "": "si-tng", "": "pt",
            "": "dteng-dtua", "": "sk", "": "km-kt",
            "": "dtak", "": "naa-l-gaa-k-m", "": "tk",
            
            // Travel & Transport
            "": "rt-tek-si", "": "rt-dtu", "": "rt-bt",
            "": "rt-fai", "": "rt-fai-fa", "": "ra",
            "": "krang-bin", "": "s-nam-bin",
            "": "s-ta-nii", "": "bpai-rt-mee",
            "": "dta", "": "s-dta", "": "kn-rt",
            "": "long-rt", "": "bpai-ni", "": "tng",
            "": "lao-sai", "": "lao-kwa",
            "": "dtrong-bpai", "": "cha-ni",
            "": "reo-ni", "": "ti-ni", "": "ti-nn",
            "": "gli", "": "glai", "": "lng", "": "pen-ti",
            "": "ti-yu", "": "t-nn", "": "si",
            "": "s-paan", "": "roong-raem", "": "hng-pk",
            "": "jng", "": "yk-lk", "": "chk-in",
            "": "chk-ao", "": "nng-s-dn-taang",
            "": "wii-sa",
            
            // Places & Sights
            "": "wt", "": "pr-pt-t-rup", "": "p-pt-t-pan",
            "": "san-sa-taa-r-n", "": "san-st",
            "": "dt-lat", "": "ran-ka",
            "": "hang-sp-p-sn-ka", "": "ran-aa-han",
            "": "t-naa-kaan", "": "p-ft", "": "b-r-st",
            
            // Weather & Seasons
            "": "aa-gat", "": "fn", "": "fn-dtk", "": "det",
            "": "lom", "": "mek", "": "fa", "": "paa-y",
            "": "fa-pa", "": "fa-rng", "": "nam-tam",
            "": "chn", "": "heng", "": "mk",
            "": "aa-gat-dii", "": "aa-gat-ye",
            "": "rn-jt", "": "nao-jt", "": "p-ao",
            "": "r-duu", "": "r-duu-fn", "": "r-duu-rn",
            "": "r-duu-nao", "": "un-h-puum", "": "ong-sa",
            "": "lok", "": "duang-aa-tt", "": "duang-jan",
            "": "daao", "": "tng-fa",
            
            // Shopping & Money
            "": "raa-kaa", "": "ngn", "": "bat",
            "": "lek-ngn", "": "bt-kree-dt",
            "": "ngn-st", "": "bai-st", "": "kng-kwn",
            "": "kng-ti-r-lk", "": "to-ri",
            "": "paeng-gn-bpai", "": "lt-ni",
            "": "hng-nam-yu-ni", "": "mee-nuu",
            "": "sng-aa-han", "": "chk-bin", "": "tp",
            "": "mi-ao-nam-dtaan", "": "mi-ao-nam-keng",
            "": "bpr-yt", "": "lak", "": "dtt-sn-jai",
            "": "beng-bpan", "": "bprap-tap",
            
            // Work & Business
            "": "tam-ngaan", "": "ngaan", "": "aa-chip",
            "": "ngn-dan", "": "bpr-chum",
            "": "nt-mai", "": "sm-pat", "": "s-mk",
            "": "sen", "": "pim", "": "sng-ii-meo",
            "": "too", "": "raai-ngaan", "": "ek-g-san",
            "": "sm-nao", "": "dtn-ch-bp", "": "bep-fm",
            "": "bai-s-mk", "": "bt-bpr-chaa-chon",
            "": "bai-kp-ki", "": "bpr-gan", "": "paa-si",
            "": "ka-chi-jai", "": "ngp-bpr-maan",
            "": "gam-rai", "": "kat-tun", "": "ni",
            "": "dk-ba", "": "ban-chii", "": "ban-chii-t-naa-kaan",
            "": "fak", "": "fak-ngn", "": "tn-ngn", 
            "": "oon", "": "oon-ngn",
            "": "gu-ngn", "": "jai",
            
            // Technology
            "": "too-r-tt", "": "too-r-sp",
            "": "m-t", "": "km-piw-dt",
            "": "in-t-nt", "": "r-ht", "": "k-kwaam",
            "": "rup-pap", "": "w-dii-oo", "": "pleeng",
            "": "nng-s-pim", "": "nt-dt-y-san",
            "": "bet-dt-ri", "": "na-j", "": "bplk",
            "": "s-wt", "": "fai-fa", "": "lt-fai",
            "": "tian", "": "fai-chai", "": "glng",
            "": "j", "": "lam-poong", "": "hu-fang",
            "": "mo", "": "kii-bt", "": "krang-pim",
            "": "geem", "": "ep", "": "wp-sai",
            "": "wai-fai", "": "sn-yaan", "": "daao-lot",
            "": "p-lot", "": "bpt-krang",
            "": "bpt-krang", "": "chat", "": "tai-rup",
            "": "ban-tk", "": "lp", "": "kt-lk",
            "": "kn-ha",
            
            // Entertainment & Sports
            "": "kao", "": "kot-s-naa", "": "l-kn",
            "": "pap-p-yon", "": "gaa-dtuun", "": "raai-gaan",
            "": "chng", "": "rng", "": "dtn", "": "ln",
            "": "ch-n", "": "keng-kn", "": "keng", "": "gii-laa",
            "": "ft-bn", "": "bat-gt-bn",
            "": "wn-lee-bn", "": "wai-nam",
            "": "bpn-jk-gr-yaan", "": "dtii-gp",
            "": "muay", "": "yoo-k", "": "nat", "": "s-bpaa",
            
            // Personal Care
            "": "dtt-pm", "": "tam-pm", "": "ym-pm",
            "": "goon", "": "dteng-na", "": "taa-lp-s-dtk",
            "": "nam-hm", "": "s-bu", "": "chaem-puu",
            "": "kriim", "": "yaa-si-fan", "": "bpraeng-si-fan",
            "": "wi", "": "dai-bpo-pm",
            "": "krang-goon-nat",
            "": "gan-grai-dtt-lp", "": "lang",
            "": "sm", "": "dtriam-dtua", "": "bplan-bplaeng",
            
            // Household Chores
            "": "gwat", "": "cht", "": "kt",
            "": "lang-jaan", "": "tam-kwaam-s-at",
            "": "jt-hng", "": "bpluk", "": "rt-nam",
            "": "gp-gao", "": "kt", "": "sang",
            "": "tam-laai", "": "ge-ki", "": "bprp-bprung",
            "": "pt-t-naa", "": "k-bep", "": "wat",
            "": "r-baai",
            
            // Abstract & Concepts
            "": "chok-dii", "": "chok-rai", "": "kwaam-fn",
            "": "kwaam-jing", "": "kwaam-lp", "": "bpan-ha",
            "": "kam-dtp", "": "kam-tam", "": "het-pn",
            "": "kwaam-kt", "": "kwaam-sm-rt",
            "": "kwaam-lm-lo", "": "oo-gat", "": "taang",
            "": "taang-lak", "": "bpo-mai", "": "pen",
            "": "gt", "": "gt-mai", "": "st-t",
            "": "na-ti", "": "ae-t",
            
            // Physical Actions
            "": "kn", "": "ym", "": "hi-ym",
            "": "gp", "": "tng", "": "ha", "": "pp", "": "j",
            "": "yek", "": "ruam", "": "pm", "": "lt",
            "": "k-yai", "": "y", "": "dng", "": "dan",
            "": "yk", "": "waang", "": "kwen", "": "puk",
            "": "ge", "": "h", "": "pp", "": "dtt",
            
            // New verbs
            "": "ao", "": "yak", "": "dtng", "": "di",
            "": "bpen", "": "mii", "": "yu", "": "tam",
            "": "gin", "": "dm", "": "nn-lp",
            "": "chay", "": "lng", "": "ru",
            
            // Question words & expressions
            "": "-rai", "": "tam-mai", "": "yang-rai",
            "": "yang-ngai", "": "ma-ri", "": "gi",
            "": "krai", "": "di-li", "": "mi-ao",
            "": "mi-ru", "": "mi-mii", "": "st",
            "": "dao", "": "dao-gn",
            
            // Time expressions
            "": "dtn-ni", "": "gn", "": "lng",
            "": "bi", "": "s-m", "": "mi-ki",
            "": "tan-tii", "": "ik", "": "to-nn",
            "": "lew-g",
            
            // Grammar & Particles
            "": "dte", "": "le", "": "r", "": "pr",
            "": "ta", "": "g", "": "day", "": "li",
            "": "n", "": "krp", "": "k", "": "k",
            "": "mi", "": "s", "": "r",
            "": "chn", "": "pm", "": "kun", "": "ko",
            "": "rao", "": "man", "": "ni", "": "nn",
            "": "non", "": "kng", "": "ti",
            "": "mi", "": "chi", "": "mi-chi",
            "": "p", "": "mak", "": "ni",
            "": "tk", "": "baang", "": "ke", "": "eeng",
            
            // Misc
            "": "pe",
            
            // Common Phrases
            "": "s-baai dii mi",
            "": "s-baai dii",
            "": "mi s-baai",
            "": "mi j gan naan",
            "": "yin-dii ti di ru-jk",
            "": "gin kao r yang",
            "": "gin lew",
            "": "yang mi gin",
            "": "wa ngai",
            "": "bpen yang-ngai bang",
            "": "lew j gan",
            "": "j gan prng-ni",
            "": "chok dii n",
            "": "yin-dii day",
            "": "sk-sn wan-gt",
            "": "k hi chok dii",
            "": "lew dte kun",
            "": "chang man t",
            "": "jing r",
            "": "mi mii taang",
            "": "ne-nn",
            "": "ko-jai lew",
            "": "r sk kru",
            "": "dtaam s-baai",
            "": "chn",
            "": "k-tot tii",
            "": "mi dtng hang",
            "": "r-wang n",
            "": "nay mi",
            "": "hu mi",
            "": "rn mak",
            "": "fn dtk lew",
            "": "ao -rai dii",
            "": "-ri mak",
            "": "to mi",
            "": "s-nk mi",
            "": "mi di j gan naan li",
            "": "kt-tng n",
            "": "j gan mi n",
            "": "tam ngai dii",
            "": "mi dtng greeng-jai",
            "": "rang lk",
            "": "glp ban gn n",
            "": "wi j gan n",
            "": "r-wang dtuua day n",
            "": "pk-pn hi dii n",
            "": "hai reo reo n",
            "": "dn-taang bplt-pai",
            "": "ya lm n",
            "": "ko-jai mi",
            "": "put ik tii di mi",
            "": "mi bpen rai",
            "": "ngn g di",
            "": "ne-jai r",
            "": "tam di",
            
            // Development & International
            "": "gaan-pt-t-naa",
            "": "gaan-pt-t-naa ti yng-yn",
            "": "kwaam yng-yn",
            "": "s-h-bpr-chaa-chat",
            "": "ong-gn",
            "": "ong-gn r-wang bpr-tet",
            "": "bpo-mai",
            "": "n-yoo-baai",
            "": "kroong-gaan",
            "": "kwaam ram-m",
            "": "kwaam chay-la",
            "": "ngn-tun",
            "": "ngp-bpr-maan",
            "": "kwaam yak-jon",
            "": "kwaam lam-lm",
            "": "sng-wet-lm",
            "": "gaan-bplan-bplaeng s-pap puum-aa-gat",
            "": "p-lang-ngaan mn-wian",
            "": "p-lang-ngaan s-at",
            "": "gaan-sk-sa",
            "": "sa-taa-r-n-sk",
            "": "st-t-m-nt-s-y-chon",
            "": "kwaam to-tiam",
            "": "kwaam to-tiam taang pet",
            "": "chum-chon",
            "": "bpr-chaa-chon",
            "": "pu mii san-di san-sa",
            "": "pak bpr-chaa-sng-kom",
            "": "pak ek-g-chon",
            "": "pak rt",
            "": "rt-t-baan",
            "": "gr-suang",
            "": "bpr-tet gam-lang pt-t-naa",
            "": "bpr-tet pt-t-naa lew",
            "": "sp-p-yaa-gn",
            "": "sp-p-yaa-gn tam-m-chat",
            "": "nam s-at",
            "": "s-ka-p-baan",
            "": "kroong-sang pn-tan",
            "": "gaan-bpr-chum",
            "": "k-dtk-long",
            "": "sn-t-sn-yaa",
            "": "gaan-jee-r-jaa",
            "": "dtuua-chi-wt",
            "": "gaan-dtt-dtaam",
            "": "gaan-bpr-mn-pn",
            "": "raai-ngaan",
            "": "k-muun",
            "": "w-jai",
            "": "n-wt-dt-gam",
            "": "tk-noo-loo-yii",
            "": "d-j-tan",
            "": "pu li-pai",
            "": "gaan yai tn",
            "": "m-nt-s-y-tam",
            "": "pai-p-bt",
            "": "chk-chn",
            "": "gaan fn-fuu",
            "": "kwaam mn-kong",
            "": "sn-dt-pap"
        };
        
        // GRAMMAR LESSONS
        const grammarLessons = [
            {
                id: "telling-time",
                title: "Telling Time in Thai",
                structure: "Time System",
                structureRoman: "gi moong lew",
                structureEnglish: "What time is it?",
                description: "Thai uses a unique 6-hour clock system that divides the day into 4 parts.",
                explanation: `<p><strong>Why Thai time is confusing:</strong> Instead of the 12-hour system, Thai traditionally divides the day into <em>four 6-hour blocks</em>, each with its own word. The good news? There's a logical pattern once you understand it.</p>

<p><strong> 1AM - 5AM:  (dtii) + number</strong></p>
<p style="margin-left:20px;"> comes <em>before</em> the number (think: "strike one")<br>
 = 1AM,  = 2AM,  = 3AM,  = 4AM,  = 5AM<br>
<em>Memory trick:</em> "D" for Dark  it's the darkest part of night</p>

<p><strong> 6AM - 11AM: number +  (moong chao)</strong></p>
<p style="margin-left:20px;"> = 6AM,  = 7AM...  = 11AM<br>
 (chao) means "morning"  often dropped in casual speech<br>
<em>Memory trick:</em>  sounds like "gong"  the morning gong</p>

<p><strong> 12PM (noon):  (tang)</strong></p>
<p style="margin-left:20px;">Just say  or  (tang wan = "midday")</p>

<p><strong> 1PM - 3PM:  (bai) + number + </strong></p>
<p style="margin-left:20px;"> comes <em>first</em>:  = 1PM,  = 2PM,  = 3PM<br>
<em>Memory trick:</em> "Bai bai" to the morning!</p>

<p><strong> 4PM - 6PM: number +  (moong yen)</strong></p>
<p style="margin-left:20px;"> = 4PM,  = 5PM,  = 6PM<br>
 (yen) means "evening/cool"  often dropped in context</p>

<p><strong> 7PM - 11PM: number +  (tm)</strong></p>
<p style="margin-left:20px;"><strong> Counting restarts at 1!</strong> Think of 7-Eleven  becomes 1-5<br>
 = 7PM,  = 8PM,  = 9PM,  = 10PM,  = 11PM<br>
<em>Memory trick:</em>  sounds like a drum beat  the night watchman's drum</p>

<p><strong> 12AM (midnight):  (tang kn)</strong></p>
<p style="margin-left:20px;"> (kn) = "night"  so "midpoint of night"</p>

<p><strong>Adding minutes:</strong></p>
<p style="margin-left:20px;"> Just add the number after the hour:  = 8:15PM<br>
 For :30, use  (krng = half):  = 9:30AM<br>
  (naa-tii = minutes) is optional: () = 7:20AM</p>

<p><strong>Asking the time:</strong>  (gi moong lew) = "What time is it?"</p>

<p><strong>Quick reference pattern:</strong></p>
<p style="margin-left:20px;font-family:monospace;">
1-5 AM   + number<br>
6-11 AM  number + ()<br>
Noon  <br>
1-3 PM   + number + <br>
4-6 PM  number + ()<br>
7-11 PM  (number-6) + <br>
Midnight  
</p>`,
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "dtii sam",
                        english: "3:00 AM"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bpet moong chao",
                        english: "8:00 AM"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "tang",
                        english: "12:00 PM (noon)"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bai sng moong krng",
                        english: "2:30 PM"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ha moong yen",
                        english: "5:00 PM"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "sam tm sp ha",
                        english: "9:15 PM"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "tang kn",
                        english: "12:00 AM (midnight)"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "It's 9PM. How do you say this in Thai?",
                    hint: "Remember: 7PM = 1, so 9PM = ?",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "For 7-11PM, start counting from 1 at 7PM. So 7PM=1, 8PM=2, 9PM=3. Think '7-11 becomes 1-5'!"
                }
            },
            {
                id: "mae-wa",
                title: "Even though...",
                structure: "......",
                structureRoman: "me wa ... g ...",
                structureEnglish: "Even though [A], still [B]",
                description: "Express contrast: something happens despite another condition.",
                explanation: `<p><strong>What it means:</strong> This pattern lets you say that something happens <em>despite</em> a condition that might normally prevent it. It's like saying "even though X is true, Y still happens anyway."</p>

<p><strong>The two key words:</strong></p>
<p> <strong></strong> (me wa) = "even though"  introduces the obstacle or condition<br>
 <strong></strong> (g) = "still/anyway"  introduces what happens regardless</p>

<p><strong>Why  is essential:</strong> In English, we often drop "still" ("Even though it's raining, I go to work"). In Thai, you <em>need</em> the   it's the glue that makes the contrast work. Without it, the sentence feels incomplete to Thai ears.</p>

<p><strong>Word order:</strong></p>
<p style="margin-left:20px;font-family:monospace;"> + [condition/obstacle] +  + [what happens anyway]</p>

<p><strong>Shortcuts in casual speech:</strong></p>
<p> You can drop  and just say <strong></strong>  very common in everyday Thai<br>
 The subject often comes after :  <strong></strong> (Even though it's raining, <strong>I still</strong> go)</p>

<p><strong>Common mistakes to avoid:</strong></p>
<p>  Using  (but) instead of   "<em></em>" sounds wrong<br>
  Forgetting  entirely  the sentence will feel unfinished<br>
  Putting  at the end  it needs to come <em>before</em> the verb/action</p>

<p><strong>Similar patterns:</strong> ()... is almost identical but slightly more emphatic (covered in next lesson).</p>

<p><strong>When to use it:</strong> Anytime you want to express doing something despite difficulties, continuing despite obstacles, or when the outcome defies expectations.</p>`,
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa fn dtk g bpai tam-ngaan",
                        english: "Even though it's raining, (I) still go to work"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa nay g dtng tam dt",
                        english: "Even though tired, (I) still have to continue"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa paeng g yak s",
                        english: "Even though it's expensive, (I) still want to buy it"
                    },
                    {
                        thai: "<span class='highlight'></span> <span class='highlight'></span>",
                        roman: "me mi hu chn g gin di",
                        english: "Even though I'm not hungry, I can still eat"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa ko j mi chp g dtng tam",
                        english: "Even though he doesn't like it, (he) still has to do it"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'Even though I'm busy, I still help you'?",
                    hint: "busy =  (yng), help =  (chay)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "... is the correct pattern.  means 'but' (simple contrast),  means 'if' (conditional), and  means 'because' (cause)."
                }
            },
            {
                id: "tung-mae",
                title: "Although / Even if",
                structure: "()......",
                structureRoman: "tng me (wa) ... g ...",
                structureEnglish: "Although [A], still [B]",
                description: "A more emphatic version of , often translated as 'even if'.",
                explanation: `<p><strong>What it means:</strong> This pattern works just like ... but with extra emphasis. While  is "even though,"  leans more toward "even if"  it often implies the condition is hypothetical or extreme.</p>

<p><strong>Breaking it down:</strong></p>
<p> <strong></strong> (tng) = "even/to the point of"  adds emphasis<br>
 <strong></strong> (me) = "though/although"<br>
 <strong></strong> (wa) = optional softener, often dropped<br>
 <strong></strong> (g) = "still/anyway"  required, just like with </p>

<p><strong>The nuance:</strong> Think of  as adding "even" to make things more emphatic:</p>
<p style="margin-left:20px;">  = "Even though it's raining" (it IS raining)<br>
  = "Even if it rains" (maybe it will, maybe it won't)</p>

<p><strong>Common variations:</strong></p>
<p> <strong></strong>  full form, slightly formal<br>
 <strong></strong>  most common in everyday speech<br>
 <strong>...</strong>  shortest form, casual: </p>

<p><strong>The  particle:</strong> You'll often see  (will/would) after   this reinforces the hypothetical feeling: <em></em> = "even if it were to be difficult"</p>

<p><strong>When to use  vs :</strong></p>
<p> Use <strong></strong> for situations that are definitely true<br>
 Use <strong></strong> when emphasizing despite extreme conditions, or for hypotheticals<br>
 In practice, Thai speakers often use them interchangeably  you won't be wrong either way</p>

<p><strong>Real-world usage:</strong>  is popular for expressing determination: "Even if it's hard, I'll do it" or resilience: "Even if things go wrong, it'll be okay."</p>`,
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me j yak g dtng lng",
                        english: "Even if it's difficult, (I) still have to try"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me wa mi mii ngn g mii kwaam-sk",
                        english: "Even though (I) don't have money, (I'm) still happy"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me ko mi maa g mi bpen rai",
                        english: "Even if he doesn't come, it's still okay"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng j paeng g s",
                        english: "Even if it's expensive, (I'll) still buy it"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me wa j nay mak g mi ym pe",
                        english: "Even though (I'm) very tired, (I) won't give up"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "What's the difference between  and ?",
                    options: [
                        { text: " is slightly more emphatic, like 'even if'", correct: true },
                        { text: "They have completely different meanings", correct: false },
                        { text: " is more formal", correct: false },
                        { text: " is only for future events", correct: false }
                    ],
                    explanation: "Both express contrast ('despite X, still Y'), but  adds emphasis with  ('even/to the point of'). It's often used for hypotheticals or to stress determination. In everyday speech, they're largely interchangeable."
                }
            },
            {
                id: "tae-wa",
                title: "But / However",
                structure: "()",
                structureRoman: "dte (wa)",
                structureEnglish: "[A], but [B]",
                description: "Simple contrast connector. '' makes it slightly softer.",
                explanation: "'' is the basic word for 'but'. Adding '' softens it slightly and is often used when explaining or giving a reason. In casual speech, '' alone is most common.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "yak bpai dte mi mii wee-laa",
                        english: "Want to go but don't have time"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "aa-han -ri dte wa paeng mak",
                        english: "The food is delicious, but it's very expensive"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko gng dte ki-gat",
                        english: "He's talented but lazy"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "Complete: ' ___ ' (I like coffee but don't like tea)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " is the simple connector for 'but' in contrasting statements"
                }
            },
            {
                id: "pror-wa",
                title: "Because",
                structure: "()......",
                structureRoman: "pr (wa) ... g li ...",
                structureEnglish: "Because [A], so [B]",
                description: "Shows cause and effect. '' introduces the result.",
                explanation: "'' means 'because' and introduces the reason. '' (g li) introduces the result/consequence and means 'so' or 'therefore'. You can use just '' for a shorter version.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "pr fn dtk g li mi bpai",
                        english: "Because it's raining, so (I) don't go"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "pr wa hu li gin kao",
                        english: "Because (I'm) hungry, so (I) eat"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "pr ko chay g li st reo",
                        english: "Because he helped, so (it) finished quickly"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'Because I'm tired, I sleep' - which pattern?",
                    hint: "tired = , sleep = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "... shows cause (tired) and effect (sleep)"
                }
            },
            {
                id: "taa",
                title: "If... then",
                structure: "......",
                structureRoman: "ta ... g ...",
                structureEnglish: "If [A], then [B]",
                description: "Conditional statements - if something happens, then something else follows.",
                explanation: "'' (ta) means 'if' and introduces the condition. '' introduces the result. The '' is often optional in casual speech but adds clarity.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ta mii wee-laa g bpai tao",
                        english: "If (I) have time, then (I'll) go travel"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ta hu g gin li",
                        english: "If (you're) hungry, then just eat"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ta fn dtk g mi dtng bpai",
                        english: "If it rains, then (you) don't have to go"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'If you're free, call me' - which word means 'if'?",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " (ta) is the standard word for 'if' in conditional sentences"
                }
            },
            {
                id: "ying-ying",
                title: "The more... the more",
                structure: "......",
                structureRoman: "yng ... yng ...",
                structureEnglish: "The more [A], the more [B]",
                description: "Shows that as one thing increases, another thing also increases.",
                explanation: "This pattern shows proportional change. The first '' introduces what increases, and the second '' introduces what also increases as a result. Very useful for comparisons!",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yng rian yng gng",
                        english: "The more (you) study, the better (you) get"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yng gin yng hu",
                        english: "The more (I) eat, the more hungry (I get)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yng ru yng mi ko-jai",
                        english: "The more (I) know, the less (I) understand"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'The more you practice, the better you get' uses which pattern?",
                    options: [
                        { text: "......", correct: true },
                        { text: "......", correct: false },
                        { text: "......", correct: false },
                        { text: "......", correct: false }
                    ],
                    explanation: "... shows proportional increase - the more X, the more Y"
                }
            },
            {
                id: "gwa",
                title: "More than / -er",
                structure: "...",
                structureRoman: "... gwa",
                structureEnglish: "[A] is more [X] than [B]",
                description: "Comparison - saying something is more than something else.",
                explanation: "'' comes AFTER the adjective to make it comparative. Unlike English where we say 'bigger than', Thai puts the comparison word after: 'big + '. Simple and consistent!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "wan-ni rn gwa ma-waan",
                        english: "Today is hotter than yesterday"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "an-ni dii gwa",
                        english: "This one is better"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko sung gwa pm",
                        english: "He is taller than me"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'This is cheaper' - where does  go?",
                    hint: "cheap = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " always comes after the adjective:  (cheap) +  = cheaper"
                }
            },
            {
                id: "tee-sut",
                title: "The most / -est",
                structure: "...",
                structureRoman: "... ti-st",
                structureEnglish: "[A] is the most [X]",
                description: "Superlative - saying something is the most or best.",
                explanation: "'' comes AFTER the adjective to make it superlative. It means 'the most' or '-est'. Very easy to use - just add it after any adjective!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "an-ni dii ti-st",
                        english: "This one is the best"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko gng ti-st nai hng",
                        english: "He is the best in the room"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "wan-ni rn ti-st",
                        english: "Today is the hottest"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'She is the most beautiful' - which is correct?",
                    hint: "beautiful = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " always comes after the adjective:  (beautiful) +  = most beautiful"
                }
            },
            {
                id: "gam-lang",
                title: "Currently doing",
                structure: "...",
                structureRoman: "gam-lang ... yu",
                structureEnglish: "[I] am [verb]-ing",
                description: "Shows an action in progress right now. Like English '-ing'.",
                explanation: "'' before the verb and '' after the verb indicate ongoing action. You can use just '' or just '', but using both is most complete. '' is often dropped in casual speech.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "gam-lang gin kao yu",
                        english: "(I) am eating (right now)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ko gam-lang nn yu",
                        english: "He is sleeping (right now)"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gam-lang tam-ngaan",
                        english: "(I) am working"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'I am studying right now' - which pattern shows ongoing action?",
                    hint: "study = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "... wraps around the verb to show ongoing action"
                }
            },
            {
                id: "laew",
                title: "Already / Completed",
                structure: "...",
                structureRoman: "... lew",
                structureEnglish: "[I] already [verb]ed",
                description: "Shows that something has already happened or is now complete.",
                explanation: "'' is very versatile! It can mean 'already', show completion, or indicate a change of state ('now'). It always comes at the end of the phrase. One of the most common words in Thai!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin kao lew",
                        english: "(I) already ate / (I've) finished eating"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko-jai lew",
                        english: "(I) understand now / Got it"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bpai lew",
                        english: "(He) already went / Gone already"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'I already finished' uses which word?",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " at the end shows completion or 'already'"
                }
            },
            {
                id: "yang-mai",
                title: "Not yet",
                structure: "......()",
                structureRoman: "yang ... mi ... (li)",
                structureEnglish: "[I] haven't [verb]ed yet",
                description: "Expresses that something has not happened yet, often implying it will happen later.",
                explanation: "'' means 'still' or 'yet'. Combined with '' (not), it creates 'not yet'. Adding '' at the end emphasizes that it really hasn't happened at all. This is the opposite of '' (already).",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yang mi dai gin",
                        english: "(I) haven't eaten yet"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span><span class='highlight'></span>",
                        roman: "yang mi ko-jai li",
                        english: "(I) don't understand at all yet"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ko yang mi maa",
                        english: "He hasn't come yet"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I haven't finished yet'?",
                    hint: "finished =  (st)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = haven't [verb]ed yet"
                }
            },
            {
                id: "koey",
                title: "Have ever / Used to",
                structure: "...()",
                structureRoman: "ki ... (maa) gn",
                structureEnglish: "[I] have [verb]ed before / used to [verb]",
                description: "Expresses past experience - something you have done at some point in your life.",
                explanation: "'' indicates past experience. It's like 'have ever' in English. You can add '' (before) for emphasis. For negative, use '' (have never). This is very common when asking about experiences.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ki bpai mang thai mi",
                        english: "Have you ever been to Thailand?"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ki gin t-rian maa gn",
                        english: "(I) have eaten durian before"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "mi ki hn maa gn li",
                        english: "(I've) never seen (it) before at all"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you ask: 'Have you ever eaten this?'?",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb +  = Have you ever [verb]ed?"
                }
            },
            {
                id: "ja",
                title: "Will / Going to",
                structure: "...",
                structureRoman: "j ...",
                structureEnglish: "[I] will [verb] / going to [verb]",
                description: "Expresses future actions or intentions.",
                explanation: "'' is placed before the verb to indicate future tense or intention. Thai doesn't conjugate verbs, so this word is essential for showing future. It's one of the most important grammar words!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "pm j bpai prng-ni",
                        english: "I will go tomorrow"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "j gin -rai",
                        english: "What will (you) eat? / What are you going to eat?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko j mi maa",
                        english: "He won't come / He's not going to come"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I will buy this'?",
                    hint: "buy =  (s)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = will [verb]"
                }
            },
            {
                id: "dai-mai",
                title: "Can / Able to",
                structure: "... / ...",
                structureRoman: "... dai mi / dai ... mi",
                structureEnglish: "Can [I/you] [verb]?",
                description: "Used to ask permission or ability. '' means 'can' or 'able to'.",
                explanation: "'' shows ability or possibility. To ask 'Can you...?', add '' at the end. For statements, '' can come before or after the verb. '' means 'cannot'. This is extremely common in daily Thai!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "put thai dai mi",
                        english: "Can you speak Thai?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin pt dai",
                        english: "(I) can eat spicy food"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bpai mi dai",
                        english: "(I) can't go"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you ask: 'Can you help me?'?",
                    hint: "help =  (chay)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "verb +  = Can you [verb]?"
                }
            },
            {
                id: "tong",
                title: "Must / Have to",
                structure: "...",
                structureRoman: "dtng ...",
                structureEnglish: "[I] must [verb] / have to [verb]",
                description: "Expresses necessity or obligation.",
                explanation: "'' is placed before the verb to show that something is necessary or required. '' means 'don't have to' (not required). For prohibition, use '' instead.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "dtng bpai dtn-ni",
                        english: "(I) have to go now"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "mi dtng gang-won",
                        english: "(You) don't have to worry"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "kun dtng put paa-sa thai",
                        english: "You must speak Thai"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I have to work'?",
                    hint: "work =  (tam-ngaan)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = must/have to [verb]"
                }
            },
            {
                id: "yaak",
                title: "Want to",
                structure: "...",
                structureRoman: "yak ...",
                structureEnglish: "[I] want to [verb]",
                description: "Expresses desire to do something.",
                explanation: "'' means 'want to' and is used before verbs. For wanting objects, use '' (want/take) or '' (need/want - more formal). '' = 'don't want to'.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "yak gin kao",
                        english: "(I) want to eat rice"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "yak bpai tao",
                        english: "(I) want to go out / travel"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "mi yak tam-ngaan",
                        english: "(I) don't want to work"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I want to learn Thai'?",
                    hint: "learn =  (rian)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = want to [verb]"
                }
            },
            {
                id: "hai",
                title: "Using  (give/let/for/make)",
                structure: "...",
                structureRoman: "hi ...",
                structureEnglish: "give / let / for / make / to",
                description: "One of the most versatile Thai words with 5 main uses.",
                explanation: "'' has 5 main uses: 1) GIVE:  (give money), 2) LET/ALLOW:  (Mom doesn't let [me] go), 3) CAUSATIVE (make/have):  (have him do it), 4) FOR BENEFIT:  (do it for you), 5) ADVERB MARKER:  (do it well/properly). When  comes at the END of a phrase with an adjective, it means 'properly' or 'make sure to' - e.g.,  (eat until full),  (sleep well).",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "hi ngn ko",
                        english: "Give (him) money [GIVE]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "me mi hi bpai",
                        english: "Mom doesn't let (me) go [LET/ALLOW]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bk hi ko maa",
                        english: "Tell him to come [CAUSATIVE]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "tam hi kun",
                        english: "Do it for you [FOR BENEFIT]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "tam hi dii",
                        english: "Do it well/properly [ADVERB]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin hi m",
                        english: "Eat until full [RESULT]"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "What does '' mean?",
                    hint: " (nn) = sleep,  (lp) = asleep",
                    options: [
                        { text: "Sleep well/properly", correct: true },
                        { text: "Give sleep", correct: false },
                        { text: "Let someone sleep", correct: false },
                        { text: "Sleeping for you", correct: false }
                    ],
                    explanation: "Verb +  + adjective = do the action properly/until that state.  = sleep until properly asleep"
                }
            },
            {
                id: "polite-request",
                title: "Polite Requests",
                structure: "...  /",
                structureRoman: "... ni di mi krp/k",
                structureEnglish: "Could you [verb] please?",
                description: "The polite way to make requests in Thai using  and .",
                explanation: "To make a polite request in Thai, use: [verb] +  (a little/please) +  (can you?) + / (polite particle). '' softens the request, '' asks permission, and '/' adds politeness. You can also use just '[verb] +  + /' for a shorter polite request.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "chay ni di mi krp",
                        english: "Could you help me please? (male speaker)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "put cha cha ni di mi k",
                        english: "Could you speak slowly please? (female speaker)"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "r ni krp",
                        english: "Please wait (a moment)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "k nam ni di mi krp",
                        english: "Could I have some water please?"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "lt raa-kaa ni di mi k",
                        english: "Could you lower the price please?"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you politely ask: 'Could you wait please?' (male speaker)",
                    hint: "wait =  (r)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "The order is: verb +  +  + /"
                }
            },
            {
                id: "question-particles",
                title: "Question Particles: , , ",
                structure: "... / ... / ...",
                structureRoman: "... mi / ... r plo / ... r yang",
                structureEnglish: "yes/no? / or not? / yet?",
                description: "Three ways to form yes/no questions in Thai, each with different nuances.",
                explanation: " (mi): Neutral yes/no question - 'Are you hungry?' = .\n\n (r plo): Also yes/no, but implies you expect 'no' or are checking - 'Are you [not] hungry?' = . Sounds more casual.\n\n (r yang): Asks if something has happened YET - 'Have you eaten yet?' = . Expects either 'already' () or 'not yet' ().\n\nAll three go at the END of the statement to turn it into a question.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "hu mi",
                        english: "Are you hungry? [neutral question]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "hu r plo",
                        english: "Are you hungry (or not)? [checking]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin kao r yang",
                        english: "Have you eaten yet?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bpai tam-ngaan r yang",
                        english: "Have you gone to work yet?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "mii faen r plo",
                        english: "Do you have a boyfriend/girlfriend?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "chp mi",
                        english: "Do you like it?"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you ask 'Have you finished yet?'",
                    hint: "finish =  (st), 'yet' questions use ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "Use  for 'yet' questions.  is neutral,  is for checking assumptions."
                }
            }
        ];
        
        // Grammar practice sentence templates
        // Each template has: pattern (grammar rule), templates with slots, and word pools
        const grammarPracticeTemplates = {
            "mae-wa": {
                // ...... (even though...still...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "Even though it's raining, I still go to work" },
                    { sentence: "______", blanks: ["", ""], english: "Even though I'm tired, I still have to continue" },
                    { sentence: "______", blanks: ["", ""], english: "Even though it's expensive, I still want to buy it" },
                    { sentence: "______", blanks: ["", ""], english: "Even though I don't have time, I'll still help you" },
                    { sentence: "______", blanks: ["", ""], english: "Even though it's difficult, I still have to try" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "Even though it's raining, I still go", correct: "" },
                    { words: ["", "", "", ""], english: "Even though I'm tired, I still work", correct: "" },
                    { words: ["", "", "", ""], english: "Even though I have no money, I'm still happy", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Even though it's raining, I still have to go meet my friends", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Even though I'm tired, I still have to cook for my wife", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Even though I don't want to go, I still have to go to work", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "tae-wa": {
                // () (but)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I want to go, but I don't have time" },
                    { sentence: "___", blanks: [""], english: "The food is delicious, but it's very expensive" },
                    { sentence: "___", blanks: [""], english: "He's talented, but lazy" },
                    { sentence: "___", blanks: [""], english: "I like coffee, but I don't like tea" },
                    { sentence: "___", blanks: [""], english: "It's hot, but I won't turn on the AC" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "I want to go, but I don't have time", correct: "" },
                    { words: ["", "", ""], english: "I like it, but I won't buy it", correct: "" },
                    { words: ["", "", ""], english: "I'm hungry, but I won't eat", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "I want to eat, but I have to work first", correct: "" },
                    { words: ["", "", "", "", ""], english: "He's rich, but he's not happy", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "The food is delicious, but the restaurant is very far", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "pror-wa": {
                // ()...... (because...so...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "Because it's raining, I'm not going" },
                    { sentence: "______", blanks: ["", ""], english: "Because I'm hungry, I'm eating" },
                    { sentence: "______", blanks: ["", ""], english: "Because I'm tired, I'm going to sleep" },
                    { sentence: "______", blanks: ["", ""], english: "Because I have no money, I'm not buying it" },
                    { sentence: "______", blanks: ["", ""], english: "Because it's hot, I'm turning on the AC" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "Because I'm hungry, I'm eating", correct: "" },
                    { words: ["", "", "", ""], english: "Because I'm tired, I'm sleeping", correct: "" },
                    { words: ["", "", "", ""], english: "Because it's raining, I'm not going", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Because I worked hard, I'm very tired", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Because I didn't study, I failed the exam", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Because of traffic, I arrived late", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "taa": {
                // ...... (if...then...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "If I have time, I'll go out" },
                    { sentence: "______", blanks: ["", ""], english: "If you're hungry, just eat" },
                    { sentence: "______", blanks: ["", ""], english: "If it rains, I won't go" },
                    { sentence: "______", blanks: ["", ""], english: "If you're free, give me a call" },
                    { sentence: "______", blanks: ["", ""], english: "If you don't like it, you don't have to eat it" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "If you're hungry, eat", correct: "" },
                    { words: ["", "", "", ""], english: "If you're free, come over", correct: "" },
                    { words: ["", "", "", ""], english: "If it rains, stay home", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "If I have time, I'll go to the beach", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "If you're not feeling well, rest at home", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "If the food isn't good, you don't have to eat it", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "ying-ying": {
                // ...... (the more...the more...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "The more you study, the better you get" },
                    { sentence: "______", blanks: ["", ""], english: "The more I eat, the hungrier I get" },
                    { sentence: "______", blanks: ["", ""], english: "The more I learn, the less I understand" },
                    { sentence: "______", blanks: ["", ""], english: "The more you practice, the better" },
                    { sentence: "______", blanks: ["", ""], english: "The more I think, the more confused I get" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "The more you study, the better you get", correct: "" },
                    { words: ["", "", "", ""], english: "The more you practice, the better", correct: "" },
                    { words: ["", "", "", ""], english: "The more you eat, the fatter you get", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "The more I know him, the more I like him", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "The more I read, the more I understand", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "The more I practice speaking Thai, the better I get", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "gwa": {
                // ... (more than / -er)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Today is hotter than yesterday" },
                    { sentence: "___", blanks: [""], english: "This one is better" },
                    { sentence: "___", blanks: [""], english: "He's taller than me" },
                    { sentence: "___", blanks: [""], english: "This one is cheaper" },
                    { sentence: "___", blanks: [""], english: "Thai is harder than English" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "This one is better", correct: "" },
                    { words: ["", "", "", ""], english: "Today is hotter than yesterday", correct: "" },
                    { words: ["", "", "", ""], english: "He's better than me", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "His house is bigger than my house", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "This restaurant's food is tastier than that one", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Learning Thai is harder than I thought", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "tee-sut": {
                // ... (the most / -est)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "This one is the best" },
                    { sentence: "___", blanks: [""], english: "He is the best in the room" },
                    { sentence: "___", blanks: [""], english: "Today is the hottest" },
                    { sentence: "___", blanks: [""], english: "Thai food is the most delicious" },
                    { sentence: "___", blanks: [""], english: "This is the most important" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "This one is the best", correct: "" },
                    { words: ["", "", ""], english: "She is the most beautiful", correct: "" },
                    { words: ["", "", ""], english: "Thai food is the best", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "This is the happiest day of my life", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "This shop sells the best coffee in town", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "He's the kindest person I know", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "gam-lang": {
                // ... (currently -ing)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "I'm eating right now" },
                    { sentence: "______", blanks: ["", ""], english: "He's sleeping right now" },
                    { sentence: "______", blanks: ["", ""], english: "I'm working right now" },
                    { sentence: "______", blanks: ["", ""], english: "I'm studying right now" },
                    { sentence: "______", blanks: ["", ""], english: "He's on the phone right now" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "I'm eating right now", correct: "" },
                    { words: ["", "", ""], english: "I'm working right now", correct: "" },
                    { words: ["", "", "", ""], english: "He's sleeping right now", correct: "" },
                    { words: ["", "", "", "", ""], english: "I'm studying Thai right now", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Mom is cooking in the kitchen right now", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "He's in a meeting with a client right now", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "laew": {
                // ... (already/completed)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I already ate" },
                    { sentence: "___", blanks: [""], english: "I understand now" },
                    { sentence: "___", blanks: [""], english: "He already left" },
                    { sentence: "___", blanks: [""], english: "I already finished" },
                    { sentence: "___", blanks: [""], english: "I already know" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "I already ate", correct: "" },
                    { words: ["", ""], english: "He already left", correct: "" },
                    { words: ["", ""], english: "I understand now", correct: "" },
                    { words: ["", "", "", "", ""], english: "I already finished my homework", correct: "" },
                    { words: ["", "", "", "", ""], english: "He already went home", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "I already told him, but he didn't listen", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "yang-mai": {
                // ... (not yet)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "I haven't eaten yet" },
                    { sentence: "___", blanks: ["", ""], english: "He hasn't come yet" },
                    { sentence: "______", blanks: ["", ""], english: "I don't understand at all yet" },
                    { sentence: "___", blanks: ["", ""], english: "Not finished yet" },
                    { sentence: "___", blanks: ["", ""], english: "I don't know yet" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Haven't eaten yet", correct: "" },
                    { words: ["", ""], english: "Not finished yet", correct: "" },
                    { words: ["", "", ""], english: "He hasn't come yet", correct: "" },
                    { words: ["", "", "", ""], english: "I don't understand at all yet", correct: "" },
                    { words: ["", "", ""], english: "Haven't done homework yet", correct: "" },
                    { words: ["", "", ""], english: "Not ready to go yet", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "koey": {
                // ... (have ever / used to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Have you ever been to Thailand?" },
                    { sentence: "___", blanks: [""], english: "I've eaten durian before" },
                    { sentence: "___", blanks: [""], english: "I've never seen it before" },
                    { sentence: "___", blanks: [""], english: "I used to work here" },
                    { sentence: "___", blanks: [""], english: "Have you ever spoken Thai?" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "Have you ever been?", correct: "" },
                    { words: ["", "", ""], english: "I've eaten it before", correct: "" },
                    { words: ["", "", ""], english: "I've never seen it", correct: "" },
                    { words: ["", "", "", "", ""], english: "Have you ever been to Thailand?", correct: "" },
                    { words: ["", "", "", "", ""], english: "I used to live in Bangkok", correct: "" },
                    { words: ["", "", "", "", ""], english: "I've never done this before", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "ja": {
                // ... (will / going to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I will go tomorrow" },
                    { sentence: "___", blanks: [""], english: "What will you eat?" },
                    { sentence: "___", blanks: [""], english: "He won't come" },
                    { sentence: "___", blanks: [""], english: "I'm going to work today" },
                    { sentence: "___", blanks: [""], english: "Which one will you buy?" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "I will go", correct: "" },
                    { words: ["", "", ""], english: "What will you eat?", correct: "" },
                    { words: ["", "", "", ""], english: "When will he come?", correct: "" },
                    { words: ["", "", "", "", ""], english: "I will go shopping", correct: "" },
                    { words: ["", "", "", ""], english: "Tomorrow it will rain", correct: "" },
                    { words: ["", "", "", "", ""], english: "What will you do today?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "dai-mai": {
                // ... (can/able to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Can you speak Thai?" },
                    { sentence: "___", blanks: [""], english: "I can eat spicy food" },
                    { sentence: "___", blanks: [""], english: "I can't go" },
                    { sentence: "___", blanks: [""], english: "Can you help?" },
                    { sentence: "___", blanks: [""], english: "I can come" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "Can you speak Thai?", correct: "" },
                    { words: ["", "", ""], english: "I can eat spicy", correct: "" },
                    { words: ["", ""], english: "Can't go", correct: "" },
                    { words: ["", "", "", ""], english: "Can you help me?", correct: "" },
                    { words: ["", "", ""], english: "I can't come today", correct: "" },
                    { words: ["", "", "", "", ""], english: "Can you drive?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "tong": {
                // ... (must / have to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I have to go now" },
                    { sentence: "___", blanks: [""], english: "Don't have to worry" },
                    { sentence: "___", blanks: [""], english: "I have to work" },
                    { sentence: "___", blanks: [""], english: "No need to wait" },
                    { sentence: "___", blanks: [""], english: "Must speak Thai" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Have to go", correct: "" },
                    { words: ["", ""], english: "Don't have to worry", correct: "" },
                    { words: ["", "", ""], english: "Have to work today", correct: "" },
                    { words: ["", "", "", ""], english: "You don't have to wait for me", correct: "" },
                    { words: ["", "", "", ""], english: "We have to go now", correct: "" },
                    { words: ["", "", "", "", ""], english: "Have to study Thai every day", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "yaak": {
                // ... (want to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I want to eat" },
                    { sentence: "___", blanks: [""], english: "I want to travel" },
                    { sentence: "___", blanks: [""], english: "I don't want to work" },
                    { sentence: "___", blanks: [""], english: "I want to learn Thai" },
                    { sentence: "___", blanks: [""], english: "I want to rest" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Want to eat", correct: "" },
                    { words: ["", "", ""], english: "Want to travel", correct: "" },
                    { words: ["", ""], english: "Don't want to work", correct: "" },
                    { words: ["", "", "", ""], english: "I want to learn Thai", correct: "" },
                    { words: ["", "", "", ""], english: "What do you want to eat?", correct: "" },
                    { words: ["", "", "", ""], english: "I really want to go to Thailand", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "hai": {
                // ... (give/let/for someone to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Give him money" },
                    { sentence: "___", blanks: [""], english: "Tell him to come" },
                    { sentence: "___", blanks: [""], english: "Please help" },
                    { sentence: "___", blanks: [""], english: "Let me see" },
                    { sentence: "___", blanks: [""], english: "Make it finished" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Give money", correct: "" },
                    { words: ["", "", "", ""], english: "Tell him to come", correct: "" },
                    { words: ["", "", "", ""], english: "Let me see", correct: "" },
                    { words: ["", "", "", ""], english: "Please help me", correct: "" },
                    { words: ["", "", "", "", ""], english: "Tell him to wait a moment", correct: "" },
                    { words: ["", "", "", ""], english: "Do it the best you can", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "polite-request": {
                // ... (polite requests)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Could you help please?" },
                    { sentence: "______", blanks: ["", ""], english: "Could you speak slowly please?" },
                    { sentence: "___", blanks: [""], english: "Please wait a moment" },
                    { sentence: "______", blanks: ["", ""], english: "Could I have some water please?" },
                    { sentence: "______", blanks: ["", ""], english: "Could you lower the price please?" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "Please help (male)", correct: "" },
                    { words: ["", "", "", ""], english: "Could you wait please?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could you speak slowly please?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could I have water please?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could you lower the price?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could you write it again please?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "question-particles": {
                // , ,  (question particles)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Are you hungry? [neutral]" },
                    { sentence: "___", blanks: [""], english: "Have you eaten yet?" },
                    { sentence: "___", blanks: [""], english: "Do you have a boyfriend/girlfriend?" },
                    { sentence: "___", blanks: [""], english: "Have you finished yet?" },
                    { sentence: "___", blanks: [""], english: "Do you like it?" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Are you hungry?", correct: "" },
                    { words: ["", "", ""], english: "Have you eaten yet?", correct: "" },
                    { words: ["", "", ""], english: "Have you gone to work yet?", correct: "" },
                    { words: ["", "", ""], english: "Is he coming (or not)?", correct: "" },
                    { words: ["", "", ""], english: "Do you like Thai food?", correct: "" },
                    { words: ["", "", ""], english: "Have you finished?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "telling-time": {
                // Time telling practice - uses special time format
                fillBlanks: [
                    { sentence: "3:00 AM = ___", blanks: [""], english: "3:00 AM" },
                    { sentence: "8:00 AM = ___", blanks: [""], english: "8:00 AM" },
                    { sentence: "12:00 PM = ___", blanks: [""], english: "12:00 PM (noon)" },
                    { sentence: "2:00 PM = ___", blanks: [""], english: "2:00 PM" },
                    { sentence: "5:00 PM = ___", blanks: [""], english: "5:00 PM" },
                    { sentence: "9:00 PM = ___", blanks: [""], english: "9:00 PM (7+2=9, so 3)" },
                    { sentence: "12:00 AM = ___", blanks: [""], english: "12:00 AM (midnight)" },
                    { sentence: "1:00 AM = ___", blanks: [""], english: "1:00 AM" },
                    { sentence: "7:00 AM = ___", blanks: [""], english: "7:00 AM" },
                    { sentence: "1:00 PM = ___", blanks: [""], english: "1:00 PM" },
                    { sentence: "4:00 PM = ___", blanks: [""], english: "4:00 PM" },
                    { sentence: "7:00 PM = ___", blanks: [""], english: "7:00 PM (first )" },
                    { sentence: "10:00 PM = ___", blanks: [""], english: "10:00 PM (7+3=10, so 4)" },
                    { sentence: "11:00 PM = ___", blanks: [""], english: "11:00 PM (7+4=11, so 5)" },
                    { sentence: "5:00 AM = ___", blanks: [""], english: "5:00 AM" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "3:00 AM", correct: "" },
                    { words: ["", "", ""], english: "8:00 AM", correct: "" },
                    { words: ["", "", ""], english: "2:00 PM", correct: "" },
                    { words: ["", "", ""], english: "5:00 PM", correct: "" },
                    { words: ["", ""], english: "9:00 PM", correct: "" },
                    { words: ["", ""], english: "Midnight", correct: "" },
                    { words: ["", ""], english: "7:00 PM", correct: "" },
                    { words: ["", ""], english: "10:00 PM", correct: "" },
                    { words: ["", ""], english: "1:00 PM", correct: "" },
                    { words: ["", "", ""], english: "9:00 AM", correct: "" },
                    { words: ["", ""], english: "5:00 AM", correct: "" },
                    { words: ["", "", ""], english: "6:00 PM", correct: "" }
                ],
                distractors: ["", "", "", "", "", "", "", ""]
            }
        };
        
        // Grammar practice state
        let currentPracticeLesson = null;
        let currentPracticeMode = null; // 'fillblank' or 'build'
        let currentPracticeIndex = 0;
        let practiceScore = { correct: 0, total: 0 };
        let currentPracticeItems = [];
        
        // Grammar lesson state
        let currentLessonIndex = null;
        let currentStepIndex = 0;
        let lessonProgress = JSON.parse(localStorage.getItem('thaiGrammarProgress') || '{}');
        
        // THEMED VOCABULARY LISTS
        const themedLists = [
            {
                name: "Animals & Nature",
                words: [
                    { thai: "", english: "dog" },
                    { thai: "", english: "cat" },
                    { thai: "", english: "bird" },
                    { thai: "", english: "fish" },
                    { thai: "", english: "elephant" },
                    { thai: "", english: "monkey" },
                    { thai: "", english: "snake" },
                    { thai: "", english: "cow" },
                    { thai: "", english: "pig" },
                    { thai: "", english: "chicken" },
                    { thai: "", english: "duck" },
                    { thai: "", english: "frog" },
                    { thai: "", english: "mosquito" },
                    { thai: "", english: "ant" },
                    { thai: "", english: "butterfly" },
                    { thai: "", english: "tree" },
                    { thai: "", english: "flower" },
                    { thai: "", english: "leaf" },
                    { thai: "", english: "grass" },
                    { thai: "", english: "forest/jungle" },
                    { thai: "", english: "mountain" },
                    { thai: "", english: "river" },
                    { thai: "", english: "sea/ocean" },
                    { thai: "", english: "island" },
                    { thai: "", english: "beach" },
                    { thai: "", english: "waterfall" }
                ]
            },
            {
                name: "Food & Drinks",
                words: [
                    { thai: "", english: "rice" },
                    { thai: "", english: "egg" },
                    { thai: "", english: "milk" },
                    { thai: "", english: "bread" },
                    { thai: "", english: "meat/beef" },
                    { thai: "", english: "shrimp" },
                    { thai: "", english: "crab" },
                    { thai: "", english: "squid" },
                    { thai: "", english: "fruit" },
                    { thai: "", english: "vegetable" },
                    { thai: "", english: "mango" },
                    { thai: "", english: "banana" },
                    { thai: "", english: "orange" },
                    { thai: "", english: "watermelon" },
                    { thai: "", english: "grape" },
                    { thai: "", english: "mangosteen" },
                    { thai: "", english: "durian" },
                    { thai: "", english: "longan" },
                    { thai: "", english: "lime" },
                    { thai: "", english: "tomato" },
                    { thai: "", english: "cucumber" },
                    { thai: "", english: "cabbage" },
                    { thai: "", english: "carrot" },
                    { thai: "", english: "chili" },
                    { thai: "", english: "garlic" },
                    { thai: "", english: "onion" },
                    { thai: "", english: "salt" },
                    { thai: "", english: "sugar" },
                    { thai: "", english: "water" },
                    { thai: "", english: "tea" },
                    { thai: "", english: "coffee" },
                    { thai: "", english: "beer" },
                    { thai: "", english: "alcohol/liquor" },
                    { thai: "", english: "fruit juice" },
                    { thai: "", english: "plain water" },
                    { thai: "", english: "ice" }
                ]
            },
            {
                name: "Cooking & Taste",
                words: [
                    { thai: "", english: "to cook" },
                    { thai: "", english: "to fry" },
                    { thai: "", english: "to boil" },
                    { thai: "", english: "to steam" },
                    { thai: "", english: "to grill" },
                    { thai: "", english: "to bake" },
                    { thai: "", english: "to mix (cooking)" },
                    { thai: "", english: "to chop/cut" },
                    { thai: "", english: "to season" },
                    { thai: "", english: "ingredient" },
                    { thai: "", english: "recipe" },
                    { thai: "", english: "ingredients" },
                    { thai: "", english: "spice" },
                    { thai: "", english: "seasoning" },
                    { thai: "", english: "taste/flavor" },
                    { thai: "", english: "spicy" },
                    { thai: "", english: "sweet" },
                    { thai: "", english: "sour" },
                    { thai: "", english: "salty" },
                    { thai: "", english: "bitter" },
                    { thai: "", english: "bland" },
                    { thai: "", english: "delicious" },
                    { thai: "", english: "smelly/stinky" },
                    { thai: "", english: "fragrant" },
                    { thai: "", english: "crispy" },
                    { thai: "", english: "soft" },
                    { thai: "", english: "hard" },
                    { thai: "", english: "sticky/chewy" },
                    { thai: "", english: "fresh" },
                    { thai: "", english: "broken/spoiled" }
                ]
            },
            {
                name: "Family & People",
                words: [
                    { thai: "", english: "father" },
                    { thai: "", english: "mother" },
                    { thai: "", english: "older sibling" },
                    { thai: "", english: "younger sibling" },
                    { thai: "", english: "older brother" },
                    { thai: "", english: "older sister" },
                    { thai: "", english: "younger brother" },
                    { thai: "", english: "younger sister" },
                    { thai: "", english: "child/offspring" },
                    { thai: "", english: "son" },
                    { thai: "", english: "daughter" },
                    { thai: "", english: "grandparents (paternal)" },
                    { thai: "", english: "grandparents (maternal)" },
                    { thai: "", english: "grandchild/nephew/niece" },
                    { thai: "", english: "uncle (older than parent)" },
                    { thai: "", english: "aunt (older than parent)" },
                    { thai: "", english: "husband" },
                    { thai: "", english: "wife" },
                    { thai: "", english: "boyfriend/girlfriend" },
                    { thai: "", english: "friend" },
                    { thai: "", english: "neighbor" },
                    { thai: "", english: "teacher" },
                    { thai: "", english: "student" },
                    { thai: "", english: "doctor" },
                    { thai: "", english: "nurse" },
                    { thai: "", english: "employee/staff" },
                    { thai: "", english: "boss" },
                    { thai: "", english: "customer" },
                    { thai: "", english: "monk" }
                ]
            },
            {
                name: "Body & Health",
                words: [
                    { thai: "", english: "head" },
                    { thai: "", english: "hair" },
                    { thai: "", english: "face" },
                    { thai: "", english: "eye" },
                    { thai: "", english: "ear" },
                    { thai: "", english: "nose" },
                    { thai: "", english: "mouth" },
                    { thai: "", english: "tooth/teeth" },
                    { thai: "", english: "tongue" },
                    { thai: "", english: "neck" },
                    { thai: "", english: "shoulder" },
                    { thai: "", english: "arm" },
                    { thai: "", english: "hand" },
                    { thai: "", english: "finger" },
                    { thai: "", english: "back" },
                    { thai: "", english: "stomach" },
                    { thai: "", english: "leg" },
                    { thai: "", english: "foot" },
                    { thai: "", english: "knee" },
                    { thai: "", english: "heart" },
                    { thai: "", english: "blood" },
                    { thai: "", english: "bone" },
                    { thai: "", english: "skin" },
                    { thai: "", english: "sick/ill" },
                    { thai: "", english: "to ache/pain" },
                    { thai: "", english: "to cough" },
                    { thai: "", english: "to sneeze" },
                    { thai: "", english: "fever" },
                    { thai: "", english: "to hurt/injured" },
                    { thai: "", english: "wound" },
                    { thai: "", english: "allergic to" },
                    { thai: "", english: "to recover/heal" },
                    { thai: "", english: "to examine/check" },
                    { thai: "", english: "to treat/cure" },
                    { thai: "", english: "medicine" },
                    { thai: "", english: "hospital" },
                    { thai: "", english: "to exercise" },
                    { thai: "", english: "to rest/relax" }
                ]
            },
            {
                name: "Numbers & Time",
                words: [
                    { thai: "", english: "one" },
                    { thai: "", english: "two" },
                    { thai: "", english: "three" },
                    { thai: "", english: "four" },
                    { thai: "", english: "five" },
                    { thai: "", english: "six" },
                    { thai: "", english: "seven" },
                    { thai: "", english: "eight" },
                    { thai: "", english: "nine" },
                    { thai: "", english: "ten" },
                    { thai: "", english: "hundred" },
                    { thai: "", english: "thousand" },
                    { thai: "", english: "ten thousand" },
                    { thai: "", english: "hundred thousand" },
                    { thai: "", english: "million" },
                    { thai: "", english: "day" },
                    { thai: "", english: "week" },
                    { thai: "", english: "month" },
                    { thai: "", english: "year" },
                    { thai: "", english: "today" },
                    { thai: "", english: "tomorrow" },
                    { thai: "", english: "yesterday" },
                    { thai: "", english: "morning" },
                    { thai: "", english: "afternoon" },
                    { thai: "", english: "evening" },
                    { thai: "", english: "night" },
                    { thai: "", english: "noon" },
                    { thai: "", english: "midnight" },
                    { thai: "", english: "hour" },
                    { thai: "", english: "minute" },
                    { thai: "", english: "second" },
                    { thai: "", english: "clock/watch" },
                    { thai: "", english: "Monday (wan jan)" },
                    { thai: "", english: "Tuesday (wan ang-kaan)" },
                    { thai: "", english: "Wednesday (wan pt)" },
                    { thai: "", english: "Thursday (wan p-r-ht)" },
                    { thai: "", english: "Friday (wan sk)" },
                    { thai: "", english: "Saturday (wan so)" },
                    { thai: "", english: "Sunday (wan aa-tt)" },
                    { thai: "", english: "already" },
                    { thai: "", english: "still/yet" },
                    { thai: "", english: "currently/in progress" },
                    { thai: "", english: "will (future)" },
                    { thai: "", english: "used to/have done before" },
                    { thai: "", english: "on time" },
                    { thai: "", english: "late" },
                    { thai: "", english: "to spend time" },
                    { thai: "", english: "to save time" },
                    { thai: "", english: "to waste time" },
                    { thai: "", english: "now" },
                    { thai: "", english: "before" },
                    { thai: "", english: "after" },
                    { thai: "", english: "often" },
                    { thai: "", english: "always" },
                    { thai: "", english: "never" },
                    { thai: "", english: "immediately" },
                    { thai: "", english: "again/more" },
                    { thai: "", english: "only/that's all" },
                    { thai: "", english: "and then" }
                ]
            },
            {
                name: "Colors & Descriptions",
                words: [
                    { thai: "", english: "color" },
                    { thai: "", english: "red (sii daeng)" },
                    { thai: "", english: "green (sii kiaw)" },
                    { thai: "", english: "blue (sii nam ngern)" },
                    { thai: "", english: "yellow (sii leuang)" },
                    { thai: "", english: "white (sii kaao)" },
                    { thai: "", english: "black (sii dam)" },
                    { thai: "", english: "pink (sii chom-puu)" },
                    { thai: "", english: "purple (sii muang)" },
                    { thai: "", english: "gray (sii tao)" },
                    { thai: "", english: "orange (sii som)" },
                    { thai: "", english: "beautiful" },
                    { thai: "", english: "cute" },
                    { thai: "", english: "smart/clever" },
                    { thai: "", english: "clean" },
                    { thai: "", english: "dirty" },
                    { thai: "", english: "big" },
                    { thai: "", english: "small" },
                    { thai: "", english: "tall/high" },
                    { thai: "", english: "short" },
                    { thai: "", english: "long (length/distance)" },
                    { thai: "", english: "short (length)" },
                    { thai: "", english: "wide" },
                    { thai: "", english: "narrow" },
                    { thai: "", english: "thick" },
                    { thai: "", english: "thin (objects)" },
                    { thai: "", english: "old" },
                    { thai: "", english: "new" },
                    { thai: "", english: "strong" },
                    { thai: "", english: "weak" },
                    { thai: "", english: "fat" },
                    { thai: "", english: "thin/skinny (people)" },
                    { thai: "", english: "expensive" },
                    { thai: "", english: "cheap" },
                    { thai: "", english: "cold" },
                    { thai: "", english: "hot" },
                    { thai: "", english: "fast/quick" },
                    { thai: "", english: "slow" },
                    { thai: "", english: "easy" },
                    { thai: "", english: "difficult" },
                    { thai: "", english: "dark" },
                    { thai: "", english: "bright" },
                    { thai: "", english: "quiet" },
                    { thai: "", english: "loud/noisy" },
                    { thai: "", english: "convenient" },
                    { thai: "", english: "complicated" },
                    { thai: "", english: "suitable/appropriate" },
                    { thai: "", english: "worthwhile/good value" },
                    { thai: "", english: "dangerous" },
                    { thai: "", english: "safe" },
                    { thai: "", english: "neat/tidy" }
                ]
            },
            {
                name: "Emotions & Feelings",
                words: [
                    { thai: "", english: "tired" },
                    { thai: "", english: "bored" },
                    { thai: "", english: "excited" },
                    { thai: "", english: "worried/anxious" },
                    { thai: "", english: "relaxed" },
                    { thai: "", english: "surprised" },
                    { thai: "", english: "disappointed" },
                    { thai: "", english: "proud" },
                    { thai: "", english: "ashamed" },
                    { thai: "", english: "angry" },
                    { thai: "", english: "sad/sorry" },
                    { thai: "", english: "happy/glad" },
                    { thai: "", english: "shocked/startled" },
                    { thai: "", english: "afraid/scared" },
                    { thai: "", english: "comfortable" },
                    { thai: "", english: "difficult/troublesome" },
                    { thai: "", english: "fun" },
                    { thai: "", english: "boring" },
                    { thai: "", english: "scary" },
                    { thai: "", english: "hungry" },
                    { thai: "", english: "full (not hungry)" },
                    { thai: "", english: "thirsty" },
                    { thai: "", english: "to miss (someone)" },
                    { thai: "", english: "to love" },
                    { thai: "", english: "to hate" },
                    { thai: "", english: "to like" },
                    { thai: "", english: "to dislike" },
                    { thai: "", english: "to hope" },
                    { thai: "", english: "to believe" },
                    { thai: "", english: "to doubt/wonder" },
                    { thai: "", english: "confused" },
                    { thai: "", english: "diligent/hardworking" },
                    { thai: "", english: "lazy" },
                    { thai: "", english: "rich" },
                    { thai: "", english: "poor" },
                    { thai: "", english: "famous" }
                ]
            },
            {
                name: "Basic Actions",
                words: [
                    { thai: "", english: "to walk" },
                    { thai: "", english: "to run" },
                    { thai: "", english: "to jump" },
                    { thai: "", english: "to sit" },
                    { thai: "", english: "to stand" },
                    { thai: "", english: "to lie down/sleep" },
                    { thai: "", english: "to sleep" },
                    { thai: "", english: "to wake up" },
                    { thai: "", english: "to return" },
                    { thai: "", english: "to come" },
                    { thai: "", english: "to go" },
                    { thai: "", english: "to enter" },
                    { thai: "", english: "to exit/leave" },
                    { thai: "", english: "to go up" },
                    { thai: "", english: "to go down" },
                    { thai: "", english: "to pass through" },
                    { thai: "", english: "to stop" },
                    { thai: "", english: "to wait" },
                    { thai: "", english: "to start/begin" },
                    { thai: "", english: "to finish/end" },
                    { thai: "", english: "to open" },
                    { thai: "", english: "to close" },
                    { thai: "", english: "to use" },
                    { thai: "", english: "to buy" },
                    { thai: "", english: "to sell" },
                    { thai: "", english: "to give" },
                    { thai: "", english: "to receive" },
                    { thai: "", english: "to send" },
                    { thai: "", english: "to watch" },
                    { thai: "", english: "to see" },
                    { thai: "", english: "to look at" },
                    { thai: "", english: "to hear" },
                    { thai: "", english: "to listen" },
                    { thai: "", english: "to taste" },
                    { thai: "", english: "to smell" },
                    { thai: "", english: "to touch" },
                    { thai: "", english: "to think" },
                    { thai: "", english: "to feel" },
                    { thai: "", english: "to understand" },
                    { thai: "", english: "to remember" },
                    { thai: "", english: "to forget" },
                    { thai: "", english: "to hurry" },
                    { thai: "", english: "to be late/delayed" },
                    { thai: "", english: "to be fast" },
                    { thai: "", english: "to take/want" },
                    { thai: "", english: "to want" },
                    { thai: "", english: "must/have to" },
                    { thai: "", english: "can/get" },
                    { thai: "", english: "to be" },
                    { thai: "", english: "to have" },
                    { thai: "", english: "to be at/live" },
                    { thai: "", english: "to do/make" },
                    { thai: "", english: "to eat" },
                    { thai: "", english: "to drink" },
                    { thai: "", english: "to help" },
                    { thai: "", english: "to try (test/sample)" },
                    { thai: "", english: "to know" }
                ]
            },
            {
                name: "Communication",
                words: [
                    { thai: "", english: "to speak" },
                    { thai: "", english: "to chat/talk" },
                    { thai: "", english: "to call (phone)" },
                    { thai: "", english: "to talk together" },
                    { thai: "", english: "to tell/narrate" },
                    { thai: "", english: "to explain" },
                    { thai: "", english: "to ask" },
                    { thai: "", english: "to answer" },
                    { thai: "", english: "to tell/inform" },
                    { thai: "", english: "to clarify" },
                    { thai: "", english: "to warn/remind" },
                    { thai: "", english: "to promise" },
                    { thai: "", english: "to lie" },
                    { thai: "", english: "to recommend/introduce" },
                    { thai: "", english: "to contact" },
                    { thai: "", english: "to announce" },
                    { thai: "", english: "to read" },
                    { thai: "", english: "to write" },
                    { thai: "", english: "hello/goodbye" },
                    { thai: "", english: "thank you" },
                    { thai: "", english: "excuse me/sorry" },
                    { thai: "", english: "never mind/no problem" },
                    { thai: "", english: "can you help?" },
                    { thai: "", english: "don't understand" },
                    { thai: "", english: "speak slowly" },
                    { thai: "", english: "what" },
                    { thai: "", english: "why" },
                    { thai: "", english: "how" },
                    { thai: "", english: "how (informal)" },
                    { thai: "", english: "when" },
                    { thai: "", english: "how many" },
                    { thai: "", english: "who" },
                    { thai: "", english: "where" },
                    { thai: "", english: "go ahead/sure" },
                    { thai: "", english: "don't want" },
                    { thai: "", english: "don't know" },
                    { thai: "", english: "don't have" },
                    { thai: "", english: "finished/done" },
                    { thai: "", english: "wait/moment" },
                    { thai: "", english: "wait a moment" }
                ]
            },
            {
                name: "Education & Learning",
                words: [
                    { thai: "", english: "to teach" },
                    { thai: "", english: "to learn" },
                    { thai: "", english: "to write down/note" },
                    { thai: "", english: "to study" },
                    { thai: "", english: "to take a test" },
                    { thai: "", english: "to fail" },
                    { thai: "", english: "to review" },
                    { thai: "", english: "to try (make effort)" },
                    { thai: "", english: "to practice" },
                    { thai: "", english: "housework" },
                    { thai: "", english: "homework (school)" },
                    { thai: "", english: "degree" },
                    { thai: "", english: "college" },
                    { thai: "", english: "university" },
                    { thai: "", english: "school" },
                    { thai: "", english: "classroom" },
                    { thai: "", english: "library" },
                    { thai: "", english: "sports field" },
                    { thai: "", english: "book" },
                    { thai: "", english: "pen" },
                    { thai: "", english: "pencil" },
                    { thai: "", english: "paper" },
                    { thai: "", english: "scissors" },
                    { thai: "", english: "knowledge" },
                    { thai: "", english: "experience" }
                ]
            },
            {
                name: "Home & Furniture",
                words: [
                    { thai: "", english: "house/home" },
                    { thai: "", english: "room" },
                    { thai: "", english: "bedroom" },
                    { thai: "", english: "kitchen" },
                    { thai: "", english: "bathroom" },
                    { thai: "", english: "living room" },
                    { thai: "", english: "door" },
                    { thai: "", english: "window" },
                    { thai: "", english: "floor" },
                    { thai: "", english: "wall" },
                    { thai: "", english: "roof" },
                    { thai: "", english: "stairs" },
                    { thai: "", english: "chair" },
                    { thai: "", english: "table" },
                    { thai: "", english: "bed" },
                    { thai: "", english: "cabinet/closet" },
                    { thai: "", english: "refrigerator" },
                    { thai: "", english: "air conditioner" },
                    { thai: "", english: "fan" },
                    { thai: "", english: "key" },
                    { thai: "", english: "blanket" },
                    { thai: "", english: "pillow" },
                    { thai: "", english: "mattress" },
                    { thai: "", english: "bed sheet" },
                    { thai: "", english: "mirror" },
                    { thai: "", english: "towel" }
                ]
            },
            {
                name: "Clothing & Accessories",
                words: [
                    { thai: "", english: "shirt" },
                    { thai: "", english: "pants" },
                    { thai: "", english: "skirt" },
                    { thai: "", english: "shoes" },
                    { thai: "", english: "socks" },
                    { thai: "", english: "hat" },
                    { thai: "", english: "glasses" },
                    { thai: "", english: "bag" },
                    { thai: "", english: "umbrella" },
                    { thai: "", english: "ring" },
                    { thai: "", english: "necklace" },
                    { thai: "", english: "gold/golden (color)" },
                    { thai: "", english: "diamond" },
                    { thai: "", english: "to get dressed" },
                    { thai: "", english: "to wash (clothes)" },
                    { thai: "", english: "belt" },
                    { thai: "", english: "to dry (in sun)" },
                    { thai: "", english: "wristwatch" }
                ]
            },
            {
                name: "Travel & Transport",
                words: [
                    { thai: "", english: "taxi" },
                    { thai: "", english: "van" },
                    { thai: "", english: "bus" },
                    { thai: "", english: "train" },
                    { thai: "", english: "skytrain/metro" },
                    { thai: "", english: "boat" },
                    { thai: "", english: "airplane" },
                    { thai: "", english: "airport" },
                    { thai: "", english: "station" },
                    { thai: "", english: "bus stop" },
                    { thai: "", english: "ticket" },
                    { thai: "", english: "buy ticket" },
                    { thai: "", english: "get on (vehicle)" },
                    { thai: "", english: "get off (vehicle)" },
                    { thai: "", english: "where are you going?" },
                    { thai: "", english: "to arrive" },
                    { thai: "", english: "turn left" },
                    { thai: "", english: "turn right" },
                    { thai: "", english: "go straight" },
                    { thai: "", english: "slow down" },
                    { thai: "", english: "faster please" },
                    { thai: "", english: "here" },
                    { thai: "", english: "there" },
                    { thai: "", english: "near/close" },
                    { thai: "", english: "far" },
                    { thai: "", english: "lost/get lost" },
                    { thai: "", english: "map" },
                    { thai: "", english: "address" },
                    { thai: "", english: "road/street" },
                    { thai: "", english: "side street/alley" },
                    { thai: "", english: "bridge" },
                    { thai: "", english: "hotel" },
                    { thai: "", english: "room (hotel)" },
                    { thai: "", english: "to book/reserve" },
                    { thai: "", english: "to cancel" },
                    { thai: "", english: "check in" },
                    { thai: "", english: "check out" },
                    { thai: "", english: "passport" },
                    { thai: "", english: "visa" }
                ]
            },
            {
                name: "Places & Sights",
                words: [
                    { thai: "", english: "temple" },
                    { thai: "", english: "Buddha statue" },
                    { thai: "", english: "museum" },
                    { thai: "", english: "park" },
                    { thai: "", english: "zoo" },
                    { thai: "", english: "market" },
                    { thai: "", english: "shop/store" },
                    { thai: "", english: "department store/mall" },
                    { thai: "", english: "restaurant" },
                    { thai: "", english: "bank" },
                    { thai: "", english: "office" },
                    { thai: "", english: "company" }
                ]
            },
            {
                name: "Weather & Seasons",
                words: [
                    { thai: "", english: "weather/air" },
                    { thai: "", english: "rain" },
                    { thai: "", english: "it's raining" },
                    { thai: "", english: "sunlight" },
                    { thai: "", english: "wind" },
                    { thai: "", english: "cloud" },
                    { thai: "", english: "light blue (sii faa)" },
                    { thai: "", english: "storm" },
                    { thai: "", english: "lightning" },
                    { thai: "", english: "thunder" },
                    { thai: "", english: "flood" },
                    { thai: "", english: "humid" },
                    { thai: "", english: "dry" },
                    { thai: "", english: "fog" },
                    { thai: "", english: "good weather" },
                    { thai: "", english: "bad weather" },
                    { thai: "", english: "very hot" },
                    { thai: "", english: "very cold" },
                    { thai: "", english: "hot and humid" },
                    { thai: "", english: "season" },
                    { thai: "", english: "rainy season" },
                    { thai: "", english: "hot season" },
                    { thai: "", english: "cool season" },
                    { thai: "", english: "temperature" },
                    { thai: "", english: "degree (temperature)" },
                    { thai: "", english: "world/earth" },
                    { thai: "", english: "sun" },
                    { thai: "", english: "moon" },
                    { thai: "", english: "star" },
                    { thai: "", english: "the sky" }
                ]
            },
            {
                name: "Shopping & Money",
                words: [
                    { thai: "", english: "price" },
                    { thai: "", english: "money" },
                    { thai: "", english: "baht (currency)" },
                    { thai: "", english: "exchange money" },
                    { thai: "", english: "credit card" },
                    { thai: "", english: "cash" },
                    { thai: "", english: "receipt" },
                    { thai: "", english: "gift/souvenir" },
                    { thai: "", english: "souvenir" },
                    { thai: "", english: "how much?" },
                    { thai: "", english: "too expensive" },
                    { thai: "", english: "discount please" },
                    { thai: "", english: "where is the bathroom?" },
                    { thai: "", english: "menu" },
                    { thai: "", english: "to order food" },
                    { thai: "", english: "check/bill please" },
                    { thai: "", english: "tip (gratuity)" },
                    { thai: "", english: "no sugar" },
                    { thai: "", english: "no ice" },
                    { thai: "", english: "to save/economize" },
                    { thai: "", english: "to choose" },
                    { thai: "", english: "to decide" },
                    { thai: "", english: "to share" },
                    { thai: "", english: "to compare" }
                ]
            },
            {
                name: "Work & Business",
                words: [
                    { thai: "", english: "to work" },
                    { thai: "", english: "work/job" },
                    { thai: "", english: "profession/career" },
                    { thai: "", english: "salary" },
                    { thai: "", english: "meeting" },
                    { thai: "", english: "appointment" },
                    { thai: "", english: "interview" },
                    { thai: "", english: "to apply" },
                    { thai: "", english: "to sign" },
                    { thai: "", english: "to type/print" },
                    { thai: "", english: "to send email" },
                    { thai: "", english: "to call (phone)" },
                    { thai: "", english: "report" },
                    { thai: "", english: "document" },
                    { thai: "", english: "copy" },
                    { thai: "", english: "original" },
                    { thai: "", english: "form" },
                    { thai: "", english: "application form" },
                    { thai: "", english: "ID card" },
                    { thai: "", english: "driver's license" },
                    { thai: "", english: "insurance" },
                    { thai: "", english: "tax" },
                    { thai: "", english: "expenses" },
                    { thai: "", english: "budget" },
                    { thai: "", english: "profit" },
                    { thai: "", english: "loss (financial)" },
                    { thai: "", english: "debt" },
                    { thai: "", english: "interest (financial)" },
                    { thai: "", english: "account" },
                    { thai: "", english: "bank account" },
                    { thai: "", english: "to deposit/leave with" },
                    { thai: "", english: "to deposit money" },
                    { thai: "", english: "to withdraw money" },
                    { thai: "", english: "to transfer" },
                    { thai: "", english: "to transfer money" },
                    { thai: "", english: "to borrow money (formal loan)" },
                    { thai: "", english: "to pay" }
                ]
            },
            {
                name: "Technology",
                words: [
                    { thai: "", english: "television" },
                    { thai: "", english: "telephone" },
                    { thai: "", english: "mobile phone" },
                    { thai: "", english: "computer" },
                    { thai: "", english: "internet" },
                    { thai: "", english: "password/code" },
                    { thai: "", english: "message" },
                    { thai: "", english: "picture/photo" },
                    { thai: "", english: "video" },
                    { thai: "", english: "song/music" },
                    { thai: "", english: "newspaper" },
                    { thai: "", english: "magazine" },
                    { thai: "", english: "battery" },
                    { thai: "", english: "screen" },
                    { thai: "", english: "plug" },
                    { thai: "", english: "switch" },
                    { thai: "", english: "electricity" },
                    { thai: "", english: "light bulb" },
                    { thai: "", english: "candle" },
                    { thai: "", english: "flashlight" },
                    { thai: "", english: "camera" },
                    { thai: "", english: "screen (n.)" },
                    { thai: "", english: "speaker" },
                    { thai: "", english: "headphones" },
                    { thai: "", english: "mouse (computer)" },
                    { thai: "", english: "keyboard" },
                    { thai: "", english: "printer" },
                    { thai: "", english: "game" },
                    { thai: "", english: "app" },
                    { thai: "", english: "website" },
                    { thai: "", english: "wifi" },
                    { thai: "", english: "signal" },
                    { thai: "", english: "to download" },
                    { thai: "", english: "to upload" },
                    { thai: "", english: "to turn on" },
                    { thai: "", english: "to turn off" },
                    { thai: "", english: "to charge" },
                    { thai: "", english: "to take a photo" },
                    { thai: "", english: "to record/save" },
                    { thai: "", english: "to delete/erase/subtract" },
                    { thai: "", english: "to copy" },
                    { thai: "", english: "to search" }
                ]
            },
            {
                name: "Entertainment & Sports",
                words: [
                    { thai: "", english: "news" },
                    { thai: "", english: "advertisement" },
                    { thai: "", english: "drama/series" },
                    { thai: "", english: "movie/film" },
                    { thai: "", english: "cartoon" },
                    { thai: "", english: "program/show" },
                    { thai: "", english: "channel" },
                    { thai: "", english: "to sing/cry out" },
                    { thai: "", english: "to dance" },
                    { thai: "", english: "to play" },
                    { thai: "", english: "to win" },
                    { thai: "", english: "to compete" },
                    { thai: "", english: "to compete/race" },
                    { thai: "", english: "sport" },
                    { thai: "", english: "football/soccer" },
                    { thai: "", english: "basketball" },
                    { thai: "", english: "volleyball" },
                    { thai: "", english: "to swim" },
                    { thai: "", english: "to cycle" },
                    { thai: "", english: "to play golf" },
                    { thai: "", english: "boxing" },
                    { thai: "", english: "yoga" },
                    { thai: "", english: "massage" },
                    { thai: "", english: "spa" }
                ]
            },
            {
                name: "Personal Care",
                words: [
                    { thai: "", english: "haircut" },
                    { thai: "", english: "to do hair" },
                    { thai: "", english: "to dye hair" },
                    { thai: "", english: "to shave" },
                    { thai: "", english: "to put on makeup" },
                    { thai: "", english: "to apply lipstick" },
                    { thai: "", english: "perfume" },
                    { thai: "", english: "soap" },
                    { thai: "", english: "shampoo" },
                    { thai: "", english: "cream/lotion" },
                    { thai: "", english: "toothpaste" },
                    { thai: "", english: "toothbrush" },
                    { thai: "", english: "comb" },
                    { thai: "", english: "hair dryer" },
                    { thai: "", english: "razor/shaver" },
                    { thai: "", english: "nail clipper" },
                    { thai: "", english: "to wash" },
                    { thai: "", english: "to repair/fix" },
                    { thai: "", english: "to prepare oneself" },
                    { thai: "", english: "to change/alter" }
                ]
            },
            {
                name: "Household Chores",
                words: [
                    { thai: "", english: "to sweep" },
                    { thai: "", english: "to wipe" },
                    { thai: "", english: "to wash dishes" },
                    { thai: "", english: "to clean" },
                    { thai: "", english: "to tidy room" },
                    { thai: "", english: "to plant/grow" },
                    { thai: "", english: "to water (plants)" },
                    { thai: "", english: "to build/create" },
                    { thai: "", english: "to destroy/break" },
                    { thai: "", english: "to fix/correct" },
                    { thai: "", english: "to improve" },
                    { thai: "", english: "to develop" },
                    { thai: "", english: "to design" },
                    { thai: "", english: "to draw" },
                    { thai: "", english: "to paint/color" }
                ]
            },
            {
                name: "Abstract & Concepts",
                words: [
                    { thai: "", english: "good luck" },
                    { thai: "", english: "bad luck" },
                    { thai: "", english: "dream" },
                    { thai: "", english: "truth/reality" },
                    { thai: "", english: "secret" },
                    { thai: "", english: "problem" },
                    { thai: "", english: "answer" },
                    { thai: "", english: "question" },
                    { thai: "", english: "reason" },
                    { thai: "", english: "idea/thought" },
                    { thai: "", english: "success" },
                    { thai: "", english: "failure" },
                    { thai: "", english: "opportunity/chance" },
                    { thai: "", english: "way/path" },
                    { thai: "", english: "choice/option" },
                    { thai: "", english: "goal/target" },
                    { thai: "", english: "plan" },
                    { thai: "", english: "rule" },
                    { thai: "", english: "law" },
                    { thai: "", english: "right (legal)" },
                    { thai: "", english: "duty/responsibility" },
                    { thai: "", english: "crowded" }
                ]
            },
            {
                name: "Physical Actions",
                words: [
                    { thai: "", english: "to return/give back" },
                    { thai: "", english: "to borrow (general)" },
                    { thai: "", english: "to lend" },
                    { thai: "", english: "to keep/collect" },
                    { thai: "", english: "to throw away" },
                    { thai: "", english: "to find/look for" },
                    { thai: "", english: "to meet/find" },
                    { thai: "", english: "to encounter/meet" },
                    { thai: "", english: "to separate" },
                    { thai: "", english: "to combine/include" },
                    { thai: "", english: "to add/increase" },
                    { thai: "", english: "to reduce/decrease" },
                    { thai: "", english: "to expand" },
                    { thai: "", english: "to shrink/abbreviate" },
                    { thai: "", english: "to pull" },
                    { thai: "", english: "to push" },
                    { thai: "", english: "to lift" },
                    { thai: "", english: "to place/put down" },
                    { thai: "", english: "to hang" },
                    { thai: "", english: "to unwrap/open" },
                    { thai: "", english: "to wrap" },
                    { thai: "", english: "to cut" }
                ]
            },
            {
                name: "Grammar & Particles",
                words: [
                    { thai: "", english: "but" },
                    { thai: "", english: "and" },
                    { thai: "", english: "or" },
                    { thai: "", english: "because" },
                    { thai: "", english: "if" },
                    { thai: "", english: "then/also" },
                    { thai: "", english: "also/too/with" },
                    { thai: "", english: "so/at all/very" },
                    { thai: "", english: "(softener particle)" },
                    { thai: "", english: "(polite particle, male)" },
                    { thai: "", english: "(polite particle, female)" },
                    { thai: "", english: "(question particle, female)" },
                    { thai: "", english: "(yes/no question)" },
                    { thai: "", english: "(urging particle)" },
                    { thai: "", english: "(really?/is that so?)" },
                    { thai: "", english: "I (female)" },
                    { thai: "", english: "I (male)" },
                    { thai: "", english: "you" },
                    { thai: "", english: "he/she/they" },
                    { thai: "", english: "we" },
                    { thai: "", english: "it" },
                    { thai: "", english: "this" },
                    { thai: "", english: "that" },
                    { thai: "", english: "that (over there)" },
                    { thai: "", english: "of/belonging to" },
                    { thai: "", english: "that/which/where" },
                    { thai: "", english: "not/no" },
                    { thai: "", english: "yes/correct" },
                    { thai: "", english: "no/not correct" },
                    { thai: "", english: "enough" },
                    { thai: "", english: "very/much" },
                    { thai: "", english: "little/few" },
                    { thai: "", english: "every/all" },
                    { thai: "", english: "some" },
                    { thai: "", english: "just/only" },
                    { thai: "", english: "oneself/itself" }
                ]
            },
            {
                name: "Common Phrases",
                words: [
                    { thai: "", english: "How are you?" },
                    { thai: "", english: "I'm fine" },
                    { thai: "", english: "Not well/sick" },
                    { thai: "", english: "Long time no see" },
                    { thai: "", english: "Nice to meet you" },
                    { thai: "", english: "Have you eaten?" },
                    { thai: "", english: "Already ate" },
                    { thai: "", english: "Haven't eaten yet" },
                    { thai: "", english: "What's up?" },
                    { thai: "", english: "How's it going?" },
                    { thai: "", english: "See you later" },
                    { thai: "", english: "See you tomorrow" },
                    { thai: "", english: "Good luck!" },
                    { thai: "", english: "Congratulations!" },
                    { thai: "", english: "Happy birthday!" },
                    { thai: "", english: "Best wishes" },
                    { thai: "", english: "Up to you" },
                    { thai: "", english: "Never mind/forget it" },
                    { thai: "", english: "Really?" },
                    { thai: "", english: "No way!" },
                    { thai: "", english: "Of course/certainly" },
                    { thai: "", english: "I understand now" },
                    { thai: "", english: "Wait a moment" },
                    { thai: "", english: "Make yourself at home" },
                    { thai: "", english: "Please (go ahead)" },
                    { thai: "", english: "Sorry about that" },
                    { thai: "", english: "Don't worry" },
                    { thai: "", english: "Be careful" },
                    { thai: "", english: "Are you tired?" },
                    { thai: "", english: "Are you hungry?" },
                    { thai: "", english: "It's very hot" },
                    { thai: "", english: "It's raining" },
                    { thai: "", english: "What would you like?" },
                    { thai: "", english: "Very delicious!" },
                    { thai: "", english: "Is it cool?" },
                    { thai: "", english: "Is it fun?" },
                    { thai: "", english: "It's been so long!" },
                    { thai: "", english: "I miss you" },
                    { thai: "", english: "See you again" },
                    { thai: "", english: "What should I do?" },
                    { thai: "", english: "Don't be shy/Don't hold back" },
                    { thai: "", english: "It's no big deal" },
                    { thai: "", english: "I'm heading home" },
                    { thai: "", english: "See you around" },
                    { thai: "", english: "Take care of yourself" },
                    { thai: "", english: "Rest well" },
                    { thai: "", english: "Get well soon" },
                    { thai: "", english: "Have a safe trip" },
                    { thai: "", english: "Don't forget" },
                    { thai: "", english: "Do you understand?" },
                    { thai: "", english: "Can you say that again?" },
                    { thai: "", english: "It's okay/Never mind" },
                    { thai: "", english: "Alright then/That works" },
                    { thai: "", english: "Are you sure?" },
                    { thai: "", english: "Can do/Possible" }
                ]
            },
            {
                name: "Development & International",
                words: [
                    { thai: "", english: "development" },
                    { thai: "", english: "sustainable development" },
                    { thai: "", english: "sustainability" },
                    { thai: "", english: "United Nations" },
                    { thai: "", english: "organization" },
                    { thai: "", english: "international organization" },
                    { thai: "", english: "goal/target" },
                    { thai: "", english: "policy" },
                    { thai: "", english: "project/program" },
                    { thai: "", english: "cooperation" },
                    { thai: "", english: "assistance/aid" },
                    { thai: "", english: "funding/capital" },
                    { thai: "", english: "budget" },
                    { thai: "", english: "poverty" },
                    { thai: "", english: "inequality" },
                    { thai: "", english: "environment" },
                    { thai: "", english: "climate change" },
                    { thai: "", english: "renewable energy" },
                    { thai: "", english: "clean energy" },
                    { thai: "", english: "education" },
                    { thai: "", english: "public health" },
                    { thai: "", english: "human rights" },
                    { thai: "", english: "equality" },
                    { thai: "", english: "gender equality" },
                    { thai: "", english: "community" },
                    { thai: "", english: "people/citizens" },
                    { thai: "", english: "stakeholder" },
                    { thai: "", english: "civil society" },
                    { thai: "", english: "private sector" },
                    { thai: "", english: "public sector/government" },
                    { thai: "", english: "government" },
                    { thai: "", english: "ministry" },
                    { thai: "", english: "developing country" },
                    { thai: "", english: "developed country" },
                    { thai: "", english: "resources" },
                    { thai: "", english: "natural resources" },
                    { thai: "", english: "clean water" },
                    { thai: "", english: "sanitation" },
                    { thai: "", english: "infrastructure" },
                    { thai: "", english: "meeting/conference" },
                    { thai: "", english: "agreement" },
                    { thai: "", english: "treaty" },
                    { thai: "", english: "negotiation" },
                    { thai: "", english: "indicator" },
                    { thai: "", english: "monitoring" },
                    { thai: "", english: "evaluation" },
                    { thai: "", english: "report" },
                    { thai: "", english: "data/information" },
                    { thai: "", english: "research" },
                    { thai: "", english: "innovation" },
                    { thai: "", english: "technology" },
                    { thai: "", english: "digital" },
                    { thai: "", english: "refugee" },
                    { thai: "", english: "migration" },
                    { thai: "", english: "humanitarian" },
                    { thai: "", english: "disaster" },
                    { thai: "", english: "emergency" },
                    { thai: "", english: "recovery/rehabilitation" },
                    { thai: "", english: "security" },
                    { thai: "", english: "peace" }
                ]
            }
        ];

        // Generate mixed lists from themed lists
        // Mixed list size (cards per list)
        let mixedListSize = parseInt(localStorage.getItem('thaiFlashcardsMixedListSize')) || 200;
        
        function generateMixedLists(chunkSize = mixedListSize) {
            // Collect all words with their theme index for even distribution
            const allWords = [];
            themedLists.forEach((theme, themeIdx) => {
                theme.words.forEach(word => {
                    allWords.push({ ...word, themeIdx });
                });
            });
            
            // Randomly shuffle all words
            for (let i = allWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allWords[i], allWords[j]] = [allWords[j], allWords[i]];
            }
            
            // Split into chunks of specified size
            const mixedLists = [];
            const numLists = Math.ceil(allWords.length / chunkSize);
            
            for (let i = 0; i < numLists; i++) {
                const start = i * chunkSize;
                const end = Math.min(start + chunkSize, allWords.length);
                const words = allWords.slice(start, end).map(({ thai, english }) => ({ thai, english }));
                mixedLists.push({
                    name: "Mixed List " + (i + 1) + " (" + words.length + " words)",
                    words
                });
            }
            
            return mixedLists;
        }

        let mixedLists = generateMixedLists();
        
        // Current view mode: 'themed' or 'mixed'
        let viewMode = localStorage.getItem('thaiFlashcardsViewMode') || 'mixed';
        
        // Get active vocabulary lists based on view mode
        function getActiveVocabularyLists() {
            return viewMode === 'themed' ? themedLists : mixedLists;
        }
        
        let vocabularyLists = getActiveVocabularyLists();

        const LEARNING_THRESHOLD = 3;
        const BASE_REVIEW_DAYS = 7; // Base review interval for easily learned words
        const MIN_REVIEW_DAYS = 1;  // Minimum review interval for hard words
        
        // Calculate review interval based on difficulty
        // Words learned easily (low incorrect count, high streak) get longer intervals
        // Words learned with difficulty get shorter intervals
        function getReviewInterval(stats) {
            if (!stats) return BASE_REVIEW_DAYS;
            
            const incorrectCount = stats.incorrect || 0;
            const correctCount = stats.correct || 0;
            const streak = stats.consecutiveCorrect || 0;
            
            // Difficulty factor: higher = harder word
            // Based on ratio of incorrect to total attempts and absolute incorrect count
            const totalAttempts = correctCount + incorrectCount;
            const errorRate = totalAttempts > 0 ? incorrectCount / totalAttempts : 0;
            
            // Ease factor: starts at 1.0, increases with streak, decreases with errors
            // Range roughly 0.3 (very hard) to 2.5 (very easy)
            let easeFactor = 1.0;
            easeFactor += (streak - LEARNING_THRESHOLD) * 0.2; // Bonus for streaks beyond threshold
            easeFactor -= errorRate * 1.5; // Penalty for error rate
            easeFactor -= Math.min(incorrectCount * 0.1, 0.5); // Additional penalty for absolute errors
            easeFactor = Math.max(0.3, Math.min(2.5, easeFactor)); // Clamp
            
            // Calculate interval: base * ease factor
            const interval = BASE_REVIEW_DAYS * easeFactor;
            return Math.max(MIN_REVIEW_DAYS, Math.round(interval * 10) / 10);
        }

        // Utility functions - must be defined before use
        function getCardKey(card) { return card.thai + "|" + card.english; }
        
        // Get global stats for a card (not list-dependent)
        function getCardStats(key) {
            if (!cardStats.global) cardStats.global = {};
            return cardStats.global;
        }
        
        // Legacy function for compatibility - redirects to global stats
        function getListStats(idx) { 
            return getCardStats(); 
        }
        
        // Migrate old list-indexed stats to global stats
        function migrateOldStats() {
            if (cardStats.global) return; // Already migrated
            
            cardStats.global = {};
            
            // Merge all old list-based stats into global
            for (let i = 0; i < 100; i++) { // Check up to 100 old list indices
                if (cardStats[i] && typeof cardStats[i] === 'object') {
                    for (const key in cardStats[i]) {
                        if (cardStats[i].hasOwnProperty(key) && key.includes('|')) {
                            // Only copy if we don't already have this key, or if this one has more progress
                            const existing = cardStats.global[key];
                            const incoming = cardStats[i][key];
                            if (!existing || 
                                (incoming.consecutiveCorrect || 0) > (existing.consecutiveCorrect || 0) ||
                                ((incoming.correct || 0) + (incoming.incorrect || 0)) > 
                                ((existing.correct || 0) + (existing.incorrect || 0))) {
                                cardStats.global[key] = incoming;
                            }
                        }
                    }
                    // Remove old list-indexed stats
                    delete cardStats[i];
                }
            }
        }

        let currentListIndex = 0;
        let vocabulary = vocabularyLists[currentListIndex].words;
        let cards = [];
        let currentIndex = 0;
        let isFlipped = false;
        let showThaiFront = localStorage.getItem('thaiFlashcardsThaiFront') !== 'false';
        let autoPlayAudio = localStorage.getItem('thaiFlashcardsAutoPlay') === 'true';
        let currentMode = 'all';
        let cardStats = {};
        let sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
        let sessionState = { cardOrder: [], currentIndex: 0, listIndex: 0, mode: 'all', inProgress: false };
        let favorites = new Set(); // Track favorited card keys
        let darkMode = false;
        
        // Mode-specific state: track cards and position separately for each mode
        let modeState = {
            all: { cards: [], currentIndex: 0 },
            review: { cards: [], currentIndex: 0 }
        };

        // Special list indices (negative to distinguish from vocabulary lists)
        const FAVORITES_LIST = -1;
        const HARDEST_LIST = -2;
        const ALL_CARDS_LIST = -3;

        let touchStartX = 0, touchStartY = 0, currentX = 0, isSwiping = false, lastTouchEnd = 0;

        const flashcard = document.getElementById('flashcard');
        const frontText = document.getElementById('frontText');
        const backText = document.getElementById('backText');
        const frontRomanization = document.getElementById('frontRomanization');
        const backRomanization = document.getElementById('backRomanization');
        const masteryIndicator = document.getElementById('masteryIndicator');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const flipBtn = document.getElementById('flipBtn');
        const sentenceBtn = document.getElementById('sentenceBtn');
        const sentenceExample = document.getElementById('sentenceExample');
        const sentenceThai = document.getElementById('sentenceThai');
        const sentenceRoman = document.getElementById('sentenceRoman');
        const sentenceEnglish = document.getElementById('sentenceEnglish');
        const cardCounter = document.getElementById('cardCounter');
        const progressPercent = document.getElementById('progressPercent');
        const progressFill = document.getElementById('progressFill');
        const correctScore = document.getElementById('correctScore');
        const incorrectScore = document.getElementById('incorrectScore');
        const csvFileInput = document.getElementById('csvFileInput');
        const optionsBtn = document.getElementById('optionsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const statsModal = document.getElementById('statsModal');
        const optionsModal = document.getElementById('optionsModal');
        const resumeModal = document.getElementById('resumeModal');
        const listSelector = document.getElementById('listSelector');
        const listProgressDisplay = document.getElementById('listProgressDisplay');
        const swipeLeft = document.getElementById('swipeLeft');
        const swipeRight = document.getElementById('swipeRight');
        const swipeBarLeft = document.getElementById('swipeBarLeft');
        const swipeBarRight = document.getElementById('swipeBarRight');
        const toast = document.getElementById('toast');
        const modeBtns = document.querySelectorAll('.mode-btn');
        const themeToggle = document.getElementById('themeToggle');
        const romanizationToggle = document.getElementById('romanizationToggle');
        
        // App mode (flashcards vs grammar)
        let currentAppMode = 'flashcards';
        
        // Grammar functions
        function renderGrammarLessonsList() {
            var container = document.getElementById('grammarLessonsList');
            var html = '';
            
            grammarLessons.forEach(function(lesson, index) {
                var isCompleted = lessonProgress[lesson.id];
                var statusClass = isCompleted ? 'completed' : '';
                var statusText = isCompleted ? ' Practice' : 'Start Lesson';
                
                html += '<div class="grammar-lesson-card ' + statusClass + '" data-lesson="' + index + '" data-completed="' + (isCompleted ? 'true' : 'false') + '">' +
                    '<div class="lesson-card-header">' +
                        '<span class="lesson-card-title">' + lesson.title + '</span>' +
                        '<span class="lesson-card-thai">' + lesson.structure + '</span>' +
                    '</div>' +
                    '<div class="lesson-card-desc">' + lesson.description + '</div>' +
                    '<div class="lesson-card-example">' +
                        '<div class="thai">' + lesson.examples[0].thai + '</div>' +
                        '<div class="english">' + lesson.examples[0].english + '</div>' +
                    '</div>' +
                    '<div class="lesson-card-footer">' +
                        '<span class="lesson-card-status ' + statusClass + '">' + (isCompleted ? ' Learned' : '') + '</span>' +
                        '<button class="lesson-card-btn ' + statusClass + '">' + statusText + '</button>' +
                    '</div>' +
                '</div>';
            });
            
            container.innerHTML = html;
            
            // Add click listeners
            document.querySelectorAll('.grammar-lesson-card').forEach(function(card) {
                card.addEventListener('click', function(e) {
                    // Prevent double firing if clicking the button
                    if (e.target.classList.contains('lesson-card-btn')) return;
                    
                    var lessonIndex = parseInt(this.getAttribute('data-lesson'));
                    var isCompleted = this.getAttribute('data-completed') === 'true';
                    
                    if (isCompleted) {
                        // Go straight to practice
                        openGrammarLesson(lessonIndex);
                        currentStepIndex = 4; // Go to build sentence step
                        renderLessonStep();
                    } else {
                        openGrammarLesson(lessonIndex);
                    }
                });
            });
            
            // Button click listeners
            document.querySelectorAll('.lesson-card-btn').forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    var card = this.closest('.grammar-lesson-card');
                    var lessonIndex = parseInt(card.getAttribute('data-lesson'));
                    var isCompleted = card.getAttribute('data-completed') === 'true';
                    
                    if (isCompleted) {
                        // Go straight to build practice
                        currentLessonIndex = lessonIndex;
                        var lesson = grammarLessons[lessonIndex];
                        startPractice(lesson.id, 'build');
                    } else {
                        openGrammarLesson(lessonIndex);
                    }
                });
            });
        }
        
        function openGrammarLesson(index) {
            currentLessonIndex = index;
            currentStepIndex = 0;
            
            document.getElementById('grammarLessonsList').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'block';
            
            renderLessonStep();
        }
        
        function closeGrammarLesson() {
            currentLessonIndex = null;
            currentStepIndex = 0;
            
            document.getElementById('grammarLessonView').style.display = 'none';
            document.getElementById('grammarLessonsList').style.display = 'flex';
            
            renderGrammarLessonsList();
        }
        
        function renderLessonStep() {
            var lesson = grammarLessons[currentLessonIndex];
            var container = document.getElementById('lessonContent');
            var totalSteps = 5; // Structure, Explanation, Examples, Guided Practice, Build Sentences
            
            document.getElementById('lessonProgress').textContent = (currentStepIndex + 1) + ' / ' + totalSteps;
            
            var html = '';
            
            if (currentStepIndex === 0) {
                // Structure overview
                html = '<div class="lesson-step active">' +
                    '<div class="lesson-step-title">Pattern</div>' +
                    '<div class="lesson-structure">' +
                        '<div class="lesson-structure-thai">' + lesson.structure + '</div>' +
                        '<div class="lesson-structure-roman">' + lesson.structureRoman + '</div>' +
                        '<div class="lesson-structure-english">' + lesson.structureEnglish + '</div>' +
                    '</div>' +
                    '<div class="lesson-explanation">' + lesson.description + '</div>' +
                '</div>';
            } else if (currentStepIndex === 1) {
                // Explanation
                if (lesson.id === 'telling-time') {
                    // Special interactive clock for telling-time lesson
                    html = '<div class="lesson-step active">' +
                        '<div class="lesson-step-title">Tap a section to learn</div>' +
                        '<div id="interactiveTimeClockContainer"></div>' +
                    '</div>';
                } else {
                    html = '<div class="lesson-step active">' +
                        '<div class="lesson-step-title">How it works</div>' +
                        '<div class="lesson-structure">' +
                            '<div class="lesson-structure-thai">' + lesson.structure + '</div>' +
                        '</div>' +
                        '<div class="lesson-explanation">' + lesson.explanation + '</div>' +
                    '</div>';
                }
            } else if (currentStepIndex === 2) {
                // Examples
                html = '<div class="lesson-step active">' +
                    '<div class="lesson-step-title">Examples</div>' +
                    '<div class="lesson-examples">';
                
                lesson.examples.forEach(function(ex) {
                    html += '<div class="example-card">' +
                        '<div class="example-thai">' + ex.thai + '</div>' +
                        '<div class="example-roman">' + ex.roman + '</div>' +
                        '<div class="example-english">' + ex.english + '</div>' +
                    '</div>';
                });
                
                html += '</div></div>';
            } else if (currentStepIndex === 3) {
                // Step 4: Guided practice
                var hasTemplates = grammarPracticeTemplates[lesson.id];
                
                // Special clock practice for telling-time lesson
                if (lesson.id === 'telling-time') {
                    html = '<div class="lesson-step active">' +
                        '<div class="lesson-step-title"> Clock Practice</div>' +
                        '<p style="color: var(--text-secondary); margin-bottom: 16px; text-align: center;">Read the clock and select the correct Thai time:</p>' +
                        '<div id="clockPracticeContainer"></div>' +
                    '</div>';
                } else {
                    html = '<div class="lesson-step active">' +
                        '<div class="lesson-step-title">Guided Practice</div>' +
                        '<p style="color: var(--text-secondary); margin-bottom: 16px; text-align: center;">Fill in the grammar words to complete this sentence:</p>';
                    
                    if (hasTemplates) {
                        // Will be populated by startGuidedFillBlank
                        html += '<div id="guidedFillBlankContainer"></div>';
                    } else {
                        html += '<p style="text-align: center; color: var(--text-muted);">No guided practice available for this lesson.</p>';
                    }
                    
                    html += '</div>';
                }
            } else if (currentStepIndex === 4) {
                // Step 5: Build Sentence practice (repeatable)
                var hasTemplates = grammarPracticeTemplates[lesson.id];
                
                // Special extra practice options for telling-time
                if (lesson.id === 'telling-time') {
                    html = '<div class="lesson-step active">' +
                        '<div class="lesson-step-title">More Practice</div>' +
                        '<div class="lesson-structure" style="margin-bottom: 16px;">' +
                            '<div class="lesson-structure-thai">' + lesson.structure + '</div>' +
                            '<div class="lesson-structure-english">' + lesson.structureEnglish + '</div>' +
                        '</div>' +
                        '<p style="color: var(--text-secondary); margin-bottom: 20px; text-align: center;">Choose your practice mode:</p>' +
                        '<div class="practice-start-buttons" style="display: flex; flex-direction: column; gap: 12px;">' +
                            '<button class="btn-action" id="clockPracticeBtn" style="width: 100%;">' +
                                '<strong> Clock Practice</strong><br>' +
                                '<small style="opacity: 0.8;">Read analog clock, pick Thai time</small>' +
                            '</button>' +
                            '<button class="btn-action practice-start-btn" data-mode="fillblank" style="width: 100%;">' +
                                '<strong> Fill in the Blank</strong><br>' +
                                '<small style="opacity: 0.8;">Match times to Thai expressions</small>' +
                            '</button>' +
                            '<button class="btn-action practice-start-btn" data-mode="build" style="width: 100%;">' +
                                '<strong> Build Time Words</strong><br>' +
                                '<small style="opacity: 0.8;">Arrange Thai words in correct order</small>' +
                            '</button>' +
                        '</div>' +
                    '</div>';
                } else {
                    html = '<div class="lesson-step active">' +
                        '<div class="lesson-step-title">Build Sentences</div>' +
                        '<div class="lesson-structure" style="margin-bottom: 16px;">' +
                            '<div class="lesson-structure-thai">' + lesson.structure + '</div>' +
                            '<div class="lesson-structure-english">' + lesson.structureEnglish + '</div>' +
                        '</div>';
                    
                    if (hasTemplates) {
                        html += '<p style="color: var(--text-secondary); margin-bottom: 20px; text-align: center;">Arrange the words to build correct sentences.</p>' +
                            '<div class="practice-start-buttons">' +
                                '<button class="btn-action practice-start-btn" data-mode="build" style="width: 100%;">' +
                                    '<strong> Start Practice</strong><br>' +
                                    '<small style="opacity: 0.8;">Arrange Thai words in correct order</small>' +
                                '</button>' +
                            '</div>';
                    } else {
                        html += '<p style="text-align: center; color: var(--text-muted);">No practice available for this lesson.</p>';
                    }
                    
                    html += '</div>';
                }
            }
            
            container.innerHTML = html;
            
            // Handle step-specific setup
            if (currentStepIndex === 1) {
                if (lesson.id === 'telling-time') {
                    // Render interactive time period clock
                    renderInteractiveTimeClock();
                }
            }
            
            if (currentStepIndex === 3) {
                if (lesson.id === 'telling-time') {
                    // Start clock practice for telling-time
                    startClockPractice();
                    // Allow navigation after a couple of questions
                    window.guidedPracticeCompleted = false;
                } else if (grammarPracticeTemplates[lesson.id]) {
                    // Start guided fill-in-blank for other lessons
                    startGuidedFillBlank(lesson.id);
                }
            }
            
            if (currentStepIndex === 4) {
                // Handle telling-time practice buttons
                if (lesson.id === 'telling-time') {
                    var clockBtn = document.getElementById('clockPracticeBtn');
                    if (clockBtn) {
                        clockBtn.addEventListener('click', function() {
                            showClockPracticeModal();
                        });
                    }
                }
                
                document.querySelectorAll('.practice-start-btn').forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        var mode = this.getAttribute('data-mode');
                        startPractice(lesson.id, mode);
                    });
                });
            }
            
            // Update nav buttons
            document.getElementById('lessonPrevBtn').disabled = currentStepIndex === 0;
            var totalSteps = 5;
            document.getElementById('lessonNextBtn').textContent = currentStepIndex === totalSteps - 1 ? 'Finish' : 'Next ';
            
            // Disable Next on guided practice step until completed correctly
            if (currentStepIndex === 3) {
                if (lesson.id === 'telling-time') {
                    // For clock practice, enable Next after first correct answer
                    document.getElementById('lessonNextBtn').disabled = false;
                } else if (grammarPracticeTemplates[lesson.id]) {
                    document.getElementById('lessonNextBtn').disabled = true;
                    window.guidedPracticeCompleted = false;
                } else {
                    document.getElementById('lessonNextBtn').disabled = false;
                }
            } else {
                document.getElementById('lessonNextBtn').disabled = false;
            }
        }
        
        function setupPracticeListeners() {
            var options = document.querySelectorAll('.practice-option');
            var checkBtn = document.getElementById('practiceCheckBtn');
            var selectedIndex = null;
            
            options.forEach(function(opt) {
                opt.addEventListener('click', function() {
                    if (this.classList.contains('correct') || this.classList.contains('incorrect')) return;
                    
                    options.forEach(function(o) { o.classList.remove('selected'); });
                    this.classList.add('selected');
                    selectedIndex = parseInt(this.getAttribute('data-index'));
                    checkBtn.disabled = false;
                });
            });
            
            checkBtn.addEventListener('click', function() {
                if (selectedIndex === null) return;
                
                var selected = document.querySelector('.practice-option.selected');
                var isCorrect = selected.getAttribute('data-correct') === 'true';
                var feedback = document.getElementById('practiceFeedback');
                
                // Show correct/incorrect
                options.forEach(function(opt) {
                    if (opt.getAttribute('data-correct') === 'true') {
                        opt.classList.add('correct');
                    } else if (opt.classList.contains('selected')) {
                        opt.classList.add('incorrect');
                    }
                });
                
                feedback.classList.add('show');
                feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
                
                // Mark lesson as completed
                var lesson = grammarLessons[currentLessonIndex];
                lessonProgress[lesson.id] = true;
                localStorage.setItem('thaiGrammarProgress', JSON.stringify(lessonProgress));
                
                checkBtn.textContent = isCorrect ? ' Correct!' : 'See explanation above';
                checkBtn.disabled = true;
            });
        }
        
        function nextLessonStep() {
            if (currentStepIndex < 4) {
                currentStepIndex++;
                renderLessonStep();
            } else {
                // Mark lesson as completed when finishing
                var lesson = grammarLessons[currentLessonIndex];
                lessonProgress[lesson.id] = true;
                localStorage.setItem('thaiGrammarProgress', JSON.stringify(lessonProgress));
                closeGrammarLesson();
            }
        }
        
        function prevLessonStep() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                renderLessonStep();
            }
        }
        
        // ============== ALPHABET TRAINING ==============
        
        // Thai consonants with class, sound, and example word
        const thaiConsonants = [
            // Mid class (9 consonants)
            { letter: '', roman: 'g', sound: 'g', class: 'mid', name: 'g gi', thaiName: '', example: ' (chicken)' },
            { letter: '', roman: 'j', sound: 'j', class: 'mid', name: 'j jaan', thaiName: '', example: ' (plate)' },
            { letter: '', roman: 'd', sound: 'd', class: 'mid', name: 'd ch-daa', thaiName: '', example: ' (headdress)' },
            { letter: '', roman: 'dt', sound: 'dt', class: 'mid', name: 'dt bp-dtk', thaiName: '', example: ' (spear)' },
            { letter: '', roman: 'd', sound: 'd', class: 'mid', name: 'd dk', thaiName: '', example: ' (child)' },
            { letter: '', roman: 'dt', sound: 'dt', class: 'mid', name: 'dt dto', thaiName: '', example: ' (turtle)' },
            { letter: '', roman: 'b', sound: 'b', class: 'mid', name: 'b bai-mai', thaiName: '', example: ' (leaf)' },
            { letter: '', roman: 'bp', sound: 'bp', class: 'mid', name: 'bp bplaa', thaiName: '', example: ' (fish)' },
            { letter: '', roman: '', sound: 'silent', class: 'mid', name: ' ang', thaiName: ' ', example: ' (basin)' },
            
            // High class (11 consonants)
            { letter: '', roman: 'k', sound: 'k', class: 'high', name: 'k ki', thaiName: '', example: ' (egg)' },
            { letter: '', roman: 'k', sound: 'k', class: 'high', name: 'k kat', thaiName: '', example: ' (bottle) [obsolete]' },
            { letter: '', roman: 'ch', sound: 'ch', class: 'high', name: 'ch chng', thaiName: '', example: ' (cymbals)' },
            { letter: '', roman: 't', sound: 't', class: 'high', name: 't tng', thaiName: '', example: ' (bag)' },
            { letter: '', roman: 'p', sound: 'p', class: 'high', name: 'p png', thaiName: '', example: ' (bee)' },
            { letter: '', roman: 'f', sound: 'f', class: 'high', name: 'f fa', thaiName: '', example: ' (lid)' },
            { letter: '', roman: 's', sound: 's', class: 'high', name: 's sa-laa', thaiName: '', example: ' (pavilion)' },
            { letter: '', roman: 's', sound: 's', class: 'high', name: 's r-si', thaiName: '', example: ' (hermit)' },
            { letter: '', roman: 's', sound: 's', class: 'high', name: 's sa', thaiName: '', example: ' (tiger)' },
            { letter: '', roman: 'h', sound: 'h', class: 'high', name: 'h hip', thaiName: '', example: ' (chest)' },
            
            // Low class (24 consonants)
            { letter: '', roman: 'k', sound: 'k', class: 'low', name: 'k kwaai', thaiName: '', example: ' (buffalo)' },
            { letter: '', roman: 'k', sound: 'k', class: 'low', name: 'k kon', thaiName: '', example: ' (person) [obsolete]' },
            { letter: '', roman: 'k', sound: 'k', class: 'low', name: 'k r-kang', thaiName: '', example: ' (bell)' },
            { letter: '', roman: 'ng', sound: 'ng', class: 'low', name: 'ng nguu', thaiName: '', example: ' (snake)' },
            { letter: '', roman: 'ch', sound: 'ch', class: 'low', name: 'ch chang', thaiName: '', example: ' (elephant)' },
            { letter: '', roman: 's', sound: 's', class: 'low', name: 's so', thaiName: '', example: ' (chain)' },
            { letter: '', roman: 'ch', sound: 'ch', class: 'low', name: 'ch g-ch', thaiName: '', example: ' (tree)' },
            { letter: '', roman: 'y', sound: 'y', class: 'low', name: 'y yng', thaiName: '', example: ' (woman)' },
            { letter: '', roman: 't', sound: 't', class: 'low', name: 't mon-too', thaiName: '', example: ' (Montho)' },
            { letter: '', roman: 't', sound: 't', class: 'low', name: 't pu-to', thaiName: '', example: ' (elder)' },
            { letter: '', roman: 'n', sound: 'n', class: 'low', name: 'n neen', thaiName: '', example: ' (novice)' },
            { letter: '', roman: 't', sound: 't', class: 'low', name: 't t-han', thaiName: '', example: ' (soldier)' },
            { letter: '', roman: 't', sound: 't', class: 'low', name: 't tong', thaiName: '', example: ' (flag)' },
            { letter: '', roman: 'n', sound: 'n', class: 'low', name: 'n nu', thaiName: '', example: ' (mouse)' },
            { letter: '', roman: 'p', sound: 'p', class: 'low', name: 'p paan', thaiName: '', example: ' (tray)' },
            { letter: '', roman: 'f', sound: 'f', class: 'low', name: 'f fan', thaiName: '', example: ' (teeth)' },
            { letter: '', roman: 'p', sound: 'p', class: 'low', name: 'p sm-pao', thaiName: '', example: ' (junk boat)' },
            { letter: '', roman: 'm', sound: 'm', class: 'low', name: 'm ma', thaiName: '', example: ' (horse)' },
            { letter: '', roman: 'y', sound: 'y', class: 'low', name: 'y yk', thaiName: '', example: ' (giant)' },
            { letter: '', roman: 'r', sound: 'r', class: 'low', name: 'r ra', thaiName: '', example: ' (boat)' },
            { letter: '', roman: 'l', sound: 'l', class: 'low', name: 'l ling', thaiName: '', example: ' (monkey)' },
            { letter: '', roman: 'w', sound: 'w', class: 'low', name: 'w wen', thaiName: '', example: ' (ring)' },
            { letter: '', roman: 'l', sound: 'l', class: 'low', name: 'l j-laa', thaiName: '', example: ' (kite)' },
            { letter: '', roman: 'h', sound: 'h', class: 'low', name: 'h nk-huk', thaiName: '', example: ' (owl)' }
        ];
        
        // Common consonants to start with (most frequently used)
        const commonConsonants = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];
        
        // Alphabet practice state
        let alphabetState = {
            mode: null, // 'recognize', 'sound', 'class'
            currentConsonant: null,
            options: [],
            answered: false,
            score: { correct: 0, total: 0 },
            questionNumber: 0
        };
        
        // Alphabet progress (persisted)
        let alphabetProgress = JSON.parse(localStorage.getItem('thaiAlphabetProgress') || '{}');
        
        // Start alphabet practice mode
        function startAlphabetMode(mode) {
            alphabetState = {
                mode: mode,
                currentConsonant: null,
                options: [],
                answered: false,
                score: { correct: 0, total: 0 },
                questionNumber: 0
            };
            
            document.getElementById('alphabetModes').style.display = 'none';
            document.getElementById('alphabetProgressOverview').style.display = 'none';
            document.getElementById('alphabetPracticeView').style.display = 'block';
            
            const modeNames = {
                'recognize': 'Recognition',
                'sound': 'Sound Match',
                'class': 'Tone Class'
            };
            document.getElementById('alphabetPracticeMode').textContent = modeNames[mode];
            
            document.getElementById('alphabetBackBtn').onclick = function() {
                document.getElementById('alphabetPracticeView').style.display = 'none';
                document.getElementById('alphabetModes').style.display = 'grid';
                document.getElementById('alphabetProgressOverview').style.display = 'block';
                updateAlphabetProgressDisplay();
            };
            
            nextAlphabetQuestion();
        }
        
        // Generate next alphabet question
        function nextAlphabetQuestion() {
            alphabetState.questionNumber++;
            alphabetState.answered = false;
            
            // Pick a random consonant (prefer common ones for beginners)
            const useCommon = Math.random() < 0.7;
            let pool = useCommon ? thaiConsonants.filter(c => commonConsonants.includes(c.letter)) : thaiConsonants;
            const randomIndex = Math.floor(Math.random() * pool.length);
            alphabetState.currentConsonant = pool[randomIndex];
            
            // Generate options based on mode
            if (alphabetState.mode === 'recognize') {
                alphabetState.options = generateRecognitionOptions(alphabetState.currentConsonant);
            } else if (alphabetState.mode === 'sound') {
                alphabetState.options = generateSoundOptions(alphabetState.currentConsonant);
            }
            
            renderAlphabetQuestion();
        }
        
        // Generate options for recognition mode (letter  sound)
        function generateRecognitionOptions(correct) {
            let options = [correct];
            
            // Find similar sounding consonants as distractors
            const similar = thaiConsonants.filter(c => 
                c.letter !== correct.letter && 
                (c.sound === correct.sound || c.class === correct.class)
            );
            shuffleArray(similar).slice(0, 2).forEach(c => {
                if (options.length < 4) options.push(c);
            });
            
            // Fill with random if needed
            const others = thaiConsonants.filter(c => !options.some(o => o.letter === c.letter));
            shuffleArray(others).slice(0, 4 - options.length).forEach(c => options.push(c));
            
            return shuffleArray(options);
        }
        
        // Generate options for sound mode (sound  letter)
        function generateSoundOptions(correct) {
            let options = [correct];
            
            // Find consonants with same sound as distractors
            const sameSound = thaiConsonants.filter(c => 
                c.letter !== correct.letter && c.sound === correct.sound
            );
            shuffleArray(sameSound).slice(0, 1).forEach(c => {
                if (options.length < 4) options.push(c);
            });
            
            // Add some from same class
            const sameClass = thaiConsonants.filter(c => 
                c.letter !== correct.letter && c.class === correct.class && !options.some(o => o.letter === c.letter)
            );
            shuffleArray(sameClass).slice(0, 1).forEach(c => {
                if (options.length < 4) options.push(c);
            });
            
            // Fill with random
            const others = thaiConsonants.filter(c => !options.some(o => o.letter === c.letter));
            shuffleArray(others).slice(0, 4 - options.length).forEach(c => options.push(c));
            
            return shuffleArray(options);
        }
        
        // Render alphabet question
        function renderAlphabetQuestion() {
            const container = document.getElementById('alphabetPracticeContent');
            const consonant = alphabetState.currentConsonant;
            
            document.getElementById('alphabetScore').textContent = 
                `${alphabetState.score.correct} / ${alphabetState.score.total}`;
            
            const audioBtn = `<button class="quiz-audio-btn" onclick="speakCurrentQuizConsonant()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                </svg>
            </button>`;
            
            let html = '';
            
            if (alphabetState.mode === 'recognize') {
                // Show letter, pick the sound
                html = `
                    <div class="alphabet-question">
                        <div class="alphabet-question-letter">${consonant.letter}${audioBtn}</div>
                        <div class="alphabet-question-prompt">What sound does this make?</div>
                    </div>
                    <div class="alphabet-options">
                        ${alphabetState.options.map((opt, idx) => `
                            <div class="alphabet-option" data-index="${idx}" onclick="selectAlphabetOption(${idx})">
                                <div class="alphabet-option-main">${opt.roman}</div>
                                <div class="alphabet-option-sub">${opt.sound}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="alphabetFeedback"></div>
                `;
            } else if (alphabetState.mode === 'sound') {
                // Show sound, pick the letter
                html = `
                    <div class="alphabet-question">
                        <div class="alphabet-question-letter" style="font-size: 2.5em;">${consonant.roman}</div>
                        <div class="alphabet-question-prompt">Which letter makes this sound?</div>
                    </div>
                    <div class="alphabet-options">
                        ${alphabetState.options.map((opt, idx) => `
                            <div class="alphabet-option" data-index="${idx}" onclick="selectAlphabetOption(${idx})">
                                <div class="alphabet-option-main" style="font-size: 2em;">${opt.letter}</div>
                                <div class="alphabet-option-sub">${opt.name}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div id="alphabetFeedback"></div>
                `;
            } else if (alphabetState.mode === 'class') {
                // Show letter, pick the class
                html = `
                    <div class="alphabet-question">
                        <div class="alphabet-question-letter">${consonant.letter}${audioBtn}</div>
                        <div class="alphabet-question-prompt" style="margin-bottom: 8px;">${consonant.roman}</div>
                        <div class="alphabet-question-prompt">What tone class?</div>
                    </div>
                    <div class="class-options">
                        <div class="class-option low" onclick="selectClassOption('low')">
                            <div class="class-option-label">Low</div>
                        </div>
                        <div class="class-option mid" onclick="selectClassOption('mid')">
                            <div class="class-option-label">Mid</div>
                        </div>
                        <div class="class-option high" onclick="selectClassOption('high')">
                            <div class="class-option-label">High</div>
                        </div>
                    </div>
                    <div id="alphabetFeedback"></div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // Handle option selection for recognize/sound modes
        function selectAlphabetOption(index) {
            if (alphabetState.answered) {
                nextAlphabetQuestion();
                return;
            }
            
            alphabetState.answered = true;
            alphabetState.score.total++;
            
            const selected = alphabetState.options[index];
            const correct = alphabetState.currentConsonant;
            const isCorrect = selected.letter === correct.letter;
            
            if (isCorrect) {
                alphabetState.score.correct++;
                playCorrectSound();
                updateAlphabetProgress(correct.letter, true);
            } else {
                playIncorrectSound();
                updateAlphabetProgress(correct.letter, false);
            }
            
            // Update option styles
            document.querySelectorAll('.alphabet-option').forEach((opt, idx) => {
                const optData = alphabetState.options[idx];
                if (optData.letter === correct.letter) {
                    opt.classList.add('correct-answer');
                    if (isCorrect) opt.classList.add('correct');
                } else if (idx === index) {
                    opt.classList.add('incorrect');
                }
            });
            
            // Show feedback
            showAlphabetFeedback(isCorrect, correct);
        }
        
        // Handle class selection
        function selectClassOption(selectedClass) {
            if (alphabetState.answered) {
                nextAlphabetQuestion();
                return;
            }
            
            alphabetState.answered = true;
            alphabetState.score.total++;
            
            const correct = alphabetState.currentConsonant;
            const isCorrect = selectedClass === correct.class;
            
            if (isCorrect) {
                alphabetState.score.correct++;
                playCorrectSound();
                updateAlphabetProgress(correct.letter, true);
            } else {
                playIncorrectSound();
                updateAlphabetProgress(correct.letter, false);
            }
            
            // Update class option styles
            document.querySelectorAll('.class-option').forEach(opt => {
                if (opt.classList.contains(correct.class)) {
                    opt.classList.add('correct');
                } else if (opt.classList.contains(selectedClass) && !isCorrect) {
                    opt.classList.add('incorrect');
                }
            });
            
            // Show feedback
            showAlphabetFeedback(isCorrect, correct, true);
        }
        
        // Show feedback after answer
        function showAlphabetFeedback(isCorrect, consonant, isClassMode = false) {
            const feedbackEl = document.getElementById('alphabetFeedback');
            
            const classColors = { low: '#22c55e', mid: '#3b82f6', high: '#f97316' };
            const classInfo = `<span style="color: ${classColors[consonant.class]}; font-weight: 600;">${consonant.class.toUpperCase()} class</span>`;
            
            if (isCorrect) {
                feedbackEl.innerHTML = `
                    <div class="alphabet-feedback correct">
                         Correct!
                    </div>
                    <div class="alphabet-feedback-detail">
                        ${consonant.letter} (${consonant.roman})  ${classInfo}<br>
                        ${consonant.example}
                    </div>
                    <div class="tap-to-continue">Tap anywhere to continue</div>
                `;
            } else {
                feedbackEl.innerHTML = `
                    <div class="alphabet-feedback incorrect">
                         The answer is ${isClassMode ? consonant.class.toUpperCase() : consonant.letter}
                    </div>
                    <div class="alphabet-feedback-detail">
                        ${consonant.letter} (${consonant.roman})  ${classInfo}<br>
                        ${consonant.example}
                    </div>
                    <div class="tap-to-continue">Tap anywhere to continue</div>
                `;
            }
            
            document.getElementById('alphabetScore').textContent = 
                `${alphabetState.score.correct} / ${alphabetState.score.total}`;
            
            // Make container tappable
            document.getElementById('alphabetPracticeContent').onclick = function() {
                if (alphabetState.answered) {
                    this.onclick = null;
                    nextAlphabetQuestion();
                }
            };
        }
        
        // Update progress for a consonant
        function updateAlphabetProgress(letter, correct) {
            if (!alphabetProgress[letter]) {
                alphabetProgress[letter] = { correct: 0, total: 0 };
            }
            alphabetProgress[letter].total++;
            if (correct) alphabetProgress[letter].correct++;
            localStorage.setItem('thaiAlphabetProgress', JSON.stringify(alphabetProgress));
        }
        
        // Update progress display
        function updateAlphabetProgressDisplay() {
            const mastered = Object.values(alphabetProgress).filter(p => p.correct >= 3 && p.correct / p.total >= 0.7).length;
            document.getElementById('consonantsMastered').textContent = mastered;
        }
        
        // Show full alphabet chart
        function showAlphabetChart() {
            document.getElementById('alphabetModes').style.display = 'none';
            document.getElementById('alphabetProgressOverview').style.display = 'none';
            document.getElementById('alphabetFlashcardView').style.display = 'none';
            document.getElementById('alphabetChartView').style.display = 'block';
            
            document.getElementById('alphabetChartBackBtn').onclick = function() {
                document.getElementById('alphabetChartView').style.display = 'none';
                document.getElementById('alphabetModes').style.display = 'grid';
                document.getElementById('alphabetProgressOverview').style.display = 'block';
            };
            
            renderAlphabetChart();
        }
        
        // Alphabet flashcard state
        let alphabetFlashcardState = {
            cards: [],
            currentIndex: 0,
            flipped: false,
            score: { known: 0, learning: 0 }
        };
        
        // Start alphabet flashcard mode
        // Alphabet flashcard swipe state
        let alphaTouchStartX = 0, alphaTouchStartY = 0, alphaCurrentX = 0, alphaIsSwiping = false;
        
        function startAlphabetFlashcards() {
            // Shuffle consonants
            alphabetFlashcardState.cards = shuffleArray([...thaiConsonants]);
            alphabetFlashcardState.currentIndex = 0;
            alphabetFlashcardState.flipped = false;
            alphabetFlashcardState.score = { correct: 0, incorrect: 0 };
            
            document.getElementById('alphabetModes').style.display = 'none';
            document.getElementById('alphabetProgressOverview').style.display = 'none';
            document.getElementById('alphabetFlashcardView').style.display = 'block';
            
            document.getElementById('alphabetFlashcardBackBtn').onclick = function() {
                document.getElementById('alphabetFlashcardView').style.display = 'none';
                document.getElementById('alphabetModes').style.display = 'grid';
                document.getElementById('alphabetProgressOverview').style.display = 'block';
                updateAlphabetProgressDisplay();
            };
            
            // Setup swipe handlers
            const alphaCard = document.getElementById('alphabetCard');
            
            // Touch events for swipe
            alphaCard.addEventListener('touchstart', handleAlphaTouchStart);
            alphaCard.addEventListener('touchmove', handleAlphaTouchMove);
            alphaCard.addEventListener('touchend', handleAlphaTouchEnd);
            
            // Click to flip
            alphaCard.addEventListener('click', function() {
                if (!alphaIsSwiping) {
                    toggleAlphabetFlashcard();
                }
            });
            
            updateAlphabetFlashcard();
        }
        
        function handleAlphaTouchStart(e) {
            if (e.touches.length > 1) return;
            alphaTouchStartX = alphaCurrentX = e.touches[0].clientX;
            alphaTouchStartY = e.touches[0].clientY;
            alphaIsSwiping = false;
        }
        
        function handleAlphaTouchMove(e) {
            if (!alphaTouchStartX) return;
            alphaCurrentX = e.touches[0].clientX;
            const diffX = alphaCurrentX - alphaTouchStartX;
            const diffY = e.touches[0].clientY - alphaTouchStartY;
            
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 10) {
                e.preventDefault();
                alphaIsSwiping = true;
                
                const card = document.getElementById('alphabetCard');
                card.classList.add('swiping');
                card.style.transform = "translateX(" + diffX + "px) rotateY(" + (alphabetFlashcardState.flipped ? 180 : 0) + "deg)";
                
                const intensity = Math.min(Math.abs(diffX) / 100, 1);
                
                const alphaSwipeRight = document.getElementById('alphaSwipeRight');
                const alphaSwipeLeft = document.getElementById('alphaSwipeLeft');
                const alphaSwipeBarRight = document.getElementById('alphaSwipeBarRight');
                const alphaSwipeBarLeft = document.getElementById('alphaSwipeBarLeft');
                
                if (diffX > 30) {
                    alphaSwipeRight.classList.add('visible');
                    alphaSwipeBarRight.classList.add('visible');
                    alphaSwipeBarRight.style.opacity = intensity;
                    alphaSwipeLeft.classList.remove('visible');
                    alphaSwipeBarLeft.classList.remove('visible');
                } else if (diffX < -30) {
                    alphaSwipeLeft.classList.add('visible');
                    alphaSwipeBarLeft.classList.add('visible');
                    alphaSwipeBarLeft.style.opacity = intensity;
                    alphaSwipeRight.classList.remove('visible');
                    alphaSwipeBarRight.classList.remove('visible');
                } else {
                    alphaSwipeLeft.classList.remove('visible');
                    alphaSwipeRight.classList.remove('visible');
                    alphaSwipeBarLeft.classList.remove('visible');
                    alphaSwipeBarRight.classList.remove('visible');
                }
            }
        }
        
        function handleAlphaTouchEnd() {
            if (!alphaTouchStartX) return;
            const diffX = alphaCurrentX - alphaTouchStartX;
            
            const alphaSwipeRight = document.getElementById('alphaSwipeRight');
            const alphaSwipeLeft = document.getElementById('alphaSwipeLeft');
            const alphaSwipeBarRight = document.getElementById('alphaSwipeBarRight');
            const alphaSwipeBarLeft = document.getElementById('alphaSwipeBarLeft');
            const card = document.getElementById('alphabetCard');
            
            alphaSwipeLeft.classList.remove('visible');
            alphaSwipeRight.classList.remove('visible');
            alphaSwipeBarLeft.classList.remove('visible');
            alphaSwipeBarRight.classList.remove('visible');
            alphaSwipeBarLeft.style.opacity = '';
            alphaSwipeBarRight.style.opacity = '';
            card.classList.remove('swiping');
            
            // Clear inline transform style
            card.style.transform = '';
            
            if (Math.abs(diffX) > 100) {
                // Unflip card before moving to next
                if (alphabetFlashcardState.flipped) {
                    card.style.transition = 'none';
                    card.classList.remove('flipped');
                    alphabetFlashcardState.flipped = false;
                    card.offsetHeight; // Force reflow
                    card.style.transition = '';
                }
                diffX > 0 ? alphabetFlashcardAnswer(true) : alphabetFlashcardAnswer(false);
            }
            
            alphaTouchStartX = alphaCurrentX = 0;
            setTimeout(() => { alphaIsSwiping = false; }, 100);
        }
        
        // Update the flashcard display
        function updateAlphabetFlashcard() {
            const cardData = alphabetFlashcardState.cards[alphabetFlashcardState.currentIndex];
            alphabetFlashcardState.flipped = false;
            
            const card = document.getElementById('alphabetCard');
            card.classList.remove('flipped');
            card.style.transform = '';
            
            document.getElementById('alphabetCardLetter').textContent = cardData.letter;
            document.getElementById('alphabetCardLetterBack').textContent = cardData.letter;
            document.getElementById('alphabetCardRoman').textContent = cardData.name;
            document.getElementById('alphabetCardClass').textContent = cardData.class.charAt(0).toUpperCase() + cardData.class.slice(1) + ' Class';
            document.getElementById('alphabetCardClass').className = 'alphabet-card-class ' + cardData.class;
            document.getElementById('alphabetCardExample').textContent = cardData.example;
            
            document.getElementById('alphabetFlashcardCounter').textContent = 
                `${alphabetFlashcardState.currentIndex + 1} / ${alphabetFlashcardState.cards.length}`;
            document.getElementById('alphabetFlashcardScore').textContent = 
                `${alphabetFlashcardState.score.correct} correct`;
            document.getElementById('alphaCorrectScore').textContent = alphabetFlashcardState.score.correct;
            document.getElementById('alphaIncorrectScore').textContent = alphabetFlashcardState.score.incorrect;
        }
        
        // Toggle flashcard flip
        function toggleAlphabetFlashcard() {
            alphabetFlashcardState.flipped = !alphabetFlashcardState.flipped;
            const card = document.getElementById('alphabetCard');
            card.classList.toggle('flipped', alphabetFlashcardState.flipped);
        }
        
        // Handle flashcard answer
        function alphabetFlashcardAnswer(correct) {
            const cardData = alphabetFlashcardState.cards[alphabetFlashcardState.currentIndex];
            
            if (correct) {
                alphabetFlashcardState.score.correct++;
                playCorrectSound();
                updateAlphabetProgress(cardData.letter, true);
            } else {
                alphabetFlashcardState.score.incorrect++;
                playIncorrectSound();
                updateAlphabetProgress(cardData.letter, false);
            }
            
            // Move to next card
            if (alphabetFlashcardState.currentIndex < alphabetFlashcardState.cards.length - 1) {
                alphabetFlashcardState.currentIndex++;
                updateAlphabetFlashcard();
            } else {
                // Finished all cards
                showAlphabetFlashcardComplete();
            }
        }
        
        // Speak current alphabet flashcard
        function speakCurrentAlphabetCard() {
            if (alphabetFlashcardState.cards && alphabetFlashcardState.cards[alphabetFlashcardState.currentIndex]) {
                const card = alphabetFlashcardState.cards[alphabetFlashcardState.currentIndex];
                speakThai(card.letter);
            }
        }
        
        // Speak current sorting card
        function speakCurrentSortingCard() {
            if (classSortingState.currentConsonant) {
                speakThai(classSortingState.currentConsonant.letter);
            }
        }
        
        // Speak current quiz consonant
        function speakCurrentQuizConsonant() {
            if (alphabetState.currentConsonant) {
                speakThai(alphabetState.currentConsonant.letter);
            }
        }
        
        // Speak a specific consonant letter
        function speakConsonant(letter) {
            speakThai(letter);
        }
        
        // Navigate flashcards
        function prevAlphabetFlashcard() {
            if (alphabetFlashcardState.currentIndex > 0) {
                alphabetFlashcardState.currentIndex--;
                updateAlphabetFlashcard();
            }
        }
        
        function nextAlphabetFlashcard() {
            if (alphabetFlashcardState.currentIndex < alphabetFlashcardState.cards.length - 1) {
                alphabetFlashcardState.currentIndex++;
                updateAlphabetFlashcard();
            }
        }
        
        // Show completion screen
        function showAlphabetFlashcardComplete() {
            const container = document.querySelector('.alphabet-flashcard-wrapper');
            const total = alphabetFlashcardState.cards.length;
            const correct = alphabetFlashcardState.score.correct;
            const percent = Math.round((correct / total) * 100);
            
            container.innerHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 3em; margin-bottom: 16px;"></div>
                    <h3 style="color: var(--text-primary); margin-bottom: 8px;">Session Complete!</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">
                        You got <strong>${correct}</strong> of <strong>${total}</strong> correct (${percent}%)
                    </p>
                    <button class="btn-action" onclick="startAlphabetFlashcards()" style="margin-right: 8px;"> Practice Again</button>
                    <button class="btn-action" onclick="document.getElementById('alphabetFlashcardBackBtn').click();"> Back to Menu</button>
                </div>
            `;
        }
        
        // ============== CLASS SORTING GAME ==============
        
        let classSortingState = {
            remaining: [],
            currentConsonant: null,
            bins: { low: [], mid: [], high: [] },
            isAnimating: false
        };
        
        function startClassSorting() {
            // Initialize with all consonants shuffled
            classSortingState.remaining = shuffleArray([...thaiConsonants]);
            classSortingState.bins = { low: [], mid: [], high: [] };
            classSortingState.isAnimating = false;
            
            document.getElementById('alphabetModes').style.display = 'none';
            document.getElementById('alphabetProgressOverview').style.display = 'none';
            document.getElementById('classSortingView').style.display = 'flex';
            
            document.getElementById('classSortingBackBtn').onclick = function() {
                document.getElementById('classSortingView').style.display = 'none';
                document.getElementById('alphabetModes').style.display = 'grid';
                document.getElementById('alphabetProgressOverview').style.display = 'block';
                updateAlphabetProgressDisplay();
            };
            
            updateClassBinDisplays();
            showNextSortingCard();
        }
        
        function showNextSortingCard() {
            if (classSortingState.remaining.length === 0) {
                showSortingComplete();
                return;
            }
            
            classSortingState.currentConsonant = classSortingState.remaining[0];
            const card = document.getElementById('sortingCard');
            
            // Reset card state
            card.classList.remove('correct-animation', 'wrong-animation');
            card.style.transform = '';
            card.style.opacity = '';
            
            document.getElementById('sortingCardLetter').textContent = classSortingState.currentConsonant.letter;
            document.getElementById('sortingCardRoman').textContent = classSortingState.currentConsonant.name;
            document.getElementById('classSortingRemaining').textContent = `${classSortingState.remaining.length} left`;
        }
        
        function sortToClass(selectedClass) {
            if (classSortingState.isAnimating || !classSortingState.currentConsonant) return;
            
            const correct = classSortingState.currentConsonant;
            const isCorrect = selectedClass === correct.class;
            const card = document.getElementById('sortingCard');
            const bin = document.querySelector(`.class-bin.${selectedClass}`);
            
            classSortingState.isAnimating = true;
            
            if (isCorrect) {
                // Correct! Add to bin
                playCorrectSound();
                updateAlphabetProgress(correct.letter, true);
                
                // Animate card shrinking
                card.classList.add('correct-animation');
                bin.classList.add('pulse-correct');
                
                // Add to bin and remove from remaining
                classSortingState.bins[selectedClass].push(correct);
                classSortingState.remaining.shift();
                
                setTimeout(() => {
                    bin.classList.remove('pulse-correct');
                    updateClassBinDisplays();
                    classSortingState.isAnimating = false;
                    showNextSortingCard();
                }, 300);
                
            } else {
                // Wrong! Shuffle back
                playIncorrectSound();
                updateAlphabetProgress(correct.letter, false);
                
                // Shake animation
                card.classList.add('wrong-animation');
                bin.classList.add('pulse-incorrect');
                
                // Move to random position in remaining pile
                classSortingState.remaining.shift();
                const insertPos = Math.floor(Math.random() * (classSortingState.remaining.length - 1)) + 1;
                classSortingState.remaining.splice(Math.min(insertPos, classSortingState.remaining.length), 0, correct);
                
                setTimeout(() => {
                    card.classList.remove('wrong-animation');
                    bin.classList.remove('pulse-incorrect');
                    classSortingState.isAnimating = false;
                    showNextSortingCard();
                }, 500);
            }
        }
        
        function updateClassBinDisplays() {
            ['low', 'mid', 'high'].forEach(cls => {
                const letters = classSortingState.bins[cls];
                document.getElementById(`${cls}BinCount`).textContent = letters.length;
                document.getElementById(`${cls}BinLetters`).textContent = letters.map(c => c.letter).join(' ');
            });
        }
        
        function expandBin(cls) {
            const bin = classSortingState.bins[cls];
            if (bin.length === 0) return;
            
            const titles = { low: 'Low Class', mid: 'Mid Class', high: 'High Class' };
            const colors = { low: '#16a34a', mid: '#2563eb', high: '#ea580c' };
            
            document.getElementById('expandedBinTitle').textContent = titles[cls];
            document.getElementById('expandedBinTitle').style.color = colors[cls];
            
            document.getElementById('expandedBinContent').innerHTML = bin.map(c => `
                <div class="expanded-letter-item">
                    <button class="expanded-letter-audio" onclick="speakConsonant('${c.letter}')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                    </button>
                    <div class="expanded-letter-thai">${c.letter}</div>
                    <div class="expanded-letter-roman">${c.roman}</div>
                </div>
            `).join('');
            
            document.getElementById('classBinExpanded').style.display = 'block';
        }
        
        function closeExpandedBin() {
            document.getElementById('classBinExpanded').style.display = 'none';
        }
        
        function showSortingComplete() {
            const cardArea = document.querySelector('.sorting-card-area');
            const total = thaiConsonants.length;
            const lowCount = classSortingState.bins.low.length;
            const midCount = classSortingState.bins.mid.length;
            const highCount = classSortingState.bins.high.length;
            
            cardArea.innerHTML = `
                <div class="sorting-complete">
                    <div style="font-size: 3em; margin-bottom: 16px;"></div>
                    <h3>All Sorted!</h3>
                    <p>You sorted all ${total} consonants into their correct classes.</p>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 24px;">
                        <div><span style="color: #16a34a; font-weight: 700;">${lowCount}</span> Low</div>
                        <div><span style="color: #2563eb; font-weight: 700;">${midCount}</span> Mid</div>
                        <div><span style="color: #ea580c; font-weight: 700;">${highCount}</span> High</div>
                    </div>
                    <button class="btn-action" onclick="startClassSorting()"> Sort Again</button>
                </div>
            `;
            document.getElementById('classSortingRemaining').textContent = 'Done!';
        }
        
        // Render the alphabet chart
        function renderAlphabetChart() {
            const container = document.getElementById('alphabetChartContent');
            
            const midClass = thaiConsonants.filter(c => c.class === 'mid');
            const highClass = thaiConsonants.filter(c => c.class === 'high');
            const lowClass = thaiConsonants.filter(c => c.class === 'low');
            
            container.innerHTML = `
                <!-- Class System Explainer -->
                <div class="chart-explainer">
                    <h3>Why Classes Matter</h3>
                    <p>Every Thai consonant belongs to one of three classes: <strong style="color: #3b82f6;">Mid</strong>, <strong style="color: #f97316;">High</strong>, or <strong style="color: #22c55e;">Low</strong>. The class determines the tone of a syllable when combined with vowels and tone marks.</p>
                </div>
                
                <div class="chart-legend">
                    <div class="chart-legend-item"><span class="chart-legend-color mid"></span> Mid class (9)</div>
                    <div class="chart-legend-item"><span class="chart-legend-color high"></span> High class (11)</div>
                    <div class="chart-legend-item"><span class="chart-legend-color low"></span> Low class (24)</div>
                </div>
                <p style="text-align: center; color: var(--text-muted); font-size: 0.85em; margin-bottom: 16px;">Tap any letter to hear its sound, then its name (e.g. "g gi")</p>
                
                <div class="alphabet-chart-section">
                    <h3><span class="chart-legend-color mid" style="display: inline-block;"></span> Mid Class</h3>
                    <div class="alphabet-chart-grid">
                        ${midClass.map(c => `
                            <div class="alphabet-chart-item mid tappable" onclick="speakThai('${c.thaiName}')">
                                <div class="chart-item-thai">${c.letter}</div>
                                <div class="chart-item-roman">${c.roman}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="alphabet-chart-section">
                    <h3><span class="chart-legend-color high" style="display: inline-block;"></span> High Class</h3>
                    <div class="alphabet-chart-grid">
                        ${highClass.map(c => `
                            <div class="alphabet-chart-item high tappable" onclick="speakThai('${c.thaiName}')">
                                <div class="chart-item-thai">${c.letter}</div>
                                <div class="chart-item-roman">${c.roman}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="alphabet-chart-section">
                    <h3><span class="chart-legend-color low" style="display: inline-block;"></span> Low Class</h3>
                    <div class="alphabet-chart-grid">
                        ${lowClass.map(c => `
                            <div class="alphabet-chart-item low tappable" onclick="speakThai('${c.thaiName}')">
                                <div class="chart-item-thai">${c.letter}</div>
                                <div class="chart-item-roman">${c.roman}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Vowels Section -->
                <div class="alphabet-chart-section">
                    <h3> Common Vowels</h3>
                    <p style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 12px;">
                        Vowels can appear before, after, above, below, or around consonants. Tap to hear the vowel sound.
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; text-align: center; font-size: 0.85em; color: var(--text-muted); margin-bottom: 8px;">
                        <div>Short</div>
                        <div>Long</div>
                    </div>
                    <div class="vowel-grid">
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">a</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">aa</span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">i</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">ii</span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound"></span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound"></span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">u</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">uu</span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">e</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">ee</span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">ae</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">ae</span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">o</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">oo</span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound"></span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound"></span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound"></span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound"></span></div>
                        
                        <div class="vowel-pair-label">Diphthongs</div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">ai</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">ai</span></div>
                        
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">ao</span></div>
                        <div class="vowel-item tappable" onclick="speakThai('')"><span class="vowel-thai">_</span><span class="vowel-sound">am</span></div>
                    </div>
                </div>
                
                <!-- Tone Marks Section -->
                <div class="alphabet-chart-section">
                    <h3> Tone Marks</h3>
                    <div class="tone-marks-grid">
                        <div class="tone-mark-item">
                            <span class="tone-mark-thai"></span>
                            <span class="tone-mark-name"> (mai ek)</span>
                            <span class="tone-mark-effect">Lowers tone</span>
                        </div>
                        <div class="tone-mark-item">
                            <span class="tone-mark-thai"></span>
                            <span class="tone-mark-name"> (mai too)</span>
                            <span class="tone-mark-effect">Changes tone (varies by class)</span>
                        </div>
                        <div class="tone-mark-item">
                            <span class="tone-mark-thai"></span>
                            <span class="tone-mark-name"> (mai dtrii)</span>
                            <span class="tone-mark-effect">High tone (mid class only)</span>
                        </div>
                        <div class="tone-mark-item">
                            <span class="tone-mark-thai"></span>
                            <span class="tone-mark-name"> (mai jt-dt-waa)</span>
                            <span class="tone-mark-effect">Rising tone (mid class only)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Tone Rules Chart -->
                <div class="alphabet-chart-section">
                    <h3> Tone Rules (Live Syllables)</h3>
                    <p style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 12px;">
                        Live syllables end in a long vowel or sonorant (    ). Dead syllables follow different rules.
                    </p>
                    <div class="tone-rules-table">
                        <div class="tone-rules-header">
                            <div>Class</div>
                            <div>No mark</div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                        <div class="tone-rules-row mid">
                            <div><strong>Mid</strong></div>
                            <div>Mid</div>
                            <div>Low</div>
                            <div>Falling</div>
                            <div>High</div>
                            <div>Rising</div>
                        </div>
                        <div class="tone-rules-row high">
                            <div><strong>High</strong></div>
                            <div>Rising</div>
                            <div>Low</div>
                            <div>Falling</div>
                            <div></div>
                            <div></div>
                        </div>
                        <div class="tone-rules-row low">
                            <div><strong>Low</strong></div>
                            <div>Mid</div>
                            <div>Falling</div>
                            <div>High</div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>
                    <p style="color: var(--text-muted); font-size: 0.85em; margin-top: 12px;">
                         <strong>Tip:</strong> Mid class consonants can produce all 5 tones. High and Low class consonants cannot use  or .
                    </p>
                </div>
            `;
        }
        
        // ============== CLOCK PRACTICE FOR TELLING TIME ==============
        
        // Thai time data - all possible times with their Thai expressions
        const thaiTimeData = [
            // 1-5 AM:  + number
            { hour: 1, minute: 0, period: 'late-night', thai: '', roman: 'dtii neng', hint: '1AM =  + 1' },
            { hour: 2, minute: 0, period: 'late-night', thai: '', roman: 'dtii sng', hint: '2AM =  + 2' },
            { hour: 3, minute: 0, period: 'late-night', thai: '', roman: 'dtii sam', hint: '3AM =  + 3' },
            { hour: 4, minute: 0, period: 'late-night', thai: '', roman: 'dtii si', hint: '4AM =  + 4' },
            { hour: 5, minute: 0, period: 'late-night', thai: '', roman: 'dtii ha', hint: '5AM =  + 5' },
            // 6-11 AM: number + 
            { hour: 6, minute: 0, period: 'morning', thai: '', roman: 'hk moong chao', hint: '6AM = 6 + ' },
            { hour: 7, minute: 0, period: 'morning', thai: '', roman: 'jt moong chao', hint: '7AM = 7 + ' },
            { hour: 8, minute: 0, period: 'morning', thai: '', roman: 'bpet moong chao', hint: '8AM = 8 + ' },
            { hour: 9, minute: 0, period: 'morning', thai: '', roman: 'gao moong chao', hint: '9AM = 9 + ' },
            { hour: 10, minute: 0, period: 'morning', thai: '', roman: 'sp moong chao', hint: '10AM = 10 + ' },
            { hour: 11, minute: 0, period: 'morning', thai: '', roman: 'sp-t moong chao', hint: '11AM = 11 + ' },
            // 12 PM: 
            { hour: 12, minute: 0, period: 'noon', thai: '', roman: 'tang', hint: 'Noon = ' },
            // 1-3 PM:  + number + 
            { hour: 13, minute: 0, period: 'afternoon', thai: '', roman: 'bai moong', hint: '1PM =  + ' },
            { hour: 14, minute: 0, period: 'afternoon', thai: '', roman: 'bai sng moong', hint: '2PM =  + 2 + ' },
            { hour: 15, minute: 0, period: 'afternoon', thai: '', roman: 'bai sam moong', hint: '3PM =  + 3 + ' },
            // 4-6 PM: number + 
            { hour: 16, minute: 0, period: 'evening', thai: '', roman: 'si moong yen', hint: '4PM = 4 + ' },
            { hour: 17, minute: 0, period: 'evening', thai: '', roman: 'ha moong yen', hint: '5PM = 5 + ' },
            { hour: 18, minute: 0, period: 'evening', thai: '', roman: 'hk moong yen', hint: '6PM = 6 + ' },
            // 7-11 PM: (number-6) + 
            { hour: 19, minute: 0, period: 'night', thai: '', roman: 'neng tm', hint: '7PM = 1 (7-6=1)' },
            { hour: 20, minute: 0, period: 'night', thai: '', roman: 'sng tm', hint: '8PM = 2 (8-6=2)' },
            { hour: 21, minute: 0, period: 'night', thai: '', roman: 'sam tm', hint: '9PM = 3 (9-6=3)' },
            { hour: 22, minute: 0, period: 'night', thai: '', roman: 'si tm', hint: '10PM = 4 (10-6=4)' },
            { hour: 23, minute: 0, period: 'night', thai: '', roman: 'ha tm', hint: '11PM = 5 (11-6=5)' },
            // 12 AM: 
            { hour: 0, minute: 0, period: 'midnight', thai: '', roman: 'tang kn', hint: 'Midnight = ' }
        ];
        
        // Period display names and colors
        const periodInfo = {
            'late-night': { name: ' 1-5 AM', color: '#4f46e5' },
            'morning': { name: ' 6-11 AM', color: '#f59e0b' },
            'noon': { name: ' Noon', color: '#eab308' },
            'afternoon': { name: ' 1-3 PM', color: '#f97316' },
            'evening': { name: ' 4-6 PM', color: '#ea580c' },
            'night': { name: ' 7-11 PM', color: '#7c3aed' },
            'midnight': { name: ' Midnight', color: '#1e1b4b' }
        };
        
        // Interactive time period data for learning
        const timePeriodData = [
            {
                id: 'late-night',
                hours: '1-5 AM',
                emoji: '',
                color: '#4f46e5',
                startHour: 1,
                endHour: 5,
                thai: '',
                roman: 'dtii',
                pattern: ' + number',
                patternRoman: 'dtii + number',
                examples: ' (1AM),  (2AM),  (3AM),  (4AM),  (5AM)',
                memory: '"D" for Dark  it\'s the darkest part of night.  means "strike" (like striking a drum).',
                note: ' comes BEFORE the number'
            },
            {
                id: 'morning',
                hours: '6-11 AM',
                emoji: '',
                color: '#f59e0b',
                startHour: 6,
                endHour: 11,
                thai: '',
                roman: 'moong chao',
                pattern: 'number + ',
                patternRoman: 'number + moong chao',
                examples: ' (6AM),  (7AM),  (8AM)...',
                memory: ' sounds like "gong"  the morning gong wakes you up!  means "morning".',
                note: ' is often dropped in casual speech'
            },
            {
                id: 'noon',
                hours: '12 PM',
                emoji: '',
                color: '#eab308',
                startHour: 12,
                endHour: 12,
                thai: '',
                roman: 'tang',
                pattern: '',
                patternRoman: 'tang',
                examples: ' or  (tang wan)',
                memory: ' means "middle/midpoint"  the middle of the day!',
                note: 'Just one word, no number needed'
            },
            {
                id: 'afternoon',
                hours: '1-3 PM',
                emoji: '',
                color: '#f97316',
                startHour: 13,
                endHour: 15,
                thai: '...',
                roman: 'bai...moong',
                pattern: ' + number + ',
                patternRoman: 'bai + number + moong',
                examples: ' (1PM),  (2PM),  (3PM)',
                memory: '"Bai bai" to the morning!  comes FIRST, then the number.',
                note: '1PM is just  (no )'
            },
            {
                id: 'evening',
                hours: '4-6 PM',
                emoji: '',
                color: '#ea580c',
                startHour: 16,
                endHour: 18,
                thai: '',
                roman: 'moong yen',
                pattern: 'number + ',
                patternRoman: 'number + moong yen',
                examples: ' (4PM),  (5PM),  (6PM)',
                memory: ' means "cool/evening"  when it starts cooling down.',
                note: ' often dropped when context is clear'
            },
            {
                id: 'night',
                hours: '7-11 PM',
                emoji: '',
                color: '#7c3aed',
                startHour: 19,
                endHour: 23,
                thai: '',
                roman: 'tm',
                pattern: '(hour - 6) + ',
                patternRoman: '(hour - 6) + tm',
                examples: ' (7PM),  (8PM),  (9PM),  (10PM),  (11PM)',
                memory: '7-Eleven  1-5!  sounds like a drum beat  the night watchman\'s drum.',
                note: ' Counting RESTARTS at 1 for 7PM!'
            },
            {
                id: 'midnight',
                hours: '12 AM',
                emoji: '',
                color: '#1e1b4b',
                startHour: 0,
                endHour: 0,
                thai: '',
                roman: 'tang kn',
                pattern: '',
                patternRoman: 'tang kn',
                examples: ' (midnight)',
                memory: ' (middle) +  (night) = middle of the night!',
                note: 'Just one word, like noon'
            }
        ];
        
        // Render interactive time period clock
        function renderInteractiveTimeClock() {
            const container = document.getElementById('interactiveTimeClockContainer');
            if (!container) return;
            
            let periodsHtml = '';
            timePeriodData.forEach(period => {
                periodsHtml += `
                    <div class="time-period-item" data-period="${period.id}">
                        <div class="time-period-row" onclick="toggleTimePeriodInfo('${period.id}')" style="border-left: 4px solid ${period.color};">
                            <div class="time-period-row-left">
                                <span class="time-period-row-emoji">${period.emoji}</span>
                                <span class="time-period-row-hours">${period.hours}</span>
                            </div>
                            <div class="time-period-row-thai">${period.thai}</div>
                        </div>
                        <div class="time-period-detail" id="detail-${period.id}" style="border-color: ${period.color}; display: none;">
                            <div class="time-period-pattern">
                                <strong>Pattern:</strong> ${period.pattern}
                            </div>
                            <div class="time-period-examples">
                                ${period.examples}
                            </div>
                            <div class="time-period-memory">
                                 ${period.memory}
                            </div>
                            ${period.note ? `<div class="time-period-note"> ${period.note}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = `<div class="time-periods-list">${periodsHtml}</div>`;
        }
        
        // Toggle time period info - only one open at a time
        function toggleTimePeriodInfo(periodId) {
            const allItems = document.querySelectorAll('.time-period-item');
            const clickedDetail = document.getElementById('detail-' + periodId);
            const isCurrentlyOpen = clickedDetail.style.display === 'block';
            
            // Close all
            allItems.forEach(item => {
                item.querySelector('.time-period-row').classList.remove('selected');
                item.querySelector('.time-period-detail').style.display = 'none';
            });
            
            // If it wasn't open, open it
            if (!isCurrentlyOpen) {
                const clickedItem = document.querySelector(`.time-period-item[data-period="${periodId}"]`);
                clickedItem.querySelector('.time-period-row').classList.add('selected');
                clickedDetail.style.display = 'block';
            }
        }
        
        // Clock practice state
        let clockPracticeState = {
            currentTime: null,
            options: [],
            answered: false,
            score: { correct: 0, total: 0 },
            questionNumber: 0
        };
        
        // Generate confusing options (times that use similar numbers)
        function generateClockOptions(correctTime) {
            let options = [correctTime];
            
            // Strategy: find times with same number but different period
            // e.g., if answer is 3AM (), offer 9PM (), 3PM ()
            const correctHour12 = correctTime.hour % 12 || 12;
            
            // Find confusing alternatives with same number display
            const confusingTimes = thaiTimeData.filter(t => {
                if (t.thai === correctTime.thai) return false;
                const hour12 = t.hour % 12 || 12;
                // Same number on clock face (e.g., 3 and 3)
                if (hour12 === correctHour12) return true;
                // Night times () - find matching  numbers
                if (correctTime.period === 'night' && t.period === 'late-night') {
                    // e.g., 9PM (3) vs 3AM (3)
                    return (correctTime.hour - 6) === t.hour;
                }
                if (correctTime.period === 'late-night' && t.period === 'night') {
                    return correctTime.hour === (t.hour - 6);
                }
                return false;
            });
            
            // Add confusing times first
            shuffleArray(confusingTimes).slice(0, 2).forEach(t => {
                if (options.length < 4 && !options.includes(t)) options.push(t);
            });
            
            // Fill remaining with random times from different periods
            const otherTimes = thaiTimeData.filter(t => 
                !options.some(o => o.thai === t.thai) && t.period !== correctTime.period
            );
            shuffleArray(otherTimes).slice(0, 4 - options.length).forEach(t => {
                if (options.length < 4) options.push(t);
            });
            
            return shuffleArray(options);
        }
        
        // Render the analog clock
        function renderAnalogClock(hour, minute) {
            const hour12 = hour % 12;
            const hourAngle = (hour12 * 30) + (minute * 0.5); // 30 degrees per hour + minute offset
            const minuteAngle = minute * 6; // 6 degrees per minute
            
            let ticksHtml = '';
            // Add hour ticks
            for (let i = 0; i < 12; i++) {
                const isMajor = i % 3 === 0;
                ticksHtml += `<div class="clock-tick ${isMajor ? 'major' : ''}" style="transform: translateX(-50%) rotate(${i * 30}deg);"></div>`;
            }
            
            // Add hour numbers
            const numbers = [12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
            const radius = 60; // Distance from center
            numbers.forEach((num, i) => {
                const angle = (i * 30 - 90) * Math.PI / 180; // Start from 12 o'clock
                const x = 90 + radius * Math.cos(angle) - 12; // Center at 90px, offset by half width
                const y = 90 + radius * Math.sin(angle) - 12;
                ticksHtml += `<div class="clock-number" style="left: ${x}px; top: ${y}px;">${num}</div>`;
            });
            
            return `
                <div class="analog-clock">
                    <div class="clock-face">
                        ${ticksHtml}
                        <div class="clock-hand minute-hand" style="transform: rotate(${minuteAngle}deg);"></div>
                        <div class="clock-hand hour-hand" style="transform: rotate(${hourAngle}deg);"></div>
                        <div class="clock-center"></div>
                    </div>
                </div>
            `;
        }
        
        // Format time for display (12-hour format)
        function formatTimeDisplay(hour, minute) {
            const hour12 = hour % 12 || 12;
            const ampm = hour < 12 ? 'AM' : 'PM';
            if (hour === 0) return '12:00 AM';
            if (hour === 12) return '12:00 PM';
            return `${hour12}:${minute.toString().padStart(2, '0')} ${ampm}`;
        }
        
        // Start clock practice
        function startClockPractice() {
            clockPracticeState = {
                currentTime: null,
                options: [],
                answered: false,
                score: { correct: 0, total: 0 },
                questionNumber: 0
            };
            nextClockQuestion();
        }
        
        // Generate next clock question
        function nextClockQuestion() {
            clockPracticeState.questionNumber++;
            clockPracticeState.answered = false;
            
            // Pick a random time
            const timeIndex = Math.floor(Math.random() * thaiTimeData.length);
            clockPracticeState.currentTime = thaiTimeData[timeIndex];
            clockPracticeState.options = generateClockOptions(clockPracticeState.currentTime);
            
            renderClockPractice();
        }
        
        // Render clock practice UI
        function renderClockPractice() {
            const container = document.getElementById('clockPracticeContainer');
            if (!container) return;
            
            const time = clockPracticeState.currentTime;
            const period = periodInfo[time.period];
            
            let optionsHtml = '';
            clockPracticeState.options.forEach((opt, idx) => {
                optionsHtml += `
                    <div class="clock-option" data-index="${idx}" onclick="selectClockOption(${idx}, event)">
                        <div class="clock-option-thai">${opt.thai}</div>
                        ${showRomanization ? `<div class="clock-option-roman">${opt.roman}</div>` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = `
                <div class="clock-practice-container" onclick="handleClockContainerTap(event)">
                    <div class="clock-score">Question ${clockPracticeState.questionNumber}  Score: ${clockPracticeState.score.correct}/${clockPracticeState.score.total}</div>
                    ${renderAnalogClock(time.hour, time.minute)}
                    <div class="clock-period-indicator" style="background: ${period.color};">${period.name}</div>
                    <div class="clock-time-display">${formatTimeDisplay(time.hour, time.minute)}</div>
                    <div class="clock-hint">How do you say this time in Thai?</div>
                    <div class="clock-options" id="clockOptions">
                        ${optionsHtml}
                    </div>
                    <div id="clockFeedback"></div>
                </div>
            `;
        }
        
        // Handle option selection
        function selectClockOption(index, event) {
            // Stop event from bubbling to container
            if (event) {
                event.stopPropagation();
            }
            
            // If already answered, tap goes to next question
            if (clockPracticeState.answered) {
                nextClockQuestion();
                return;
            }
            
            // Guard against invalid index
            if (!clockPracticeState.options || index >= clockPracticeState.options.length) {
                console.error('Invalid clock option index:', index);
                return;
            }
            
            clockPracticeState.answered = true;
            clockPracticeState.score.total++;
            
            const selected = clockPracticeState.options[index];
            const correct = clockPracticeState.currentTime;
            const isCorrect = selected.thai === correct.thai;
            
            if (isCorrect) {
                clockPracticeState.score.correct++;
                playCorrectSound();
            } else {
                playIncorrectSound();
            }
            
            // Add glow effect to the clock
            const clockEl = document.querySelector('.analog-clock');
            if (clockEl) {
                clockEl.classList.add(isCorrect ? 'clock-correct-glow' : 'clock-incorrect-glow');
            }
            
            // Update option styles
            document.querySelectorAll('.clock-option').forEach((opt, idx) => {
                const optData = clockPracticeState.options[idx];
                if (optData && optData.thai === correct.thai) {
                    opt.classList.add('correct-answer');
                    if (isCorrect) opt.classList.add('correct');
                } else if (idx === index) {
                    opt.classList.add('incorrect');
                }
            });
            
            // Show feedback (no button, tap to continue)
            const feedbackEl = document.getElementById('clockFeedback');
            if (isCorrect) {
                feedbackEl.innerHTML = `
                    <div class="clock-feedback correct">
                         Correct! ${correct.hint}
                    </div>
                    <div class="tap-to-continue">Tap anywhere to continue</div>
                `;
            } else {
                feedbackEl.innerHTML = `
                    <div class="clock-feedback incorrect">
                         The answer is <strong>${correct.thai}</strong><br>
                        <span style="font-size: 0.9em;">${correct.hint}</span>
                    </div>
                    <div class="tap-to-continue">Tap anywhere to continue</div>
                `;
            }
            
            // Add tap-to-advance class for styling
            const practiceContainer = document.querySelector('.clock-practice-container');
            if (practiceContainer) {
                practiceContainer.classList.add('tap-to-advance');
            }
        }
        
        // Handle tap on clock practice container (for advancing after answer)
        function handleClockContainerTap(event) {
            // Only advance if already answered
            if (clockPracticeState.answered) {
                nextClockQuestion();
            }
        }
        
        // Show clock practice in a fullscreen modal mode
        function showClockPracticeModal() {
            // Hide lesson view, show practice view with clock
            document.getElementById('grammarLessonsList').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'none';
            document.getElementById('grammarPracticeView').style.display = 'block';
            
            // Reset clock practice state
            clockPracticeState = {
                currentTime: null,
                options: [],
                answered: false,
                score: { correct: 0, total: 0 },
                questionNumber: 0
            };
            
            // Render clock practice in practice content area
            var container = document.getElementById('practiceContent');
            container.innerHTML = '<div id="clockPracticeContainer"></div>';
            document.getElementById('practiceScore').textContent = '0 / 0';
            
            nextClockQuestion();
            
            // Update back button to return to lesson
            document.getElementById('practiceBackBtn').onclick = function() {
                document.getElementById('grammarPracticeView').style.display = 'none';
                document.getElementById('grammarLessonView').style.display = 'block';
            };
        }
        
        // ============== END CLOCK PRACTICE ==============
        
        // Guided Fill-in-Blank (single question within lesson flow)
        function startGuidedFillBlank(lessonId) {
            var templates = grammarPracticeTemplates[lessonId];
            if (!templates || !templates.fillBlanks.length) return;
            
            // Pick a random fill-blank item
            var item = templates.fillBlanks[Math.floor(Math.random() * templates.fillBlanks.length)];
            var container = document.getElementById('guidedFillBlankContainer');
            
            window.guidedFillItem = item;
            window.guidedFillChecked = false;
            
            // Create sentence with blanks
            var sentenceHtml = item.sentence;
            var blankIndex = 0;
            while (sentenceHtml.indexOf('___') !== -1) {
                sentenceHtml = sentenceHtml.replace('___', '<span class="blank guided-blank" data-index="' + blankIndex + '" data-answer="' + item.blanks[blankIndex] + '"></span>');
                blankIndex++;
            }
            
            // Create word options (correct answers + distractors, shuffled)
            var options = [...item.blanks];
            var distractors = shuffleArray([...templates.distractors]).slice(0, Math.max(3, 6 - item.blanks.length));
            options = shuffleArray([...options, ...distractors]);
            
            var optionsHtml = '';
            options.forEach(function(word) {
                optionsHtml += '<div class="practice-word-option guided-option" data-word="' + word + '">' + word + '</div>';
            });
            
            container.innerHTML = 
                '<div class="practice-question">' +
                    '<div class="practice-english">' + item.english + '</div>' +
                    '<div class="practice-sentence" id="guidedSentence">' + sentenceHtml + '</div>' +
                '</div>' +
                '<div class="practice-word-options" id="guidedOptions">' + optionsHtml + '</div>' +
                '<div class="practice-buttons" id="guidedButtons">' +
                    '<button class="practice-check-btn" id="guidedSubmitBtn" disabled>Check Answer</button>' +
                '</div>' +
                '<div class="practice-result" id="guidedResult" style="display:none;"></div>';
            
            // Add click listeners to word options
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.addEventListener('click', function() {
                    if (!window.guidedFillChecked) {
                        handleGuidedFillSelect(this.getAttribute('data-word'), this);
                    }
                });
            });
            
            // Add click listeners to blanks (to remove filled words)
            document.querySelectorAll('.guided-blank').forEach(function(blank) {
                blank.addEventListener('click', function() {
                    if (!window.guidedFillChecked) {
                        handleGuidedBlankClick(this);
                    }
                });
            });
            
            // Submit button listener
            document.getElementById('guidedSubmitBtn').addEventListener('click', checkGuidedFillAnswer);
        }
        
        function handleGuidedFillSelect(word, optionEl) {
            var blanks = document.querySelectorAll('.guided-blank');
            
            // Find first empty blank
            var targetBlank = null;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    targetBlank = blanks[i];
                    break;
                }
            }
            
            if (!targetBlank) return;
            
            targetBlank.innerHTML = '<span class="filled-word">' + word + '</span>';
            targetBlank.setAttribute('data-filled', word);
            targetBlank.classList.add('filled');
            optionEl.classList.add('used');
            
            updateGuidedSubmitState();
        }
        
        function handleGuidedBlankClick(blank) {
            var filledWord = blank.getAttribute('data-filled');
            if (!filledWord) return;
            
            blank.innerHTML = '';
            blank.removeAttribute('data-filled');
            blank.classList.remove('filled');
            
            var option = document.querySelector('.guided-option[data-word="' + filledWord + '"]');
            if (option) option.classList.remove('used');
            
            updateGuidedSubmitState();
        }
        
        function updateGuidedSubmitState() {
            var blanks = document.querySelectorAll('.guided-blank');
            var allFilled = true;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    allFilled = false;
                    break;
                }
            }
            document.getElementById('guidedSubmitBtn').disabled = !allFilled;
        }
        
        function checkGuidedFillAnswer() {
            var item = window.guidedFillItem;
            var blanks = document.querySelectorAll('.guided-blank');
            
            var userAnswers = [];
            blanks.forEach(function(blank) {
                userAnswers.push(blank.getAttribute('data-filled') || '');
            });
            
            var allCorrect = true;
            for (var i = 0; i < item.blanks.length; i++) {
                if (userAnswers[i] !== item.blanks[i]) {
                    allCorrect = false;
                    break;
                }
            }
            
            window.guidedFillChecked = true;
            
            // Show visual feedback
            blanks.forEach(function(blank, i) {
                if (userAnswers[i] === item.blanks[i]) {
                    blank.classList.add('correct');
                    blank.classList.remove('filled');
                } else {
                    blank.classList.add('incorrect');
                    blank.classList.remove('filled');
                }
            });
            
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.style.pointerEvents = 'none';
            });
            
            var resultEl = document.getElementById('guidedResult');
            var buttonsEl = document.getElementById('guidedButtons');
            
            if (allCorrect) {
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result correct';
                resultEl.innerHTML = ' Correct! Click Next to continue to sentence building.';
                buttonsEl.innerHTML = '';
                
                // Enable the Next button
                window.guidedPracticeCompleted = true;
                document.getElementById('lessonNextBtn').disabled = false;
            } else {
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result incorrect';
                resultEl.innerHTML = ' Not quite right...';
                
                buttonsEl.innerHTML = 
                    '<button class="btn-action" id="guidedTryAgainBtn" style="margin-right: 10px;"> Try Again</button>' +
                    '<button class="btn-flip" id="guidedRevealBtn"> Show Answer</button>';
                
                document.getElementById('guidedTryAgainBtn').addEventListener('click', function() {
                    resetGuidedFillBlank();
                });
                
                document.getElementById('guidedRevealBtn').addEventListener('click', function() {
                    revealGuidedAnswer();
                });
            }
        }
        
        function resetGuidedFillBlank() {
            var blanks = document.querySelectorAll('.guided-blank');
            
            blanks.forEach(function(blank) {
                blank.innerHTML = '';
                blank.removeAttribute('data-filled');
                blank.classList.remove('filled', 'correct', 'incorrect');
            });
            
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.classList.remove('used');
                opt.style.pointerEvents = '';
            });
            
            window.guidedFillChecked = false;
            
            document.getElementById('guidedButtons').innerHTML = 
                '<button class="practice-check-btn" id="guidedSubmitBtn" disabled>Check Answer</button>';
            document.getElementById('guidedSubmitBtn').addEventListener('click', checkGuidedFillAnswer);
            
            document.getElementById('guidedResult').style.display = 'none';
        }
        
        function revealGuidedAnswer() {
            var item = window.guidedFillItem;
            var blanks = document.querySelectorAll('.guided-blank');
            
            // Show the correct answer
            var resultEl = document.getElementById('guidedResult');
            resultEl.className = 'practice-result incorrect';
            resultEl.innerHTML = 'The correct answer is: <strong>' + item.blanks.join(' ... ') + '</strong><br>Now fill it in correctly to continue.';
            
            // Reset blanks so user can try again with the answer visible
            blanks.forEach(function(blank) {
                blank.innerHTML = '';
                blank.removeAttribute('data-filled');
                blank.classList.remove('filled', 'correct', 'incorrect');
            });
            
            // Reset all options
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.classList.remove('used');
                opt.style.pointerEvents = '';
            });
            
            // Reset state but mark that answer was revealed
            window.guidedFillChecked = false;
            window.guidedAnswerRevealed = true;
            
            // Reset buttons
            document.getElementById('guidedButtons').innerHTML = 
                '<button class="practice-check-btn" id="guidedSubmitBtn" disabled>Check Answer</button>';
            document.getElementById('guidedSubmitBtn').addEventListener('click', checkGuidedFillAnswer);
        }
        
        // Practice Mode Functions
        function startPractice(lessonId, mode) {
            currentPracticeLesson = lessonId;
            currentPracticeMode = mode || 'build';
            currentPracticeIndex = 0;
            practiceScore = { correct: 0, total: 0 };
            
            var templates = grammarPracticeTemplates[lessonId];
            if (!templates) {
                showToast('No practice available for this lesson');
                return;
            }
            
            // Only use build mode now
            currentPracticeItems = shuffleArray([...templates.sentenceBuilds]);
            
            // Hide both lessons list and lesson view, show practice view
            document.getElementById('grammarLessonsList').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'none';
            document.getElementById('grammarPracticeView').style.display = 'block';
            
            renderPracticeQuestion();
        }
        
        function shuffleArray(arr) {
            var shuffled = [...arr];
            for (var i = shuffled.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = shuffled[i];
                shuffled[i] = shuffled[j];
                shuffled[j] = temp;
            }
            return shuffled;
        }
        
        function renderPracticeQuestion() {
            var container = document.getElementById('practiceContent');
            var item = currentPracticeItems[currentPracticeIndex];
            var templates = grammarPracticeTemplates[currentPracticeLesson];
            
            document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
            
            if (!item) {
                // Practice complete
                renderPracticeComplete();
                return;
            }
            
            renderBuildQuestion(item, templates);
        }
        
        function renderFillBlankQuestion(item, templates) {
            var container = document.getElementById('practiceContent');
            
            // Reset state
            currentBlankIndex = 0;
            filledBlanks = [];
            window.fillBlankItem = item;
            window.fillBlankChecked = false;
            
            // Create sentence with blanks
            var sentenceHtml = item.sentence;
            var blankIndex = 0;
            while (sentenceHtml.indexOf('___') !== -1) {
                sentenceHtml = sentenceHtml.replace('___', '<span class="blank" data-index="' + blankIndex + '" data-answer="' + item.blanks[blankIndex] + '"></span>');
                blankIndex++;
            }
            
            // Create word options (correct answers + distractors, shuffled)
            var options = [...item.blanks];
            var distractors = shuffleArray([...templates.distractors]).slice(0, Math.max(3, 6 - item.blanks.length));
            options = shuffleArray([...options, ...distractors]);
            
            var optionsHtml = '';
            options.forEach(function(word) {
                optionsHtml += '<div class="practice-word-option" data-word="' + word + '">' + word + '</div>';
            });
            
            container.innerHTML = 
                '<div class="practice-question">' +
                    '<div class="practice-english">' + item.english + '</div>' +
                    '<div class="practice-sentence" id="practiceSentence">' + sentenceHtml + '</div>' +
                '</div>' +
                '<div class="practice-word-options" id="practiceOptions">' + optionsHtml + '</div>' +
                '<div class="practice-buttons" id="practiceButtons">' +
                    '<button class="practice-check-btn" id="fillBlankSubmitBtn" disabled>Check Answer</button>' +
                '</div>' +
                '<div class="practice-result" id="practiceResult" style="display:none;"></div>';
            
            // Add click listeners to word options
            document.querySelectorAll('.practice-word-option').forEach(function(opt) {
                opt.addEventListener('click', function() {
                    if (!window.fillBlankChecked) {
                        handleFillBlankSelect(this.getAttribute('data-word'), this);
                    }
                });
            });
            
            // Add click listeners to blanks (to remove filled words)
            document.querySelectorAll('.practice-sentence .blank').forEach(function(blank) {
                blank.addEventListener('click', function() {
                    if (!window.fillBlankChecked) {
                        handleBlankClick(this);
                    }
                });
            });
            
            // Submit button listener
            document.getElementById('fillBlankSubmitBtn').addEventListener('click', checkFillBlankAnswer);
            
            document.getElementById('practiceNextBtn').style.display = 'none';
        }
        
        var currentBlankIndex = 0;
        var filledBlanks = [];
        
        function handleFillBlankSelect(word, optionEl) {
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Find first empty blank
            var targetBlank = null;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    targetBlank = blanks[i];
                    break;
                }
            }
            
            if (!targetBlank) return; // All blanks filled
            
            // Fill the blank
            targetBlank.innerHTML = '<span class="filled-word">' + word + '</span>';
            targetBlank.setAttribute('data-filled', word);
            targetBlank.classList.add('filled');
            
            // Mark the option as used
            optionEl.classList.add('used');
            
            // Update submit button state
            updateSubmitButtonState();
        }
        
        function handleBlankClick(blank) {
            var filledWord = blank.getAttribute('data-filled');
            if (!filledWord) return;
            
            // Clear the blank
            blank.innerHTML = '';
            blank.removeAttribute('data-filled');
            blank.classList.remove('filled');
            
            // Un-mark the option
            var option = document.querySelector('.practice-word-option[data-word="' + filledWord + '"]');
            if (option) option.classList.remove('used');
            
            // Update submit button state
            updateSubmitButtonState();
        }
        
        function updateSubmitButtonState() {
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            var allFilled = true;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    allFilled = false;
                    break;
                }
            }
            document.getElementById('fillBlankSubmitBtn').disabled = !allFilled;
        }
        
        function checkFillBlankAnswer() {
            var item = window.fillBlankItem;
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Gather user answers
            var userAnswers = [];
            blanks.forEach(function(blank) {
                userAnswers.push(blank.getAttribute('data-filled') || '');
            });
            
            // Check if correct
            var allCorrect = true;
            for (var i = 0; i < item.blanks.length; i++) {
                if (userAnswers[i] !== item.blanks[i]) {
                    allCorrect = false;
                    break;
                }
            }
            
            window.fillBlankChecked = true;
            
            // Show visual feedback on blanks
            blanks.forEach(function(blank, i) {
                if (userAnswers[i] === item.blanks[i]) {
                    blank.classList.add('correct');
                    blank.classList.remove('filled');
                } else {
                    blank.classList.add('incorrect');
                    blank.classList.remove('filled');
                }
            });
            
            // Disable word options
            document.querySelectorAll('.practice-word-option').forEach(function(opt) {
                opt.style.pointerEvents = 'none';
            });
            
            var resultEl = document.getElementById('practiceResult');
            var buttonsEl = document.getElementById('practiceButtons');
            
            if (allCorrect) {
                // Correct!
                practiceScore.total++;
                practiceScore.correct++;
                document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
                
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result correct';
                resultEl.innerHTML = ' Correct!';
                
                buttonsEl.innerHTML = '';
                document.getElementById('practiceNextBtn').style.display = 'block';
            } else {
                // Incorrect - offer try again or reveal
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result incorrect';
                resultEl.innerHTML = ' Not quite right...';
                
                buttonsEl.innerHTML = 
                    '<button class="btn-action" id="tryAgainBtn" style="margin-right: 10px;"> Try Again</button>' +
                    '<button class="btn-flip" id="revealAnswerBtn"> Reveal Answer</button>';
                
                document.getElementById('tryAgainBtn').addEventListener('click', function() {
                    resetFillBlankQuestion();
                });
                
                document.getElementById('revealAnswerBtn').addEventListener('click', function() {
                    revealFillBlankAnswer();
                });
            }
        }
        
        function resetFillBlankQuestion() {
            var item = window.fillBlankItem;
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Clear all blanks
            blanks.forEach(function(blank) {
                blank.innerHTML = '';
                blank.removeAttribute('data-filled');
                blank.classList.remove('filled', 'correct', 'incorrect');
            });
            
            // Reset all options
            document.querySelectorAll('.practice-word-option').forEach(function(opt) {
                opt.classList.remove('used');
                opt.style.pointerEvents = '';
            });
            
            // Reset state
            window.fillBlankChecked = false;
            
            // Reset buttons
            document.getElementById('practiceButtons').innerHTML = 
                '<button class="practice-check-btn" id="fillBlankSubmitBtn" disabled>Check Answer</button>';
            document.getElementById('fillBlankSubmitBtn').addEventListener('click', checkFillBlankAnswer);
            
            // Hide result
            document.getElementById('practiceResult').style.display = 'none';
        }
        
        function revealFillBlankAnswer() {
            var item = window.fillBlankItem;
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Count as attempted but wrong
            practiceScore.total++;
            document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
            
            // Show correct answers in blanks
            blanks.forEach(function(blank, i) {
                blank.innerHTML = '<span class="filled-word">' + item.blanks[i] + '</span>';
                blank.classList.remove('incorrect', 'filled');
                blank.classList.add('correct');
            });
            
            // Update result
            var resultEl = document.getElementById('practiceResult');
            resultEl.className = 'practice-result incorrect';
            resultEl.innerHTML = 'The correct answer is: <strong>' + item.blanks.join(' ... ') + '</strong>';
            
            // Show next button
            document.getElementById('practiceButtons').innerHTML = '';
            document.getElementById('practiceNextBtn').style.display = 'block';
        }
        
        function renderBuildQuestion(item, templates) {
            var container = document.getElementById('practiceContent');
            
            // Shuffle word order
            var shuffledWords = shuffleArray([...item.words]);
            
            var wordsHtml = '';
            shuffledWords.forEach(function(word, i) {
                wordsHtml += '<div class="build-word-chip" data-word="' + word + '" data-index="' + i + '">' + word + '</div>';
            });
            
            container.innerHTML = 
                '<div class="practice-question">' +
                    '<div class="practice-english">' + item.english + '</div>' +
                '</div>' +
                '<div class="build-target" id="buildTarget">' +
                    '<span class="build-placeholder">Tap words to build the sentence</span>' +
                '</div>' +
                '<div class="build-word-bank" id="buildWordBank">' + wordsHtml + '</div>' +
                '<div class="practice-result" id="practiceResult" style="display:none;"></div>';
            
            // Add click listeners
            document.querySelectorAll('.build-word-chip').forEach(function(chip) {
                chip.addEventListener('click', function() {
                    if (!this.classList.contains('used')) {
                        handleBuildSelect(this);
                    }
                });
            });
            
            document.getElementById('practiceNextBtn').style.display = 'none';
            window.buildItem = item;
        }
        
        function handleBuildSelect(chip) {
            var word = chip.getAttribute('data-word');
            var target = document.getElementById('buildTarget');
            
            // Remove placeholder if present
            var placeholder = target.querySelector('.build-placeholder');
            if (placeholder) placeholder.remove();
            
            // Add word to target
            var wordEl = document.createElement('div');
            wordEl.className = 'build-word';
            wordEl.textContent = word;
            wordEl.setAttribute('data-word', word);
            wordEl.onclick = function() {
                // Remove from target, add back to bank
                this.remove();
                chip.classList.remove('used');
                
                // Show placeholder if empty
                if (target.querySelectorAll('.build-word').length === 0) {
                    target.innerHTML = '<span class="build-placeholder">Tap words to build the sentence</span>';
                }
            };
            target.appendChild(wordEl);
            
            // Mark chip as used
            chip.classList.add('used');
            
            // Check if all words used
            var allUsed = document.querySelectorAll('.build-word-chip:not(.used)').length === 0;
            if (allUsed) {
                checkBuildAnswer();
            }
        }
        
        function checkBuildAnswer() {
            var item = window.buildItem;
            var target = document.getElementById('buildTarget');
            
            // Get answer from visual order in DOM, not from array
            var wordEls = target.querySelectorAll('.build-word');
            var userAnswer = Array.from(wordEls).map(function(el) { return el.getAttribute('data-word'); }).join('');
            var isCorrect = userAnswer === item.correct;
            
            practiceScore.total++;
            if (isCorrect) {
                practiceScore.correct++;
            }
            
            // Show visual feedback on target
            var target = document.getElementById('buildTarget');
            target.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            // Show result
            var resultEl = document.getElementById('practiceResult');
            resultEl.style.display = 'block';
            resultEl.className = 'practice-result clickable ' + (isCorrect ? 'correct' : 'incorrect');
            
            if (isCorrect) {
                resultEl.innerHTML = ' Correct!<div class="tap-hint">Tap to continue</div>';
            } else {
                resultEl.innerHTML = ' Not quite.<div class="practice-correct-answer">Correct: ' + item.correct + '</div><div class="tap-hint">Tap to continue</div>';
            }
            
            // Allow tap on result to advance
            resultEl.onclick = function() {
                nextPracticeQuestion();
            };
            
            document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
            document.getElementById('practiceNextBtn').style.display = 'block';
        }
        
        function renderPracticeComplete() {
            var container = document.getElementById('practiceContent');
            var percentage = practiceScore.total > 0 ? Math.round((practiceScore.correct / practiceScore.total) * 100) : 0;
            var emoji = percentage >= 80 ? '' : percentage >= 50 ? '' : '';
            
            container.innerHTML = 
                '<div class="practice-complete">' +
                    '<div class="practice-complete-icon">' + emoji + '</div>' +
                    '<div class="practice-complete-title">Practice Complete!</div>' +
                    '<div class="practice-complete-score">' + practiceScore.correct + ' / ' + practiceScore.total + ' (' + percentage + '%)</div>' +
                    '<div class="practice-complete-buttons">' +
                        '<button class="btn-action" onclick="restartPractice()"> Practice Again</button>' +
                        '<button class="btn-flip" onclick="backToLessons()"> Back to Lessons</button>' +
                    '</div>' +
                '</div>';
            
            document.getElementById('practiceNextBtn').style.display = 'none';
            
            // Mark lesson as completed
            var lesson = grammarLessons[currentLessonIndex];
            lessonProgress[lesson.id] = true;
            localStorage.setItem('thaiGrammarProgress', JSON.stringify(lessonProgress));
        }
        
        function restartPractice() {
            startPractice(currentPracticeLesson, 'build');
        }
        
        function backToLessons() {
            document.getElementById('grammarPracticeView').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'none';
            document.getElementById('grammarLessonsList').style.display = '';
            renderGrammarLessonsList();
        }
        
        function nextPracticeQuestion() {
            currentPracticeIndex++;
            renderPracticeQuestion();
        }
        
        function closePractice() {
            document.getElementById('grammarPracticeView').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'block';
            renderLessonStep();
        }

        function switchAppMode(mode) {
            currentAppMode = mode;
            
            // Update buttons
            document.querySelectorAll('.app-mode-btn').forEach(function(btn) {
                btn.classList.toggle('active', btn.getAttribute('data-appmode') === mode);
            });
            
            // Show/hide sections
            var flashcardsSection = document.querySelector('.container');
            var grammarSection = document.getElementById('grammarSection');
            var alphabetSection = document.getElementById('alphabetSection');
            
            // Hide all controls that are only for flashcards
            var flashcardElements = [
                '.top-controls', '.session-controls', '.mode-selector', 
                '.progress-container', '.card-container', '.score-display',
                '.controls', '.action-controls', '.sentence-example'
            ];
            
            if (mode === 'flashcards') {
                flashcardElements.forEach(function(sel) {
                    var el = document.querySelector(sel);
                    if (el) el.style.display = '';
                });
                grammarSection.style.display = 'none';
                alphabetSection.style.display = 'none';
            } else if (mode === 'grammar') {
                flashcardElements.forEach(function(sel) {
                    var el = document.querySelector(sel);
                    if (el) el.style.display = 'none';
                });
                grammarSection.style.display = 'block';
                alphabetSection.style.display = 'none';
                renderGrammarLessonsList();
            } else if (mode === 'alphabet') {
                flashcardElements.forEach(function(sel) {
                    var el = document.querySelector(sel);
                    if (el) el.style.display = 'none';
                });
                grammarSection.style.display = 'none';
                alphabetSection.style.display = 'block';
                // Reset to main view
                document.getElementById('alphabetModes').style.display = 'grid';
                document.getElementById('alphabetProgressOverview').style.display = 'block';
                document.getElementById('alphabetPracticeView').style.display = 'none';
                document.getElementById('alphabetFlashcardView').style.display = 'none';
                document.getElementById('classSortingView').style.display = 'none';
                document.getElementById('alphabetChartView').style.display = 'none';
                updateAlphabetProgressDisplay();
            }
        }

        // Show main menu
        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('writingSection').style.display = 'none';
            document.getElementById('readingSection').style.display = 'none';
            document.getElementById('backToMenu').style.display = 'none';
        }

        // Start app from main menu
        function startApp(mode) {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('backToMenu').style.display = 'flex';
            
            // Hide all sections first
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('writingSection').style.display = 'none';
            document.getElementById('readingSection').style.display = 'none';
            
            // Show the appropriate section
            if (mode === 'writing') {
                document.getElementById('writingSection').style.display = 'block';
                initWritingPractice();
            } else if (mode === 'reading') {
                document.getElementById('readingSection').style.display = 'block';
                initReadingPractice();
            } else {
                document.getElementById('appContainer').style.display = 'block';
                // Initialize the app
                initApp();
                
                // Switch to the requested mode
                if (mode === 'grammar') {
                    switchAppMode('grammar');
                } else if (mode === 'alphabet') {
                    switchAppMode('alphabet');
                } else {
                    switchAppMode('flashcards');
                }
            }
        }

        function initApp() {
            try {
                loadProgress();
                loadTheme();
                initOptionsPanel();
                updateListSelector();
                // Only show resume if cards have actually been swiped (correct or incorrect > 0)
                var hasSwipedCards = sessionState.inProgress && sessionState.cardOrder.length > 0 && 
                                     (sessionStats.correct > 0 || sessionStats.incorrect > 0);
                if (hasSwipedCards) {
                    showResumeModal();
                } else {
                    // Reset session stats for fresh start
                    sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                    initializeCards();
                    updateCard();
                }
                setupEventListeners();
            } catch (e) {
                console.error('initApp error:', e);
                alert('Error initializing app: ' + e.message);
            }
        }

        // ============== WRITING PRACTICE ==============
        
        let writingState = {
            words: [],
            currentIndex: 0,
            correct: 0,
            total: 0,
            answered: false
        };
        
        function initWritingPractice() {
            // Populate list selector
            const selector = document.getElementById('writingListSelector');
            selector.innerHTML = '<option value="all">All Vocabulary</option>';
            themedLists.forEach((list, i) => {
                selector.innerHTML += `<option value="${i}">${list.name}</option>`;
            });
            
            selector.addEventListener('change', () => {
                loadWritingWords();
                nextWritingWord();
            });
            
            // Setup event listeners
            document.getElementById('writingCheckBtn').addEventListener('click', checkWritingAnswer);
            document.getElementById('writingSkipBtn').addEventListener('click', skipWritingWord);
            document.getElementById('writingNextBtn').addEventListener('click', nextWritingWord);
            document.getElementById('writingInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    if (writingState.answered) {
                        nextWritingWord();
                    } else {
                        checkWritingAnswer();
                    }
                }
            });
            
            document.getElementById('writingShowRomanization').addEventListener('change', (e) => {
                document.getElementById('writingRomanization').style.display = e.target.checked ? 'block' : 'none';
            });
            
            loadWritingWords();
            nextWritingWord();
        }
        
        function loadWritingWords() {
            const selector = document.getElementById('writingListSelector');
            const value = selector.value;
            
            if (value === 'all') {
                writingState.words = [];
                themedLists.forEach(list => {
                    writingState.words = writingState.words.concat(list.words);
                });
            } else {
                writingState.words = [...themedLists[parseInt(value)].words];
            }
            
            // Shuffle
            for (let i = writingState.words.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [writingState.words[i], writingState.words[j]] = [writingState.words[j], writingState.words[i]];
            }
            
            writingState.currentIndex = 0;
            writingState.correct = 0;
            writingState.total = 0;
            updateWritingScore();
        }
        
        function nextWritingWord() {
            if (writingState.currentIndex >= writingState.words.length) {
                writingState.currentIndex = 0;
                // Reshuffle
                for (let i = writingState.words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [writingState.words[i], writingState.words[j]] = [writingState.words[j], writingState.words[i]];
                }
            }
            
            const word = writingState.words[writingState.currentIndex];
            document.getElementById('writingEnglish').textContent = word.english;
            
            // Get romanization
            const roman = romanization[word.thai] || word.thai;
            document.getElementById('writingRomanization').textContent = roman;
            document.getElementById('writingRomanization').style.display = 
                document.getElementById('writingShowRomanization').checked ? 'block' : 'none';
            
            // Reset input
            const input = document.getElementById('writingInput');
            input.value = '';
            input.className = 'writing-input';
            input.disabled = false;
            input.focus();
            
            // Reset feedback
            document.getElementById('writingFeedback').className = 'writing-feedback';
            
            // Reset buttons
            document.getElementById('writingCheckBtn').style.display = 'inline-block';
            document.getElementById('writingSkipBtn').style.display = 'inline-block';
            document.getElementById('writingNextBtn').style.display = 'none';
            
            writingState.answered = false;
        }
        
        function checkWritingAnswer() {
            const word = writingState.words[writingState.currentIndex];
            const input = document.getElementById('writingInput');
            const userAnswer = input.value.trim();
            
            const isCorrect = userAnswer === word.thai;
            
            writingState.total++;
            if (isCorrect) {
                writingState.correct++;
                input.className = 'writing-input correct';
                document.getElementById('writingFeedback').className = 'writing-feedback show correct';
                document.getElementById('writingFeedbackText').textContent = ' Correct!';
                document.getElementById('writingCorrectAnswer').textContent = '';
            } else {
                input.className = 'writing-input incorrect';
                document.getElementById('writingFeedback').className = 'writing-feedback show incorrect';
                document.getElementById('writingFeedbackText').textContent = ' Not quite';
                document.getElementById('writingCorrectAnswer').textContent = `Correct: ${word.thai}`;
            }
            
            input.disabled = true;
            document.getElementById('writingCheckBtn').style.display = 'none';
            document.getElementById('writingSkipBtn').style.display = 'none';
            document.getElementById('writingNextBtn').style.display = 'inline-block';
            
            writingState.answered = true;
            writingState.currentIndex++;
            updateWritingScore();
        }
        
        function skipWritingWord() {
            const word = writingState.words[writingState.currentIndex];
            
            document.getElementById('writingFeedback').className = 'writing-feedback show incorrect';
            document.getElementById('writingFeedbackText').textContent = 'Skipped';
            document.getElementById('writingCorrectAnswer').textContent = `Answer: ${word.thai}`;
            
            document.getElementById('writingInput').disabled = true;
            document.getElementById('writingCheckBtn').style.display = 'none';
            document.getElementById('writingSkipBtn').style.display = 'none';
            document.getElementById('writingNextBtn').style.display = 'inline-block';
            
            writingState.answered = true;
            writingState.total++;
            writingState.currentIndex++;
            updateWritingScore();
        }
        
        function updateWritingScore() {
            document.getElementById('writingCorrect').textContent = writingState.correct;
            document.getElementById('writingTotal').textContent = writingState.total;
        }
        
        // ============== READING PRACTICE ==============
        
        // Stories with spaced words for beginner/intermediate, natural text for advanced
        // Each sentence has: thai (display), spaced (word-separated), roman, english
        const readingStories = {
            beginner: [
                {
                    title: "My Day",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", spaced: " ", roman: "s-wt-dii krp", english: "Hello." },
                        { thai: "", spaced: "  ", roman: "pm chue sm-chaai", english: "My name is Somchai." },
                        { thai: "", spaced: "   ", roman: "wan-ni pm dtuen cho", english: "Today I woke up early." },
                        { thai: "", spaced: "   ", roman: "pm gin kao cho", english: "I had breakfast." },
                        { thai: "", spaced: "   ", roman: "lew pm bpai tam-ngaan", english: "Then I went to work." },
                        { thai: "", spaced: "    ", roman: "te tam-ngaan mii kon yh", english: "There were many people at work." },
                        { thai: "", spaced: "   ", roman: "pm tam-ngaan nk mak", english: "I worked very hard." },
                        { thai: "", spaced: "    ", roman: "dton-yen pm glp ban", english: "In the evening, I went home." },
                        { thai: "", spaced: "     ", roman: "pm gin kao yen gp krp-krua", english: "I had dinner with my family." },
                        { thai: "", spaced: "   ", roman: "lew pm gr non", english: "Then I went to sleep." }
                    ]
                },
                {
                    title: "At the Market",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", spaced: "   ", roman: "wan-ni chn bpai dt-lat", english: "Today I went to the market." },
                        { thai: "", spaced: "  ", roman: "dt-lat yi mak", english: "The market is very big." },
                        { thai: "", spaced: "   ", roman: "mii pn-l-mai lai yang", english: "There are many kinds of fruit." },
                        { thai: "", spaced: "    ", roman: "chn sue m-mang ha luk", english: "I bought five mangoes." },
                        { thai: "", spaced: "  ", roman: "m-mang wan mak", english: "The mangoes are very sweet." },
                        { thai: "", spaced: "   ", roman: "chn sue pk day", english: "I also bought vegetables." },
                        { thai: "", spaced: "    ", roman: "pk st le raa-kaa tuk", english: "The vegetables are fresh and cheap." },
                        { thai: "", spaced: "     ", roman: "chn jai ngern lew glp ban", english: "I paid and went home." }
                    ]
                },
                {
                    title: "My Family",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", spaced: "     ", roman: "krp-krua kng chn mii si kon", english: "There are four people in my family." },
                        { thai: "", spaced: "    ", roman: "pr kng chn bpen mr", english: "My father is a doctor." },
                        { thai: "", spaced: "    ", roman: "me kng chn bpen kruu", english: "My mother is a teacher." },
                        { thai: "", spaced: "    ", roman: "chn mii nng-sao neng kon", english: "I have one younger sister." },
                        { thai: "", spaced: "   ", roman: "nng-sao aa-y sp kap", english: "My sister is ten years old." },
                        { thai: "", spaced: "   ", roman: "ter chp wat rup", english: "She likes to draw." },
                        { thai: "", spaced: "       ", roman: "rao yu day gan yang mii kwaam-sk", english: "We live together happily." }
                    ]
                },
                {
                    title: "My Pet Dog",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", spaced: "    ", roman: "chn mii s-nk neng dtua", english: "I have one dog." },
                        { thai: "", spaced: "    ", roman: "s-nk kng chn chue chok", english: "My dog's name is Chok." },
                        { thai: "", spaced: "    ", roman: "chok bpen s-nk si nm-dtaan", english: "Chok is a brown dog." },
                        { thai: "", spaced: "   ", roman: "ko chp wng ln", english: "He likes to run and play." },
                        { thai: "", spaced: "       ", roman: "tk cho chn paa chok bpai dern ln", english: "Every morning I take Chok for a walk." },
                        { thai: "", spaced: "     ", roman: "chok chp gin kao gp nea", english: "Chok likes to eat rice with meat." },
                        { thai: "", spaced: "     ", roman: "dton glaang-keun chok non nai ban", english: "At night Chok sleeps inside the house." },
                        { thai: "", spaced: "   ", roman: "chn rk chok mak", english: "I love Chok very much." }
                    ]
                }
            ],
            intermediate: [
                {
                    title: "A Trip to Chiang Mai",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", spaced: "      ", roman: "mea deuan te lew pm bpai chiang-mi", english: "Last month I went to Chiang Mai." },
                        { thai: "", spaced: "    ", roman: "pm nng kreang-bin jak grung-typ", english: "I flew from Bangkok." },
                        { thai: "", spaced: "    ", roman: "chi way-laa bpr-maan neng cha-moong", english: "It took about one hour." },
                        { thai: "", spaced: "      ", roman: "aa-gat te chiang-mi yen gwa grung-typ mak", english: "The weather in Chiang Mai is much cooler than Bangkok." },
                        { thai: "", spaced: "     ", roman: "pm bpai tao wt pr-tat doi-s-typ", english: "I visited Wat Phra That Doi Suthep." },
                        { thai: "", spaced: "    ", roman: "wt yu bon puu-ko sung", english: "The temple is on a high mountain." },
                        { thai: "", spaced: "       ", roman: "dtng dern ken ban-dai sam ri gwa kn", english: "You have to climb over 300 steps." },
                        { thai: "", spaced: "     ", roman: "wiw jak bon wt say mak", english: "The view from the temple is beautiful." },
                        { thai: "", spaced: "        ", roman: "pm yang dai bpai dern t-nn kon dern day", english: "I also went to the walking street." },
                        { thai: "", spaced: "       ", roman: "mii aa-han le kng te r-lek yh mak", english: "There was lots of food and souvenirs." },
                        { thai: "", spaced: "     ", roman: "gaan dern-taang krng ni s-nk mak", english: "This trip was really fun." }
                    ]
                },
                {
                    title: "Learning Thai",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", spaced: "         ", roman: "pm rrm rian paa-sa tai mea hk deuan te lew", english: "I started learning Thai six months ago." },
                        { thai: "", spaced: "        ", roman: "dton rek yak mak prr mii ha sang wan-n-yk", english: "At first it was very hard because there are five tones." },
                        { thai: "", spaced: "     ", roman: "pm dtng fek put tk wan", english: "I have to practice speaking every day." },
                        { thai: "", spaced: "      ", roman: "pm duu l-kon tai pea fek fang", english: "I watch Thai dramas to practice listening." },
                        { thai: "", spaced: "       ", roman: "gaan an paa-sa tai gr yak mean gan", english: "Reading Thai is also difficult." },
                        { thai: "", spaced: "       ", roman: "dtua k-sn tai mii si-sp-si dtua", english: "The Thai alphabet has 44 letters." },
                        { thai: "", spaced: "        ", roman: "dte dton-ni pm an dai dii ken lew", english: "But now I can read much better." },
                        { thai: "", spaced: "     ", roman: "pm chp kui gp kon tai", english: "I like chatting with Thai people." },
                        { thai: "", spaced: "       ", roman: "pak-ko jai-dii le chay ge-ki hi pm", english: "They're kind and help correct my mistakes." },
                        { thai: "", spaced: "         ", roman: "pm wng wa bpii na j put tai dai klng", english: "I hope to speak Thai fluently by next year." }
                    ]
                },
                {
                    title: "Thai Food Adventure",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", spaced: "           ", roman: "aa-han tai bpen neng nai aa-han te mii chue-sang te-st nai lok", english: "Thai food is one of the most famous cuisines in the world." },
                        { thai: "", spaced: "     ", roman: "pm chp gin pt-tai mak te-st", english: "I like eating Pad Thai the most." },
                        { thai: "", spaced: "        ", roman: "pt-tai mii sn gay-dtao pt gp ki le gng", english: "Pad Thai has rice noodles stir-fried with egg and shrimp." },
                        { thai: "", spaced: "     ", roman: "dtm-yam-gng gr -ri mak chn gan", english: "Tom Yum Goong is also very delicious." },
                        { thai: "", spaced: "        ", roman: "bpen sp rt pt bprao te mii gng st", english: "It's a spicy and sour soup with fresh shrimp." },
                        { thai: "", spaced: "       ", roman: "sm-dtam bpen aa-han ii-san te n-yom ta bpr-tyt", english: "Som Tam is an Isaan dish popular throughout the country." },
                        { thai: "", spaced: "        ", roman: "tam jak m-l-gor dp dtam gp prk le nm-bplaa", english: "It's made from raw papaya pounded with chili and fish sauce." },
                        { thai: "", spaced: "         ", roman: "ta kun maa meuang-tai dtng long gin aa-han rim taang", english: "If you come to Thailand, you must try street food." },
                        { thai: "", spaced: "      ", roman: "aa-han rim taang -ri le raa-kaa tuk", english: "Street food is delicious and cheap." }
                    ]
                }
            ],
            advanced: [
                {
                    title: "Thai Economy and Tourism",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", roman: "bpr-tyt tai mii syt-t-gt yi bpen an-dp sng nai ay-sia dt-wan-k chang-dti", english: "Thailand has the second largest economy in Southeast Asia." },
                        { thai: "", roman: "gaan tng-tao bpen leng raai-dai sm-kan kng bpr-tyt", english: "Tourism is a major source of income for the country." },
                        { thai: "", roman: "tk bpii mii nk tng-tao dtang chat mak gwa sam-sp-ha lan kon", english: "Over 35 million foreign tourists visit each year." },
                        { thai: "   ", roman: "grung-typ puu-gt le chiang-mi bpen jt-mai yt-n-yom", english: "Bangkok, Phuket, and Chiang Mai are the most popular destinations." },
                        { thai: "", roman: "nk-jak gaan tng-tao lew tai yang mii t-sa-h-gam gaan p-lt te keng-graeng", english: "Besides tourism, Thailand also has a strong manufacturing sector." },
                        { thai: "", roman: "tai sng-k rt-yon le chn-san -lk-trn-k bpen jam-nuan mak", english: "Thailand exports large quantities of automobiles and electronics." },
                        { thai: "", roman: "rt-t-baan gam-lang sng-srm syt-t-gt d-j-tan pea pt-t-naa bpr-tyt", english: "The government is promoting the digital economy to develop the country." },
                        { thai: "", roman: "mii gaan long-tun mak nai kroong-sang pen-tan le tk-noo-loo-yii", english: "There is significant investment in infrastructure and technology." },
                        { thai: "", roman: "yang-rai-gr-dtaam kwaam-leam-lm taang syt-t-gt yang kong bpen bpan-ha", english: "However, economic inequality remains a challenge." },
                        { thai: "", roman: "gaan pt-t-naa yang yng-yeun bpen bpo-mai sm-kan sm-rp -naa-kt", english: "Sustainable development is an important goal for the future." }
                    ]
                },
                {
                    title: "Thai Culture and Traditions",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", roman: "sng-kom tai gam-lang p-chern gp kwaam ta-taai nai gaan rk-sa bpr-pay-nii dng-derm", english: "Thai society faces challenges in preserving traditional customs." },
                        { thai: "", roman: "kon rn mi rp t-t-pon jak wt-t-n-tam dt-wan-dtk mak ken", english: "Younger generations are increasingly influenced by Western culture." },
                        { thai: "", roman: "dte tyt-s-gaan sm-kan chn sng-graan yang kong dai rp kwaam n-yom", english: "But important festivals like Songkran remain popular." },
                        { thai: "", roman: "sng-graan bpen tyt-s-gaan bpii mi tai nai deuan may-sa-yon", english: "Songkran is the Thai New Year festival held in April." },
                        { thai: "", roman: "pu-kon rt nam dam ha pu-yi pea s-daeng kwaam kao-rp", english: "People pour water over elders' hands as a sign of respect." },
                        { thai: "", roman: "sat-s-na pt mii bt-bat sm-kan nai chii-wt bpr-jam-wan", english: "Buddhism plays an important role in daily life." },
                        { thai: "", roman: "kon tai san yi tam bun dtk bat bpen bpr-jam", english: "Most Thai people regularly give alms to monks." },
                        { thai: "", roman: "gaan kao-rp pu aa-w-so bpen ka-n-yom te fng rak lek nai sng-kom tai", english: "Respect for elders is a deeply rooted value in Thai society." },
                        { thai: "", roman: "me sng-kom j bplan bpai dte rak-tan wt-t-n-tam lo-ni yang kong keng-graeng", english: "Although society changes, these cultural foundations remain strong." }
                    ]
                },
                {
                    title: "Climate Change and Thailand",
                    titleThai: "",
                    icon: "",
                    sentences: [
                        { thai: "", roman: "bpr-tyt tai gam-lang p-chern gp pn gr-tp jak gaan bplan-bplaeng s-pap puu-m-aa-gat", english: "Thailand is facing the impacts of climate change." },
                        { thai: "", roman: "r-dp nam t-lay te sung ken kk-kaam pen-te chaai-fng lai heng", english: "Rising sea levels threaten many coastal areas." },
                        { thai: "", roman: "grung-typ seng yu gli r-dp nam t-lay mii kwaam sang bpen p-syt", english: "Bangkok, which is near sea level, is especially at risk." },
                        { thai: "", roman: "pai leng le nam tam grt ken bi le run-raeng mak ken", english: "Droughts and floods occur more frequently and severely." },
                        { thai: "", roman: "g-syt-dt-gon dtng bprp dtua gp s-pap aa-gat te mi ne-non", english: "Farmers must adapt to unpredictable weather conditions." },
                        { thai: "", roman: "rt-t-baan dtng bpo lt gaan bpli gat reuan gr-jk", english: "The government has set targets to reduce greenhouse gas emissions." },
                        { thai: "", roman: "p-lang-ngaan mn wian gam-lang dai rp gaan sng-srm mak ken", english: "Renewable energy is being increasingly promoted." },
                        { thai: "", roman: "bpr-chaa-chon rrm dtr-nk teng kwaam sm-kan kng gaan rk-sa sng-wet-lm", english: "Citizens are becoming aware of the importance of environmental protection." },
                        { thai: "", roman: "gaan ge bpan-ha ni dtng aa-si kwaam ram-meu jak tk pak san", english: "Solving this problem requires cooperation from all sectors." }
                    ]
                }
            ]
        };
        
        let currentReadingLevel = 'beginner';
        let currentStory = null;
        let activeSentenceIndex = null;
        
        function initReadingPractice() {
            showStoryList();
        }
        
        function selectReadingLevel(level, element) {
            currentReadingLevel = level;
            
            // Update active state
            document.querySelectorAll('.reading-level-card').forEach(card => {
                card.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
            
            showStoryList();
        }
        
        function showStoryList() {
            const stories = readingStories[currentReadingLevel];
            const container = document.getElementById('readingStoryList');
            
            container.innerHTML = stories.map((story, i) => `
                <div class="reading-story-card" onclick="openStory(${i})">
                    <div class="reading-story-icon">${story.icon}</div>
                    <div class="reading-story-info">
                        <div class="reading-story-title">${story.titleThai}</div>
                        <div class="reading-story-subtitle">${story.title}</div>
                    </div>
                    <div class="reading-story-arrow"></div>
                </div>
            `).join('');
            
            document.getElementById('readingLevelSelect').style.display = 'block';
            document.getElementById('readingStoryView').style.display = 'none';
        }
        
        function openStory(index) {
            currentStory = readingStories[currentReadingLevel][index];
            activeSentenceIndex = null;
            
            // Set titles
            document.getElementById('storyTitleThai').textContent = currentStory.titleThai;
            document.getElementById('storyTitleEnglish').textContent = currentStory.title;
            
            // Build story text
            const storyText = document.getElementById('readingStoryText');
            const useSpacing = currentReadingLevel !== 'advanced';
            
            storyText.innerHTML = currentStory.sentences.map((s, i) => {
                const displayText = useSpacing ? s.spaced : s.thai;
                return `<span class="reading-sentence" data-index="${i}" onclick="showSentenceTranslation(${i})">${displayText || s.thai}</span>`;
            }).join(' ');
            
            // Hide translation box
            document.getElementById('readingTranslationBox').classList.remove('show');
            
            // Reset reveal button
            document.getElementById('readingFullTranslation').style.display = 'none';
            document.getElementById('revealStoryBtn').textContent = ' Reveal Full Translation';
            document.getElementById('revealStoryBtn').classList.remove('active');
            
            document.getElementById('readingLevelSelect').style.display = 'none';
            document.getElementById('readingStoryView').style.display = 'block';
        }
        
        function showSentenceTranslation(index) {
            const sentence = currentStory.sentences[index];
            
            // Update active state
            document.querySelectorAll('.reading-sentence').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`.reading-sentence[data-index="${index}"]`).classList.add('active');
            
            // Show translation box
            document.getElementById('transBoxThai').textContent = sentence.thai;
            document.getElementById('transBoxRoman').textContent = sentence.roman;
            document.getElementById('transBoxEnglish').textContent = sentence.english;
            document.getElementById('readingTranslationBox').classList.add('show');
            
            activeSentenceIndex = index;
        }
        
        function backToStoryList() {
            document.getElementById('readingLevelSelect').style.display = 'block';
            document.getElementById('readingStoryView').style.display = 'none';
        }
        
        function toggleRevealStory() {
            const translationDiv = document.getElementById('readingFullTranslation');
            const btn = document.getElementById('revealStoryBtn');
            const isShowing = translationDiv.style.display !== 'none';
            
            if (isShowing) {
                translationDiv.style.display = 'none';
                btn.textContent = ' Reveal Full Translation';
                btn.classList.remove('active');
            } else {
                // Build full translation
                const fullText = currentStory.sentences.map(s => s.english).join(' ');
                document.getElementById('fullTranslationText').textContent = fullText;
                translationDiv.style.display = 'block';
                btn.textContent = ' Hide Translation';
                btn.classList.add('active');
            }
        }

        function init() {
            loadTheme();
            // Check if user has visited before - if so, skip menu
            const hasVisited = localStorage.getItem('thaiFlashcardsVisited');
            if (hasVisited) {
                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                document.getElementById('backToMenu').style.display = 'flex';
                initApp();
            }
            // Mark as visited for next time
            localStorage.setItem('thaiFlashcardsVisited', 'true');
        }
        
        function loadTheme() {
            const savedTheme = localStorage.getItem('thaiFlashcardsTheme');
            if (savedTheme === 'dark') {
                darkMode = true;
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '';
            } else {
                darkMode = false;
                document.documentElement.removeAttribute('data-theme');
                themeToggle.textContent = '';
            }
        }
        
        function toggleTheme() {
            darkMode = !darkMode;
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '';
                localStorage.setItem('thaiFlashcardsTheme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.textContent = '';
                localStorage.setItem('thaiFlashcardsTheme', 'light');
            }
        }
        
        function switchViewMode(newMode) {
            if (newMode === viewMode) return;
            
            viewMode = newMode;
            localStorage.setItem('thaiFlashcardsViewMode', viewMode);
            
            // Update button states
            document.querySelectorAll('.option-toggle-btn[data-view]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewMode);
            });
            
            // Show/hide mixed list size option
            document.getElementById('mixedListSizeGroup').style.display = viewMode === 'mixed' ? 'block' : 'none';
            
            // Update vocabulary lists
            vocabularyLists = getActiveVocabularyLists();
            
            // Reset to first list of new view
            currentListIndex = 0;
            vocabulary = vocabularyLists[currentListIndex].words;
            
            // Update UI
            updateListSelector();
            initializeCards();
            updateCard();
            
            showToast(viewMode === 'themed' ? 'Switched to Themed Lists' : 'Switched to Mixed Lists');
        }
        
        function reshuffleMixedLists() {
            const sizeInput = document.getElementById('mixedListSizeInput');
            let newSize = parseInt(sizeInput.value);
            
            // Validate input
            if (isNaN(newSize) || newSize < 10) {
                newSize = 10;
                sizeInput.value = 10;
            } else if (newSize > 500) {
                newSize = 500;
                sizeInput.value = 500;
            }
            
            // Save the new size
            mixedListSize = newSize;
            localStorage.setItem('thaiFlashcardsMixedListSize', mixedListSize);
            
            // Regenerate mixed lists
            mixedLists = generateMixedLists(mixedListSize);
            
            // If currently in mixed mode, update the view
            if (viewMode === 'mixed') {
                vocabularyLists = getActiveVocabularyLists();
                currentListIndex = 0;
                vocabulary = vocabularyLists[currentListIndex].words;
                updateListSelector();
                initializeCards();
                updateCard();
            }
            
            const numLists = mixedLists.length;
            showToast(`Reshuffled into ${numLists} list${numLists > 1 ? 's' : ''} of ~${mixedListSize} cards`);
        }
        
        function initOptionsPanel() {
            // Initialize romanization toggle
            romanizationToggle.checked = showRomanization;
            romanizationToggle.addEventListener('change', () => {
                showRomanization = romanizationToggle.checked;
                localStorage.setItem('thaiFlashcardsRomanization', showRomanization);
                updateCard();
                showToast(showRomanization ? 'Romanization enabled' : 'Romanization disabled');
            });
            
            // Initialize auto-play toggle
            const autoPlayToggle = document.getElementById('autoPlayToggle');
            autoPlayToggle.checked = autoPlayAudio;
            autoPlayToggle.addEventListener('change', () => {
                autoPlayAudio = autoPlayToggle.checked;
                localStorage.setItem('thaiFlashcardsAutoPlay', autoPlayAudio);
                showToast(autoPlayAudio ? 'Auto-play enabled' : 'Auto-play disabled');
            });
            
            // Initialize dark mode toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.checked = darkMode;
            darkModeToggle.addEventListener('change', () => {
                darkMode = darkModeToggle.checked;
                document.documentElement.setAttribute('data-theme', darkMode ? 'dark' : 'light');
                localStorage.setItem('thaiFlashcardsTheme', darkMode ? 'dark' : 'light');
                themeToggle.textContent = darkMode ? '' : '';
                showToast(darkMode ? 'Dark mode enabled' : 'Light mode enabled');
            });
            
            // Initialize view mode buttons
            document.querySelectorAll('.option-toggle-btn[data-view]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewMode);
                btn.addEventListener('click', () => switchViewMode(btn.dataset.view));
            });
            
            // Initialize mixed list size controls
            const mixedListSizeGroup = document.getElementById('mixedListSizeGroup');
            const mixedListSizeInput = document.getElementById('mixedListSizeInput');
            const reshuffleMixedBtn = document.getElementById('reshuffleMixedBtn');
            
            mixedListSizeGroup.style.display = viewMode === 'mixed' ? 'block' : 'none';
            mixedListSizeInput.value = mixedListSize;
            
            reshuffleMixedBtn.addEventListener('click', reshuffleMixedLists);
            
            // Allow Enter key to trigger reshuffle
            mixedListSizeInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    reshuffleMixedLists();
                }
            });
            
            // Initialize card direction buttons
            document.querySelectorAll('.option-toggle-btn[data-direction]').forEach(btn => {
                btn.classList.toggle('active', 
                    (btn.dataset.direction === 'thai' && showThaiFront) ||
                    (btn.dataset.direction === 'english' && !showThaiFront)
                );
                btn.addEventListener('click', () => {
                    const newDirection = btn.dataset.direction === 'thai';
                    if (newDirection !== showThaiFront) {
                        showThaiFront = newDirection;
                        localStorage.setItem('thaiFlashcardsThaiFront', showThaiFront);
                        document.querySelectorAll('.option-toggle-btn[data-direction]').forEach(b => {
                            b.classList.toggle('active', 
                                (b.dataset.direction === 'thai' && showThaiFront) ||
                                (b.dataset.direction === 'english' && !showThaiFront)
                            );
                        });
                        updateCard();
                        showToast(showThaiFront ? 'Thai  English' : 'English  Thai');
                    }
                });
            });
            
            // Options modal open/close
            optionsBtn.addEventListener('click', () => optionsModal.classList.add('open'));
            document.getElementById('closeOptions').addEventListener('click', () => optionsModal.classList.remove('open'));
            optionsModal.addEventListener('click', (e) => {
                if (e.target === optionsModal) optionsModal.classList.remove('open');
            });
            
            // Vocab list modal
            var vocabListModal = document.getElementById('vocabListModal');
            document.getElementById('viewVocabListBtn').addEventListener('click', () => {
                optionsModal.classList.remove('open');
                showVocabList();
            });
            document.getElementById('closeVocabList').addEventListener('click', () => vocabListModal.classList.remove('open'));
            vocabListModal.addEventListener('click', (e) => {
                if (e.target === vocabListModal) vocabListModal.classList.remove('open');
            });
            document.getElementById('vocabListFilter').addEventListener('change', showVocabList);
            
            // Stats button
            document.getElementById('viewStatsBtn').addEventListener('click', () => {
                optionsModal.classList.remove('open');
                statsModal.classList.add('open');
                updateStatsModal();
            });
            
            // Import/Export button (opens settings modal)
            document.getElementById('importExportBtn').addEventListener('click', () => {
                optionsModal.classList.remove('open');
                settingsModal.classList.add('open');
            });
            
            // Restore Defaults button
            var resetConfirmModal = document.getElementById('resetConfirmModal');
            document.getElementById('restoreDefaultsBtn').addEventListener('click', function() {
                optionsModal.classList.remove('open');
                resetConfirmModal.classList.add('open');
            });
            document.getElementById('cancelResetBtn').addEventListener('click', function() {
                resetConfirmModal.classList.remove('open');
            });
            document.getElementById('confirmResetBtn').addEventListener('click', function() {
                resetConfirmModal.classList.remove('open');
                restoreDefaultSettings();
            });
            resetConfirmModal.addEventListener('click', function(e) {
                if (e.target === resetConfirmModal) resetConfirmModal.classList.remove('open');
            });
        }
        
        function restoreDefaultSettings() {
            // Clear ALL localStorage data for this app
            localStorage.removeItem('thaiFlashcardsProgress');
            localStorage.removeItem('thaiFlashcardsSession');
            localStorage.removeItem('thaiFlashcardsViewMode');
            localStorage.removeItem('thaiFlashcardsThaiFront');
            localStorage.removeItem('thaiFlashcardsRomanization');
            localStorage.removeItem('thaiFlashcardsAutoPlay');
            localStorage.removeItem('thaiFlashcardsTheme');
            localStorage.removeItem('thaiFlashcardsMixedListSize');
            localStorage.removeItem('thaiFlashcardsVisited');
            
            // Reset all variables to defaults
            viewMode = 'mixed';
            showThaiFront = true;
            showRomanization = true;
            autoPlayAudio = false;
            darkMode = false;
            mixedListSize = 200;
            cardStats = { global: {} };
            sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
            sessionState = { cardOrder: [], currentIndex: 0, listIndex: 0, mode: 'all', inProgress: false };
            favorites = new Set();
            currentMode = 'all';
            currentListIndex = 0;
            
            // Update UI elements
            // View mode buttons
            document.querySelectorAll('.option-toggle-btn[data-view]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewMode);
            });
            document.getElementById('mixedListSizeGroup').style.display = viewMode === 'mixed' ? 'block' : 'none';
            document.getElementById('mixedListSizeInput').value = mixedListSize;
            
            // Card direction buttons
            document.querySelectorAll('.option-toggle-btn[data-direction]').forEach(btn => {
                btn.classList.toggle('active', 
                    (btn.dataset.direction === 'thai' && showThaiFront) ||
                    (btn.dataset.direction === 'english' && !showThaiFront)
                );
            });
            
            // Mode buttons
            modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === currentMode));
            
            // Toggles
            document.getElementById('romanizationToggle').checked = showRomanization;
            document.getElementById('autoPlayToggle').checked = autoPlayAudio;
            document.getElementById('darkModeToggle').checked = darkMode;
            
            // Theme
            document.documentElement.removeAttribute('data-theme');
            themeToggle.textContent = '';
            
            // Regenerate mixed lists with default size
            mixedLists = generateMixedLists(mixedListSize);
            
            // Update vocabulary lists
            vocabularyLists = getActiveVocabularyLists();
            vocabulary = vocabularyLists[currentListIndex].words;
            
            // Update UI
            updateListSelector();
            initializeCards();
            updateCard();
            updateScoreDisplay();
            
            showToast('App completely reset');
        }
        
        function getMasteryStatus(card) {
            const key = getCardKey(card);
            
            // Use global stats
            const globalStats = getCardStats();
            const stats = globalStats[key];
            
            if (!stats || (stats.consecutiveCorrect === 0 && stats.incorrect === 0)) {
                return { status: 'new', label: 'New', class: 'mastery-new' };
            }
            
            // Check if struggling: more incorrect than correct, or high incorrect count with no streak
            const isStruggling = stats.incorrect >= 3 && stats.consecutiveCorrect === 0 && stats.incorrect > stats.correct;
            
            if (isStruggling) {
                return { status: 'struggling', label: 'Hard', class: 'mastery-struggling' };
            } else if (stats.consecutiveCorrect >= LEARNING_THRESHOLD) {
                // Check if it's been too long since last review (based on difficulty)
                if (stats.lastReviewed) {
                    const daysSinceReview = (Date.now() - new Date(stats.lastReviewed).getTime()) / (1000 * 60 * 60 * 24);
                    const reviewInterval = getReviewInterval(stats);
                    
                    if (daysSinceReview > reviewInterval) {
                        // Needs review
                        return { 
                            status: 'learning', 
                            label: 'Review', 
                            class: 'mastery-learning',
                            reviewInterval: reviewInterval,
                            daysSinceReview: daysSinceReview
                        };
                    }
                }
                // Show days until review in mastered label
                const reviewInterval = getReviewInterval(stats);
                const daysSinceReview = stats.lastReviewed ? 
                    (Date.now() - new Date(stats.lastReviewed).getTime()) / (1000 * 60 * 60 * 24) : 0;
                const daysUntilReview = Math.max(0, Math.round(reviewInterval - daysSinceReview));
                
                return { 
                    status: 'mastered', 
                    label: 'Learned', 
                    class: 'mastery-mastered',
                    reviewInterval: reviewInterval,
                    daysUntilReview: daysUntilReview
                };
            } else if (stats.consecutiveCorrect === 0) {
                return { status: 'new', label: 'New', class: 'mastery-new' };
            } else {
                // Show progress toward mastery
                const remaining = LEARNING_THRESHOLD - stats.consecutiveCorrect;
                return { 
                    status: 'learning', 
                    label: `Learning (${stats.consecutiveCorrect}/${LEARNING_THRESHOLD})`, 
                    class: 'mastery-learning' 
                };
            }
        }
        
        function getRomanization(thaiText) {
            return romanization[thaiText] || '';
        }
        
        function getCardsForSmartReview(cardList) {
            if (!smartReviewMode) return cardList;
            
            // Helper to get stats for a card (from global stats)
            function getCardStatsFor(card) {
                const key = getCardKey(card);
                const globalStats = getCardStats();
                return globalStats[key] || { consecutiveCorrect: 0, incorrect: 0 };
            }
            
            // Sort cards: due cards first, then by difficulty
            return [...cardList].sort((a, b) => {
                const statsA = getCardStatsFor(a);
                const statsB = getCardStatsFor(b);
                
                const masteryA = getMasteryStatus(a);
                const masteryB = getMasteryStatus(b);
                
                // Priority: struggling > new > learning/review > mastered
                const priorityOrder = { 'struggling': 0, 'new': 1, 'learning': 2, 'mastered': 3 };
                const priorityDiff = priorityOrder[masteryA.status] - priorityOrder[masteryB.status];
                if (priorityDiff !== 0) return priorityDiff;
                
                // Within learning/review, prioritize more overdue cards
                if (masteryA.status === 'learning' && masteryA.daysSinceReview && masteryB.daysSinceReview) {
                    const overdueA = masteryA.daysSinceReview - (masteryA.reviewInterval || 7);
                    const overdueB = masteryB.daysSinceReview - (masteryB.reviewInterval || 7);
                    if (overdueA !== overdueB) return overdueB - overdueA; // More overdue first
                }
                
                // Within mastered, prioritize cards closer to needing review
                if (masteryA.status === 'mastered' && masteryA.daysUntilReview !== undefined && masteryB.daysUntilReview !== undefined) {
                    if (masteryA.daysUntilReview !== masteryB.daysUntilReview) {
                        return masteryA.daysUntilReview - masteryB.daysUntilReview; // Sooner review first
                    }
                }
                
                // Within same priority, sort by incorrect count (higher = harder = first)
                return (statsB.incorrect || 0) - (statsA.incorrect || 0);
            });
        }
        
        function updateMilestones(progress) {
            const milestones = document.querySelectorAll('.milestone');
            milestones.forEach(m => {
                const percent = parseInt(m.dataset.percent);
                if (progress >= percent) {
                    m.classList.add('reached');
                } else {
                    m.classList.remove('reached');
                }
            });
        }

        // Custom example sentences for words that don't fit templates well
        const customSentences = {
            // Particles and grammar words
            "": [{ thai: "", roman: "yak bpai dte mi mii wee-laa", english: "Want to go but don't have time" }],
            "": [{ thai: "", roman: "p le me", english: "Father and mother" }],
            "": [{ thai: "", roman: "gaa-fae r chaa", english: "Coffee or tea?" }],
            "": [{ thai: "", roman: "mi bpai pr wa fn dtk", english: "Not going because it's raining" }],
            "": [{ thai: "", roman: "ta wang g maa", english: "If you're free, come" }],
            "": [{ thai: "", roman: "dii g dii", english: "That's fine" }],
            "": [{ thai: "", roman: "bpai dai gan", english: "Go together" }],
            "": [{ thai: "", roman: "mi ru li", english: "Don't know at all" }],
            "": [{ thai: "", roman: "bpai n", english: "I'm going, okay?" }],
            "": [{ thai: "", roman: "kp-kun krp", english: "Thank you (male)" }],
            "": [{ thai: "", roman: "kp-kun k", english: "Thank you (female)" }],
            "": [{ thai: "", roman: "-rai k", english: "What? (female)" }],
            "": [{ thai: "", roman: "bpai mi", english: "Are you going?" }],
            "": [{ thai: "", roman: "bpai s", english: "Go on then!" }],
            "": [{ thai: "", roman: "jing r", english: "Really?" }],
            
            // Pronouns
            "": [{ thai: "...", roman: "chn ch...", english: "My name is..." }],
            "": [{ thai: "", roman: "pm bpen kon tai", english: "I am Thai (male)" }],
            "": [{ thai: "", roman: "kun ch -rai", english: "What's your name?" }],
            "": [{ thai: "", roman: "ko bpai lew", english: "He/she already left" }],
            "": [{ thai: "", roman: "rao bpai gan", english: "Let's go" }],
            "": [{ thai: "", roman: "man -ri", english: "It's delicious" }],
            "": [{ thai: "", roman: "ni -rai", english: "What's this?" }],
            "": [{ thai: "", roman: "nn -rai", english: "What's that?" }],
            "": [{ thai: "", roman: "non ngai", english: "Over there, see?" }],
            
            // Common phrases
            "": [{ thai: "", roman: "s-wt-dii krp", english: "Hello (male)" }],
            "": [{ thai: "", roman: "kp-kun mak", english: "Thank you very much" }],
            "": [{ thai: "", roman: "k-tot n", english: "Sorry about that" }],
            "": [{ thai: "", roman: "mi bpen rai krp", english: "No problem" }],
            "": [{ thai: "", roman: "mi ko-jai krp", english: "I don't understand" }],
            "": [{ thai: "", roman: "put cha cha ni", english: "Please speak slowly" }],
            "": [{ thai: "", roman: "dai li krp", english: "Sure, go ahead" }],
            "": [{ thai: "", roman: "mi ao krp", english: "No thanks" }],
            "": [{ thai: "", roman: "mi ru krp", english: "I don't know" }],
            "": [{ thai: "", roman: "mi mii krp", english: "Don't have any" }],
            "": [{ thai: "", roman: "st lew", english: "Done/finished" }],
            "": [{ thai: "", roman: "dao gn", english: "Wait a moment" }],
            "": [{ thai: "", roman: "dao gn n", english: "Hold on a sec" }],
            
            // Question words
            "": [{ thai: "", roman: "ni -rai", english: "What is this?" }],
            "": [{ thai: "", roman: "tam-mai mi bpai", english: "Why not go?" }],
            "": [{ thai: "", roman: "tam yang-rai", english: "How to do it?" }],
            "": [{ thai: "", roman: "tam yang-ngai", english: "How do you do it?" }],
            "": [{ thai: "", roman: "maa ma-ri", english: "When did you come?" }],
            "": [{ thai: "", roman: "gi bat", english: "How many baht?" }],
            "": [{ thai: "", roman: "krai maa", english: "Who came?" }],
            "": [{ thai: "", roman: "yu ti-ni", english: "Where is it?" }],
            "": [{ thai: "", roman: "chay dai mi krp", english: "Can you help me?" }],
            
            // Time/tense markers
            "": [{ thai: "", roman: "gin lew", english: "Already ate" }],
            "": [{ thai: "", roman: "yang mi st", english: "Not finished yet" }],
            "": [{ thai: "", roman: "gam-lang tam yu", english: "Currently doing it" }],
            "": [{ thai: "", roman: "j bpai prng-ni", english: "Will go tomorrow" }],
            "": [{ thai: "", roman: "ki bpai mi", english: "Have you ever been?" }],
            "": [{ thai: "", roman: "maa dtrong wee-laa", english: "Come on time" }],
            "": [{ thai: "", roman: "maa sai", english: "Come late" }],
            "": [{ thai: "", roman: "bpai bi mi", english: "Do you go often?" }],
            "": [{ thai: "", roman: "maa s-m", english: "Always come" }],
            "": [{ thai: "", roman: "mi ki bpai", english: "Never been" }],
            "": [{ thai: "", roman: "maa tan-tii", english: "Come immediately" }],
            "": [{ thai: "", roman: "ik krng", english: "One more time" }],
            
            // Quantifiers
            "": [{ thai: "", roman: "kng kun", english: "Yours" }],
            "": [{ thai: "", roman: "ti ni", english: "Here" }],
            "": [{ thai: "", roman: "mi ao", english: "Don't want" }],
            "": [{ thai: "", roman: "chi krp", english: "Yes, correct" }],
            "": [{ thai: "", roman: "mi chi krp", english: "No, not correct" }],
            "": [{ thai: "", roman: "p lew", english: "That's enough" }],
            "": [{ thai: "", roman: "kp-kun mak", english: "Thank you very much" }],
            "": [{ thai: "", roman: "ni bpai", english: "Too little" }],
            "": [{ thai: "", roman: "tk wan", english: "Every day" }],
            "": [{ thai: "", roman: "baang krng", english: "Sometimes" }],
            "": [{ thai: "", roman: "ke ni", english: "Just this" }],
            "": [{ thai: "", roman: "tam eeng", english: "Do it yourself" }],
            
            // Tricky verbs
            "": [{ thai: "", roman: "bpen -rai", english: "What's wrong?" }],
            "": [{ thai: "", roman: "mii -rai mi", english: "Anything else?" }],
            "": [{ thai: "", roman: "yu ni", english: "Where are you?" }],
            "": [{ thai: "", roman: "tam -rai", english: "What are you doing?" }],
            "": [{ thai: "", roman: "dai li", english: "Sure, go ahead" }],
            "": [{ thai: "", roman: "ao an ni", english: "I'll take this one" }],
            "": [{ thai: "", roman: "yak gin -rai", english: "What do you want to eat?" }],
            "": [{ thai: "", roman: "dtng bpai lew", english: "Have to go now" }],
            "": [{ thai: "", roman: "chay ni", english: "Help please" }],
            "": [{ thai: "", roman: "lng duu", english: "Try it/let's see" }],
            "": [{ thai: "", roman: "ru lew", english: "I know already" }],
            
            // Shopping/restaurant
            "": [{ thai: "", roman: "raa-kaa to-ri", english: "What's the price?" }],
            "": [{ thai: "", roman: "an ni to-ri", english: "How much is this?" }],
            "": [{ thai: "", roman: "paeng gn bpai krp", english: "Too expensive" }],
            "": [{ thai: "", roman: "lt ni dai mi", english: "Can you discount?" }],
            "": [{ thai: "", roman: "k mee-nuu ni", english: "Menu please" }],
            "": [{ thai: "", roman: "prm sng aa-han", english: "Ready to order" }],
            "": [{ thai: "", roman: "chk bin krp", english: "Check please" }],
            
            // Travel
            "": [{ thai: "", roman: "j bpai ni", english: "Where are you going?" }],
            "": [{ thai: "", roman: "lao sai dtrong ni", english: "Turn left here" }],
            "": [{ thai: "", roman: "lao kwa kang na", english: "Turn right ahead" }],
            "": [{ thai: "", roman: "dtrong bpai li", english: "Go straight" }],
            "": [{ thai: "", roman: "ti ni krp", english: "Here please" }],
            "": [{ thai: "", roman: "dtrong ti nn", english: "Right there" }],
            "": [{ thai: "", roman: "lng taang", english: "I'm lost" }],
            
            // Banking/money
            "": [{ thai: "", roman: "oon ngn hi", english: "Transfer money to" }],
            "": [{ thai: "", roman: "oon ngn dai mi", english: "Can you transfer?" }],
            "": [{ thai: "", roman: "maa fak ngn", english: "Come to deposit" }],
            "": [{ thai: "", roman: "tn ngn ni", english: "Withdraw money" }],
            "": [{ thai: "", roman: "lek ngn ti ni", english: "Where to exchange?" }],
            "": [{ thai: "", roman: "fak kng ni", english: "Leave this with you" }],
            
            // Work
            "": [{ thai: "", roman: "bpai tam-ngaan", english: "Go to work" }],
            "": [{ thai: "", roman: "ngaan yng", english: "Work is busy" }],
            "": [{ thai: "", roman: "mii bpr-chum", english: "Have a meeting" }],
            
            // Abstract
            "": [{ thai: "", roman: "chok dii n", english: "Good luck!" }],
            "": [{ thai: "", roman: "mii bpan-ha mi", english: "Any problems?" }],
            "": [{ thai: "", roman: "ru kam-dtp mi", english: "Know the answer?" }],
            "": [{ thai: "", roman: "mii kam-tam mi", english: "Any questions?" }],
            "": [{ thai: "", roman: "kwaam-kt dii", english: "Good idea" }],
            "": [{ thai: "", roman: "mii pen mi", english: "Have a plan?" }],
            
            // Tech
            "": [{ thai: "", roman: "dtng chat bet", english: "Need to charge" }],
            "": [{ thai: "", roman: "tai rup hi ni", english: "Take a photo please" }],
            "": [{ thai: "", roman: "kn-ha nai guu-gn", english: "Search on Google" }],
            
            // Misc
            "": [{ thai: "", roman: "kon ae-t", english: "Crowded with people" }],
            "": [{ thai: "", roman: "ym ni dai mi", english: "Can I borrow?" }],
            "": [{ thai: "", roman: "gp kng", english: "Put things away" }],
            "": [{ thai: "", roman: "tng k-y", english: "Throw away trash" }],
            "": [{ thai: "", roman: "ha -rai", english: "Looking for what?" }],
            "": [{ thai: "", roman: "j gan n", english: "See you" }],
            "": [{ thai: "", roman: "si -rai", english: "What color?" }],
            "": [{ thai: "", roman: "rt-chat dii", english: "Tastes good" }],
            
            // Common phrases - use them as examples of themselves
            "": [{ thai: "", roman: "kun s-baai dii mi", english: "How are you?" }],
            "": [{ thai: "", roman: "s-baai dii krp", english: "I'm fine (male)" }],
            "": [{ thai: "", roman: "wan-ni mi s-baai", english: "Not feeling well today" }],
            "": [{ thai: "", roman: "mi j gan naan li", english: "It's been so long!" }],
            "": [{ thai: "", roman: "yin-dii ti di ru-jk krp", english: "Nice to meet you" }],
            "": [{ thai: "", roman: "gin kao r yang krp", english: "Have you eaten yet?" }],
            "": [{ thai: "", roman: "gin lew krp", english: "I've already eaten" }],
            "": [{ thai: "", roman: "wa ngai krp", english: "What's up?" }],
            "": [{ thai: "", roman: "lew j gan n", english: "See you later" }],
            "": [{ thai: "", roman: "lew dte kun li", english: "It's up to you" }],
            "": [{ thai: "", roman: "chang man t krp", english: "Forget about it" }],
            "": [{ thai: "", roman: "jing r krp", english: "Really?" }],
            "": [{ thai: "", roman: "ne-nn krp", english: "Of course!" }],
            "": [{ thai: "", roman: "mi dtng hang krp", english: "Don't worry" }],
            "": [{ thai: "", roman: "r-wang day n", english: "Be careful" }],
        };
        
        // Generate example sentence - check custom first, then template
        async function generateExampleSentence() {
            try {
                if (cards.length === 0) return;
                
                const card = cards[currentIndex];
                const thaiWord = card.thai;
                const englishMeaning = card.english;
                
                sentenceExample.classList.add('show');
                
                let sentence;
                
                // Check for custom sentence first
                if (customSentences[thaiWord]) {
                    const customs = customSentences[thaiWord];
                    sentence = { ...customs[Math.floor(Math.random() * customs.length)] };
                } else {
                    sentence = generateFallbackSentence(thaiWord, englishMeaning);
                }
                
                // Store plain Thai for TTS
                currentSentenceThai = sentence.thai.replace(/<[^>]*>/g, '');
                
                // Highlight the word
                if (!sentence.thai.includes('sentence-word-highlight')) {
                    sentence.thai = sentence.thai.replace(
                        new RegExp(`(${thaiWord})`, 'g'), 
                        '<span class="sentence-word-highlight">$1</span>'
                    );
                }
                
                sentenceThai.innerHTML = sentence.thai;
                sentenceRoman.textContent = sentence.roman;
                sentenceEnglish.textContent = sentence.english;
                
                sentenceBtn.disabled = false;
                sentenceBtn.textContent = ' Example';
            } catch (err) {
                console.error('Error:', err);
                sentenceThai.innerHTML = 'Error: ' + err.message;
            }
        }
        
        // Generate a template-based sentence
        function generateFallbackSentence(thaiWord, englishMeaning) {
            const eng = englishMeaning.toLowerCase();
            const roman = romanization[thaiWord] || '';
            
            let templates = [];
            
            // === VERBS (start with "to ") ===
            if (eng.startsWith('to ')) {
                const verb = eng.replace('to ', '');
                
                // Financial/transaction verbs
                if (eng.match(/to (transfer|pay|deposit|withdraw|send|receive|borrow|lend|owe|spend|save|invest)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} ngn`, english: `${verb} money` },
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}red` },
                    ];
                }
                // Communication verbs
                else if (eng.match(/to (say|speak|talk|tell|ask|answer|call|read|write|listen|hear)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} paa-sa tai`, english: `${verb} Thai` },
                        { thai: `${thaiWord}`, roman: `${roman} dai mi`, english: `Can you ${verb}?` },
                        { thai: `${thaiWord}`, roman: `${roman} ik tii`, english: `${verb} again` },
                    ];
                }
                // Movement verbs
                else if (eng.match(/to (go|come|walk|run|drive|ride|fly|return|arrive|leave|enter|exit)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} ni`, english: `Where are you ${verb}ing?` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                        { thai: `${thaiWord}`, roman: `j ${roman}`, english: `Will ${verb}` },
                    ];
                }
                // Eating/drinking verbs
                else if (eng.match(/to (eat|drink|taste|cook|order|serve)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} -rai`, english: `What to ${verb}?` },
                        { thai: `${thaiWord}`, roman: `yak ${roman}`, english: `Want to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                    ];
                }
                // Looking/seeing verbs
                else if (eng.match(/to (see|look|watch|find|search|check)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} -rai`, english: `${verb} what?` },
                        { thai: `${thaiWord}`, roman: `lng ${roman}`, english: `Try to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} ni`, english: `${verb} please` },
                    ];
                }
                // Work/action verbs
                else if (eng.match(/to (work|do|make|use|open|close|start|stop|finish|try|help|wait|sit|stand|sleep|wake)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                        { thai: `${thaiWord}`, roman: `gam-lang ${roman}`, english: `${verb}ing now` },
                    ];
                }
                // Buying/selling verbs
                else if (eng.match(/to (buy|sell|rent|book|reserve|order)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `yak ${roman}`, english: `Want to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} ti ni`, english: `Where to ${verb}?` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                    ];
                }
                // Cleaning verbs
                else if (eng.match(/to (wash|clean|sweep|wipe|iron|sew|fold)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}ed` },
                        { thai: `${thaiWord}`, roman: `chay ${roman}`, english: `Help ${verb}` },
                    ];
                }
                // Default verb templates
                else {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} dai mi`, english: `Can you ${verb}?` },
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}ed` },
                        { thai: `${thaiWord}`, roman: `gam-lang ${roman}`, english: `${verb}ing now` },
                    ];
                }
            }
            // === TASTE/TEXTURE adjectives ===
            else if (eng.match(/^(spicy|sweet|sour|salty|bitter|bland|delicious|crispy|soft|hard|sticky|rotten|fresh|smelly|fragrant)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} mi`, english: `Is it ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} gn bpai`, english: `Too ${englishMeaning}` },
                ];
            }
            // === SIZE/PHYSICAL adjectives ===
            else if (eng.match(/^(big|small|tall|short|long|wide|thick|thin|heavy|light|fat|skinny)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} gn bpai`, english: `Too ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                ];
            }
            // === FEELING/STATE adjectives ===
            else if (eng.match(/^(happy|sad|tired|hungry|thirsty|sick|angry|afraid|busy|bored|excited|worried|sleepy|full|drunk)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} mi`, english: `Are you ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `ru-sk ${roman}`, english: `Feel ${englishMeaning}` },
                ];
            }
            // === QUALITY adjectives ===
            else if (eng.match(/^(good|bad|beautiful|ugly|clean|dirty|new|old|fast|slow|easy|difficult|expensive|cheap|hot|cold|safe|dangerous|quiet|loud|far|near|early|late|free|same|different|important|correct|wrong)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} mi`, english: `Is it ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                ];
            }
            // === FOOD items ===
            else if (eng.match(/(rice|egg|milk|bread|meat|pork|beef|shrimp|crab|fish|chicken|soup|noodle|curry|salad|fruit|vegetable|mango|banana|orange|apple|coconut|durian|watermelon|papaya|sugar|salt|pepper|sauce|oil)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `gin ${roman}`, english: `Eat ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} -ri`, english: `${englishMeaning} is delicious` },
                    { thai: `${thaiWord}`, roman: `k ${roman}`, english: `${englishMeaning} please` },
                ];
            }
            // === DRINKS ===
            else if (eng.match(/(water|tea|coffee|beer|wine|juice|milk|soda|ice)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `dm ${roman}`, english: `Drink ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `k ${roman}`, english: `${englishMeaning} please` },
                    { thai: `${thaiWord}`, roman: `ao ${roman}`, english: `I'll have ${englishMeaning}` },
                ];
            }
            // === ANIMALS ===
            else if (eng.match(/(dog|cat|bird|fish|elephant|monkey|snake|cow|pig|chicken|duck|horse|tiger|lion|bear|mouse|rat|frog|ant|mosquito|butterfly|spider|lizard)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `hn ${roman}`, english: `I see a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} na-rk`, english: `The ${englishMeaning} is cute` },
                    { thai: `${thaiWord}`, roman: `glua ${roman}`, english: `Afraid of ${englishMeaning}s` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}s` },
                ];
            }
            // === FAMILY ===
            else if (eng.match(/(father|mother|dad|mom|parent|brother|sister|son|daughter|child|baby|husband|wife|grandfather|grandmother|grandpa|grandma|uncle|aunt|cousin|nephew|niece|grandchild)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} yu ni`, english: `Where is ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `rk ${roman}`, english: `I love ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `kt-tng ${roman}`, english: `I miss ${englishMeaning}` },
                ];
            }
            // === PEOPLE/PROFESSIONS ===
            else if (eng.match(/(friend|teacher|student|doctor|nurse|police|driver|worker|boss|customer|tourist|monk|person|people|man|woman|boy|girl)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} maa lew`, english: `The ${englishMeaning} arrived` },
                    { thai: `${thaiWord}`, roman: `bpen ${roman}`, english: `I'm a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `ru-jk ${roman}`, english: `I know the ${englishMeaning}` },
                ];
            }
            // === BODY PARTS ===
            else if (eng.match(/(head|hair|face|eye|ear|nose|mouth|tooth|tongue|neck|shoulder|arm|hand|finger|leg|foot|knee|back|stomach|heart|skin|bone|blood)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} jp`, english: `My ${englishMeaning} hurts` },
                    { thai: `${thaiWord}`, roman: `lang ${roman}`, english: `Wash your ${englishMeaning}` },
                ];
            }
            // === PLACES/BUILDINGS ===
            else if (eng.match(/(house|home|room|hotel|restaurant|shop|store|market|hospital|school|bank|office|temple|airport|station|bathroom|kitchen|bedroom)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `bpai ${roman}`, english: `Go to the ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} yu ni`, english: `Where is the ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `yu ${roman}`, english: `At the ${englishMeaning}` },
                ];
            }
            // === NATURE/OUTDOORS ===
            else if (eng.match(/(tree|flower|grass|leaf|mountain|river|sea|ocean|beach|island|forest|jungle|rain|sun|moon|star|sky|cloud|wind|fire)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} say`, english: `The ${englishMeaning} is beautiful` },
                    { thai: `${thaiWord}`, roman: `hn ${roman}`, english: `I see the ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like the ${englishMeaning}` },
                ];
            }
            // === TRANSPORT ===
            else if (eng.match(/(car|bus|train|plane|boat|bicycle|motorcycle|taxi|truck)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `kp ${roman}`, english: `Drive a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `nng ${roman}`, english: `Take a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} maa lew`, english: `The ${englishMeaning} is here` },
                ];
            }
            // === CLOTHING ===
            else if (eng.match(/(shirt|pants|dress|skirt|shoes|hat|socks|jacket|coat|underwear|glasses|watch|bag|belt)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `si ${roman}`, english: `Wear ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `s ${roman}`, english: `Buy ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} say`, english: `Nice ${englishMeaning}` },
                ];
            }
            // === TIME WORDS ===
            else if (eng.match(/(today|tomorrow|yesterday|now|later|morning|afternoon|evening|night|day|week|month|year|hour|minute|time)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} bpai ni`, english: `Where are you going ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `j gan ${roman}`, english: `See you ${englishMeaning}` },
                ];
            }
            // === COLORS ===
            else if (eng.match(/(red|blue|green|yellow|white|black|pink|orange|purple|gray|brown)/) || thaiWord.startsWith('')) {
                templates = [
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `sa ${roman}`, english: `${englishMeaning} shirt` },
                    { thai: `${thaiWord}`, roman: `mii ${roman} mi`, english: `Do you have ${englishMeaning}?` },
                ];
            }
            // === NUMBERS ===
            else if (eng.match(/^(one|two|three|four|five|six|seven|eight|nine|ten|zero|hundred|thousand|million|first|second|third)$/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `k ${roman}`, english: `${englishMeaning} please` },
                    { thai: `${thaiWord}`, roman: `mii ${roman}`, english: `There are ${englishMeaning}` },
                ];
            }
            // === QUESTION WORDS ===
            else if (eng.match(/^(what|where|when|who|why|how|which)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} k`, english: `${englishMeaning}? (polite)` },
                ];
            }
            // === DEFAULT - generic useful patterns ===
            else {
                templates = [
                    { thai: `${thaiWord}`, roman: `mii ${roman} mi`, english: `Is there ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `dtng-gaan ${roman}`, english: `I need ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `ni k ${roman}`, english: `This is ${englishMeaning}` },
                ];
            }
            
            // Pick a random template
            const template = templates[Math.floor(Math.random() * templates.length)];
            
            // Highlight the target word
            template.thai = template.thai.replace(
                new RegExp(`(${thaiWord})`, 'g'), 
                '<span class="sentence-word-highlight">$1</span>'
            );
            
            return template;
        }
        
        // Hide sentence example when changing cards
        function hideSentenceExample() {
            sentenceExample.classList.remove('show');
        }

        function setupEventListeners() {
            // App mode toggle
            document.querySelectorAll('.app-mode-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    switchAppMode(this.getAttribute('data-appmode'));
                });
            });
            
            // Grammar navigation
            document.getElementById('grammarBackBtn').addEventListener('click', closeGrammarLesson);
            document.getElementById('lessonPrevBtn').addEventListener('click', prevLessonStep);
            document.getElementById('lessonNextBtn').addEventListener('click', nextLessonStep);
            
            // Practice navigation
            document.getElementById('practiceBackBtn').addEventListener('click', closePractice);
            document.getElementById('practiceNextBtn').addEventListener('click', nextPracticeQuestion);
            
            flashcard.addEventListener('click', () => { if (!isSwiping) flipCard(); });
            flashcard.addEventListener('touchstart', handleTouchStart, { passive: false });
            flashcard.addEventListener('touchmove', handleTouchMove, { passive: false });
            flashcard.addEventListener('touchend', handleTouchEnd);

            flipBtn.addEventListener('click', flipCard);
            prevBtn.addEventListener('click', prevCard);
            nextBtn.addEventListener('click', nextCard);
            sentenceBtn.addEventListener('click', generateExampleSentence);
            document.getElementById('sentenceSpeakBtn').addEventListener('click', speakSentence);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            document.getElementById('closeSettings').addEventListener('click', () => settingsModal.classList.remove('open'));
            document.getElementById('closeStats').addEventListener('click', () => statsModal.classList.remove('open'));

            document.getElementById('startFreshBtn').addEventListener('click', () => { resumeModal.classList.remove('open'); startFresh(); });
            document.getElementById('resumeSessionBtn').addEventListener('click', () => { resumeModal.classList.remove('open'); resumeSession(); });
            
            // Completion modal handlers
            document.getElementById('closeCompletion').addEventListener('click', () => document.getElementById('completionModal').classList.remove('open'));
            document.getElementById('restartListBtn').addEventListener('click', () => {
                document.getElementById('completionModal').classList.remove('open');
                startFresh();
            });
            document.getElementById('reviewHardestBtn').addEventListener('click', () => {
                document.getElementById('completionModal').classList.remove('open');
                sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                listSelector.value = HARDEST_LIST;
                switchList(HARDEST_LIST);
            });

            csvFileInput.addEventListener('change', handleFileUpload);
            listSelector.addEventListener('change', (e) => switchList(parseInt(e.target.value)));
            document.getElementById('exportBtn').addEventListener('click', exportProgress);
            document.getElementById('resetBtn').addEventListener('click', resetProgress);

            modeBtns.forEach(btn => btn.addEventListener('click', () => switchMode(btn.dataset.mode)));
            document.addEventListener('keydown', handleKeyboard);
            
            // Favorite button
            document.getElementById('favoriteBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite();
            });
            
            // Audio button
            document.getElementById('audioBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                speakThai();
            });

            document.addEventListener('touchend', (e) => {
                const now = Date.now();
                if (now - lastTouchEnd < 300) e.preventDefault();
                lastTouchEnd = now;
            }, false);

            window.addEventListener('click', (e) => {
                if (e.target === settingsModal) settingsModal.classList.remove('open');
                if (e.target === statsModal) statsModal.classList.remove('open');
                // Don't allow closing resume modal by clicking outside - user must choose
                if (e.target.id === 'completionModal') e.target.classList.remove('open');
            });
        }

        function handleTouchStart(e) {
            if (e.touches.length > 1) return;
            touchStartX = currentX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            isSwiping = false;
        }

        function handleTouchMove(e) {
            if (!touchStartX) return;
            currentX = e.touches[0].clientX;
            const diffX = currentX - touchStartX;
            const diffY = e.touches[0].clientY - touchStartY;

            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 10) {
                e.preventDefault();
                isSwiping = true;
                flashcard.classList.add('swiping');
                flashcard.style.transform = "translateX(" + diffX + "px) rotateY(" + (isFlipped ? 180 : 0) + "deg)";

                const intensity = Math.min(Math.abs(diffX) / 100, 1);

                if (diffX > 30) {
                    swipeRight.classList.add('visible');
                    swipeBarRight.classList.add('visible');
                    swipeBarRight.style.opacity = intensity;
                    swipeLeft.classList.remove('visible');
                    swipeBarLeft.classList.remove('visible');
                } else if (diffX < -30) {
                    swipeLeft.classList.add('visible');
                    swipeBarLeft.classList.add('visible');
                    swipeBarLeft.style.opacity = intensity;
                    swipeRight.classList.remove('visible');
                    swipeBarRight.classList.remove('visible');
                } else {
                    swipeLeft.classList.remove('visible');
                    swipeRight.classList.remove('visible');
                    swipeBarLeft.classList.remove('visible');
                    swipeBarRight.classList.remove('visible');
                }
            }
        }

        function handleTouchEnd() {
            if (!touchStartX) return;
            const diffX = currentX - touchStartX;

            swipeLeft.classList.remove('visible');
            swipeRight.classList.remove('visible');
            swipeBarLeft.classList.remove('visible');
            swipeBarRight.classList.remove('visible');
            swipeBarLeft.style.opacity = '';
            swipeBarRight.style.opacity = '';
            flashcard.classList.remove('swiping');
            
            // Clear inline transform style - let CSS class handle the flip state
            flashcard.style.transform = '';

            if (Math.abs(diffX) > 100) {
                // If card is flipped, first unflip it instantly before moving to next
                if (isFlipped) {
                    flashcard.style.transition = 'none';
                    flashcard.classList.remove('flipped');
                    isFlipped = false;
                    // Force reflow
                    flashcard.offsetHeight;
                    flashcard.style.transition = '';
                }
                diffX > 0 ? markCorrect() : markIncorrect();
            }

            touchStartX = currentX = 0;
            setTimeout(() => { isSwiping = false; }, 100);
        }

        function handleKeyboard(e) {
            if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); flipCard(); }
            else if (e.key === 'ArrowRight') { e.preventDefault(); markCorrect(); }
            else if (e.key === 'ArrowLeft') { e.preventDefault(); markIncorrect(); }
        }

        function initializeCards() {
            if (currentMode === 'review') {
                // Filter to cards that are NOT yet learned
                cards = vocabulary.filter(c => {
                    const key = getCardKey(c);
                    const globalStats = getCardStats();
                    const stat = globalStats[key];
                    return !stat || !stat.consecutiveCorrect || stat.consecutiveCorrect < LEARNING_THRESHOLD;
                });
                if (cards.length === 0) {
                    showToast('All cards in this list are learned!');
                    currentMode = 'all';
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
                    cards = [...vocabulary];
                }
                // Shuffle unlearned cards
                cards.sort(() => Math.random() - 0.5);
            } else {
                // Apply smart review sorting if enabled, then shuffle within priority groups
                let cardList = [...vocabulary];
                if (smartReviewMode) {
                    cardList = getCardsForSmartReview(cardList);
                } else {
                    cardList.sort(() => Math.random() - 0.5);
                }
                cards = cardList;
            }
            currentIndex = 0;
            // Sync modeState
            modeState[currentMode].cards = [...cards];
            modeState[currentMode].currentIndex = currentIndex;
            saveSessionState();
        }
        
        function initializeCardsPreservePosition(oldCard) {
            // Save current state before switching
            const oldMode = currentMode === 'review' ? 'all' : 'review'; // The mode we're coming FROM
            
            if (currentMode === 'review') {
                // Filter to cards that are NOT yet learned (consecutiveCorrect < LEARNING_THRESHOLD)
                const unlearnedCards = vocabulary.filter(c => {
                    const key = getCardKey(c);
                    const globalStats = getCardStats();
                    const stat = globalStats[key];
                    return !stat || !stat.consecutiveCorrect || stat.consecutiveCorrect < LEARNING_THRESHOLD;
                });
                
                if (unlearnedCards.length === 0) {
                    showToast('All cards in this list are learned!');
                    currentMode = 'all';
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
                    return;
                }
                
                // Save "all" mode state before switching
                modeState.all.cards = [...cards];
                modeState.all.currentIndex = currentIndex;
                
                // Always shuffle unlearned cards fresh when entering review mode
                cards = unlearnedCards.sort(() => Math.random() - 0.5);
                currentIndex = 0;
                
                modeState.review.cards = [...cards];
                modeState.review.currentIndex = currentIndex;
            } else {
                // Switching to "All Cards"
                // Save review mode state before switching
                modeState.review.cards = [...cards];
                modeState.review.currentIndex = currentIndex;
                
                // Restore "all" mode state if we have it
                if (modeState.all.cards.length > 0) {
                    cards = modeState.all.cards;
                    currentIndex = modeState.all.currentIndex;
                } else {
                    // First time or need to initialize
                    let cardList = [...vocabulary];
                    if (smartReviewMode) {
                        cardList = getCardsForSmartReview(cardList);
                    } else {
                        cardList.sort(() => Math.random() - 0.5);
                    }
                    cards = cardList;
                    currentIndex = 0;
                }
                modeState.all.cards = [...cards];
                modeState.all.currentIndex = currentIndex;
            }
            
            saveSessionState();
        }

        function getListProgress(idx) {
            const list = vocabularyLists[idx];
            let learned = 0, reviewed = 0, totalCorrect = 0, totalIncorrect = 0;
            const globalStats = getCardStats();
            list.words.forEach(c => {
                const key = getCardKey(c);
                const s = globalStats[key];
                if (s) {
                    reviewed++;
                    totalCorrect += s.correct || 0;
                    totalIncorrect += s.incorrect || 0;
                    if (s.consecutiveCorrect >= LEARNING_THRESHOLD) learned++;
                }
            });
            return { total: list.words.length, learned, reviewed, learnedPercent: Math.round((learned / list.words.length) * 100), totalCorrect, totalIncorrect };
        }

        function updateCard() {
            if (!cards.length) { 
                // Show friendly empty state based on current list/mode
                let icon, title, text;
                
                if (currentListIndex === FAVORITES_LIST) {
                    icon = '';
                    title = 'No Favorites Yet';
                    text = 'Tap the  on any card to add it to your favorites.';
                } else if (currentListIndex === HARDEST_LIST) {
                    icon = '';
                    title = 'No Hard Cards';
                    text = "You haven't gotten any cards wrong yet. Keep practicing!";
                } else if (currentMode === 'review') {
                    icon = '';
                    title = 'Nothing to Review';
                    text = "You haven't marked any cards as incorrect. Great job!";
                } else {
                    icon = '';
                    title = 'No Cards';
                    text = 'This list is empty.';
                }
                
                frontText.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-state-icon">' + icon + '</div>' +
                    '<div class="empty-state-title">' + title + '</div>' +
                    '<div class="empty-state-text">' + text + '</div>' +
                '</div>';
                backText.innerHTML = frontText.innerHTML;
                frontRomanization.textContent = '';
                backRomanization.textContent = '';
                masteryIndicator.style.display = 'none';
                
                cardCounter.textContent = 'Card 0 of 0';
                progressPercent.textContent = '0%';
                progressFill.style.width = '0%';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                
                return; 
            }
            const card = cards[currentIndex];
            frontText.textContent = showThaiFront ? card.thai : card.english;
            backText.textContent = showThaiFront ? card.english : card.thai;
            applyFontSize(frontText);
            applyFontSize(backText);
            
            // Update romanization
            const thaiRoman = getRomanization(card.thai);
            if (showRomanization && thaiRoman) {
                frontRomanization.textContent = showThaiFront ? thaiRoman : '';
                backRomanization.textContent = showThaiFront ? '' : thaiRoman;
                frontRomanization.style.display = showThaiFront ? 'block' : 'none';
                backRomanization.style.display = showThaiFront ? 'none' : 'block';
            } else {
                frontRomanization.style.display = 'none';
                backRomanization.style.display = 'none';
            }
            
            // Update mastery indicator
            const mastery = getMasteryStatus(card);
            masteryIndicator.textContent = mastery.label;
            masteryIndicator.className = 'mastery-indicator ' + mastery.class;
            masteryIndicator.style.display = 'block';

            const progress = ((currentIndex + 1) / cards.length) * 100;
            cardCounter.textContent = "Card " + (currentIndex + 1) + " of " + cards.length;
            progressPercent.textContent = Math.round(progress) + "%";
            progressFill.style.width = progress + "%";
            updateMilestones(progress);
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === cards.length - 1;
            
            // Update favorite button
            const isFav = favorites.has(getCardKey(card));
            const favBtn = document.getElementById('favoriteBtn');
            favBtn.textContent = isFav ? '' : '';
            favBtn.classList.toggle('active', isFav);
            
            updateScoreDisplay();
            
            // Auto-play audio if enabled and showing Thai first
            // Only auto-play if this was a deliberate card change (not initial load or mode switch)
            if (autoPlayAudio && showThaiFront && cards.length > 0 && window.shouldAutoPlay) {
                window.shouldAutoPlay = false; // Reset flag
                const textToSpeak = card.thai;
                // Cancel any pending speech first
                if (pendingSpeechTimeout) {
                    clearTimeout(pendingSpeechTimeout);
                }
                pendingSpeechTimeout = setTimeout(() => {
                    pendingSpeechTimeout = null;
                    speakThai(textToSpeak);
                }, 400);
            }
        }

        function applyFontSize(el) {
            const len = el.textContent.length;
            el.className = 'card-text' + (len > 40 ? ' xtiny' : len > 25 ? ' tiny' : len > 18 ? ' small' : len > 10 ? ' medium' : '');
        }

        function flipCard() { isFlipped = !isFlipped; flashcard.classList.toggle('flipped'); }
        
        function nextCard() { 
            if (currentIndex < cards.length - 1) { 
                // First flip back if needed (without animation)
                if (isFlipped) { 
                    flashcard.style.transition = 'none';
                    flashcard.classList.remove('flipped'); 
                    isFlipped = false;
                    // Force reflow then restore transition
                    flashcard.offsetHeight;
                    flashcard.style.transition = '';
                } 
                currentIndex++; 
                // Sync modeState
                modeState[currentMode].currentIndex = currentIndex;
                hideSentenceExample();
                window.shouldAutoPlay = true; // Enable auto-play for this card change
                updateCard(); 
                saveSessionState(); 
            } 
        }
        
        function prevCard() { 
            if (currentIndex > 0) { 
                if (isFlipped) { 
                    flashcard.style.transition = 'none';
                    flashcard.classList.remove('flipped'); 
                    isFlipped = false;
                    flashcard.offsetHeight;
                    flashcard.style.transition = '';
                } 
                currentIndex--; 
                // Sync modeState
                modeState[currentMode].currentIndex = currentIndex;
                hideSentenceExample();
                window.shouldAutoPlay = true; // Enable auto-play for this card change
                updateCard(); 
                saveSessionState(); 
            } 
        }
        function shuffleCards() { 
            sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
            hideSentenceExample();
            initializeCards(); 
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; } 
            updateCard(); 
            showToast('Cards shuffled!'); 
        }
        function toggleLanguage() { 
            showThaiFront = !showThaiFront; 
            localStorage.setItem('thaiFlashcardsThaiFront', showThaiFront);
            // Sync options panel buttons
            document.querySelectorAll('.option-toggle-btn[data-direction]').forEach(btn => {
                btn.classList.toggle('active', 
                    (btn.dataset.direction === 'thai' && showThaiFront) ||
                    (btn.dataset.direction === 'english' && !showThaiFront)
                );
            });
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; } 
            updateCard(); 
            saveProgress(); 
        }
        
        function toggleFavorite() {
            if (!cards.length) return;
            const card = cards[currentIndex];
            const key = getCardKey(card);
            
            if (favorites.has(key)) {
                favorites.delete(key);
                showToast('Removed from favorites');
            } else {
                favorites.add(key);
                showToast('Added to favorites ');
            }
            
            updateCard();
            updateListSelector();
            saveProgress();
        }
        
        // Track pending speech timeout
        let pendingSpeechTimeout = null;
        let thaiVoice = null;
        
        // Pre-load Thai voice
        function loadThaiVoice() {
            const voices = speechSynthesis.getVoices();
            thaiVoice = voices.find(v => v.lang === 'th-TH') || 
                        voices.find(v => v.lang.startsWith('th'));
        }
        
        // Load voices when available
        if ('speechSynthesis' in window) {
            loadThaiVoice();
            speechSynthesis.onvoiceschanged = loadThaiVoice;
        }
        
        function speakThai(textToSpeak) {
            // Get text immediately if not provided
            const thaiText = textToSpeak || (cards.length > 0 ? cards[currentIndex].thai : null);
            if (!thaiText) return;
            
            if (!('speechSynthesis' in window)) return;
            
            // Cancel any pending speech timeout
            if (pendingSpeechTimeout) {
                clearTimeout(pendingSpeechTimeout);
                pendingSpeechTimeout = null;
            }
            
            // Cancel ongoing speech
            speechSynthesis.cancel();
            
            // Try to reload voice if not found
            if (!thaiVoice) {
                loadThaiVoice();
            }
            
            // Don't play if no Thai voice - would sound wrong
            if (!thaiVoice) {
                showToast('Thai voice not available');
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(thaiText);
            utterance.lang = 'th-TH';
            utterance.rate = 0.8;
            utterance.voice = thaiVoice;
            
            const audioBtn = document.getElementById('audioBtn');
            
            utterance.onstart = () => {
                if (audioBtn) audioBtn.classList.add('speaking');
            };
            
            utterance.onend = () => {
                if (audioBtn) audioBtn.classList.remove('speaking');
            };
            
            utterance.onerror = () => {
                if (audioBtn) audioBtn.classList.remove('speaking');
            };
            
            speechSynthesis.speak(utterance);
        }
        
        // Store current sentence Thai text for speaking
        let currentSentenceThai = '';
        
        function speakSentence() {
            if (!currentSentenceThai) return;
            
            if (!('speechSynthesis' in window)) return;
            
            speechSynthesis.cancel();
            
            // Try to reload voice if not found
            if (!thaiVoice) {
                loadThaiVoice();
            }
            
            // Don't play if no Thai voice
            if (!thaiVoice) {
                showToast('Thai voice not available');
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(currentSentenceThai);
            utterance.lang = 'th-TH';
            utterance.rate = 0.75;
            utterance.voice = thaiVoice;
            
            const speakBtn = document.getElementById('sentenceSpeakBtn');
            
            utterance.onstart = () => {
                if (speakBtn) speakBtn.textContent = '';
            };
            
            utterance.onend = () => {
                if (speakBtn) speakBtn.textContent = '';
            };
            
            utterance.onerror = () => {
                if (speakBtn) speakBtn.textContent = '';
            };
            
            speechSynthesis.speak(utterance);
        }

        // Sound effects using Web Audio API
        let audioContext = null;
        
        function playTone(frequency, duration, type = 'sine', volume = 0.1) {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // Resume AudioContext if suspended (browser autoplay policy)
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                // Soft attack and longer, gentler release
                const now = audioContext.currentTime;
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(volume, now + 0.02); // Quick fade in
                gainNode.gain.setValueAtTime(volume, now + duration * 0.3); // Hold
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration); // Gentle fade out
                
                oscillator.start(now);
                oscillator.stop(now + duration);
            } catch (e) {
                // Audio not supported, silently fail
            }
        }
        
        function playCorrectSound() {
            playTone(523, 0.25, 'sine', 0.06); // C5 - longer, softer
            setTimeout(() => playTone(659, 0.3, 'sine', 0.06), 80); // E5 - longer fade
        }
        
        function playIncorrectSound() {
            playTone(180, 0.35, 'sine', 0.12); // Lower tone, louder for mobile
        }
        
        function markCorrect() {
            if (!cards.length) return;
            const card = cards[currentIndex];
            const key = getCardKey(card);
            
            // Flash animation and sound
            flashcard.classList.add('success-flash');
            setTimeout(() => flashcard.classList.remove('success-flash'), 400);
            playCorrectSound();
            
            // Find which list this card belongs to and update stats there
            const originalListIdx = findCardOriginalList(card);
            const stats = getListStats(originalListIdx);
            
            if (!stats[key]) stats[key] = { correct: 0, incorrect: 0, consecutiveCorrect: 0, lastReviewed: null };
            stats[key].correct++;
            stats[key].consecutiveCorrect++;
            stats[key].lastReviewed = new Date().toISOString();
            sessionStats.correct++;
            
            // If card just became learned and we're in review mode, remove it from deck
            if (stats[key].consecutiveCorrect === LEARNING_THRESHOLD) {
                showToast(' Word learned!', 'success');
                if (currentMode === 'review') {
                    // Remove this card from the review deck
                    cards.splice(currentIndex, 1);
                    // Adjust index if we removed the last card
                    if (currentIndex >= cards.length && cards.length > 0) {
                        currentIndex = cards.length - 1;
                    }
                    if (cards.length === 0) {
                        showToast(' All cards learned!', 'success');
                        showCompletionModal();
                        return;
                    }
                    updateCard();
                    updateScoreDisplay();
                    saveProgress();
                    return;
                }
            }
            
            updateScoreDisplay();
            saveProgress();
            
            if (currentIndex < cards.length - 1) {
                nextCard();
            } else {
                showCompletionModal();
            }
        }

        function markIncorrect() {
            if (!cards.length) return;
            const card = cards[currentIndex];
            const key = getCardKey(card);
            
            // Flash animation and sound
            flashcard.classList.add('error-flash');
            setTimeout(() => flashcard.classList.remove('error-flash'), 400);
            playIncorrectSound();
            
            // Find which list this card belongs to and update stats there
            const originalListIdx = findCardOriginalList(card);
            const stats = getListStats(originalListIdx);
            
            if (!stats[key]) stats[key] = { correct: 0, incorrect: 0, consecutiveCorrect: 0, lastReviewed: null };
            stats[key].incorrect++;
            stats[key].consecutiveCorrect = 0;
            stats[key].lastReviewed = new Date().toISOString();
            sessionStats.incorrect++;
            updateScoreDisplay();
            saveProgress();
            
            if (currentIndex < cards.length - 1) {
                nextCard();
            } else {
                showCompletionModal();
            }
        }
        
        function findCardOriginalList(card) {
            const key = getCardKey(card);
            // Always search themedLists (the canonical source) for card stats
            for (let i = 0; i < themedLists.length; i++) {
                if (themedLists[i].words.some(c => getCardKey(c) === key)) {
                    return i;
                }
            }
            return 0; // Default to first list if not found
        }
        
        function showCompletionModal() {
            sessionState.inProgress = false;
            saveSessionState();
            
            const total = sessionStats.correct + sessionStats.incorrect;
            const accuracy = total > 0 ? Math.round((sessionStats.correct / total) * 100) : 0;
            
            document.getElementById('completionTotal').textContent = total;
            document.getElementById('completionCorrect').textContent = sessionStats.correct;
            document.getElementById('completionIncorrect').textContent = sessionStats.incorrect;
            document.getElementById('completionAccuracy').textContent = accuracy + "%";
            
            document.getElementById('completionModal').classList.add('open');
        }

        function updateScoreDisplay() {
            // Show session stats (not all-time stats)
            correctScore.textContent = sessionStats.correct;
            incorrectScore.textContent = sessionStats.incorrect;
            
            // Update list progress display
            if (currentListIndex >= 0) {
                const p = getListProgress(currentListIndex);
                listProgressDisplay.textContent = p.learned + " of " + p.total + " learned (" + p.learnedPercent + "%)";
            } else if (currentListIndex === FAVORITES_LIST) {
                listProgressDisplay.textContent = favorites.size + " favorites";
            } else if (currentListIndex === HARDEST_LIST) {
                listProgressDisplay.textContent = cards.length + " hardest cards";
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === mode));
            // Don't reset position - keep current index if possible
            const oldIndex = currentIndex;
            const oldCard = cards[currentIndex];
            initializeCardsPreservePosition(oldCard);
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
            updateCard();
            saveProgress();
        }

        function switchList(idx) {
            const oldCard = cards.length > 0 ? cards[currentIndex] : null;
            currentListIndex = idx;
            
            // Reset session stats for new list
            sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
            correctScore.textContent = '0';
            incorrectScore.textContent = '0';
            
            // Reset mode-specific state when switching lists
            modeState = {
                all: { cards: [], currentIndex: 0 },
                review: { cards: [], currentIndex: 0 }
            };
            
            // Reset to "All Cards" mode
            currentMode = 'all';
            modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
            
            if (idx === FAVORITES_LIST) {
                vocabulary = getFavoriteCards();
                if (vocabulary.length === 0) {
                    // Don't redirect, just show empty state
                    cards = [];
                    currentIndex = 0;
                    if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                    updateCard();
                    saveProgress();
                    return;
                }
            } else if (idx === HARDEST_LIST) {
                const hardest = getHardestCards();
                vocabulary = hardest.map(h => h.card);
                if (vocabulary.length === 0) {
                    // Don't redirect, just show empty state
                    cards = [];
                    currentIndex = 0;
                    if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                    updateCard();
                    saveProgress();
                    return;
                }
            } else if (idx === ALL_CARDS_LIST) {
                // Combine all words from all themed lists
                vocabulary = themedLists.reduce((all, list) => all.concat(list.words), []);
            } else {
                vocabulary = vocabularyLists[idx].words;
            }
            
            // Initialize fresh for new list
            initializeCards();
            modeState.all.cards = [...cards];
            modeState.all.currentIndex = currentIndex;
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
            updateCard();
            saveProgress();
        }

        function updateListSelector() {
            listSelector.innerHTML = '';
            
            // Add Favorites option
            const favOption = document.createElement('option');
            favOption.value = FAVORITES_LIST;
            favOption.textContent = " Favorites (" + favorites.size + " words)";
            listSelector.appendChild(favOption);
            
            // Add Hardest Cards option
            const hardOption = document.createElement('option');
            hardOption.value = HARDEST_LIST;
            const hardestCount = getHardestCards().length;
            hardOption.textContent = " Hardest Cards (" + hardestCount + " words)";
            listSelector.appendChild(hardOption);
            
            // Add All Cards option
            const allOption = document.createElement('option');
            allOption.value = ALL_CARDS_LIST;
            const totalWords = themedLists.reduce((sum, list) => sum + list.words.length, 0);
            allOption.textContent = " All Cards (" + totalWords + " words)";
            listSelector.appendChild(allOption);
            
            // Add separator
            const separator = document.createElement('option');
            separator.disabled = true;
            separator.textContent = '';
            listSelector.appendChild(separator);
            
            // Add vocabulary lists
            vocabularyLists.forEach((l, i) => {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = l.name + " (" + l.words.length + " words)";
                listSelector.appendChild(option);
            });
            
            listSelector.value = currentListIndex;
        }
        
        function getHardestCards() {
            // Get all cards with incorrect counts from global stats
            const allCardsWithStats = [];
            const globalStats = getCardStats();
            const seenKeys = new Set();
            
            themedLists.forEach((list, listIdx) => {
                list.words.forEach(card => {
                    const key = getCardKey(card);
                    if (seenKeys.has(key)) return; // Avoid duplicates
                    seenKeys.add(key);
                    
                    const stats = globalStats[key];
                    if (stats && stats.incorrect > 0) {
                        allCardsWithStats.push({
                            card,
                            incorrect: stats.incorrect,
                            listIdx
                        });
                    }
                });
            });
            
            // Sort by incorrect count (highest first) and take top 30
            allCardsWithStats.sort((a, b) => b.incorrect - a.incorrect);
            return allCardsWithStats.slice(0, 30);
        }
        
        function getFavoriteCards() {
            const favCards = [];
            vocabularyLists.forEach(list => {
                list.words.forEach(card => {
                    if (favorites.has(getCardKey(card))) {
                        favCards.push(card);
                    }
                });
            });
            return favCards;
        }

        function saveSessionState() {
            sessionState = { cardOrder: cards.map(getCardKey), currentIndex, listIndex: currentListIndex, mode: currentMode, inProgress: currentIndex < cards.length - 1 && cards.length > 0 };
            localStorage.setItem('thaiFlashcardsSession', JSON.stringify(sessionState));
        }

        function showResumeModal() {
            document.getElementById('resumeListName').textContent = vocabularyLists[sessionState.listIndex]?.name || 'Unknown';
            document.getElementById('resumeProgress').textContent = "Card " + (sessionState.currentIndex + 1) + " of " + sessionState.cardOrder.length;
            document.getElementById('resumeCorrect').textContent = sessionStats.correct;
            document.getElementById('resumeIncorrect').textContent = sessionStats.incorrect;
            resumeModal.classList.add('open');
        }

        function startFresh() {
            try {
                // Refresh vocabularyLists in case view mode changed
                vocabularyLists = getActiveVocabularyLists();
                sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                initializeCards();
                if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                updateCard();
                updateSessionScoreDisplay();
                showToast('Started fresh session!');
            } catch (err) {
                console.error('Start fresh error:', err);
            }
        }
        
        function updateSessionScoreDisplay() {
            correctScore.textContent = sessionStats.correct;
            incorrectScore.textContent = sessionStats.incorrect;
        }

        function resumeSession() {
            try {
                // Refresh vocabularyLists in case view mode changed
                vocabularyLists = getActiveVocabularyLists();
                
                if (sessionState.cardOrder && sessionState.cardOrder.length > 0) {
                    // Validate list index
                    if (sessionState.listIndex >= 0 && sessionState.listIndex < vocabularyLists.length) {
                        currentListIndex = sessionState.listIndex;
                    } else {
                        currentListIndex = 0;
                    }
                    
                    vocabulary = vocabularyLists[currentListIndex].words;
                    listSelector.value = currentListIndex;
                    currentMode = sessionState.mode || 'all';
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === currentMode));
                    const map = new Map(vocabulary.map(c => [getCardKey(c), c]));
                    cards = sessionState.cardOrder.map(k => map.get(k)).filter(Boolean);
                    
                    if (cards.length === 0) {
                        startFresh();
                        return;
                    }
                    
                    currentIndex = Math.min(sessionState.currentIndex || 0, cards.length - 1);
                    if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                    updateCard();
                    showToast('Session resumed!');
                } else {
                    startFresh();
                }
            } catch (err) {
                console.error('Resume error:', err);
                startFresh();
            }
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const lines = ev.target.result.split('\n').filter(l => l.trim());
                const newCards = [];
                for (let i = 1; i < lines.length; i++) {
                    const m = lines[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
                    if (m?.length >= 2) {
                        const thai = m[0].replace(/^"|"$/g, '').trim();
                        const english = m[1].replace(/^"|"$/g, '').trim();
                        if (thai && english) newCards.push({ thai, english });
                    }
                }
                if (!newCards.length) { showToast('No valid cards found'); return; }
                const existing = new Set(vocabulary.map(c => c.thai.toLowerCase() + '|' + c.english.toLowerCase()));
                const unique = newCards.filter(c => !existing.has(c.thai.toLowerCase() + '|' + c.english.toLowerCase()));
                if (!unique.length) { showToast('All cards are duplicates'); csvFileInput.value = ''; return; }
                vocabulary.push(...unique);
                initializeCards();
                updateCard();
                saveProgress();
                showToast("Imported " + unique.length + " new cards!");
                csvFileInput.value = '';
            };
            reader.readAsText(file);
        }

        function updateStatsModal() {
            document.getElementById('sessionCorrect').textContent = sessionStats.correct;
            document.getElementById('sessionIncorrect').textContent = sessionStats.incorrect;
            var cp = getListProgress(currentListIndex);
            document.getElementById('currentListStats').innerHTML = 
                '<div class="list-stat-item">' +
                    '<div class="list-stat-header"><span class="list-stat-name">' + vocabularyLists[currentListIndex].name + '</span><span class="list-stat-percent">' + cp.learnedPercent + '%</span></div>' +
                    '<div class="list-stat-bar"><div class="list-stat-bar-fill" style="width:' + cp.learnedPercent + '%"></div></div>' +
                    '<div class="list-stat-details">' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + cp.learned + '/' + cp.total + '</span><span>Learned</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + cp.reviewed + '</span><span>Reviewed</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value score-correct">' + cp.totalCorrect + '</span><span>Correct</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value score-incorrect">' + cp.totalIncorrect + '</span><span>Wrong</span></div>' +
                    '</div>' +
                '</div>';
            document.getElementById('allListsStats').innerHTML = vocabularyLists.map(function(l, i) {
                var p = getListProgress(i);
                return '<div class="list-stat-item">' +
                    '<div class="list-stat-header"><span class="list-stat-name">' + l.name + '</span><span class="list-stat-percent">' + p.learnedPercent + '%</span></div>' +
                    '<div class="list-stat-bar"><div class="list-stat-bar-fill" style="width:' + p.learnedPercent + '%"></div></div>' +
                    '<div class="list-stat-details">' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + p.learned + '/' + p.total + '</span><span>Learned</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + p.reviewed + '</span><span>Reviewed</span></div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }
        
        function showVocabList() {
            var vocabListModal = document.getElementById('vocabListModal');
            var container = document.getElementById('vocabListContainer');
            var filter = document.getElementById('vocabListFilter').value;
            
            // Get words to display
            var words = [];
            if (filter === 'current') {
                words = vocabulary.map(function(w) { return w; });
            } else {
                // All words from all themed lists
                themedLists.forEach(function(list) {
                    list.words.forEach(function(w) {
                        words.push(w);
                    });
                });
            }
            
            // Sort alphabetically by Thai
            words.sort(function(a, b) {
                return a.thai.localeCompare(b.thai, 'th');
            });
            
            // Build HTML
            var html = '';
            words.forEach(function(word) {
                var mastery = getMasteryStatus(word);
                var statusClass = mastery.status;
                var roman = getRomanization(word.thai) || '';
                
                html += '<div class="vocab-list-item">' +
                    '<div class="vocab-status ' + statusClass + '"></div>' +
                    '<div class="vocab-thai">' + word.thai + '</div>' +
                    '<div class="vocab-english">' + word.english + '</div>' +
                    (roman ? '<div class="vocab-roman">' + roman + '</div>' : '') +
                '</div>';
            });
            
            container.innerHTML = html;
            vocabListModal.classList.add('open');
        }

        function exportProgress() {
            try {
                var data = { 
                    version: 1, 
                    exportDate: new Date().toISOString(), 
                    cardStats: cardStats, 
                    sessionStats: sessionStats, 
                    currentListIndex: currentListIndex, 
                    showThaiFront: showThaiFront, 
                    currentMode: currentMode, 
                    favorites: Array.from(favorites) 
                };
                var blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'thai-flashcards-progress-' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast('Progress exported!');
            } catch (e) {
                console.error('Export failed:', e);
                showToast('Export failed: ' + e.message);
            }
        }

        function resetProgress() {
            // Show custom confirmation by changing button temporarily
            var resetBtn = document.getElementById('resetBtn');
            if (resetBtn.dataset.confirming === 'true') {
                // Second click - do the reset
                resetBtn.dataset.confirming = 'false';
                resetBtn.textContent = ' Reset All Progress';
                
                try {
                    // Clear all app localStorage keys
                    localStorage.removeItem('thaiFlashcardsProgress');
                    localStorage.removeItem('thaiFlashcardsSession');
                    localStorage.removeItem('thaiFlashcardsRomanization');
                    localStorage.removeItem('thaiFlashcardsSmartReview');
                    localStorage.removeItem('thaiFlashcardsThaiFront');
                    localStorage.removeItem('thaiFlashcardsViewMode');
                    localStorage.removeItem('thaiGrammarProgress');
                    
                    // Reset all in-memory state
                    cardStats = {};
                    sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                    sessionState = { cardOrder: [], currentIndex: 0, listIndex: 0, mode: 'all', inProgress: false };
                    favorites = new Set();
                    currentMode = 'all';
                    showRomanization = false;
                    smartReviewMode = false;
                    showThaiFront = true;
                    lessonProgress = {};
                    
                    // Reset UI
                    currentListIndex = 0;
                    vocabulary = vocabularyLists[0].words;
                    listSelector.value = 0;
                    updateListSelector();
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
                    
                    // Reinitialize
                    initializeCards();
                    updateCard();
                    
                    // Close modal and show confirmation
                    settingsModal.classList.remove('open');
                    showToast('All progress reset!', 'success');
                    
                } catch (e) {
                    console.error('Reset failed:', e);
                    showToast('Reset failed: ' + e.message);
                }
            } else {
                // First click - ask for confirmation
                resetBtn.dataset.confirming = 'true';
                resetBtn.textContent = ' Click again to confirm reset';
                resetBtn.style.background = '#ef4444';
                resetBtn.style.color = 'white';
                
                // Reset button state after 3 seconds if not clicked
                setTimeout(function() {
                    if (resetBtn.dataset.confirming === 'true') {
                        resetBtn.dataset.confirming = 'false';
                        resetBtn.textContent = ' Reset All Progress';
                        resetBtn.style.background = '';
                        resetBtn.style.color = '';
                    }
                }, 3000);
            }
        }

        function saveProgress() {
            localStorage.setItem('thaiFlashcardsProgress', JSON.stringify({ 
                cardStats, 
                sessionStats, 
                currentListIndex, 
                showThaiFront, 
                currentMode, 
                favorites: Array.from(favorites),
                lastSaved: new Date().toISOString() 
            }));
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('thaiFlashcardsProgress');
                if (saved) {
                    const d = JSON.parse(saved);
                    cardStats = d.cardStats || {};
                    sessionStats = d.sessionStats || { correct: 0, incorrect: 0, cardsReviewed: 0 };
                    currentListIndex = d.currentListIndex || 0;
                    showThaiFront = d.showThaiFront !== undefined ? d.showThaiFront : true;
                    currentMode = d.currentMode || 'all';
                    favorites = new Set(d.favorites || []);
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === currentMode));
                    
                    // Migrate old list-indexed stats to global stats
                    migrateOldStats();
                    saveProgress(); // Save migrated stats
                }
                const sess = localStorage.getItem('thaiFlashcardsSession');
                if (sess) sessionState = JSON.parse(sess);
            } catch (e) { console.error(e); }
        }

        function showToast(msg, variant = '') {
            toast.textContent = msg;
            toast.className = 'toast show' + (variant ? ' ' + variant : '');
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.className = 'toast', 300);
            }, 2000);
        }

        init();
    </script>
</body>
</html>
