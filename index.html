<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6b4423">
    <title>Thai Vocabulary Flashcards</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Load theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('thaiFlashcardsTheme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <style>
        :root {
            /* Light theme (default) */
            --bg-primary: #fdfbf7;
            --bg-secondary: #f5ebe0;
            --bg-card: #ffffff;
            --bg-card-back: linear-gradient(135deg, #8b6f47 0%, #6b4423 100%);
            --text-primary: #6b4423;
            --text-secondary: #666666;
            --text-muted: #999999;
            --accent-primary: #d4a373;
            --accent-secondary: #8b6f47;
            --border-color: rgba(212, 163, 115, 0.3);
            --shadow-color: rgba(107, 68, 35, 0.12);
            --shadow-strong: rgba(107, 68, 35, 0.2);
            --card-border: rgba(139, 111, 71, 0.1);
            --btn-bg: #ffffff;
            --btn-nav-bg: #f5ebe0;
            --progress-bg: #e0e0e0;
            --modal-backdrop: rgba(0, 0, 0, 0.5);
            --success-color: #22c55e;
            --error-color: #ef4444;
            --glow-success: rgba(34, 197, 94, 0.4);
            --glow-error: rgba(239, 68, 68, 0.4);
        }

        [data-theme="dark"] {
            --bg-primary: #121214;
            --bg-secondary: #1c1c1f;
            --bg-card: #242428;
            --bg-card-back: linear-gradient(135deg, #3a3a42 0%, #28282d 100%);
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent-primary: #5eead4;
            --accent-secondary: #14b8a6;
            --border-color: rgba(161, 161, 170, 0.2);
            --shadow-color: rgba(0, 0, 0, 0.4);
            --shadow-strong: rgba(0, 0, 0, 0.6);
            --card-border: rgba(161, 161, 170, 0.1);
            --btn-bg: #242428;
            --btn-nav-bg: #2e2e33;
            --progress-bg: #2e2e33;
            --modal-backdrop: rgba(0, 0, 0, 0.75);
            --success-color: #4ade80;
            --error-color: #f87171;
            --glow-success: rgba(74, 222, 128, 0.3);
            --glow-error: rgba(248, 113, 113, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            overflow-x: hidden;
            width: 100%;
        }

        body {
            font-family: 'Nunito', 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            touch-action: pan-y;
            overflow-x: hidden;
            width: 100%;
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 12px;
        }

        .header-icon {
            width: 64px;
            height: 64px;
            margin-bottom: 8px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
            border-radius: 12px;
        }
        
        .header-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        h1 {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-size: clamp(1.8em, 6vw, 2.5em);
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-size: clamp(0.75em, 3vw, 0.9em);
            padding: 0 10px;
        }

        .list-selector-container {
            text-align: center;
            margin-bottom: 15px;
        }

        .list-selector {
            padding: 12px 20px;
            font-size: clamp(0.9em, 3.5vw, 1em);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--btn-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            max-width: 100%;
            font-family: inherit;
        }

        .list-selector:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(212, 163, 115, 0.2);
        }

        .top-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: space-between;
        }

        .settings-btn, .stats-btn {
            padding: 10px 16px;
            background: var(--btn-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: clamp(0.85em, 3vw, 0.95em);
            font-weight: 500;
            transition: all 0.2s;
            flex: 1;
        }

        .settings-btn:active, .stats-btn:active {
            background: var(--bg-secondary);
            transform: scale(0.98);
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--btn-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.3em;
            z-index: 100;
            transition: all 0.3s;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .theme-toggle:active {
            transform: scale(0.9);
        }

        .session-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .session-btn {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            background: var(--btn-bg);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: clamp(0.8em, 2.8vw, 0.9em);
        }

        .session-btn:active {
            transform: scale(0.95);
            background: var(--bg-secondary);
        }

        .session-btn.primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border-color: transparent;
        }

        .session-btn.primary:disabled {
            background: var(--progress-bg);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .session-btn.primary:disabled:active {
            transform: none;
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: clamp(0.8em, 3vw, 0.9em);
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--progress-bg);
            border-radius: 10px;
            overflow: visible;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 10px;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 8px rgba(212, 163, 115, 0.4);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 50%);
            border-radius: 10px;
        }

        .progress-milestones {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            padding: 0 2px;
        }

        .milestone {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--progress-bg);
            transition: all 0.3s;
            position: relative;
        }

        .milestone.reached {
            background: var(--accent-primary);
            box-shadow: 0 0 8px var(--accent-primary);
            animation: milestonePulse 4s ease-in-out infinite;
        }

        @keyframes milestonePulse {
            0%, 100% { 
                box-shadow: 0 0 6px var(--accent-primary);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 12px var(--accent-primary), 0 0 20px var(--accent-primary);
                transform: scale(1.15);
            }
        }

        .milestone.reached::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            border: 2px solid var(--accent-primary);
            opacity: 0.5;
        }

        .card-container {
            perspective: 1000px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            border-radius: 24px;
        }

        .swipe-bar {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            border-radius: 24px;
            opacity: 0;
            transition: opacity 0.15s ease;
            pointer-events: none;
            z-index: 5;
        }

        .swipe-bar.left {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.95) 0%, rgba(239, 68, 68, 0) 50%);
        }

        .swipe-bar.right {
            background: linear-gradient(-90deg, rgba(34, 197, 94, 0.95) 0%, rgba(34, 197, 94, 0) 50%);
        }

        .swipe-bar.visible {
            opacity: 1;
        }

        .swipe-hint {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3em;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: none;
            z-index: 10;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .swipe-hint.left {
            left: 25px;
            color: white;
        }

        .swipe-hint.right {
            right: 25px;
            color: white;
        }

        .swipe-hint.visible {
            opacity: 1;
        }

        .swipe-hint.visible.left {
            transform: translateY(-50%) scale(1.2);
        }

        .swipe-hint.visible.right {
            transform: translateY(-50%) scale(1.2);
        }

        .card {
            width: 100%;
            min-height: clamp(280px, 50vh, 400px);
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            touch-action: none;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.swiping {
            transition: none;
        }

        /* Success/error feedback animations */
        .card.success-flash .card-face {
            animation: successPulse 0.4s ease;
        }

        .card.error-flash .card-face {
            animation: errorPulse 0.4s ease;
        }

        @keyframes successPulse {
            0%, 100% { box-shadow: 0 20px 60px var(--shadow-color); }
            50% { box-shadow: 0 0 40px var(--glow-success), 0 20px 60px var(--shadow-color); }
        }

        @keyframes errorPulse {
            0%, 100% { box-shadow: 0 20px 60px var(--shadow-color); }
            50% { box-shadow: 0 0 40px var(--glow-error), 0 20px 60px var(--shadow-color); }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            min-height: clamp(280px, 50vh, 400px);
            backface-visibility: hidden;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: clamp(20px, 8vw, 40px);
            box-shadow: 0 20px 60px var(--shadow-color), 0 8px 20px var(--shadow-color);
            transition: box-shadow 0.3s ease;
            overflow: hidden;
        }

        .card-front {
            background: var(--bg-card);
            border: 1px solid var(--card-border);
        }

        .card-back {
            background: var(--bg-card-back);
            transform: rotateY(180deg);
            position: relative;
            overflow: hidden;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            pointer-events: none;
        }

        .card-text {
            font-size: clamp(2em, 8vw, 3.5em);
            font-weight: 600;
            color: var(--text-primary);
            word-break: keep-all;
            overflow-wrap: normal;
            max-width: 100%;
            line-height: 1.4;
            text-align: center;
            padding: 0 10px;
            font-family: 'Sarabun', 'Nunito', sans-serif;
            min-height: 1.4em;
        }

        .card-text.medium { font-size: clamp(1.5em, 6vw, 2.2em); }
        .card-text.small { font-size: clamp(1.2em, 5vw, 1.6em); }
        .card-text.tiny { font-size: clamp(1em, 4vw, 1.2em); }
        .card-text.xtiny { font-size: clamp(0.9em, 3.5vw, 1em); }

        .card-back .card-text {
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        button {
            padding: clamp(12px, 3vw, 15px) clamp(16px, 4vw, 20px);
            border: none;
            border-radius: 14px;
            font-size: clamp(0.9em, 3.5vw, 1em);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            touch-action: manipulation;
            font-family: inherit;
        }

        button:active:not(:disabled) {
            transform: scale(0.95);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-nav { 
            background: var(--btn-nav-bg); 
            color: var(--text-primary); 
        }
        
        .btn-flip { 
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%); 
            color: white;
            box-shadow: 0 4px 15px rgba(212, 163, 115, 0.3);
        }
        
        .btn-action { 
            background: var(--btn-bg); 
            color: var(--text-primary); 
            border: 2px solid var(--border-color); 
        }

        .action-controls {
            display: flex;
            gap: 8px;
        }

        .sentence-example {
            margin-top: 15px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 14px;
            border: 1px solid var(--border-color);
            display: none;
        }

        .sentence-example.show {
            display: block;
        }

        .sentence-example-btn {
            background: var(--btn-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }

        .sentence-example-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .sentence-thai {
            font-size: 1.3em;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .sentence-roman {
            font-size: 0.95em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-style: italic;
        }

        .sentence-english {
            font-size: 1em;
            color: var(--text-secondary);
        }

        .sentence-word-highlight {
            color: var(--primary-color);
            font-weight: 600;
        }

        .sentence-speak-btn {
            margin-top: 12px;
            padding: 8px 12px;
            background: var(--btn-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .sentence-speak-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .score-display {
            text-align: center;
            margin-bottom: 15px;
            font-size: clamp(1em, 3.5vw, 1.1em);
            color: var(--text-secondary);
            background: var(--btn-bg);
            padding: 12px 16px;
            border-radius: 14px;
            border: 1px solid var(--border-color);
        }

        .score-number { font-weight: 700; font-size: 1.3em; }
        .score-correct { color: var(--success-color); }
        .score-incorrect { color: var(--error-color); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-backdrop);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            overflow: hidden;
        }

        .modal.open { display: flex; }

        .modal-content {
            background: var(--bg-card);
            border-radius: 24px;
            padding: clamp(16px, 4vw, 30px);
            max-width: 500px;
            width: 100%;
            max-height: calc(100vh - 30px);
            max-height: calc(100dvh - 30px);
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 25px 80px var(--shadow-strong);
            border: 1px solid var(--border-color);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: clamp(1.3em, 5vw, 1.6em);
            font-weight: 700;
        }

        .close-btn {
            background: var(--btn-nav-bg);
            border: none;
            font-size: 1.2em;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 12px;
            flex: none;
            border-radius: 10px;
            transition: all 0.2s;
        }

        .close-btn:active {
            transform: scale(0.9);
            background: var(--bg-secondary);
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section h3 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: clamp(1em, 4vw, 1.1em);
            font-weight: 600;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-label {
            display: block;
            padding: 12px 16px;
            background: var(--btn-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
            font-size: clamp(0.9em, 3.5vw, 1em);
            transition: all 0.2s;
        }

        .file-input-label:active {
            background: var(--bg-secondary);
        }

        #csvFileInput { position: absolute; left: -9999px; }

        .import-info {
            margin-top: 8px;
            font-size: clamp(0.75em, 3vw, 0.85em);
            color: var(--text-muted);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-box {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 14px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: clamp(1.5em, 6vw, 2em);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: clamp(0.8em, 3vw, 0.9em);
            color: var(--text-secondary);
        }

        .list-stat-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 14px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }

        .list-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .list-stat-name { font-weight: 600; color: var(--text-primary); font-size: 1em; }
        .list-stat-percent { font-size: 1.3em; font-weight: 700; color: var(--success-color); }

        .list-stat-bar {
            width: 100%;
            height: 8px;
            background: var(--progress-bg);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .list-stat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color) 0%, #22c55e 100%);
            transition: width 0.3s ease;
        }

        .list-stat-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .stat-detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-detail-value { font-weight: 600; color: var(--text-primary); }

        .mode-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            background: var(--btn-bg);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: clamp(0.85em, 3vw, 0.95em);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border-color: transparent;
        }

        .mode-btn:active { transform: scale(0.95); }

        .view-mode-toggle {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            padding: 4px;
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .view-mode-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: clamp(0.8em, 2.8vw, 0.85em);
        }

        .view-mode-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .view-mode-btn:active { transform: scale(0.95); }

        /* Options Button */
        .options-btn {
            background: var(--btn-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 10px 14px;
            font-size: 1.2em;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .options-btn:active { transform: scale(0.95); }

        /* Options Modal */
        .options-modal-content {
            max-width: 400px;
        }

        .option-group {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .option-group:last-child {
            border-bottom: none;
        }

        .option-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .option-hint {
            font-size: 0.8em;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .option-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .option-row .option-label {
            margin-bottom: 0;
        }

        .option-toggle-group {
            display: flex;
            gap: 6px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: 10px;
        }

        .option-toggle-btn {
            flex: 1;
            padding: 10px 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85em;
        }

        .option-toggle-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .option-toggle-btn:active { transform: scale(0.95); }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--progress-bg);
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Mastery Indicator */
        .mastery-indicator {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
            opacity: 0.9;
        }

        .card.flipped .mastery-indicator {
            visibility: hidden;
        }

        .mastery-new {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .mastery-learning {
            background: #fef3c7;
            color: #92400e;
        }

        [data-theme="dark"] .mastery-learning {
            background: #422006;
            color: #fbbf24;
        }

        .mastery-mastered {
            background: #d1fae5;
            color: #065f46;
        }

        [data-theme="dark"] .mastery-mastered {
            background: #064e3b;
            color: #34d399;
        }

        .mastery-struggling {
            background: #fee2e2;
            color: #991b1b;
        }

        [data-theme="dark"] .mastery-struggling {
            background: #450a0a;
            color: #f87171;
        }

        /* Vocab List Modal */
        .vocab-list-modal-content {
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            max-height: 85dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .vocab-list-controls {
            flex-shrink: 0;
            padding-bottom: 5px;
        }

        .vocab-list-controls .list-selector {
            width: 100%;
        }

        .vocab-list-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px 0;
            -webkit-overflow-scrolling: touch;
            min-height: 0;
        }

        .vocab-list-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            gap: 12px;
            flex-wrap: wrap;
        }

        .vocab-list-item:last-child {
            border-bottom: none;
        }

        .vocab-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .vocab-status.new {
            background: var(--text-muted);
        }

        .vocab-status.learning {
            background: #f59e0b;
        }

        .vocab-status.mastered {
            background: #10b981;
        }

        .vocab-status.struggling {
            background: #ef4444;
        }

        .vocab-thai {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 60px;
            flex-shrink: 0;
        }

        .vocab-english {
            flex: 1;
            color: var(--text-secondary);
            font-size: 0.9em;
            min-width: 100px;
        }

        .vocab-roman {
            color: var(--text-muted);
            font-size: 0.8em;
            font-style: italic;
            width: 100%;
            padding-left: 22px;
            margin-top: -4px;
        }

        /* App Mode Toggle */
        .app-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .app-mode-btn {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--btn-bg);
            color: var(--text-primary);
        }

        .app-mode-btn:hover {
            border-color: var(--accent-primary);
        }

        .app-mode-btn:active {
            background: var(--bg-secondary);
            transform: scale(0.98);
        }

        .app-mode-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        /* Grammar Section */
        .grammar-section {
            padding: 10px 0;
        }

        .grammar-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .grammar-header h2 {
            color: var(--text-primary);
            margin: 0 0 5px 0;
            font-size: 1.4em;
        }

        .grammar-subtitle {
            color: var(--text-muted);
            font-size: 0.9em;
            margin: 0;
        }

        .grammar-lessons-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .grammar-lesson-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .grammar-lesson-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .grammar-lesson-card.completed {
            border-color: #10b981;
        }

        .lesson-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .lesson-card-title {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .lesson-card-thai {
            font-size: 1.2em;
            color: var(--accent-primary);
        }

        .lesson-card-desc {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .lesson-card-example {
            background: var(--progress-bg);
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.85em;
        }

        .lesson-card-example .thai {
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .lesson-card-example .english {
            color: var(--text-muted);
            font-style: italic;
        }

        .lesson-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            gap: 12px;
        }

        .lesson-card-status {
            font-size: 0.8em;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .lesson-card-status.completed {
            color: #10b981;
            font-weight: 600;
        }

        .lesson-card-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--accent-primary);
            color: white;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .lesson-card-btn:hover {
            transform: scale(1.05);
        }

        .lesson-card-btn.completed {
            background: #10b981;
        }

        [data-theme="dark"] .lesson-card-status.completed {
            color: #34d399;
        }

        /* Lesson View */
        .grammar-lesson-view {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .grammar-back-btn {
            background: none;
            border: none;
            color: var(--accent-primary);
            font-size: 0.95em;
            cursor: pointer;
            padding: 8px 0;
            margin-bottom: 15px;
        }

        .lesson-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            min-height: 350px;
        }

        .lesson-step {
            display: none;
        }

        .lesson-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .lesson-step-title {
            font-size: 0.85em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .lesson-structure {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }

        .lesson-structure-thai {
            font-size: 1.8em;
            color: var(--accent-primary);
            margin-bottom: 8px;
        }

        .lesson-structure-roman {
            font-size: 1em;
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 8px;
        }

        .lesson-structure-english {
            font-size: 1.1em;
            color: var(--text-secondary);
        }

        .lesson-explanation {
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 0.95em;
        }
        
        .lesson-explanation p {
            margin: 0 0 12px 0;
        }
        
        .lesson-explanation p:last-child {
            margin-bottom: 0;
        }
        
        .lesson-explanation strong {
            color: var(--text-primary);
        }
        
        .lesson-explanation em {
            font-style: italic;
            color: var(--primary-color);
        }

        .lesson-examples {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .example-card {
            background: var(--progress-bg);
            border-radius: 12px;
            padding: 16px;
        }

        .example-thai {
            font-size: 1.15em;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .example-thai .highlight {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .example-roman {
            font-size: 0.85em;
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 6px;
        }

        .example-english {
            color: var(--text-secondary);
            font-size: 0.95em;
        }

        /* Practice Section */
        .practice-prompt {
            text-align: center;
            margin-bottom: 20px;
        }

        .practice-prompt-english {
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .practice-prompt-hint {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .practice-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .practice-option {
            background: var(--progress-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 14px 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .practice-option:hover {
            border-color: var(--accent-primary);
        }

        .practice-option.selected {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .practice-option.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .practice-option.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .practice-feedback {
            text-align: center;
            padding: 16px;
            margin-top: 16px;
            border-radius: 12px;
            display: none;
        }

        .practice-feedback.show {
            display: block;
        }

        .practice-feedback.correct {
            background: rgba(16, 185, 129, 0.1);
            color: #065f46;
        }

        .practice-feedback.incorrect {
            background: rgba(239, 68, 68, 0.1);
            color: #991b1b;
        }

        [data-theme="dark"] .practice-feedback.correct {
            color: #34d399;
        }

        [data-theme="dark"] .practice-feedback.incorrect {
            color: #fca5a5;
        }

        .practice-check-btn {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }

        .practice-check-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Sentence Builder */
        .sentence-builder {
            margin-top: 16px;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 16px;
            background: var(--progress-bg);
            border-radius: 12px;
            min-height: 50px;
            margin-bottom: 12px;
        }

        .word-chip {
            background: var(--card-bg);
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1em;
            border: 2px solid transparent;
        }

        .word-chip:hover {
            border-color: var(--accent-primary);
        }

        .word-chip.used {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .sentence-target {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 16px;
            background: var(--card-bg);
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            min-height: 60px;
            align-items: center;
        }

        .sentence-target .word-chip {
            background: var(--accent-primary);
            color: white;
        }

        .sentence-placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        .lesson-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .lesson-progress {
            color: var(--text-muted);
            font-size: 0.9em;
        }

        /* Practice Mode Styles */
        .grammar-practice-view {
            animation: fadeIn 0.3s ease;
        }

        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .practice-title {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .practice-score {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--accent-primary);
            background: var(--progress-bg);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .practice-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--progress-bg);
            padding: 4px;
            border-radius: 12px;
        }

        .practice-mode-btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: var(--text-muted);
        }

        .practice-mode-btn.active {
            background: var(--card-bg);
            color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .practice-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            min-height: 300px;
        }

        .practice-question {
            text-align: center;
            margin-bottom: 24px;
        }

        .practice-english {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-style: italic;
        }

        .practice-sentence {
            font-size: 1.5em;
            color: var(--text-primary);
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .practice-sentence .blank {
            display: inline-block;
            min-width: 80px;
            height: 40px;
            border-bottom: 3px solid var(--accent-primary);
            margin: 0 4px;
            vertical-align: bottom;
            position: relative;
        }

        .practice-sentence .blank.filled {
            border-bottom-color: var(--accent-primary);
            cursor: pointer;
        }

        .practice-sentence .blank.correct {
            border-bottom-color: #10b981;
        }

        .practice-sentence .blank.incorrect {
            border-bottom-color: #ef4444;
        }

        .practice-sentence .blank .filled-word {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-primary);
            color: var(--bg-primary);
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.8em;
            white-space: nowrap;
            font-weight: 600;
        }

        .practice-sentence .blank.filled .filled-word {
            background: var(--accent-primary);
        }

        .practice-sentence .blank.correct .filled-word {
            background: #10b981;
            color: white;
        }

        .practice-sentence .blank.incorrect .filled-word {
            background: #ef4444;
            color: white;
        }

        .practice-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .practice-word-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .practice-word-option {
            background: var(--progress-bg);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .practice-word-option:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .practice-word-option.selected {
            background: var(--accent-primary);
            color: white;
        }

        .practice-word-option.used {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .practice-word-option.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .practice-word-option.wrong {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        /* Sentence Builder Practice */
        .build-target {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 20px;
            background: var(--progress-bg);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            min-height: 70px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            transition: all 0.2s;
        }

        .build-target.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .build-target.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .build-target .build-word {
            background: var(--accent-primary);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .build-target .build-word:hover {
            opacity: 0.8;
        }

        .build-placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        .build-word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .build-word-chip {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .build-word-chip:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .build-word-chip.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .practice-result {
            text-align: center;
            padding: 16px;
            margin-top: 20px;
            border-radius: 12px;
            font-weight: 600;
        }

        .practice-result.correct {
            background: rgba(16, 185, 129, 0.15);
            color: #065f46;
        }

        .practice-result.incorrect {
            background: rgba(239, 68, 68, 0.15);
            color: #991b1b;
        }

        [data-theme="dark"] .practice-result.correct {
            color: #34d399;
        }

        [data-theme="dark"] .practice-result.incorrect {
            color: #fca5a5;
        }

        .practice-correct-answer {
            margin-top: 12px;
            font-size: 1.2em;
            color: var(--text-primary);
        }

        .practice-nav {
            margin-top: 20px;
            text-align: center;
            position: sticky;
            bottom: 10px;
            background: var(--bg-primary);
            padding: 10px 0;
        }

        .practice-nav .btn-action {
            min-width: 200px;
        }
        
        .practice-result.clickable {
            cursor: pointer;
        }
        
        .practice-result .tap-hint {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 8px;
        }

        .practice-complete {
            text-align: center;
            padding: 40px 20px;
        }

        .practice-complete-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .practice-complete-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .practice-complete-score {
            font-size: 2em;
            color: var(--accent-primary);
            font-weight: 700;
            margin-bottom: 20px;
        }

        .practice-complete-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Romanization text */
        .romanization {
            font-size: 0.45em;
            color: var(--text-muted);
            margin-top: 8px;
            font-style: italic;
            font-family: 'Nunito', sans-serif;
            letter-spacing: 0.5px;
        }

        .card-back .romanization {
            color: rgba(255, 255, 255, 0.6);
        }

        .action-btn { width: 100%; margin-bottom: 10px; }

        .resume-modal-content { text-align: center; }

        .resume-modal-content p {
            margin-bottom: 20px;
            color: var(--text-secondary);
            font-size: 1em;
            line-height: 1.5;
        }

        .resume-modal-content .session-info {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 14px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .resume-modal-content .session-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .resume-modal-content .session-info-item:last-child { margin-bottom: 0; }
        .resume-modal-content .session-info-label { color: var(--text-secondary); }
        .resume-modal-content .session-info-value { font-weight: 600; color: var(--text-primary); }

        .resume-buttons { display: flex; gap: 10px; }
        .resume-buttons button { flex: 1; }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--text-primary);
            color: var(--bg-primary);
            padding: 14px 28px;
            border-radius: 14px;
            font-size: 0.95em;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            box-shadow: 0 10px 40px var(--shadow-strong);
        }

        .toast.show { 
            opacity: 1; 
            transform: translateX(-50%) translateY(0);
        }

        /* Success/error toast variants */
        .toast.success {
            background: var(--success-color);
            color: white;
        }

        .toast.error {
            background: var(--error-color);
            color: white;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .empty-state-title {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 0.95em;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .favorite-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--bg-secondary);
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 15;
            padding: 8px;
            opacity: 0.7;
            transition: all 0.2s;
            flex: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .favorite-btn:active { transform: scale(1.15); }
        .favorite-btn.active { 
            opacity: 1; 
            background: #fef3c7;
        }

        [data-theme="dark"] .favorite-btn.active {
            background: #3f3f46;
        }

        .audio-btn {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: var(--bg-secondary);
            border: none;
            font-size: 1.1em;
            cursor: pointer;
            z-index: 15;
            padding: 8px;
            opacity: 0.5;
            transition: all 0.2s;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .audio-btn:hover { opacity: 0.8; }
        .audio-btn:active { transform: scale(1.1); }
        .audio-btn.speaking {
            opacity: 1;
            background: var(--accent-primary);
            animation: pulse-audio 0.8s ease-in-out infinite;
        }

        @keyframes pulse-audio {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { padding: 0; }
            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
            .vocab-list-item {
                padding: 8px 10px;
                gap: 8px;
            }
            .vocab-thai {
                font-size: 1em;
                min-width: 50px;
            }
            .vocab-english {
                font-size: 0.85em;
                min-width: 80px;
            }
            .modal-content {
                padding: 15px;
                border-radius: 16px;
            }
            .modal-header h2 {
                font-size: 1.2em;
            }
        }

        @media (max-width: 360px) {
            body { padding: 8px; }
            .vocab-list-item {
                padding: 6px 8px;
                gap: 6px;
            }
            .vocab-thai {
                font-size: 0.95em;
            }
            .vocab-english {
                font-size: 0.8em;
            }
            .modal {
                padding: 10px;
            }
            .modal-content {
                padding: 12px;
                border-radius: 12px;
            }
        }

        @media (max-height: 600px) {
            .modal-content {
                max-height: calc(100vh - 20px);
                max-height: calc(100dvh - 20px);
            }
            .vocab-list-modal-content {
                max-height: calc(100vh - 20px);
                max-height: calc(100dvh - 20px);
            }
        }
    </style>
</head>
<body>
    <!-- Theme toggle button -->
    <button class="theme-toggle" id="themeToggle" title="Toggle dark mode"></button>
    
    <div class="container">
        <div class="header">
            <div class="header-icon"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfqARMDEjPBpewZAAAiqUlEQVR42o19W7BlV3XdHGvvc869597b78dtSU23WggkpACSzMNGQMAGQ2wqTnCgbOxQFDgpuyo/IUkVOD/xTypll/2RxARXXLGLENlQ4mGbR5kyWAKMQehlSS0p1epWS2r1S3277+s89mONfOy91ppr7X2b6KPVfe857L3WXHOOOeaYc6Mu5sJaCBEKjAAiFBERI2JFRAAREYog/E9EhM3L4P5wb1QvgYDhF+7l/h8MPw5f1P+f/1BGH0P1LlJ/j74IEaTf5V9JikDdtf8lRUiKAABIK4JcbE1aACJGfaX7YkDIcGWCztU0C+S/jCICgu0KU+h+ifZlEDQ/V9cHaX+i7wRhSRDtQfhMEaFNVydZDus+IXww23uBewWT+6LfSjQLQoowpwhg2L6cFEIgApIAwruAYAvejsI/Jb2WZs8pbhXgV6dnpSBqRSWyCKEArY0GU3bXm9gp9F8QGW+wJMIvONGYD5DaHUn/8Wg3C8ZdmBH41UZjfD0nA97obPsXSPshaN/Y2VuEowq1tv71EL1q0UvpzrXfFbj3QiJjhP8cuE/23w91XYRbKu9cABNfeftDCJolY7M0QuOXOXy0tpFkZyjhUiT+e7QeECBsvn8l1R4zPcr+hCW20Hl14uPgTBipMwpXZ7yVSONwYEhvdoyvH8GZAWhXG3AeXaTxTO5wRm4rugsqv57sf3BzUEbS/LtdJyR3zXaHI0tBtED64klh6rrDiUv+a+/LLxNDpHImBm0ZIT60fwGQmL+hC1juQpU1JX4TPSEprJr/bir/jOb8K5NyB82fcrLdKcT33H5uX4hjx12p44kmfqkj4vfHx3rGBmu0kTfOij7m+GALMRACzTLQLblRhuNNV4eP9p9E5HHobATJKdK2wui0EcqqkLxWL5Q+74jsLoIWCFfCvneR6XYgfRMgIgTVGaJtY1w9nwotg+EiNWogDlvaKQBoD3e4rRBamGw8w/ILYw8DZ/oSOTZJDhwbxASFNtCHxvzL2Acmum+ggoPtLbUfHmKsMI/WA/4KEK1PuzSM8EizBV1z7d6oi/qAwgwKhDC+ar+4iU/v3GtjxYxAlPcpQAyv2GOY0sVD6lcGQuqVMD3BXse4dungPqsv9gVIqY8lgivtHAjGId6HFvooLTFOVFfoFoGx1coOF4bkhHYC1/XtLspV8pA2+HOO+GxQW07kuxXORSd/UearDjd6wXZ4Czxc73qxNFOC2qjg/FJ0qVYJsWUpRx0ZMLSvb84FSIEYt8lobQASmXS7PdhxEwDtsCL7YhQ/9X0y2TOKD+QJtIDCpAFSo5P+QYUPdlMXtJYcAWfTBk24QE91YEP8oI+tRrRnbi/QhOMZwGSMRdsbRhoE4AEL0MXzSf7HKPtOblLBWJ0sdRB7N1+F2g23jggbJX7h1BYYZxYMDl5Su8klii9RPHHgWDvnJBazJw4hWhMkS+AyaY0o2YcxhB28iQAtEyftnXnrMZLX0MFfQCWZ3ivHAYXSH4mdz2KbL4oOL7HVUHZI7nWslh63ge6/UxZB71ICKWJj4g7AqgfpUK2gSJdfkjjiQp8wl6ggdj00aNBqwPWdNdK5PhB7aKgbdF/i/VDvFqko5xKYnqzFZxoIXjMyUQLUVktBh0LqZNmAxNglRCemANdRDP5a2wwAyflrvQV1oEW7UtDpaYgzdFiFcTzvT4Zj8MtAtTXQwfucZinRS+kl5BCi74y/yZ+dxmMxhkB+/xmgRoeYpFDoQKljydDyPUypSwaXyk6ADDlgwrh0gz5bp4MQBHx8g6b14F6p7BQKM8CTnH2kISkC4voegS5SJU6dwRdEoIm5T+UVP6sQsCf5kNKLXXYzPqLsPRBtnu5ZtXDEQG2sCHlpcIiavgEiyo46aJIBLUaEMbopWMD9OpQxzjZatiqPoB80aSUp56t2P3E+MdGYhM8I4CLYQsv5aMaPasnZyWxaOpUg6E00fYmIW8QEtndeLQpOM/awSF178zMj8eFSh91ENEPkhRERo4GGQpciSEAU9TlCwJxkDEwUL6e4KARTSyIgpMvIRJTlTmkDu0lS+FSG44UGOujajIkAFBKeuwH+2DG493FgIVDFBtucEyrfFZ8p7QUivOuKCNqa2WPDPRWIBMeCUWWEjt2NURKMf6XZofSEKGoicLdUbKnLlOBccUwApPwAhP0IDTsXZ9hhwpoEhOiENUV5IoZPHRpEIXSNIskdC3Gky4+C97FpFhoSHer8BimS6zIhTFhkKEtNbDJ4jC5qZ+xLYyaKCX+OniJhX1YUEB+SAmgAENQFoeZ/JhQv0soglP3SU4iKoUjQZ1TJ6BLCOzEjMVkcksHeMhGl3wxT5hv9dY4+FoZ9H+eQEqBtL49NpEM7AkkZL0IzUYKg3pTeIPVr2DXJ61B96JhhnAcgymx6K99QHJrEVLWuufZdEX0JBiTzyPWxx9NQHeg+xihi1VwJIuVRGPOEtIyo0lC+7JxrJHhf0npKcPzcwXwYI/RoRUG9ylD1LXeUmmKzCCB5jKEcfvFgJ8rIA4BjEgJC7nW9MyK0ltZkAwyz5iLaP23NuhIY6sgFIGuK5yRtUycAAGMAQ5Jt4b6H0+/n5WNrD9fdYFgx1Oya6AKhC+bVfIoI4NGRWWF100Dbx2bHP2FCi1JEbI1sgCybT7Y2Xnp6tva8qSaD0cJw/7Gl1TsG4xVbFSEUGFPXtpzPivmsritaNv+JiMnMYDAcLY4Hw1GzkIgJfV43wDOiROPDG+oUUSmILeHdVHek65e8NzISlQGIlKHqO+teKACX4NCa4cLW2sWzf/sn209/a6Va27NYL+zbY27+R3bvTfNtWTz81l23/mPWZfOBk63N+XRS13VjejAZRKy1tHVjoDD5wni8snsvQjqbXgt60VY37+EOpQ1naIGnreezEOOgPSZaRjVUddBjRFQVoOhcokmDKNKs1Onv3X/6K79zeGFyy83HxwdWefgoj96BPavIMjufrT/x3XrxjgP3/GpdzNavXi3nM5MZETNaXFxYWITJRKSuy+2Nq5aZyUfVbMNSFhYW9xw4yD5jQlem1ANHlQuiIv9DhLYOpJAied8xQgc2dk4f4FkZdM8gfBVWxNZmuPDYn/+Xa9//zIm73zLD8OmtrexafsOrjx1aPVpvb9VXr2L7yp5Fc/X/3rex74Tse10x3c6HI2u5tLKytLLiNtjmg3y0tHLx9FOXH/380rG3L95412R7fbiwsLSy29padsS06NSw1cmFRDUlv3CsQ2nZ/S5v1w8m5Hgm1B0ZwWwGIMCe7Mqd1UAMWltnw4Vnv/nHlx78w/z4G7/0zccvvvBCXVdCjvLPv+EdP/2LH/tno/Vz9dqlaj5fGmLtyftx11GTZWz0UIMBKaQVa5EPaOuXv//Ha4/86Vx27X7jR20xEcr2xvp4eddOLgG6HkXSUQs7Hlet5EhLVQ2fBePjTxz3meSglB0qqeypXZA2Gy6snzv1/F//wfZ49bt//s1isxiPJYeYQTYYDB76qwe3r1z9lV9/T3nlimTDHIZbp6qty4u7Dwlrocynk+FoQaw1g9F84/yZr/22vfijQ8duv1jdno2WbbFFSlEUtq6NMVRIKiYQWr+N/gqwznvYkfjolUXu0oa46uYXGAG/Mt0rDWAIQZLmNMH+9Lf+aFIWP37opcwWb/vgh3/q/R+pitmDn/u9F5/60f4ju557/Mmn3vyG1+wfb69v5Xk2m5dZOaE0zpzNH2Y4mlw+deqLv7XAK7fe/eYrmwIsC2CttbZ5bW0y03KXfQAdnbQfyTlFv5klbE6+A5UXeXCJkEUnO0XIM9TG0OR5Odm6cuqHl67Mt66s3/svfu1D/+lztq5Nlh2/513/8xNvW790ZpjhhedeOHbw5s3tS/lwMKvymw4cycdLVTnPsmxhvGRMXk3XT3/5kwuyfuzVr4WwmMzM0oqta5K0to2YAmJHCM6WwiE6KSujyvt1IjxEaDqMrIlq6gFr9ctjdyr1iAiyfHL10sYrF6bb89FA3vCeD4tIXUzLydZ4z4G3/NLH87IcDwe2mE8rM53MttbXC+zadehVS8tLu/buW969xxiIgebZH1dXn7vp2AnY2la1AGKMtbWt66Y+kkRDJDkz0JcwdTRo6CjlNDJvKRotdwAiSateIMXOcQdFHlNeRUiZzmoDGMrkyoX22o0RkUO3vG5lKV8ampXxwnRjYzYr19eujo+/DVlWVxUtbW2b77S2Hi8t5rmpbagp0LY4tUusMuE6+nNvpER2vLJaNuIdkeljzeBzNoYqWo+ksFdTEdLTqtx1+KhZPJBn9WiEv//fv3vtpefyxSWTD0RkMFpcGuXLo2z/of3XLl7cWFvj+Ibjb/91sRYGAkFmTJaLSDGb5ZmpKZVlaVnr3Q7UGn6S0oPs1eEkTBgTdQ2cSNI0rIPi6uNSBaM6AuOwF0QEvTiNDjfc8U9+44H/9ps33Xjo2rnT9/3rt93y5ndtrV14y8d/J8/zjMWeAwcGw/zlp1+yVXnnRz81Wt5bFzOTD0U4n0y21teKOtu4ujYyeVXWZVkzs7au2Xj/2lLEWttNaEK2oQ0N0Fl4P9DQVBWYaP2NosUZlbholb7Uo3sgVZf10Nfu4jJbFq//wMdf/0ufnE83BfXaucvf+tyfrdWjG1//9vXnHzPWHjxx4uLzZ69efuXWD/y7G+56X13MssFwurlx4ezpCy+eWV97pSrn+WBoyaKsyrIuK1sXZRspbW2tjflCsI/PcR6YjKrbPdQJemqdIdvJI/PkTrKgjnKH1MCke3F+wWxVvvM3//Nrf/bD5574wXy6vf81d99yzztJPv/AFw8eu2kucunFF5EPd994e/O+Sy+eXV+73FALw4XFw0dvXp+efmU2L+dlVZWSlXVZtiyEtWJMh26HrxrpKgClW4DqUopdWzPOZ0lTZEUf3IVK4FUVK+KGdmLxXFeGu3RbFqu3vmH1NW9sMmqY7Jn7f39+8andt7zu3HNnBqNhMZnT1iJy6aXntzY2TJ4LOVocrx49lg+NtSyKuizcYhWFrWt/bdZW3bppolqUHuV3kCn9/+jZmv/lcetEfJjigqLWsYFBhQz49pK0X6ZdL8BWZeNo8sFo85ULD3zhv7/2ttsuvnBuOMxhsjozWZZvbWxubazngxFJZNmhm45lWd58b1nWxbysqspiPpvMqsqStklgGlwaC5iQ4EZ0xFqxqBIxlE9VWn598k7OgkAbtPbTdtuoWiijTew4eqbfBoExmSGtZFlVzDeYMRsOc5jBgII8M2VRbFy9AmMsWZXFnv2HhqOFupxnMhCinFfzWVHXdU0zm84ytvV9a2stdGOcwEq/SjFSEjQEpKvGdDpYoI+X5ELr1HtaqaSlOfGBd+V3VXMPeiN2Uo4+UbGwtkYkM8gyCEyVmdlkgqIQCm1NynBhUce3al7OZyWtrayZz4pF60qOtNbamF1BJHQEGJULEXqkWtbYao1K1NkWUoKWxcu1BiOIFVuqFdqgQxVHv4RxGbENqkgIydi50lprgDxDlgEGhUFVzElL0pgMUsMoLs7asqyKWSm0dSmz7fmioPkQa9lCByZ11LZi6vlvxurFtMyhild6PUNVV6Tp3YFiVClW5w/0Rb3QAKXridQqWXSqckTQ/jORdeWZGeZZnmfDPDPG1G2xtkWb88nEn3JrbVXaqqzLop5Py8nW1BFcFiL5YACTNZ1JZjCAMezWNZhCU8YpHsJx2ynB1AieTNESXWXV0/WaghAtmkYstiJD7VprsMNbG7MaDjDIMBxkBoDJjTFNbcJk2ea1tenmhhkMmm+qyqosqrqqyqKYTouqqhuPk+U5yOn2JsmqKi++8Pxkc8NkmSpE8Scw4ApJ9uTXiBoIc6dbRqq/cUUPn0hHRVohWh2gdgpkCu6TA9oushFm4CCH5BgMjQGHC+PFpeXtqxcHo8WmcvPy86eWVnYNl/esXTjHmraqAVYVispiMMzznFnWMHEXXzp75eLL8+kEwO59+93uNv2SzeWFFk90yarrFBWoRe+St1YBVQcLfq1lUH1tqo0gkc6PHUGPr0oBcWjRGfsgN8gNcwxy5LmQcmD1yNbaxdlkgizLskyE61cuZdvToixpOZ9OpS7nldjJern+CvKRGRS2LIxBWZbz2XTvgYOrrzqR5QNrawiimo/bOaiimVIstKASAeZDxPoeNxcqkcetOYiNwKg71cVWSRnBEGC6LWW6tan9/gwyyMTkwkwGhhltXVcicuOJ11x75fLm+tW6Ksv5bLi4ZIbDjXPPbm5u79tz5NDxW1YOHGRtZ1dPnrrvUwd++iNLqzeXs+2F8fKBw6srew8ILW3dNOB67Od07kQHZKJt2IiEialKy9UrhVTpjufqDQJYCUU0F5AjdXKnssoIRzMCeu01GSATiq0zEStihJlYW5UiYkx28MZX7T14uCzmZjh+6eQPH/wf/5YXn3jrO99x7PbXZIOMdVkVZX3g0N7zL/7Dlz992yc+e+KONw1yY7Lc1lXMKqUhzStwvGKViTyjB3LSNwiRzFVkMFEhi67gGok4gXQLqFs4GOX57FdLAXVZlkUxNO3XLA5Nub0mIrYqAGTDhXw0evTLn3ngj3771qPjt/7Cz1xZ2/zOF7587drWYGhOvGrPnl2L+Xj5yPLmmW/84Ym7/o8tC1tVgbAlk/QeQQ4Vqx8bjCmJgFT3fkcpXR5JuD09SK+vj+WGVOBTNeY3wkSyJ+CwmzCZbHt7Np1MFoamrllbu7J7fOaRr03f9/HF8QqtPfPjb//1Z/5jcfoH73nXHdnC7q985QcvnL8myLLMVJQnnr36tjfecPBAUXJ0/uT3r114cc/qUVsW3i+xS/MxaosJFS/N/EELRpGIqJqjmOtaJGCoKAYqmafHo4zOdyqBVc0THuIz7gOSfDgsSntlbfPA0ZV5VbKu8+F45fyj93/y3XtO3PPyMw9dOvmDO4/vvu3ddz1y8txjTz61sm/3aDDIB5kxZnt76/Cb3v/8pWdZrGWjxWq6PV1/Zc/qUZIGhmHP6eYIhMbcTvcvAtwWKI/rBlqo09P8yijvw4YVaA8VHb8M6bbKImaySStgBOzQr2ZlXY+Wdi2u7Hv21KUsHxpSKFVZHzq07/bFF/DY/3otTv/yu+9c3rv/T+5/9Mkzk4/+/ud/5kO/Nd+YGmQippra1739/Xe879fOvXR5c6ucV2Y4XvauCpE4jlq0pxCXZYDg7JePUOI1aSymcUkd1RT1HiitG+MKUNRREjTMbDdWUXE+Cbd1ZQajQzfffur05sNPXRqPBouDbGGYD/Js/8GDr7391mq08qUHTn3xG6dv/7l/+u+/9Ngd7/3VfGHcVItoMR7I0sCa0cqs4LX1yfDA8b1HbmZd+U5R3UqpO04R+/64RaCtPDCQCFHc8nec9yAPd8SgKkn0eCSEOXQ1w9R1yuBM04rkXT//oUe/8Zc/fPL8+Usbxw4vLYwGs7J+Zb04c+7ayy9Pj776pn/z2d+78z0frstCRHbfeKK2kgHb03Lf3nHx6H1PnJnmi7svXLz285/4DZPndTGDydklQQM9qUsPcNoDRrbRiIDbd1s1AcFpYUivoqHEGivNBUZcT6c3OKKpNRnk4VzH2Zp8cN+nf+V7X/gzjIwxFpC6krKUPQeX7/3gx372Y58e71ut5lMhs+Four72Xz/ylo0Xz4z37Hrd0YXpZP7Sxe2iqN7wy//qA5/6rK2q3k4nj5sj+NPVHYTJBYa6chFEq/TkcrNYvdV3nfYGnT6k9aNIGEFfIocPmkka29AK1ta1CKv55IE//d2nHvzL7Y2rmTG79h44euebXv9zH7zx9jdVZWnrOhsMRaSuyizPnn/0e3/xB5+eXThja9bI9x254e5//ol3/Mv/0NbSjQmxJeG62WlqC9pxwzBnBh1GziufVYiI9Fk9Qi0tVCd1XAyLEuM5BG2zhy1kU4+pbV3Zqiznk2KyaYDt9cvbVy9DZDReXljeTQEpg4VxPhyZbCAArS3nE7Cerq+9eOqZydbm3kOrN9x6597VY9YyHy5k+bCRAwp0Za+vth4nqhJNxUFAGIn2iJ528WK2hFYGEgVKVB1pQ09fJ3cgiqixHmld/aqmrUlr66ouC5IIVeVGAtl02BpjMjWzQ2DMcGEpGw5FUJeFraqGOQw7pxRCECaEPONO+2j5KFE9MEAj6wBU400MqvkMbSxQEUD3i6TdT46QDap1MunZg6e6VNJON5EqoZf09raoWmtS1ASQ9k5N20xmrWqBRHTzffo6IFJ69omP1AEEhNaLzRrKP3dkjG+xYsztg4ya+nzOQCBtbUa3xQLKOGFJY9An8WTPuAWXMtC2omClWmh32jIx8ND+S5XANjOv4lY5MihApUenFBjqsPbewRvVXqGGqWijJqPjCYOopCiBmYFLVAUqRxKYTGztFAztwjUUs/KjDVsCAITAZJ4kobWsW8aZljAGWSbWRiOxlHKtUwfo1F3ZJ2d35EzMt1IEjVpZp8mxGBPoKFcj1QiTTgWYSKokUFUS/uCHP3zTPfcMBkOKmCxrwCRMRmuFFllOaxthQfOTuq7/9oEHz1+4sLK8smfvntXDq7fdfltdlibPGkf193/3d7feeuv+gwdsWalpe2oGmmcwHVb6CYqIiDcW0rboDPBMQ6JtZprfJL0wgFopJd6Nhkql0k6SJ08+XZUlsmxrc/OxRx7Z2p7MprNHH3nkypUrVVU9c/Lk2bNnL56/8PBDD12+dAlZJuTb771XRO65+679+/Y9/vjjT588WVt74eXzjzz8cDGfrexaGeS6qA7VSkLVXGfivd6xL0aighkTDZFxtT+rijM7zH8hozkZSF4HEcNYHSAiVM1Ty8vL2XAoYu//8pf/4cknvvrVr86L4tzLL//Nt7/93OnT3/3e9xYXFr7+9a+XVfk33/lOw7qNFhf37du7e++ehcWFLDNnz5790Y8eyvP8yaeeeuihH5+/cGEynfoGDVf0NXr2Fft66RGJszqdhow6HX2m2ZTvrSrHo8OsSCvP9QkgqOTRQZuF62h6KBDZ2trauHYtz/Nr6+vvuPfe8dL4sccfB1AU883NrRO33HL4yJFdu3bdfc9PPf3Ms1VZNkKf+XRWV3Uxnx+/+eb9+/c/8vDD82K+uLC4sblZVVVdV6HNqEWSlhKlKV0tXn/VntF4KJc5tRyhb5pp2vCzJlh2FSiI/H0L4F06riZw9Nm0K2rQ5PmRI0f+4q++curUc+9973ufefbZQZYvLy1VZXn40OHxeHzD6qqQx44dY129+pZbHEKQo686Ohzku3ft3rt79+LC6Objx8uiGA4HK8vLR46sjsdjB0qIiHWRWDNDVXyFkjlKnzTPRMkf2WCCZn5WjBrQziWgGkvX08qooBz8mDqGBUrhqQiyHACtbat+bTSkyYxYutaJTGwtzZ/NRzR/b0IHRQx8H48IxZLdRs6kzis909xiRQTjzm7lmiQULFDPZ6HYh4a0idu1FRDt6LKQ1k/p+zIiWBw1FiG0Wul2p2ZSnKUFDGkNfJSm8wOi27RaxBCKltSsZDIZ7bq9PB2m3t9+sy2eHKznM6F1JEVkyHDdtWEh0EFbDiumE6MiZVIy0y5tlkkGHqoZoQnDQYlHbuoFgR9YGwEaRoQI+2RSnWFC0ZhfOlwO5A0WdR9FJHQeXQ0VjjHuRl8yDBjpoD2m8gLNkwRNYUMAJFN7oQREJNMJWCRBJAOiVBuFEisyquFFVYmedjuEVW5ry3BpelAoI2KZFX0lfdNF/ThXkbju1Y3J6PSuMZkFiW4DiG4uJnsK7hJm34QSPJBsQ1IJi7Tc6Vw9NTlSDfwUtJS58d10Tvzi+w1NkApqt+BHKwnUXGPfzmIkmkJKvVDRANxQCY/qat4dJMcDfrqBGvUpOsFW2lEdtlNlaNpV2oGg4YcBb6ElthW+bKkbJq2vjLiNtsADf1NuiCt8dylDngGypz8k1BoZJsKGIZwRNkSkQ1Q4MxKtN71uSQNBjzjSDzrWTFSiD0T8StLNUTWKTHCTTsL4afSVdZrXWu9n2BXrkn0SwPQ8JDNL4XdIa3eCrqqrCXIn1ANG7NhkGp9CKuF78lvXtBF34DerkTvvZ13zHJnS653Oe+0zWsoHPYNFWyFLpDZVgzxVoNOkSlpKRzRFmMq969HcbsAKIWItgX6koNlAP141EtYk3HRkBLnmrlTEQU9umdYylCKaSeE3KJ5INfJAhypNPfvljig6FcTp240j9SETLgW66RH9A2A8vwKl51DaZYS7sK7CDKeiSUeMNsZVh9HgUF4iEjIjFpBHqL2nCObkcR3+uuvU+v0IlKyD0JdhFdJI0oYdJta09a5esqE9Z24uvvW2mMeZQRyqZKf2f4l50NTvCTszxxhrW5PZm77gCOmbpUIFTOMpsNIZuS/SP3C45yTrWS1EJFM0FAsXF4Fm0nJoGmiu2kLFX+eI4pIJYuFjz0xtptO4Im0sujquoBYnRGwrRUsfPABS+saRJ+NO0HNh9I8JsKI1tLoLJRKJCNrc2Y0zBCmS0/040kYnKZKejxGMIhnlLWkuyk4XAxImMgqGkbkyTn9l5zQvVEuo5jXuwH+m8wg63YCRFN7plByzksOhE7S67sacAlwCbGq3PQN8k85advqrkcrwGc+z1UPhgvoG120tdWvLfkpBLYFJIlLLR+nFc7UDBoxpkhkPuRMbO8gEz+SZmCW1LSEREpM4VeyOE0GnC4p9yq3uU0MQj9FMs9+OD4V7UknPyCK1Z2lLE7qAL/QWsKkGwD/ehWAu4upJjaSJLcnSFs5EmpQInrplGIgBRgKKTnVDzciAHnWEiI9g0lSDhFO/fgtSyqsFSSdCU4UGyEy67BH6vvzYbXjkyPBck+a5Fy18FKOf0hCXkpLsFAqPIBIgkjvQyoyKi8lgDonHo0UazM4/JX74iU/YAzGJ/nRexwRVvnZ5fFtZFPgRy3BsebsmoSuMKlfyysxW6pfOZXJPkGEffeoYG/RoTOJAKYwoCXSreohmfwdlBfvhcY8aivEjjSRZaHY5Ez3rMgTvBhagK9lFOxnFkXHopuxER9FG1QurB/SqO2qgoO6vC42yiEwnfbyLT+O7IcxRTInsNuSU+kkcSKwXLty1TSmKwW9JBYS5YHk7AraV0Ya2zX7rTdtZENU0qZxXCOfJpqKvUM50Ane3oYzsPFWKIiaSdfRWcHrUelEHZ6Q984xI85CiUAZti6xUigobP3aJbGrZ6WNZNPZhPCQpaEDiuqwaThqp5hJaGUEQSkYSldSdScTPedjJHp61o4ll2j4TLIqJelIUS5yTbaJNncR6ur3t6yBS2CIp585OJkF2niPEhDmIR/1Qw3klxGcq0oauhrh+ZI+bkv7n3jRRcVChQ9NJT5spezb68GaMHaAKfLoKYRhaTBDPx+AOMjGGbsTuZBvdCRjhz6RlQ3qY/ijx1kvZeTKFjomIKyTp0270JCg4aEk1K9tDkDZJMEieQaaCvW/6Ct4uzF9p46ySUccgK5500OHepOcBIEis1WE9eLVU8pQKPUg4zhDh6j7UZAk6jFM75D1WMBLh6z2T7o+hfrJQmFAUT910DzJyloSO/I8ppIL01D61Lo6x5+l73oJ4sh/oDE6O20qTmEC1begdJB5JCyi2xeMBO1BBZOOk3Q2o0v7Mj7FLTgLUcyIkYmNoLYBE8BNJvUSiAmCwDqNY9Vimwb7nSUGVLxKJAePBvxGs78o5GR4053y4hFK3ZdsM5FlJQVXMpe1hb98aC0cVJ64nAkZ2RYVqXS6KhB70SMJ0+jy9vNdfO7W6KiYO2CvxgCY8EFW/1RfZeFwWg1xBtRoG+BS6Wlr3/f8AYg0mIqnLgagAAAAASUVORK5CYII=" alt="Learn Thai" /></div>
            <h1>Thai Vocabulary</h1>
        </div>
        <p class="subtitle">Tap to flip  Swipe right for   Swipe left for </p>

        <div class="list-selector-container">
            <select class="list-selector" id="listSelector">
                <option value="0">List 1: Core Vocabulary (200 words)</option>
            </select>
            <div id="listProgressDisplay" style="text-align: center; margin-top: 8px; font-size: 0.9em; color: var(--text-primary); font-weight: 500;"></div>
        </div>

        <div class="app-mode-toggle">
            <button class="app-mode-btn active" data-appmode="flashcards"> Vocabulary</button>
            <button class="app-mode-btn" data-appmode="grammar"> Grammar</button>
        </div>

        <div class="top-controls">
            <button class="options-btn" id="optionsBtn"></button>
            <button class="settings-btn" id="settingsBtn"> Settings</button>
            <button class="stats-btn" id="statsBtn"> Stats</button>
        </div>

        <div class="session-controls">
            <button class="session-btn" id="restartBtn"> Restart</button>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" data-mode="all">All Cards</button>
            <button class="mode-btn" data-mode="review">To Review</button>
        </div>

        <div class="progress-container">
            <div class="progress-info">
                <span id="cardCounter">Card 1 of 200</span>
                <span id="progressPercent">1%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-milestones" id="progressMilestones">
                <div class="milestone" data-percent="0"></div>
                <div class="milestone" data-percent="25"></div>
                <div class="milestone" data-percent="50"></div>
                <div class="milestone" data-percent="75"></div>
                <div class="milestone" data-percent="100"></div>
            </div>
        </div>

        <div class="card-container">
            <button class="favorite-btn" id="favoriteBtn" title="Add to favorites"></button>
            <button class="audio-btn" id="audioBtn" title="Listen to pronunciation">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                </svg>
            </button>
            <div class="swipe-bar left" id="swipeBarLeft"></div>
            <div class="swipe-bar right" id="swipeBarRight"></div>
            <div class="swipe-hint left" id="swipeLeft"></div>
            <div class="swipe-hint right" id="swipeRight"></div>
            <div class="card" id="flashcard">
                <div class="card-face card-front">
                    <div class="mastery-indicator" id="masteryIndicator">New</div>
                    <div class="card-text" id="frontText"></div>
                    <div class="romanization" id="frontRomanization"></div>
                </div>
                <div class="card-face card-back">
                    <div class="card-text" id="backText"></div>
                    <div class="romanization" id="backRomanization"></div>
                </div>
            </div>
        </div>

        <div class="score-display">
            <span class="score-correct score-number" id="correctScore">0</span> correct  
            <span class="score-incorrect score-number" id="incorrectScore">0</span> incorrect
        </div>

        <div class="controls">
            <button class="btn-nav" id="prevBtn"> Prev</button>
            <button class="btn-flip" id="flipBtn">Flip</button>
            <button class="btn-nav" id="nextBtn">Next </button>
        </div>

        <div class="action-controls">
            <button class="btn-action" id="shuffleBtn"> Shuffle</button>
            <button class="btn-action" id="toggleBtn"> Thai Front</button>
            <button class="btn-action" id="sentenceBtn"> Example</button>
        </div>

        <div class="sentence-example" id="sentenceExample">
            <div class="sentence-thai" id="sentenceThai"></div>
            <div class="sentence-roman" id="sentenceRoman"></div>
            <div class="sentence-english" id="sentenceEnglish"></div>
            <button class="sentence-speak-btn" id="sentenceSpeakBtn"></button>
        </div>

        <!-- Grammar Lessons Section -->
        <div class="grammar-section" id="grammarSection" style="display: none;">
            <div class="grammar-header">
                <h2>Thai Grammar Patterns</h2>
                <p class="grammar-subtitle">Learn sentence structures through examples and practice</p>
            </div>
            
            <div class="grammar-lessons-list" id="grammarLessonsList">
                <!-- Lessons will be populated by JS -->
            </div>
            
            <!-- Active Lesson View -->
            <div class="grammar-lesson-view" id="grammarLessonView" style="display: none;">
                <button class="grammar-back-btn" id="grammarBackBtn"> Back to Lessons</button>
                
                <div class="lesson-content" id="lessonContent">
                    <!-- Lesson content populated by JS -->
                </div>
                
                <div class="lesson-nav">
                    <button class="btn-nav" id="lessonPrevBtn"> Previous</button>
                    <span class="lesson-progress" id="lessonProgress">1 / 4</span>
                    <button class="btn-nav" id="lessonNextBtn">Next </button>
                </div>
            </div>
            
            <!-- Practice Mode View -->
            <div class="grammar-practice-view" id="grammarPracticeView" style="display: none;">
                <div class="practice-header">
                    <button class="grammar-back-btn" id="practiceBackBtn"> Back</button>
                    <div class="practice-title">Build Sentences</div>
                    <div class="practice-score" id="practiceScore">0 / 0</div>
                </div>
                
                <div class="practice-content" id="practiceContent">
                    <!-- Practice content populated by JS -->
                </div>
                
                <div class="practice-nav">
                    <button class="btn-action" id="practiceNextBtn">Next Question </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" id="closeSettings"></button>
            </div>
            <div class="modal-section">
                <h3>Import Flashcards</h3>
                <div class="file-input-wrapper">
                    <input type="file" id="csvFileInput" accept=".csv" />
                    <label for="csvFileInput" class="file-input-label"> Choose CSV File</label>
                </div>
                <div class="import-info">CSV format: First column = Thai, Second column = English (with header row)</div>
            </div>
            <div class="modal-section">
                <h3>Data Management</h3>
                <button class="btn-action action-btn" id="exportBtn" onclick="exportProgress()"> Export Progress</button>
                <button class="btn-action action-btn" id="resetBtn" onclick="resetProgress()"> Reset All Progress</button>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Statistics</h2>
                <button class="close-btn" id="closeStats"></button>
            </div>
            <div class="modal-section">
                <h3>Current List Progress</h3>
                <div id="currentListStats"></div>
            </div>
            <div class="modal-section">
                <h3>All Lists</h3>
                <div id="allListsStats"></div>
            </div>
            <div class="modal-section">
                <h3>Session Stats</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="sessionCorrect">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="sessionIncorrect">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                </div>
            </div>
            <div class="modal-section" style="font-size: 0.85em; color: var(--text-secondary); line-height: 1.5;">
                <strong>Learning Algorithm:</strong> A word is marked as "learned" after getting it correct 3 times in a row. If not reviewed within 7 days, it needs to be relearned.
            </div>
        </div>
    </div>

    <!-- Resume Modal -->
    <div class="modal" id="resumeModal">
        <div class="modal-content resume-modal-content">
            <div class="modal-header" style="justify-content: center;">
                <h2>Session in Progress</h2>
            </div>
            <p>You have an unfinished session. Would you like to resume or start fresh?</p>
            <div class="session-info" id="sessionInfoDisplay">
                <div class="session-info-item">
                    <span class="session-info-label">List:</span>
                    <span class="session-info-value" id="resumeListName">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Progress:</span>
                    <span class="session-info-value" id="resumeProgress">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Correct:</span>
                    <span class="session-info-value score-correct" id="resumeCorrect">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Incorrect:</span>
                    <span class="session-info-value score-incorrect" id="resumeIncorrect">-</span>
                </div>
            </div>
            <div class="resume-buttons">
                <button class="btn-action" id="startFreshBtn" onclick="document.getElementById('resumeModal').classList.remove('open'); startFresh();">Start Fresh</button>
                <button class="btn-flip" id="resumeSessionBtn" onclick="document.getElementById('resumeModal').classList.remove('open'); resumeSession();">Resume</button>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="modal" id="completionModal">
        <div class="modal-content resume-modal-content">
            <div class="modal-header">
                <h2> List Complete!</h2>
                <button class="close-btn" id="closeCompletion"></button>
            </div>
            <p>Great job! You've finished all the cards in this list.</p>
            <div class="session-info">
                <div class="session-info-item">
                    <span class="session-info-label">Cards reviewed:</span>
                    <span class="session-info-value" id="completionTotal">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Correct:</span>
                    <span class="session-info-value score-correct" id="completionCorrect">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Incorrect:</span>
                    <span class="session-info-value score-incorrect" id="completionIncorrect">-</span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">Accuracy:</span>
                    <span class="session-info-value" id="completionAccuracy">-</span>
                </div>
            </div>
            <div class="resume-buttons" style="flex-direction: column; gap: 10px;">
                <button class="btn-flip" id="restartListBtn"> Start Again</button>
                <button class="btn-action" id="reviewHardestBtn"> Review Hardest Cards</button>
            </div>
        </div>
    </div>

    <!-- Options Panel -->
    <div class="modal" id="optionsModal">
        <div class="modal-content options-modal-content">
            <div class="modal-header">
                <h2>Options</h2>
                <button class="close-btn" id="closeOptions"></button>
            </div>
            
            <div class="option-group">
                <div class="option-label">List Organization</div>
                <div class="option-toggle-group">
                    <button class="option-toggle-btn active" data-view="themed">Themed</button>
                    <button class="option-toggle-btn" data-view="mixed">Mixed</button>
                </div>
            </div>
            
            <div class="option-group">
                <div class="option-label">Card Direction</div>
                <div class="option-toggle-group">
                    <button class="option-toggle-btn active" data-direction="thai">Thai  English</button>
                    <button class="option-toggle-btn" data-direction="english">English  Thai</button>
                </div>
            </div>
            
            <div class="option-group">
                <div class="option-row">
                    <div class="option-label">Show Romanization</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="romanizationToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="option-hint">Display phonetic pronunciation guide</div>
            </div>
            
            <div class="option-group">
                <div class="option-row">
                    <div class="option-label">Auto-play Audio</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoPlayToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="option-hint">Automatically speak Thai words</div>
            </div>
            
            <div class="option-group">
                <button class="btn-action" id="viewVocabListBtn" style="width: 100%;"> View Full Vocabulary List</button>
            </div>
        </div>
    </div>
    
    <!-- Vocab List Modal -->
    <div class="modal" id="vocabListModal">
        <div class="modal-content vocab-list-modal-content">
            <div class="modal-header">
                <h2>Vocabulary List</h2>
                <button class="close-btn" id="closeVocabList"></button>
            </div>
            <div class="vocab-list-controls">
                <select id="vocabListFilter" class="list-selector" style="margin-bottom: 10px;">
                    <option value="all">All Words</option>
                    <option value="current">Current List</option>
                </select>
            </div>
            <div class="vocab-list-container" id="vocabListContainer"></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // App settings
        let showRomanization = localStorage.getItem('thaiFlashcardsRomanization') === 'true';
        let smartReviewMode = localStorage.getItem('thaiFlashcardsSmartReview') === 'true';
        
        // Romanization lookup table (Thai to phonetic)
        const romanization = {
            // Animals & Nature
            "": "ma", "": "maew", "": "nk", "": "bplaa", "": "chang",
            "": "ling", "": "nguu", "": "wua", "": "mu", "": "gi",
            "": "bpt", "": "gp", "": "yung", "": "mt", "": "pi-sa",
            "": "dtn-mai", "": "dk-mai", "": "bai-mai", "": "ya",
            "": "bpa", "": "puu-ko", "": "me-nam", "": "t-lee",
            "": "g", "": "hat", "": "nam-dtk",
            
            // Food & Drinks
            "": "kao", "": "ki", "": "nom", "": "k-nm-bpang",
            "": "na", "": "gng", "": "bpuu", "": "mk",
            "": "pn-l-mai", "": "pk", "": "m-mang", "": "glay",
            "": "sm", "": "dtaeng-moo", "": "-ngn", "": "mang-kt",
            "": "t-rian", "": "lam-yai", "": "m-naao", "": "m-ka-tet",
            "": "dtaeng-gwaa", "": "g-lm", "": "kae-rt",
            "": "prk", "": "gr-tiam", "": "ha-hm",
            "": "gla", "": "nam-dtaan", "": "nam", "": "chaa",
            "": "gaa-fae", "": "bia", "": "lo", "": "nam-pn-l-mai",
            "": "nam-bplo", "": "nam-keng",
            
            // Cooking & Taste
            "": "tam-aa-han", "": "tt", "": "dtm", "": "nng",
            "": "yang", "": "p", "": "p-sm", "": "hn", "": "bprung",
            "": "san-p-sm", "": "sut", "": "wt-t-dp",
            "": "krang-tet", "": "krang-bprung",
            "": "rt-chat", "": "pt", "": "wan", "": "bprao",
            "": "kem", "": "km", "": "jt", "": "-ri",
            "": "mn", "": "hm", "": "grp", "": "nm",
            "": "keng", "": "nao", "": "st-mi", "": "sa",
            
            // Family & People
            "": "p", "": "me", "": "pi", "": "nng",
            "": "luk", "": "luk-chaai", "": "luk-sao",
            "": "bpu", "": "ya", "": "dtaa", "": "yaai",
            "": "lung", "": "bpa", "": "na", "": "aa",
            "": "sa-mii", "": "pan-r-yaa", "": "faen",
            "": "pan", "": "pan-ban", "": "kruu",
            "": "nk-rian", "": "m", "": "p-yaa-baan",
            "": "p-nk-ngaan", "": "jo-naai", "": "luk-ka",
            "": "pi-chaai", "": "pi-sao", "": "nng-chaai",
            "": "nng-sao", "": "bpu-ya", "": "dtaa-yaai",
            "": "lan", "": "pr",
            
            // Body & Health
            "": "ha", "": "pm", "": "na", "": "dtaa", "": "hu",
            "": "j-muk", "": "bpak", "": "fan", "": "ln",
            "": "k", "": "li", "": "ken", "": "m", "": "nu",
            "": "lng", "": "tng", "": "ka", "": "tao", "": "ko",
            "": "ha-jai", "": "lat", "": "gr-duk", "": "pu",
            "": "bpay", "": "bpat", "": "ai", "": "jaam", "": "ki",
            "": "jp", "": "bat-ple", "": "pe", "": "hai",
            "": "dtrat", "": "rk-sa", "": "yaa", "": "roong-p-yaa-baan",
            "": "k-gam-lang-gaai", "": "pk-pn",
            
            // Numbers & Time
            "": "nng", "": "sng", "": "sam", "": "si", "": "ha",
            "": "hk", "": "jt", "": "bpet", "": "go", "": "sp",
            "": "ri", "": "pan", "": "mn", "": "sen", "": "lan",
            "": "wan", "": "sp-daa", "": "dan", "": "bpii",
            "": "wan-ni", "": "prng-ni", "": "ma-waan",
            "": "chao", "": "bai", "": "yen", "": "kn",
            "": "tang", "": "tang-kn", "": "cha-moong",
            "": "naa-tii", "": "w-naa-tii", "": "naa-l-gaa",
            "": "wan-jan", "": "wan-ang-kaan", "": "wan-pt", "": "wan-p-r-ht",
            "": "wan-sk", "": "wan-so", "": "wan-aa-tt",
            "": "lew", "": "yang", "": "gam-lang", "": "j", "": "ki",
            "": "dtrong-wee-laa", "": "sai", "": "chi-wee-laa",
            "": "bpr-yt-wee-laa", "": "sa-wee-laa",
            
            // Colors & Descriptions
            "": "si", "": "si-daeng", "": "si-kao", "": "si-nam-ngn",
            "": "si-lang", "": "si-kao", "": "si-dam", "": "si-chom-puu",
            "": "si-mang", "": "si-tao", "": "si-sm", "": "si-fa",
            "": "say", "": "na-rk",
            "": "ch-lat", "": "s-at", "": "sk-g-bprk",
            "": "yi", "": "lk", "": "sung", "": "dta",
            "": "yaao", "": "sn", "": "gwang", "": "kep",
            "": "na", "": "baang", "": "go", "": "mi",
            "": "keng-raeng", "": "n-ae", "": "an", "": "pm",
            "": "paeng", "": "tuk", "": "nao", "": "rn",
            "": "rat-reo", "": "cha", "": "ngai", "": "yak",
            "": "mt", "": "s-wang", "": "ngap", "": "sang-dang",
            "": "s-dak", "": "yng-yak", "": "m-sm",
            "": "km-ka", "": "an-dt-raai", "": "bplt-pai",
            "": "rap-ri",
            
            // Emotions & Feelings
            "": "nay", "": "ba", "": "dtn-dtn",
            "": "gang-won", "": "pn-klaai", "": "bpr-lat-jai",
            "": "pt-wng", "": "puum-jai", "": "p-aai",
            "": "grot", "": "sa-jai", "": "dii-jai",
            "": "dtk-jai", "": "glua", "": "s-baai",
            "": "lam-bak", "": "s-nk", "": "na-ba",
            "": "na-glua", "": "hu", "": "m", "": "gr-hai",
            "": "kt-tng", "": "rk", "": "glat",
            "": "chp", "": "mi-chp", "": "wng", "": "cha",
            "": "sng-si", "": "sp-sn", "": "k-yn",
            "": "ki-gat", "": "ruay", "": "jon", "": "mii-ch-sang",
            
            // Basic Actions
            "": "dn", "": "wng", "": "gr-dot", "": "nng",
            "": "yn", "": "nn", "": "dtn", "": "dtn-nn",
            "": "glp", "": "maa", "": "bpai", "": "ko", "": "k",
            "": "kn", "": "long", "": "pan", "": "yt", "": "r",
            "": "rm", "": "jp", "": "bpt", "": "bpt", "": "chi",
            "": "s", "": "kai", "": "hi", "": "rp", "": "sng",
            "": "duu", "": "hn", "": "mng", "": "di-yin",
            "": "fang", "": "chim", "": "dom", "": "sm-pt",
            "": "kt", "": "ru-sk", "": "ko-jai", "": "jam",
            "": "lm", "": "rip", "": "la-cha", "": "reo",
            
            // Communication
            "": "put", "": "kui", "": "put-kui", "": "kui-gan",
            "": "lo", "": "-t-baai", "": "tam", "": "dtp",
            "": "bk", "": "chi-jaeng", "": "dtan", "": "sn-yaa",
            "": "goo-hk", "": "ne-nam", "": "dtt-dt",
            "": "bpr-gat", "": "an", "": "kan",
            "": "s-wt-dii", "": "kp-kun", "": "k-tot",
            "": "mi-bpen-rai", "": "chay-di-mi",
            "": "mi-ko-jai", "": "put-cha-cha",
            
            // Education & Learning
            "": "sn", "": "rian", "": "jt", "": "sk-sa",
            "": "sp", "": "dtk", "": "tp-tuan",
            "": "p-yaa-yaam", "": "fk-fn",
            "": "tam-ngaan-ban", "": "gaan-ban", "": "bp-rin-yaa",
            "": "wt-t-yaa-lai", "": "m-ha-wt-t-yaa-lai",
            "": "roong-rian", "": "hng-rian", "": "hng-s-mt",
            "": "s-nam-gii-laa", "": "nng-s",
            "": "bpak-gaa", "": "din-s", "": "gr-dat",
            "": "gan-grai", "": "gaao", "": "kwaam-ru",
            "": "bpr-sp-gaan",
            
            // Home & Furniture
            "": "ban", "": "hng", "": "hng-nn",
            "": "hng-krua", "": "hng-nam",
            "": "hng-nng-ln", "": "bpr-dtuu",
            "": "na-dtang", "": "pn", "": "p-nng",
            "": "lng-kaa", "": "ban-dai", "": "go-i",
            "": "dt", "": "dtiang", "": "dtu", "": "dtu-yen",
            "": "ae", "": "pt-lom", "": "gun-jae",
            "": "pa-hm", "": "mn", "": "ti-nn",
            "": "pa-bpuu-ti-nn", "": "gr-jk",
            "": "pa-cht-dtua",
            
            // Clothing & Accessories
            "": "sa", "": "gaang-geeng", "": "gr-bproong",
            "": "rng-tao", "": "tng-tao", "": "mak",
            "": "wen-dtaa", "": "gr-bpo", "": "rm",
            "": "wen", "": "si", "": "si-tng", "": "pt",
            "": "dteng-dtua", "": "sk", "": "km-kt",
            "": "dtak", "": "naa-l-gaa-k-m", "": "tk",
            
            // Travel & Transport
            "": "rt-tek-si", "": "rt-dtu", "": "rt-bt",
            "": "rt-fai", "": "rt-fai-fa", "": "ra",
            "": "krang-bin", "": "s-nam-bin",
            "": "s-ta-nii", "": "bpai-rt-mee",
            "": "dta", "": "s-dta", "": "kn-rt",
            "": "long-rt", "": "bpai-ni", "": "tng",
            "": "lao-sai", "": "lao-kwa",
            "": "dtrong-bpai", "": "cha-ni",
            "": "reo-ni", "": "ti-ni", "": "ti-nn",
            "": "gli", "": "glai", "": "lng", "": "pen-ti",
            "": "ti-yu", "": "t-nn", "": "si",
            "": "s-paan", "": "roong-raem", "": "hng-pk",
            "": "jng", "": "yk-lk", "": "chk-in",
            "": "chk-ao", "": "nng-s-dn-taang",
            "": "wii-sa",
            
            // Places & Sights
            "": "wt", "": "pr-pt-t-rup", "": "p-pt-t-pan",
            "": "san-sa-taa-r-n", "": "san-st",
            "": "dt-lat", "": "ran-ka",
            "": "hang-sp-p-sn-ka", "": "ran-aa-han",
            "": "t-naa-kaan", "": "p-ft", "": "b-r-st",
            
            // Weather & Seasons
            "": "aa-gat", "": "fn", "": "fn-dtk", "": "det",
            "": "lom", "": "mek", "": "fa", "": "paa-y",
            "": "fa-pa", "": "fa-rng", "": "nam-tam",
            "": "chn", "": "heng", "": "mk",
            "": "aa-gat-dii", "": "aa-gat-ye",
            "": "rn-jt", "": "nao-jt", "": "p-ao",
            "": "r-duu", "": "r-duu-fn", "": "r-duu-rn",
            "": "r-duu-nao", "": "un-h-puum", "": "ong-sa",
            "": "lok", "": "duang-aa-tt", "": "duang-jan",
            "": "daao", "": "tng-fa",
            
            // Shopping & Money
            "": "raa-kaa", "": "ngn", "": "bat",
            "": "lek-ngn", "": "bt-kree-dt",
            "": "ngn-st", "": "bai-st", "": "kng-kwn",
            "": "kng-ti-r-lk", "": "to-ri",
            "": "paeng-gn-bpai", "": "lt-ni",
            "": "hng-nam-yu-ni", "": "mee-nuu",
            "": "sng-aa-han", "": "chk-bin", "": "tp",
            "": "mi-ao-nam-dtaan", "": "mi-ao-nam-keng",
            "": "bpr-yt", "": "lak", "": "dtt-sn-jai",
            "": "beng-bpan", "": "bprap-tap",
            
            // Work & Business
            "": "tam-ngaan", "": "ngaan", "": "aa-chip",
            "": "ngn-dan", "": "bpr-chum",
            "": "nt-mai", "": "sm-pat", "": "s-mk",
            "": "sen", "": "pim", "": "sng-ii-meo",
            "": "too", "": "raai-ngaan", "": "ek-g-san",
            "": "sm-nao", "": "dtn-ch-bp", "": "bep-fm",
            "": "bai-s-mk", "": "bt-bpr-chaa-chon",
            "": "bai-kp-ki", "": "bpr-gan", "": "paa-si",
            "": "ka-chi-jai", "": "ngp-bpr-maan",
            "": "gam-rai", "": "kat-tun", "": "ni",
            "": "dk-ba", "": "ban-chii", "": "ban-chii-t-naa-kaan",
            "": "fak", "": "fak-ngn", "": "tn-ngn", 
            "": "oon", "": "oon-ngn",
            "": "gu-ngn", "": "jai",
            
            // Technology
            "": "too-r-tt", "": "too-r-sp",
            "": "m-t", "": "km-piw-dt",
            "": "in-t-nt", "": "r-ht", "": "k-kwaam",
            "": "rup-pap", "": "w-dii-oo", "": "pleeng",
            "": "nng-s-pim", "": "nt-dt-y-san",
            "": "bet-dt-ri", "": "na-j", "": "bplk",
            "": "s-wt", "": "fai-fa", "": "lt-fai",
            "": "tian", "": "fai-chai", "": "glng",
            "": "j", "": "lam-poong", "": "hu-fang",
            "": "mo", "": "kii-bt", "": "krang-pim",
            "": "geem", "": "ep", "": "wp-sai",
            "": "wai-fai", "": "sn-yaan", "": "daao-lot",
            "": "p-lot", "": "bpt-krang",
            "": "bpt-krang", "": "chat", "": "tai-rup",
            "": "ban-tk", "": "lp", "": "kt-lk",
            "": "kn-ha",
            
            // Entertainment & Sports
            "": "kao", "": "kot-s-naa", "": "l-kn",
            "": "pap-p-yon", "": "gaa-dtuun", "": "raai-gaan",
            "": "chng", "": "rng", "": "dtn", "": "ln",
            "": "ch-n", "": "keng-kn", "": "keng", "": "gii-laa",
            "": "ft-bn", "": "bat-gt-bn",
            "": "wn-lee-bn", "": "wai-nam",
            "": "bpn-jk-gr-yaan", "": "dtii-gp",
            "": "muay", "": "yoo-k", "": "nat", "": "s-bpaa",
            
            // Personal Care
            "": "dtt-pm", "": "tam-pm", "": "ym-pm",
            "": "goon", "": "dteng-na", "": "taa-lp-s-dtk",
            "": "nam-hm", "": "s-bu", "": "chaem-puu",
            "": "kriim", "": "yaa-si-fan", "": "bpraeng-si-fan",
            "": "wi", "": "dai-bpo-pm",
            "": "krang-goon-nat",
            "": "gan-grai-dtt-lp", "": "lang",
            "": "sm", "": "dtriam-dtua", "": "bplan-bplaeng",
            
            // Household Chores
            "": "gwat", "": "cht", "": "kt",
            "": "lang-jaan", "": "tam-kwaam-s-at",
            "": "jt-hng", "": "bpluk", "": "rt-nam",
            "": "gp-gao", "": "kt", "": "sang",
            "": "tam-laai", "": "ge-ki", "": "bprp-bprung",
            "": "pt-t-naa", "": "k-bep", "": "wat",
            "": "r-baai",
            
            // Abstract & Concepts
            "": "chok-dii", "": "chok-rai", "": "kwaam-fn",
            "": "kwaam-jing", "": "kwaam-lp", "": "bpan-ha",
            "": "kam-dtp", "": "kam-tam", "": "het-pn",
            "": "kwaam-kt", "": "kwaam-sm-rt",
            "": "kwaam-lm-lo", "": "oo-gat", "": "taang",
            "": "taang-lak", "": "bpo-mai", "": "pen",
            "": "gt", "": "gt-mai", "": "st-t",
            "": "na-ti", "": "ae-t",
            
            // Physical Actions
            "": "kn", "": "ym", "": "hi-ym",
            "": "gp", "": "tng", "": "ha", "": "pp", "": "j",
            "": "yek", "": "ruam", "": "pm", "": "lt",
            "": "k-yai", "": "y", "": "dng", "": "dan",
            "": "yk", "": "waang", "": "kwen", "": "puk",
            "": "ge", "": "h", "": "pp", "": "dtt",
            
            // New verbs
            "": "ao", "": "yak", "": "dtng", "": "di",
            "": "bpen", "": "mii", "": "yu", "": "tam",
            "": "gin", "": "dm", "": "nn-lp",
            "": "chay", "": "lng", "": "ru",
            
            // Question words & expressions
            "": "-rai", "": "tam-mai", "": "yang-rai",
            "": "yang-ngai", "": "ma-ri", "": "gi",
            "": "krai", "": "di-li", "": "mi-ao",
            "": "mi-ru", "": "mi-mii", "": "st",
            "": "dao", "": "dao-gn",
            
            // Time expressions
            "": "dtn-ni", "": "gn", "": "lng",
            "": "bi", "": "s-m", "": "mi-ki",
            "": "tan-tii", "": "ik", "": "to-nn",
            "": "lew-g",
            
            // Grammar & Particles
            "": "dte", "": "le", "": "r", "": "pr",
            "": "ta", "": "g", "": "day", "": "li",
            "": "n", "": "krp", "": "k", "": "k",
            "": "mi", "": "s", "": "r",
            "": "chn", "": "pm", "": "kun", "": "ko",
            "": "rao", "": "man", "": "ni", "": "nn",
            "": "non", "": "kng", "": "ti",
            "": "mi", "": "chi", "": "mi-chi",
            "": "p", "": "mak", "": "ni",
            "": "tk", "": "baang", "": "ke", "": "eeng",
            
            // Misc
            "": "pe",
            
            // Common Phrases
            "": "s-baai dii mi",
            "": "s-baai dii",
            "": "mi s-baai",
            "": "mi j gan naan",
            "": "yin-dii ti di ru-jk",
            "": "gin kao r yang",
            "": "gin lew",
            "": "yang mi gin",
            "": "wa ngai",
            "": "bpen yang-ngai bang",
            "": "lew j gan",
            "": "j gan prng-ni",
            "": "chok dii n",
            "": "yin-dii day",
            "": "sk-sn wan-gt",
            "": "k hi chok dii",
            "": "lew dte kun",
            "": "chang man t",
            "": "jing r",
            "": "mi mii taang",
            "": "ne-nn",
            "": "ko-jai lew",
            "": "r sk kru",
            "": "dtaam s-baai",
            "": "chn",
            "": "k-tot tii",
            "": "mi dtng hang",
            "": "r-wang n",
            "": "nay mi",
            "": "hu mi",
            "": "rn mak",
            "": "fn dtk lew",
            "": "ao -rai dii",
            "": "-ri mak",
            "": "to mi",
            "": "s-nk mi",
            "": "mi di j gan naan li",
            "": "kt-tng n",
            "": "j gan mi n",
            "": "tam ngai dii",
            "": "mi dtng greeng-jai",
            "": "rang lk",
            "": "glp ban gn n",
            "": "wi j gan n",
            "": "r-wang dtuua day n",
            "": "pk-pn hi dii n",
            "": "hai reo reo n",
            "": "dn-taang bplt-pai",
            "": "ya lm n",
            "": "ko-jai mi",
            "": "put ik tii di mi",
            "": "mi bpen rai",
            "": "ngn g di",
            "": "ne-jai r",
            "": "tam di",
            
            // Development & International
            "": "gaan-pt-t-naa",
            "": "gaan-pt-t-naa ti yng-yn",
            "": "kwaam yng-yn",
            "": "s-h-bpr-chaa-chat",
            "": "ong-gn",
            "": "ong-gn r-wang bpr-tet",
            "": "bpo-mai",
            "": "n-yoo-baai",
            "": "kroong-gaan",
            "": "kwaam ram-m",
            "": "kwaam chay-la",
            "": "ngn-tun",
            "": "ngp-bpr-maan",
            "": "kwaam yak-jon",
            "": "kwaam lam-lm",
            "": "sng-wet-lm",
            "": "gaan-bplan-bplaeng s-pap puum-aa-gat",
            "": "p-lang-ngaan mn-wian",
            "": "p-lang-ngaan s-at",
            "": "gaan-sk-sa",
            "": "sa-taa-r-n-sk",
            "": "st-t-m-nt-s-y-chon",
            "": "kwaam to-tiam",
            "": "kwaam to-tiam taang pet",
            "": "chum-chon",
            "": "bpr-chaa-chon",
            "": "pu mii san-di san-sa",
            "": "pak bpr-chaa-sng-kom",
            "": "pak ek-g-chon",
            "": "pak rt",
            "": "rt-t-baan",
            "": "gr-suang",
            "": "bpr-tet gam-lang pt-t-naa",
            "": "bpr-tet pt-t-naa lew",
            "": "sp-p-yaa-gn",
            "": "sp-p-yaa-gn tam-m-chat",
            "": "nam s-at",
            "": "s-ka-p-baan",
            "": "kroong-sang pn-tan",
            "": "gaan-bpr-chum",
            "": "k-dtk-long",
            "": "sn-t-sn-yaa",
            "": "gaan-jee-r-jaa",
            "": "dtuua-chi-wt",
            "": "gaan-dtt-dtaam",
            "": "gaan-bpr-mn-pn",
            "": "raai-ngaan",
            "": "k-muun",
            "": "w-jai",
            "": "n-wt-dt-gam",
            "": "tk-noo-loo-yii",
            "": "d-j-tan",
            "": "pu li-pai",
            "": "gaan yai tn",
            "": "m-nt-s-y-tam",
            "": "pai-p-bt",
            "": "chk-chn",
            "": "gaan fn-fuu",
            "": "kwaam mn-kong",
            "": "sn-dt-pap"
        };
        
        // GRAMMAR LESSONS
        const grammarLessons = [
            {
                id: "mae-wa",
                title: "Even though...",
                structure: "......",
                structureRoman: "me wa ... g ...",
                structureEnglish: "Even though [A], still [B]",
                description: "Express contrast: something happens despite another condition.",
                explanation: `<p><strong>What it means:</strong> This pattern lets you say that something happens <em>despite</em> a condition that might normally prevent it. It's like saying "even though X is true, Y still happens anyway."</p>

<p><strong>The two key words:</strong></p>
<p> <strong></strong> (me wa) = "even though"  introduces the obstacle or condition<br>
 <strong></strong> (g) = "still/anyway"  introduces what happens regardless</p>

<p><strong>Why  is essential:</strong> In English, we often drop "still" ("Even though it's raining, I go to work"). In Thai, you <em>need</em> the   it's the glue that makes the contrast work. Without it, the sentence feels incomplete to Thai ears.</p>

<p><strong>Word order:</strong></p>
<p style="margin-left:20px;font-family:monospace;"> + [condition/obstacle] +  + [what happens anyway]</p>

<p><strong>Shortcuts in casual speech:</strong></p>
<p> You can drop  and just say <strong></strong>  very common in everyday Thai<br>
 The subject often comes after :  <strong></strong> (Even though it's raining, <strong>I still</strong> go)</p>

<p><strong>Common mistakes to avoid:</strong></p>
<p>  Using  (but) instead of   "<em></em>" sounds wrong<br>
  Forgetting  entirely  the sentence will feel unfinished<br>
  Putting  at the end  it needs to come <em>before</em> the verb/action</p>

<p><strong>Similar patterns:</strong> ()... is almost identical but slightly more emphatic (covered in next lesson).</p>

<p><strong>When to use it:</strong> Anytime you want to express doing something despite difficulties, continuing despite obstacles, or when the outcome defies expectations.</p>`,
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa fn dtk g bpai tam-ngaan",
                        english: "Even though it's raining, (I) still go to work"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa nay g dtng tam dt",
                        english: "Even though tired, (I) still have to continue"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa paeng g yak s",
                        english: "Even though it's expensive, (I) still want to buy it"
                    },
                    {
                        thai: "<span class='highlight'></span> <span class='highlight'></span>",
                        roman: "me mi hu chn g gin di",
                        english: "Even though I'm not hungry, I can still eat"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "me wa ko j mi chp g dtng tam",
                        english: "Even though he doesn't like it, (he) still has to do it"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'Even though I'm busy, I still help you'?",
                    hint: "busy =  (yng), help =  (chay)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "... is the correct pattern.  means 'but' (simple contrast),  means 'if' (conditional), and  means 'because' (cause)."
                }
            },
            {
                id: "tung-mae",
                title: "Although / Even if",
                structure: "()......",
                structureRoman: "tng me (wa) ... g ...",
                structureEnglish: "Although [A], still [B]",
                description: "A more emphatic version of , often translated as 'even if'.",
                explanation: `<p><strong>What it means:</strong> This pattern works just like ... but with extra emphasis. While  is "even though,"  leans more toward "even if"  it often implies the condition is hypothetical or extreme.</p>

<p><strong>Breaking it down:</strong></p>
<p> <strong></strong> (tng) = "even/to the point of"  adds emphasis<br>
 <strong></strong> (me) = "though/although"<br>
 <strong></strong> (wa) = optional softener, often dropped<br>
 <strong></strong> (g) = "still/anyway"  required, just like with </p>

<p><strong>The nuance:</strong> Think of  as adding "even" to make things more emphatic:</p>
<p style="margin-left:20px;">  = "Even though it's raining" (it IS raining)<br>
  = "Even if it rains" (maybe it will, maybe it won't)</p>

<p><strong>Common variations:</strong></p>
<p> <strong></strong>  full form, slightly formal<br>
 <strong></strong>  most common in everyday speech<br>
 <strong>...</strong>  shortest form, casual: </p>

<p><strong>The  particle:</strong> You'll often see  (will/would) after   this reinforces the hypothetical feeling: <em></em> = "even if it were to be difficult"</p>

<p><strong>When to use  vs :</strong></p>
<p> Use <strong></strong> for situations that are definitely true<br>
 Use <strong></strong> when emphasizing despite extreme conditions, or for hypotheticals<br>
 In practice, Thai speakers often use them interchangeably  you won't be wrong either way</p>

<p><strong>Real-world usage:</strong>  is popular for expressing determination: "Even if it's hard, I'll do it" or resilience: "Even if things go wrong, it'll be okay."</p>`,
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me j yak g dtng lng",
                        english: "Even if it's difficult, (I) still have to try"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me wa mi mii ngn g mii kwaam-sk",
                        english: "Even though (I) don't have money, (I'm) still happy"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me ko mi maa g mi bpen rai",
                        english: "Even if he doesn't come, it's still okay"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng j paeng g s",
                        english: "Even if it's expensive, (I'll) still buy it"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "tng me wa j nay mak g mi ym pe",
                        english: "Even though (I'm) very tired, (I) won't give up"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "What's the difference between  and ?",
                    options: [
                        { text: " is slightly more emphatic, like 'even if'", correct: true },
                        { text: "They have completely different meanings", correct: false },
                        { text: " is more formal", correct: false },
                        { text: " is only for future events", correct: false }
                    ],
                    explanation: "Both express contrast ('despite X, still Y'), but  adds emphasis with  ('even/to the point of'). It's often used for hypotheticals or to stress determination. In everyday speech, they're largely interchangeable."
                }
            },
            {
                id: "tae-wa",
                title: "But / However",
                structure: "()",
                structureRoman: "dte (wa)",
                structureEnglish: "[A], but [B]",
                description: "Simple contrast connector. '' makes it slightly softer.",
                explanation: "'' is the basic word for 'but'. Adding '' softens it slightly and is often used when explaining or giving a reason. In casual speech, '' alone is most common.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "yak bpai dte mi mii wee-laa",
                        english: "Want to go but don't have time"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "aa-han -ri dte wa paeng mak",
                        english: "The food is delicious, but it's very expensive"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko gng dte ki-gat",
                        english: "He's talented but lazy"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "Complete: ' ___ ' (I like coffee but don't like tea)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " is the simple connector for 'but' in contrasting statements"
                }
            },
            {
                id: "pror-wa",
                title: "Because",
                structure: "()......",
                structureRoman: "pr (wa) ... g li ...",
                structureEnglish: "Because [A], so [B]",
                description: "Shows cause and effect. '' introduces the result.",
                explanation: "'' means 'because' and introduces the reason. '' (g li) introduces the result/consequence and means 'so' or 'therefore'. You can use just '' for a shorter version.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "pr fn dtk g li mi bpai",
                        english: "Because it's raining, so (I) don't go"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "pr wa hu li gin kao",
                        english: "Because (I'm) hungry, so (I) eat"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "pr ko chay g li st reo",
                        english: "Because he helped, so (it) finished quickly"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'Because I'm tired, I sleep' - which pattern?",
                    hint: "tired = , sleep = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "... shows cause (tired) and effect (sleep)"
                }
            },
            {
                id: "taa",
                title: "If... then",
                structure: "......",
                structureRoman: "ta ... g ...",
                structureEnglish: "If [A], then [B]",
                description: "Conditional statements - if something happens, then something else follows.",
                explanation: "'' (ta) means 'if' and introduces the condition. '' introduces the result. The '' is often optional in casual speech but adds clarity.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ta mii wee-laa g bpai tao",
                        english: "If (I) have time, then (I'll) go travel"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ta hu g gin li",
                        english: "If (you're) hungry, then just eat"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ta fn dtk g mi dtng bpai",
                        english: "If it rains, then (you) don't have to go"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'If you're free, call me' - which word means 'if'?",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " (ta) is the standard word for 'if' in conditional sentences"
                }
            },
            {
                id: "ying-ying",
                title: "The more... the more",
                structure: "......",
                structureRoman: "yng ... yng ...",
                structureEnglish: "The more [A], the more [B]",
                description: "Shows that as one thing increases, another thing also increases.",
                explanation: "This pattern shows proportional change. The first '' introduces what increases, and the second '' introduces what also increases as a result. Very useful for comparisons!",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yng rian yng gng",
                        english: "The more (you) study, the better (you) get"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yng gin yng hu",
                        english: "The more (I) eat, the more hungry (I get)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yng ru yng mi ko-jai",
                        english: "The more (I) know, the less (I) understand"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'The more you practice, the better you get' uses which pattern?",
                    options: [
                        { text: "......", correct: true },
                        { text: "......", correct: false },
                        { text: "......", correct: false },
                        { text: "......", correct: false }
                    ],
                    explanation: "... shows proportional increase - the more X, the more Y"
                }
            },
            {
                id: "gwa",
                title: "More than / -er",
                structure: "...",
                structureRoman: "... gwa",
                structureEnglish: "[A] is more [X] than [B]",
                description: "Comparison - saying something is more than something else.",
                explanation: "'' comes AFTER the adjective to make it comparative. Unlike English where we say 'bigger than', Thai puts the comparison word after: 'big + '. Simple and consistent!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "wan-ni rn gwa ma-waan",
                        english: "Today is hotter than yesterday"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "an-ni dii gwa",
                        english: "This one is better"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko sung gwa pm",
                        english: "He is taller than me"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'This is cheaper' - where does  go?",
                    hint: "cheap = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " always comes after the adjective:  (cheap) +  = cheaper"
                }
            },
            {
                id: "tee-sut",
                title: "The most / -est",
                structure: "...",
                structureRoman: "... ti-st",
                structureEnglish: "[A] is the most [X]",
                description: "Superlative - saying something is the most or best.",
                explanation: "'' comes AFTER the adjective to make it superlative. It means 'the most' or '-est'. Very easy to use - just add it after any adjective!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "an-ni dii ti-st",
                        english: "This one is the best"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko gng ti-st nai hng",
                        english: "He is the best in the room"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "wan-ni rn ti-st",
                        english: "Today is the hottest"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'She is the most beautiful' - which is correct?",
                    hint: "beautiful = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " always comes after the adjective:  (beautiful) +  = most beautiful"
                }
            },
            {
                id: "gam-lang",
                title: "Currently doing",
                structure: "...",
                structureRoman: "gam-lang ... yu",
                structureEnglish: "[I] am [verb]-ing",
                description: "Shows an action in progress right now. Like English '-ing'.",
                explanation: "'' before the verb and '' after the verb indicate ongoing action. You can use just '' or just '', but using both is most complete. '' is often dropped in casual speech.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "gam-lang gin kao yu",
                        english: "(I) am eating (right now)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ko gam-lang nn yu",
                        english: "He is sleeping (right now)"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gam-lang tam-ngaan",
                        english: "(I) am working"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'I am studying right now' - which pattern shows ongoing action?",
                    hint: "study = ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "... wraps around the verb to show ongoing action"
                }
            },
            {
                id: "laew",
                title: "Already / Completed",
                structure: "...",
                structureRoman: "... lew",
                structureEnglish: "[I] already [verb]ed",
                description: "Shows that something has already happened or is now complete.",
                explanation: "'' is very versatile! It can mean 'already', show completion, or indicate a change of state ('now'). It always comes at the end of the phrase. One of the most common words in Thai!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin kao lew",
                        english: "(I) already ate / (I've) finished eating"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko-jai lew",
                        english: "(I) understand now / Got it"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bpai lew",
                        english: "(He) already went / Gone already"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "'I already finished' uses which word?",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " at the end shows completion or 'already'"
                }
            },
            {
                id: "yang-mai",
                title: "Not yet",
                structure: "......()",
                structureRoman: "yang ... mi ... (li)",
                structureEnglish: "[I] haven't [verb]ed yet",
                description: "Expresses that something has not happened yet, often implying it will happen later.",
                explanation: "'' means 'still' or 'yet'. Combined with '' (not), it creates 'not yet'. Adding '' at the end emphasizes that it really hasn't happened at all. This is the opposite of '' (already).",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "yang mi dai gin",
                        english: "(I) haven't eaten yet"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span><span class='highlight'></span>",
                        roman: "yang mi ko-jai li",
                        english: "(I) don't understand at all yet"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ko yang mi maa",
                        english: "He hasn't come yet"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I haven't finished yet'?",
                    hint: "finished =  (st)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = haven't [verb]ed yet"
                }
            },
            {
                id: "koey",
                title: "Have ever / Used to",
                structure: "...()",
                structureRoman: "ki ... (maa) gn",
                structureEnglish: "[I] have [verb]ed before / used to [verb]",
                description: "Expresses past experience - something you have done at some point in your life.",
                explanation: "'' indicates past experience. It's like 'have ever' in English. You can add '' (before) for emphasis. For negative, use '' (have never). This is very common when asking about experiences.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ki bpai mang thai mi",
                        english: "Have you ever been to Thailand?"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "ki gin t-rian maa gn",
                        english: "(I) have eaten durian before"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "mi ki hn maa gn li",
                        english: "(I've) never seen (it) before at all"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you ask: 'Have you ever eaten this?'?",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb +  = Have you ever [verb]ed?"
                }
            },
            {
                id: "ja",
                title: "Will / Going to",
                structure: "...",
                structureRoman: "j ...",
                structureEnglish: "[I] will [verb] / going to [verb]",
                description: "Expresses future actions or intentions.",
                explanation: "'' is placed before the verb to indicate future tense or intention. Thai doesn't conjugate verbs, so this word is essential for showing future. It's one of the most important grammar words!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "pm j bpai prng-ni",
                        english: "I will go tomorrow"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "j gin -rai",
                        english: "What will (you) eat? / What are you going to eat?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "ko j mi maa",
                        english: "He won't come / He's not going to come"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I will buy this'?",
                    hint: "buy =  (s)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = will [verb]"
                }
            },
            {
                id: "dai-mai",
                title: "Can / Able to",
                structure: "... / ...",
                structureRoman: "... dai mi / dai ... mi",
                structureEnglish: "Can [I/you] [verb]?",
                description: "Used to ask permission or ability. '' means 'can' or 'able to'.",
                explanation: "'' shows ability or possibility. To ask 'Can you...?', add '' at the end. For statements, '' can come before or after the verb. '' means 'cannot'. This is extremely common in daily Thai!",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "put thai dai mi",
                        english: "Can you speak Thai?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin pt dai",
                        english: "(I) can eat spicy food"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bpai mi dai",
                        english: "(I) can't go"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you ask: 'Can you help me?'?",
                    hint: "help =  (chay)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "verb +  = Can you [verb]?"
                }
            },
            {
                id: "tong",
                title: "Must / Have to",
                structure: "...",
                structureRoman: "dtng ...",
                structureEnglish: "[I] must [verb] / have to [verb]",
                description: "Expresses necessity or obligation.",
                explanation: "'' is placed before the verb to show that something is necessary or required. '' means 'don't have to' (not required). For prohibition, use '' instead.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "dtng bpai dtn-ni",
                        english: "(I) have to go now"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "mi dtng gang-won",
                        english: "(You) don't have to worry"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "kun dtng put paa-sa thai",
                        english: "You must speak Thai"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I have to work'?",
                    hint: "work =  (tam-ngaan)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = must/have to [verb]"
                }
            },
            {
                id: "yaak",
                title: "Want to",
                structure: "...",
                structureRoman: "yak ...",
                structureEnglish: "[I] want to [verb]",
                description: "Expresses desire to do something.",
                explanation: "'' means 'want to' and is used before verbs. For wanting objects, use '' (want/take) or '' (need/want - more formal). '' = 'don't want to'.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "yak gin kao",
                        english: "(I) want to eat rice"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "yak bpai tao",
                        english: "(I) want to go out / travel"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "mi yak tam-ngaan",
                        english: "(I) don't want to work"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you say: 'I want to learn Thai'?",
                    hint: "learn =  (rian)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: " + verb = want to [verb]"
                }
            },
            {
                id: "hai",
                title: "Using  (give/let/for/make)",
                structure: "...",
                structureRoman: "hi ...",
                structureEnglish: "give / let / for / make / to",
                description: "One of the most versatile Thai words with 5 main uses.",
                explanation: "'' has 5 main uses: 1) GIVE:  (give money), 2) LET/ALLOW:  (Mom doesn't let [me] go), 3) CAUSATIVE (make/have):  (have him do it), 4) FOR BENEFIT:  (do it for you), 5) ADVERB MARKER:  (do it well/properly). When  comes at the END of a phrase with an adjective, it means 'properly' or 'make sure to' - e.g.,  (eat until full),  (sleep well).",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "hi ngn ko",
                        english: "Give (him) money [GIVE]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "me mi hi bpai",
                        english: "Mom doesn't let (me) go [LET/ALLOW]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bk hi ko maa",
                        english: "Tell him to come [CAUSATIVE]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "tam hi kun",
                        english: "Do it for you [FOR BENEFIT]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "tam hi dii",
                        english: "Do it well/properly [ADVERB]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin hi m",
                        english: "Eat until full [RESULT]"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "What does '' mean?",
                    hint: " (nn) = sleep,  (lp) = asleep",
                    options: [
                        { text: "Sleep well/properly", correct: true },
                        { text: "Give sleep", correct: false },
                        { text: "Let someone sleep", correct: false },
                        { text: "Sleeping for you", correct: false }
                    ],
                    explanation: "Verb +  + adjective = do the action properly/until that state.  = sleep until properly asleep"
                }
            },
            {
                id: "polite-request",
                title: "Polite Requests",
                structure: "...  /",
                structureRoman: "... ni di mi krp/k",
                structureEnglish: "Could you [verb] please?",
                description: "The polite way to make requests in Thai using  and .",
                explanation: "To make a polite request in Thai, use: [verb] +  (a little/please) +  (can you?) + / (polite particle). '' softens the request, '' asks permission, and '/' adds politeness. You can also use just '[verb] +  + /' for a shorter polite request.",
                examples: [
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "chay ni di mi krp",
                        english: "Could you help me please? (male speaker)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "put cha cha ni di mi k",
                        english: "Could you speak slowly please? (female speaker)"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "r ni krp",
                        english: "Please wait (a moment)"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "k nam ni di mi krp",
                        english: "Could I have some water please?"
                    },
                    {
                        thai: "<span class='highlight'></span><span class='highlight'></span>",
                        roman: "lt raa-kaa ni di mi k",
                        english: "Could you lower the price please?"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you politely ask: 'Could you wait please?' (male speaker)",
                    hint: "wait =  (r)",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "The order is: verb +  +  + /"
                }
            },
            {
                id: "question-particles",
                title: "Question Particles: , , ",
                structure: "... / ... / ...",
                structureRoman: "... mi / ... r plo / ... r yang",
                structureEnglish: "yes/no? / or not? / yet?",
                description: "Three ways to form yes/no questions in Thai, each with different nuances.",
                explanation: " (mi): Neutral yes/no question - 'Are you hungry?' = .\n\n (r plo): Also yes/no, but implies you expect 'no' or are checking - 'Are you [not] hungry?' = . Sounds more casual.\n\n (r yang): Asks if something has happened YET - 'Have you eaten yet?' = . Expects either 'already' () or 'not yet' ().\n\nAll three go at the END of the statement to turn it into a question.",
                examples: [
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "hu mi",
                        english: "Are you hungry? [neutral question]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "hu r plo",
                        english: "Are you hungry (or not)? [checking]"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "gin kao r yang",
                        english: "Have you eaten yet?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "bpai tam-ngaan r yang",
                        english: "Have you gone to work yet?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "mii faen r plo",
                        english: "Do you have a boyfriend/girlfriend?"
                    },
                    {
                        thai: "<span class='highlight'></span>",
                        roman: "chp mi",
                        english: "Do you like it?"
                    }
                ],
                practice: {
                    type: "multiple-choice",
                    prompt: "How do you ask 'Have you finished yet?'",
                    hint: "finish =  (st), 'yet' questions use ",
                    options: [
                        { text: "", correct: true },
                        { text: "", correct: false },
                        { text: "", correct: false },
                        { text: "", correct: false }
                    ],
                    explanation: "Use  for 'yet' questions.  is neutral,  is for checking assumptions."
                }
            }
        ];
        
        // Grammar practice sentence templates
        // Each template has: pattern (grammar rule), templates with slots, and word pools
        const grammarPracticeTemplates = {
            "mae-wa": {
                // ...... (even though...still...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "Even though it's raining, I still go to work" },
                    { sentence: "______", blanks: ["", ""], english: "Even though I'm tired, I still have to continue" },
                    { sentence: "______", blanks: ["", ""], english: "Even though it's expensive, I still want to buy it" },
                    { sentence: "______", blanks: ["", ""], english: "Even though I don't have time, I'll still help you" },
                    { sentence: "______", blanks: ["", ""], english: "Even though it's difficult, I still have to try" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "Even though it's raining, I still go", correct: "" },
                    { words: ["", "", "", ""], english: "Even though I'm tired, I still work", correct: "" },
                    { words: ["", "", "", ""], english: "Even though I have no money, I'm still happy", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Even though it's raining, I still have to go meet my friends", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Even though I'm tired, I still have to cook for my wife", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Even though I don't want to go, I still have to go to work", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "tae-wa": {
                // () (but)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I want to go, but I don't have time" },
                    { sentence: "___", blanks: [""], english: "The food is delicious, but it's very expensive" },
                    { sentence: "___", blanks: [""], english: "He's talented, but lazy" },
                    { sentence: "___", blanks: [""], english: "I like coffee, but I don't like tea" },
                    { sentence: "___", blanks: [""], english: "It's hot, but I won't turn on the AC" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "I want to go, but I don't have time", correct: "" },
                    { words: ["", "", ""], english: "I like it, but I won't buy it", correct: "" },
                    { words: ["", "", ""], english: "I'm hungry, but I won't eat", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "I want to eat, but I have to work first", correct: "" },
                    { words: ["", "", "", "", ""], english: "He's rich, but he's not happy", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "The food is delicious, but the restaurant is very far", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "pror-wa": {
                // ()...... (because...so...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "Because it's raining, I'm not going" },
                    { sentence: "______", blanks: ["", ""], english: "Because I'm hungry, I'm eating" },
                    { sentence: "______", blanks: ["", ""], english: "Because I'm tired, I'm going to sleep" },
                    { sentence: "______", blanks: ["", ""], english: "Because I have no money, I'm not buying it" },
                    { sentence: "______", blanks: ["", ""], english: "Because it's hot, I'm turning on the AC" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "Because I'm hungry, I'm eating", correct: "" },
                    { words: ["", "", "", ""], english: "Because I'm tired, I'm sleeping", correct: "" },
                    { words: ["", "", "", ""], english: "Because it's raining, I'm not going", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Because I worked hard, I'm very tired", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "Because I didn't study, I failed the exam", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Because of traffic, I arrived late", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "taa": {
                // ...... (if...then...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "If I have time, I'll go out" },
                    { sentence: "______", blanks: ["", ""], english: "If you're hungry, just eat" },
                    { sentence: "______", blanks: ["", ""], english: "If it rains, I won't go" },
                    { sentence: "______", blanks: ["", ""], english: "If you're free, give me a call" },
                    { sentence: "______", blanks: ["", ""], english: "If you don't like it, you don't have to eat it" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "If you're hungry, eat", correct: "" },
                    { words: ["", "", "", ""], english: "If you're free, come over", correct: "" },
                    { words: ["", "", "", ""], english: "If it rains, stay home", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "If I have time, I'll go to the beach", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "If you're not feeling well, rest at home", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "If the food isn't good, you don't have to eat it", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "ying-ying": {
                // ...... (the more...the more...)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "The more you study, the better you get" },
                    { sentence: "______", blanks: ["", ""], english: "The more I eat, the hungrier I get" },
                    { sentence: "______", blanks: ["", ""], english: "The more I learn, the less I understand" },
                    { sentence: "______", blanks: ["", ""], english: "The more you practice, the better" },
                    { sentence: "______", blanks: ["", ""], english: "The more I think, the more confused I get" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "The more you study, the better you get", correct: "" },
                    { words: ["", "", "", ""], english: "The more you practice, the better", correct: "" },
                    { words: ["", "", "", ""], english: "The more you eat, the fatter you get", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "The more I know him, the more I like him", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "The more I read, the more I understand", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "The more I practice speaking Thai, the better I get", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "gwa": {
                // ... (more than / -er)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Today is hotter than yesterday" },
                    { sentence: "___", blanks: [""], english: "This one is better" },
                    { sentence: "___", blanks: [""], english: "He's taller than me" },
                    { sentence: "___", blanks: [""], english: "This one is cheaper" },
                    { sentence: "___", blanks: [""], english: "Thai is harder than English" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "This one is better", correct: "" },
                    { words: ["", "", "", ""], english: "Today is hotter than yesterday", correct: "" },
                    { words: ["", "", "", ""], english: "He's better than me", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "His house is bigger than my house", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "This restaurant's food is tastier than that one", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Learning Thai is harder than I thought", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "tee-sut": {
                // ... (the most / -est)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "This one is the best" },
                    { sentence: "___", blanks: [""], english: "He is the best in the room" },
                    { sentence: "___", blanks: [""], english: "Today is the hottest" },
                    { sentence: "___", blanks: [""], english: "Thai food is the most delicious" },
                    { sentence: "___", blanks: [""], english: "This is the most important" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "This one is the best", correct: "" },
                    { words: ["", "", ""], english: "She is the most beautiful", correct: "" },
                    { words: ["", "", ""], english: "Thai food is the best", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "This is the happiest day of my life", correct: "" },
                    { words: ["", "", "", "", "", "", ""], english: "This shop sells the best coffee in town", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "He's the kindest person I know", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "gam-lang": {
                // ... (currently -ing)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "I'm eating right now" },
                    { sentence: "______", blanks: ["", ""], english: "He's sleeping right now" },
                    { sentence: "______", blanks: ["", ""], english: "I'm working right now" },
                    { sentence: "______", blanks: ["", ""], english: "I'm studying right now" },
                    { sentence: "______", blanks: ["", ""], english: "He's on the phone right now" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "I'm eating right now", correct: "" },
                    { words: ["", "", ""], english: "I'm working right now", correct: "" },
                    { words: ["", "", "", ""], english: "He's sleeping right now", correct: "" },
                    { words: ["", "", "", "", ""], english: "I'm studying Thai right now", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "Mom is cooking in the kitchen right now", correct: "" },
                    { words: ["", "", "", "", "", ""], english: "He's in a meeting with a client right now", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "laew": {
                // ... (already/completed)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I already ate" },
                    { sentence: "___", blanks: [""], english: "I understand now" },
                    { sentence: "___", blanks: [""], english: "He already left" },
                    { sentence: "___", blanks: [""], english: "I already finished" },
                    { sentence: "___", blanks: [""], english: "I already know" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "I already ate", correct: "" },
                    { words: ["", ""], english: "He already left", correct: "" },
                    { words: ["", ""], english: "I understand now", correct: "" },
                    { words: ["", "", "", "", ""], english: "I already finished my homework", correct: "" },
                    { words: ["", "", "", "", ""], english: "He already went home", correct: "" },
                    { words: ["", "", "", "", "", "", "", ""], english: "I already told him, but he didn't listen", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "yang-mai": {
                // ... (not yet)
                fillBlanks: [
                    { sentence: "______", blanks: ["", ""], english: "I haven't eaten yet" },
                    { sentence: "___", blanks: ["", ""], english: "He hasn't come yet" },
                    { sentence: "______", blanks: ["", ""], english: "I don't understand at all yet" },
                    { sentence: "___", blanks: ["", ""], english: "Not finished yet" },
                    { sentence: "___", blanks: ["", ""], english: "I don't know yet" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Haven't eaten yet", correct: "" },
                    { words: ["", ""], english: "Not finished yet", correct: "" },
                    { words: ["", "", ""], english: "He hasn't come yet", correct: "" },
                    { words: ["", "", "", ""], english: "I don't understand at all yet", correct: "" },
                    { words: ["", "", ""], english: "Haven't done homework yet", correct: "" },
                    { words: ["", "", ""], english: "Not ready to go yet", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "koey": {
                // ... (have ever / used to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Have you ever been to Thailand?" },
                    { sentence: "___", blanks: [""], english: "I've eaten durian before" },
                    { sentence: "___", blanks: [""], english: "I've never seen it before" },
                    { sentence: "___", blanks: [""], english: "I used to work here" },
                    { sentence: "___", blanks: [""], english: "Have you ever spoken Thai?" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "Have you ever been?", correct: "" },
                    { words: ["", "", ""], english: "I've eaten it before", correct: "" },
                    { words: ["", "", ""], english: "I've never seen it", correct: "" },
                    { words: ["", "", "", "", ""], english: "Have you ever been to Thailand?", correct: "" },
                    { words: ["", "", "", "", ""], english: "I used to live in Bangkok", correct: "" },
                    { words: ["", "", "", "", ""], english: "I've never done this before", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "ja": {
                // ... (will / going to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I will go tomorrow" },
                    { sentence: "___", blanks: [""], english: "What will you eat?" },
                    { sentence: "___", blanks: [""], english: "He won't come" },
                    { sentence: "___", blanks: [""], english: "I'm going to work today" },
                    { sentence: "___", blanks: [""], english: "Which one will you buy?" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "I will go", correct: "" },
                    { words: ["", "", ""], english: "What will you eat?", correct: "" },
                    { words: ["", "", "", ""], english: "When will he come?", correct: "" },
                    { words: ["", "", "", "", ""], english: "I will go shopping", correct: "" },
                    { words: ["", "", "", ""], english: "Tomorrow it will rain", correct: "" },
                    { words: ["", "", "", "", ""], english: "What will you do today?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "dai-mai": {
                // ... (can/able to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Can you speak Thai?" },
                    { sentence: "___", blanks: [""], english: "I can eat spicy food" },
                    { sentence: "___", blanks: [""], english: "I can't go" },
                    { sentence: "___", blanks: [""], english: "Can you help?" },
                    { sentence: "___", blanks: [""], english: "I can come" }
                ],
                sentenceBuilds: [
                    { words: ["", "", "", ""], english: "Can you speak Thai?", correct: "" },
                    { words: ["", "", ""], english: "I can eat spicy", correct: "" },
                    { words: ["", ""], english: "Can't go", correct: "" },
                    { words: ["", "", "", ""], english: "Can you help me?", correct: "" },
                    { words: ["", "", ""], english: "I can't come today", correct: "" },
                    { words: ["", "", "", "", ""], english: "Can you drive?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "tong": {
                // ... (must / have to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I have to go now" },
                    { sentence: "___", blanks: [""], english: "Don't have to worry" },
                    { sentence: "___", blanks: [""], english: "I have to work" },
                    { sentence: "___", blanks: [""], english: "No need to wait" },
                    { sentence: "___", blanks: [""], english: "Must speak Thai" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Have to go", correct: "" },
                    { words: ["", ""], english: "Don't have to worry", correct: "" },
                    { words: ["", "", ""], english: "Have to work today", correct: "" },
                    { words: ["", "", "", ""], english: "You don't have to wait for me", correct: "" },
                    { words: ["", "", "", ""], english: "We have to go now", correct: "" },
                    { words: ["", "", "", "", ""], english: "Have to study Thai every day", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "yaak": {
                // ... (want to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "I want to eat" },
                    { sentence: "___", blanks: [""], english: "I want to travel" },
                    { sentence: "___", blanks: [""], english: "I don't want to work" },
                    { sentence: "___", blanks: [""], english: "I want to learn Thai" },
                    { sentence: "___", blanks: [""], english: "I want to rest" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Want to eat", correct: "" },
                    { words: ["", "", ""], english: "Want to travel", correct: "" },
                    { words: ["", ""], english: "Don't want to work", correct: "" },
                    { words: ["", "", "", ""], english: "I want to learn Thai", correct: "" },
                    { words: ["", "", "", ""], english: "What do you want to eat?", correct: "" },
                    { words: ["", "", "", ""], english: "I really want to go to Thailand", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "hai": {
                // ... (give/let/for someone to)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Give him money" },
                    { sentence: "___", blanks: [""], english: "Tell him to come" },
                    { sentence: "___", blanks: [""], english: "Please help" },
                    { sentence: "___", blanks: [""], english: "Let me see" },
                    { sentence: "___", blanks: [""], english: "Make it finished" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Give money", correct: "" },
                    { words: ["", "", "", ""], english: "Tell him to come", correct: "" },
                    { words: ["", "", "", ""], english: "Let me see", correct: "" },
                    { words: ["", "", "", ""], english: "Please help me", correct: "" },
                    { words: ["", "", "", "", ""], english: "Tell him to wait a moment", correct: "" },
                    { words: ["", "", "", ""], english: "Do it the best you can", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "polite-request": {
                // ... (polite requests)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Could you help please?" },
                    { sentence: "______", blanks: ["", ""], english: "Could you speak slowly please?" },
                    { sentence: "___", blanks: [""], english: "Please wait a moment" },
                    { sentence: "______", blanks: ["", ""], english: "Could I have some water please?" },
                    { sentence: "______", blanks: ["", ""], english: "Could you lower the price please?" }
                ],
                sentenceBuilds: [
                    { words: ["", "", ""], english: "Please help (male)", correct: "" },
                    { words: ["", "", "", ""], english: "Could you wait please?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could you speak slowly please?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could I have water please?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could you lower the price?", correct: "" },
                    { words: ["", "", "", "", ""], english: "Could you write it again please?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            },
            "question-particles": {
                // , ,  (question particles)
                fillBlanks: [
                    { sentence: "___", blanks: [""], english: "Are you hungry? [neutral]" },
                    { sentence: "___", blanks: [""], english: "Have you eaten yet?" },
                    { sentence: "___", blanks: [""], english: "Do you have a boyfriend/girlfriend?" },
                    { sentence: "___", blanks: [""], english: "Have you finished yet?" },
                    { sentence: "___", blanks: [""], english: "Do you like it?" }
                ],
                sentenceBuilds: [
                    { words: ["", ""], english: "Are you hungry?", correct: "" },
                    { words: ["", "", ""], english: "Have you eaten yet?", correct: "" },
                    { words: ["", "", ""], english: "Have you gone to work yet?", correct: "" },
                    { words: ["", "", ""], english: "Is he coming (or not)?", correct: "" },
                    { words: ["", "", ""], english: "Do you like Thai food?", correct: "" },
                    { words: ["", "", ""], english: "Have you finished?", correct: "" }
                ],
                distractors: ["", "", "", "", ""]
            }
        };
        
        // Grammar practice state
        let currentPracticeLesson = null;
        let currentPracticeMode = null; // 'fillblank' or 'build'
        let currentPracticeIndex = 0;
        let practiceScore = { correct: 0, total: 0 };
        let currentPracticeItems = [];
        
        // Grammar lesson state
        let currentLessonIndex = null;
        let currentStepIndex = 0;
        let lessonProgress = JSON.parse(localStorage.getItem('thaiGrammarProgress') || '{}');
        
        // THEMED VOCABULARY LISTS
        const themedLists = [
            {
                name: "Animals & Nature",
                words: [
                    { thai: "", english: "dog" },
                    { thai: "", english: "cat" },
                    { thai: "", english: "bird" },
                    { thai: "", english: "fish" },
                    { thai: "", english: "elephant" },
                    { thai: "", english: "monkey" },
                    { thai: "", english: "snake" },
                    { thai: "", english: "cow" },
                    { thai: "", english: "pig" },
                    { thai: "", english: "chicken" },
                    { thai: "", english: "duck" },
                    { thai: "", english: "frog" },
                    { thai: "", english: "mosquito" },
                    { thai: "", english: "ant" },
                    { thai: "", english: "butterfly" },
                    { thai: "", english: "tree" },
                    { thai: "", english: "flower" },
                    { thai: "", english: "leaf" },
                    { thai: "", english: "grass" },
                    { thai: "", english: "forest/jungle" },
                    { thai: "", english: "mountain" },
                    { thai: "", english: "river" },
                    { thai: "", english: "sea/ocean" },
                    { thai: "", english: "island" },
                    { thai: "", english: "beach" },
                    { thai: "", english: "waterfall" }
                ]
            },
            {
                name: "Food & Drinks",
                words: [
                    { thai: "", english: "rice" },
                    { thai: "", english: "egg" },
                    { thai: "", english: "milk" },
                    { thai: "", english: "bread" },
                    { thai: "", english: "meat/beef" },
                    { thai: "", english: "shrimp" },
                    { thai: "", english: "crab" },
                    { thai: "", english: "squid" },
                    { thai: "", english: "fruit" },
                    { thai: "", english: "vegetable" },
                    { thai: "", english: "mango" },
                    { thai: "", english: "banana" },
                    { thai: "", english: "orange" },
                    { thai: "", english: "watermelon" },
                    { thai: "", english: "grape" },
                    { thai: "", english: "mangosteen" },
                    { thai: "", english: "durian" },
                    { thai: "", english: "longan" },
                    { thai: "", english: "lime" },
                    { thai: "", english: "tomato" },
                    { thai: "", english: "cucumber" },
                    { thai: "", english: "cabbage" },
                    { thai: "", english: "carrot" },
                    { thai: "", english: "chili" },
                    { thai: "", english: "garlic" },
                    { thai: "", english: "onion" },
                    { thai: "", english: "salt" },
                    { thai: "", english: "sugar" },
                    { thai: "", english: "water" },
                    { thai: "", english: "tea" },
                    { thai: "", english: "coffee" },
                    { thai: "", english: "beer" },
                    { thai: "", english: "alcohol/liquor" },
                    { thai: "", english: "fruit juice" },
                    { thai: "", english: "plain water" },
                    { thai: "", english: "ice" }
                ]
            },
            {
                name: "Cooking & Taste",
                words: [
                    { thai: "", english: "to cook" },
                    { thai: "", english: "to fry" },
                    { thai: "", english: "to boil" },
                    { thai: "", english: "to steam" },
                    { thai: "", english: "to grill" },
                    { thai: "", english: "to bake" },
                    { thai: "", english: "to mix (cooking)" },
                    { thai: "", english: "to chop/cut" },
                    { thai: "", english: "to season" },
                    { thai: "", english: "ingredient" },
                    { thai: "", english: "recipe" },
                    { thai: "", english: "ingredients" },
                    { thai: "", english: "spice" },
                    { thai: "", english: "seasoning" },
                    { thai: "", english: "taste/flavor" },
                    { thai: "", english: "spicy" },
                    { thai: "", english: "sweet" },
                    { thai: "", english: "sour" },
                    { thai: "", english: "salty" },
                    { thai: "", english: "bitter" },
                    { thai: "", english: "bland" },
                    { thai: "", english: "delicious" },
                    { thai: "", english: "smelly/stinky" },
                    { thai: "", english: "fragrant" },
                    { thai: "", english: "crispy" },
                    { thai: "", english: "soft" },
                    { thai: "", english: "hard" },
                    { thai: "", english: "sticky/chewy" },
                    { thai: "", english: "fresh" },
                    { thai: "", english: "broken/spoiled" }
                ]
            },
            {
                name: "Family & People",
                words: [
                    { thai: "", english: "father" },
                    { thai: "", english: "mother" },
                    { thai: "", english: "older sibling" },
                    { thai: "", english: "younger sibling" },
                    { thai: "", english: "older brother" },
                    { thai: "", english: "older sister" },
                    { thai: "", english: "younger brother" },
                    { thai: "", english: "younger sister" },
                    { thai: "", english: "child/offspring" },
                    { thai: "", english: "son" },
                    { thai: "", english: "daughter" },
                    { thai: "", english: "grandparents (paternal)" },
                    { thai: "", english: "grandparents (maternal)" },
                    { thai: "", english: "grandchild/nephew/niece" },
                    { thai: "", english: "uncle (older than parent)" },
                    { thai: "", english: "aunt (older than parent)" },
                    { thai: "", english: "husband" },
                    { thai: "", english: "wife" },
                    { thai: "", english: "boyfriend/girlfriend" },
                    { thai: "", english: "friend" },
                    { thai: "", english: "neighbor" },
                    { thai: "", english: "teacher" },
                    { thai: "", english: "student" },
                    { thai: "", english: "doctor" },
                    { thai: "", english: "nurse" },
                    { thai: "", english: "employee/staff" },
                    { thai: "", english: "boss" },
                    { thai: "", english: "customer" },
                    { thai: "", english: "monk" }
                ]
            },
            {
                name: "Body & Health",
                words: [
                    { thai: "", english: "head" },
                    { thai: "", english: "hair" },
                    { thai: "", english: "face" },
                    { thai: "", english: "eye" },
                    { thai: "", english: "ear" },
                    { thai: "", english: "nose" },
                    { thai: "", english: "mouth" },
                    { thai: "", english: "tooth/teeth" },
                    { thai: "", english: "tongue" },
                    { thai: "", english: "neck" },
                    { thai: "", english: "shoulder" },
                    { thai: "", english: "arm" },
                    { thai: "", english: "hand" },
                    { thai: "", english: "finger" },
                    { thai: "", english: "back" },
                    { thai: "", english: "stomach" },
                    { thai: "", english: "leg" },
                    { thai: "", english: "foot" },
                    { thai: "", english: "knee" },
                    { thai: "", english: "heart" },
                    { thai: "", english: "blood" },
                    { thai: "", english: "bone" },
                    { thai: "", english: "skin" },
                    { thai: "", english: "sick/ill" },
                    { thai: "", english: "to ache/pain" },
                    { thai: "", english: "to cough" },
                    { thai: "", english: "to sneeze" },
                    { thai: "", english: "fever" },
                    { thai: "", english: "to hurt/injured" },
                    { thai: "", english: "wound" },
                    { thai: "", english: "allergic to" },
                    { thai: "", english: "to recover/heal" },
                    { thai: "", english: "to examine/check" },
                    { thai: "", english: "to treat/cure" },
                    { thai: "", english: "medicine" },
                    { thai: "", english: "hospital" },
                    { thai: "", english: "to exercise" },
                    { thai: "", english: "to rest/relax" }
                ]
            },
            {
                name: "Numbers & Time",
                words: [
                    { thai: "", english: "one" },
                    { thai: "", english: "two" },
                    { thai: "", english: "three" },
                    { thai: "", english: "four" },
                    { thai: "", english: "five" },
                    { thai: "", english: "six" },
                    { thai: "", english: "seven" },
                    { thai: "", english: "eight" },
                    { thai: "", english: "nine" },
                    { thai: "", english: "ten" },
                    { thai: "", english: "hundred" },
                    { thai: "", english: "thousand" },
                    { thai: "", english: "ten thousand" },
                    { thai: "", english: "hundred thousand" },
                    { thai: "", english: "million" },
                    { thai: "", english: "day" },
                    { thai: "", english: "week" },
                    { thai: "", english: "month" },
                    { thai: "", english: "year" },
                    { thai: "", english: "today" },
                    { thai: "", english: "tomorrow" },
                    { thai: "", english: "yesterday" },
                    { thai: "", english: "morning" },
                    { thai: "", english: "afternoon" },
                    { thai: "", english: "evening" },
                    { thai: "", english: "night" },
                    { thai: "", english: "noon" },
                    { thai: "", english: "midnight" },
                    { thai: "", english: "hour" },
                    { thai: "", english: "minute" },
                    { thai: "", english: "second" },
                    { thai: "", english: "clock/watch" },
                    { thai: "", english: "Monday (wan jan)" },
                    { thai: "", english: "Tuesday (wan ang-kaan)" },
                    { thai: "", english: "Wednesday (wan pt)" },
                    { thai: "", english: "Thursday (wan p-r-ht)" },
                    { thai: "", english: "Friday (wan sk)" },
                    { thai: "", english: "Saturday (wan so)" },
                    { thai: "", english: "Sunday (wan aa-tt)" },
                    { thai: "", english: "already" },
                    { thai: "", english: "still/yet" },
                    { thai: "", english: "currently/in progress" },
                    { thai: "", english: "will (future)" },
                    { thai: "", english: "used to/have done before" },
                    { thai: "", english: "on time" },
                    { thai: "", english: "late" },
                    { thai: "", english: "to spend time" },
                    { thai: "", english: "to save time" },
                    { thai: "", english: "to waste time" },
                    { thai: "", english: "now" },
                    { thai: "", english: "before" },
                    { thai: "", english: "after" },
                    { thai: "", english: "often" },
                    { thai: "", english: "always" },
                    { thai: "", english: "never" },
                    { thai: "", english: "immediately" },
                    { thai: "", english: "again/more" },
                    { thai: "", english: "only/that's all" },
                    { thai: "", english: "and then" }
                ]
            },
            {
                name: "Colors & Descriptions",
                words: [
                    { thai: "", english: "color" },
                    { thai: "", english: "red (sii daeng)" },
                    { thai: "", english: "green (sii kiaw)" },
                    { thai: "", english: "blue (sii nam ngern)" },
                    { thai: "", english: "yellow (sii leuang)" },
                    { thai: "", english: "white (sii kaao)" },
                    { thai: "", english: "black (sii dam)" },
                    { thai: "", english: "pink (sii chom-puu)" },
                    { thai: "", english: "purple (sii muang)" },
                    { thai: "", english: "gray (sii tao)" },
                    { thai: "", english: "orange (sii som)" },
                    { thai: "", english: "beautiful" },
                    { thai: "", english: "cute" },
                    { thai: "", english: "smart/clever" },
                    { thai: "", english: "clean" },
                    { thai: "", english: "dirty" },
                    { thai: "", english: "big" },
                    { thai: "", english: "small" },
                    { thai: "", english: "tall/high" },
                    { thai: "", english: "short" },
                    { thai: "", english: "long (length/distance)" },
                    { thai: "", english: "short (length)" },
                    { thai: "", english: "wide" },
                    { thai: "", english: "narrow" },
                    { thai: "", english: "thick" },
                    { thai: "", english: "thin (objects)" },
                    { thai: "", english: "old" },
                    { thai: "", english: "new" },
                    { thai: "", english: "strong" },
                    { thai: "", english: "weak" },
                    { thai: "", english: "fat" },
                    { thai: "", english: "thin/skinny (people)" },
                    { thai: "", english: "expensive" },
                    { thai: "", english: "cheap" },
                    { thai: "", english: "cold" },
                    { thai: "", english: "hot" },
                    { thai: "", english: "fast/quick" },
                    { thai: "", english: "slow" },
                    { thai: "", english: "easy" },
                    { thai: "", english: "difficult" },
                    { thai: "", english: "dark" },
                    { thai: "", english: "bright" },
                    { thai: "", english: "quiet" },
                    { thai: "", english: "loud/noisy" },
                    { thai: "", english: "convenient" },
                    { thai: "", english: "complicated" },
                    { thai: "", english: "suitable/appropriate" },
                    { thai: "", english: "worthwhile/good value" },
                    { thai: "", english: "dangerous" },
                    { thai: "", english: "safe" },
                    { thai: "", english: "neat/tidy" }
                ]
            },
            {
                name: "Emotions & Feelings",
                words: [
                    { thai: "", english: "tired" },
                    { thai: "", english: "bored" },
                    { thai: "", english: "excited" },
                    { thai: "", english: "worried/anxious" },
                    { thai: "", english: "relaxed" },
                    { thai: "", english: "surprised" },
                    { thai: "", english: "disappointed" },
                    { thai: "", english: "proud" },
                    { thai: "", english: "ashamed" },
                    { thai: "", english: "angry" },
                    { thai: "", english: "sad/sorry" },
                    { thai: "", english: "happy/glad" },
                    { thai: "", english: "shocked/startled" },
                    { thai: "", english: "afraid/scared" },
                    { thai: "", english: "comfortable" },
                    { thai: "", english: "difficult/troublesome" },
                    { thai: "", english: "fun" },
                    { thai: "", english: "boring" },
                    { thai: "", english: "scary" },
                    { thai: "", english: "hungry" },
                    { thai: "", english: "full (not hungry)" },
                    { thai: "", english: "thirsty" },
                    { thai: "", english: "to miss (someone)" },
                    { thai: "", english: "to love" },
                    { thai: "", english: "to hate" },
                    { thai: "", english: "to like" },
                    { thai: "", english: "to dislike" },
                    { thai: "", english: "to hope" },
                    { thai: "", english: "to believe" },
                    { thai: "", english: "to doubt/wonder" },
                    { thai: "", english: "confused" },
                    { thai: "", english: "diligent/hardworking" },
                    { thai: "", english: "lazy" },
                    { thai: "", english: "rich" },
                    { thai: "", english: "poor" },
                    { thai: "", english: "famous" }
                ]
            },
            {
                name: "Basic Actions",
                words: [
                    { thai: "", english: "to walk" },
                    { thai: "", english: "to run" },
                    { thai: "", english: "to jump" },
                    { thai: "", english: "to sit" },
                    { thai: "", english: "to stand" },
                    { thai: "", english: "to lie down/sleep" },
                    { thai: "", english: "to sleep" },
                    { thai: "", english: "to wake up" },
                    { thai: "", english: "to return" },
                    { thai: "", english: "to come" },
                    { thai: "", english: "to go" },
                    { thai: "", english: "to enter" },
                    { thai: "", english: "to exit/leave" },
                    { thai: "", english: "to go up" },
                    { thai: "", english: "to go down" },
                    { thai: "", english: "to pass through" },
                    { thai: "", english: "to stop" },
                    { thai: "", english: "to wait" },
                    { thai: "", english: "to start/begin" },
                    { thai: "", english: "to finish/end" },
                    { thai: "", english: "to open" },
                    { thai: "", english: "to close" },
                    { thai: "", english: "to use" },
                    { thai: "", english: "to buy" },
                    { thai: "", english: "to sell" },
                    { thai: "", english: "to give" },
                    { thai: "", english: "to receive" },
                    { thai: "", english: "to send" },
                    { thai: "", english: "to watch" },
                    { thai: "", english: "to see" },
                    { thai: "", english: "to look at" },
                    { thai: "", english: "to hear" },
                    { thai: "", english: "to listen" },
                    { thai: "", english: "to taste" },
                    { thai: "", english: "to smell" },
                    { thai: "", english: "to touch" },
                    { thai: "", english: "to think" },
                    { thai: "", english: "to feel" },
                    { thai: "", english: "to understand" },
                    { thai: "", english: "to remember" },
                    { thai: "", english: "to forget" },
                    { thai: "", english: "to hurry" },
                    { thai: "", english: "to be late/delayed" },
                    { thai: "", english: "to be fast" },
                    { thai: "", english: "to take/want" },
                    { thai: "", english: "to want" },
                    { thai: "", english: "must/have to" },
                    { thai: "", english: "can/get" },
                    { thai: "", english: "to be" },
                    { thai: "", english: "to have" },
                    { thai: "", english: "to be at/live" },
                    { thai: "", english: "to do/make" },
                    { thai: "", english: "to eat" },
                    { thai: "", english: "to drink" },
                    { thai: "", english: "to help" },
                    { thai: "", english: "to try (test/sample)" },
                    { thai: "", english: "to know" }
                ]
            },
            {
                name: "Communication",
                words: [
                    { thai: "", english: "to speak" },
                    { thai: "", english: "to chat/talk" },
                    { thai: "", english: "to call (phone)" },
                    { thai: "", english: "to talk together" },
                    { thai: "", english: "to tell/narrate" },
                    { thai: "", english: "to explain" },
                    { thai: "", english: "to ask" },
                    { thai: "", english: "to answer" },
                    { thai: "", english: "to tell/inform" },
                    { thai: "", english: "to clarify" },
                    { thai: "", english: "to warn/remind" },
                    { thai: "", english: "to promise" },
                    { thai: "", english: "to lie" },
                    { thai: "", english: "to recommend/introduce" },
                    { thai: "", english: "to contact" },
                    { thai: "", english: "to announce" },
                    { thai: "", english: "to read" },
                    { thai: "", english: "to write" },
                    { thai: "", english: "hello/goodbye" },
                    { thai: "", english: "thank you" },
                    { thai: "", english: "excuse me/sorry" },
                    { thai: "", english: "never mind/no problem" },
                    { thai: "", english: "can you help?" },
                    { thai: "", english: "don't understand" },
                    { thai: "", english: "speak slowly" },
                    { thai: "", english: "what" },
                    { thai: "", english: "why" },
                    { thai: "", english: "how" },
                    { thai: "", english: "how (informal)" },
                    { thai: "", english: "when" },
                    { thai: "", english: "how many" },
                    { thai: "", english: "who" },
                    { thai: "", english: "where" },
                    { thai: "", english: "go ahead/sure" },
                    { thai: "", english: "don't want" },
                    { thai: "", english: "don't know" },
                    { thai: "", english: "don't have" },
                    { thai: "", english: "finished/done" },
                    { thai: "", english: "wait/moment" },
                    { thai: "", english: "wait a moment" }
                ]
            },
            {
                name: "Education & Learning",
                words: [
                    { thai: "", english: "to teach" },
                    { thai: "", english: "to learn" },
                    { thai: "", english: "to write down/note" },
                    { thai: "", english: "to study" },
                    { thai: "", english: "to take a test" },
                    { thai: "", english: "to fail" },
                    { thai: "", english: "to review" },
                    { thai: "", english: "to try (make effort)" },
                    { thai: "", english: "to practice" },
                    { thai: "", english: "housework" },
                    { thai: "", english: "homework (school)" },
                    { thai: "", english: "degree" },
                    { thai: "", english: "college" },
                    { thai: "", english: "university" },
                    { thai: "", english: "school" },
                    { thai: "", english: "classroom" },
                    { thai: "", english: "library" },
                    { thai: "", english: "sports field" },
                    { thai: "", english: "book" },
                    { thai: "", english: "pen" },
                    { thai: "", english: "pencil" },
                    { thai: "", english: "paper" },
                    { thai: "", english: "scissors" },
                    { thai: "", english: "knowledge" },
                    { thai: "", english: "experience" }
                ]
            },
            {
                name: "Home & Furniture",
                words: [
                    { thai: "", english: "house/home" },
                    { thai: "", english: "room" },
                    { thai: "", english: "bedroom" },
                    { thai: "", english: "kitchen" },
                    { thai: "", english: "bathroom" },
                    { thai: "", english: "living room" },
                    { thai: "", english: "door" },
                    { thai: "", english: "window" },
                    { thai: "", english: "floor" },
                    { thai: "", english: "wall" },
                    { thai: "", english: "roof" },
                    { thai: "", english: "stairs" },
                    { thai: "", english: "chair" },
                    { thai: "", english: "table" },
                    { thai: "", english: "bed" },
                    { thai: "", english: "cabinet/closet" },
                    { thai: "", english: "refrigerator" },
                    { thai: "", english: "air conditioner" },
                    { thai: "", english: "fan" },
                    { thai: "", english: "key" },
                    { thai: "", english: "blanket" },
                    { thai: "", english: "pillow" },
                    { thai: "", english: "mattress" },
                    { thai: "", english: "bed sheet" },
                    { thai: "", english: "mirror" },
                    { thai: "", english: "towel" }
                ]
            },
            {
                name: "Clothing & Accessories",
                words: [
                    { thai: "", english: "shirt" },
                    { thai: "", english: "pants" },
                    { thai: "", english: "skirt" },
                    { thai: "", english: "shoes" },
                    { thai: "", english: "socks" },
                    { thai: "", english: "hat" },
                    { thai: "", english: "glasses" },
                    { thai: "", english: "bag" },
                    { thai: "", english: "umbrella" },
                    { thai: "", english: "ring" },
                    { thai: "", english: "necklace" },
                    { thai: "", english: "gold/golden (color)" },
                    { thai: "", english: "diamond" },
                    { thai: "", english: "to get dressed" },
                    { thai: "", english: "to wash (clothes)" },
                    { thai: "", english: "belt" },
                    { thai: "", english: "to dry (in sun)" },
                    { thai: "", english: "wristwatch" }
                ]
            },
            {
                name: "Travel & Transport",
                words: [
                    { thai: "", english: "taxi" },
                    { thai: "", english: "van" },
                    { thai: "", english: "bus" },
                    { thai: "", english: "train" },
                    { thai: "", english: "skytrain/metro" },
                    { thai: "", english: "boat" },
                    { thai: "", english: "airplane" },
                    { thai: "", english: "airport" },
                    { thai: "", english: "station" },
                    { thai: "", english: "bus stop" },
                    { thai: "", english: "ticket" },
                    { thai: "", english: "buy ticket" },
                    { thai: "", english: "get on (vehicle)" },
                    { thai: "", english: "get off (vehicle)" },
                    { thai: "", english: "where are you going?" },
                    { thai: "", english: "to arrive" },
                    { thai: "", english: "turn left" },
                    { thai: "", english: "turn right" },
                    { thai: "", english: "go straight" },
                    { thai: "", english: "slow down" },
                    { thai: "", english: "faster please" },
                    { thai: "", english: "here" },
                    { thai: "", english: "there" },
                    { thai: "", english: "near/close" },
                    { thai: "", english: "far" },
                    { thai: "", english: "lost/get lost" },
                    { thai: "", english: "map" },
                    { thai: "", english: "address" },
                    { thai: "", english: "road/street" },
                    { thai: "", english: "side street/alley" },
                    { thai: "", english: "bridge" },
                    { thai: "", english: "hotel" },
                    { thai: "", english: "room (hotel)" },
                    { thai: "", english: "to book/reserve" },
                    { thai: "", english: "to cancel" },
                    { thai: "", english: "check in" },
                    { thai: "", english: "check out" },
                    { thai: "", english: "passport" },
                    { thai: "", english: "visa" }
                ]
            },
            {
                name: "Places & Sights",
                words: [
                    { thai: "", english: "temple" },
                    { thai: "", english: "Buddha statue" },
                    { thai: "", english: "museum" },
                    { thai: "", english: "park" },
                    { thai: "", english: "zoo" },
                    { thai: "", english: "market" },
                    { thai: "", english: "shop/store" },
                    { thai: "", english: "department store/mall" },
                    { thai: "", english: "restaurant" },
                    { thai: "", english: "bank" },
                    { thai: "", english: "office" },
                    { thai: "", english: "company" }
                ]
            },
            {
                name: "Weather & Seasons",
                words: [
                    { thai: "", english: "weather/air" },
                    { thai: "", english: "rain" },
                    { thai: "", english: "it's raining" },
                    { thai: "", english: "sunlight" },
                    { thai: "", english: "wind" },
                    { thai: "", english: "cloud" },
                    { thai: "", english: "light blue (sii faa)" },
                    { thai: "", english: "storm" },
                    { thai: "", english: "lightning" },
                    { thai: "", english: "thunder" },
                    { thai: "", english: "flood" },
                    { thai: "", english: "humid" },
                    { thai: "", english: "dry" },
                    { thai: "", english: "fog" },
                    { thai: "", english: "good weather" },
                    { thai: "", english: "bad weather" },
                    { thai: "", english: "very hot" },
                    { thai: "", english: "very cold" },
                    { thai: "", english: "hot and humid" },
                    { thai: "", english: "season" },
                    { thai: "", english: "rainy season" },
                    { thai: "", english: "hot season" },
                    { thai: "", english: "cool season" },
                    { thai: "", english: "temperature" },
                    { thai: "", english: "degree (temperature)" },
                    { thai: "", english: "world/earth" },
                    { thai: "", english: "sun" },
                    { thai: "", english: "moon" },
                    { thai: "", english: "star" },
                    { thai: "", english: "the sky" }
                ]
            },
            {
                name: "Shopping & Money",
                words: [
                    { thai: "", english: "price" },
                    { thai: "", english: "money" },
                    { thai: "", english: "baht (currency)" },
                    { thai: "", english: "exchange money" },
                    { thai: "", english: "credit card" },
                    { thai: "", english: "cash" },
                    { thai: "", english: "receipt" },
                    { thai: "", english: "gift/souvenir" },
                    { thai: "", english: "souvenir" },
                    { thai: "", english: "how much?" },
                    { thai: "", english: "too expensive" },
                    { thai: "", english: "discount please" },
                    { thai: "", english: "where is the bathroom?" },
                    { thai: "", english: "menu" },
                    { thai: "", english: "to order food" },
                    { thai: "", english: "check/bill please" },
                    { thai: "", english: "tip (gratuity)" },
                    { thai: "", english: "no sugar" },
                    { thai: "", english: "no ice" },
                    { thai: "", english: "to save/economize" },
                    { thai: "", english: "to choose" },
                    { thai: "", english: "to decide" },
                    { thai: "", english: "to share" },
                    { thai: "", english: "to compare" }
                ]
            },
            {
                name: "Work & Business",
                words: [
                    { thai: "", english: "to work" },
                    { thai: "", english: "work/job" },
                    { thai: "", english: "profession/career" },
                    { thai: "", english: "salary" },
                    { thai: "", english: "meeting" },
                    { thai: "", english: "appointment" },
                    { thai: "", english: "interview" },
                    { thai: "", english: "to apply" },
                    { thai: "", english: "to sign" },
                    { thai: "", english: "to type/print" },
                    { thai: "", english: "to send email" },
                    { thai: "", english: "to call (phone)" },
                    { thai: "", english: "report" },
                    { thai: "", english: "document" },
                    { thai: "", english: "copy" },
                    { thai: "", english: "original" },
                    { thai: "", english: "form" },
                    { thai: "", english: "application form" },
                    { thai: "", english: "ID card" },
                    { thai: "", english: "driver's license" },
                    { thai: "", english: "insurance" },
                    { thai: "", english: "tax" },
                    { thai: "", english: "expenses" },
                    { thai: "", english: "budget" },
                    { thai: "", english: "profit" },
                    { thai: "", english: "loss (financial)" },
                    { thai: "", english: "debt" },
                    { thai: "", english: "interest (financial)" },
                    { thai: "", english: "account" },
                    { thai: "", english: "bank account" },
                    { thai: "", english: "to deposit/leave with" },
                    { thai: "", english: "to deposit money" },
                    { thai: "", english: "to withdraw money" },
                    { thai: "", english: "to transfer" },
                    { thai: "", english: "to transfer money" },
                    { thai: "", english: "to borrow money (formal loan)" },
                    { thai: "", english: "to pay" }
                ]
            },
            {
                name: "Technology",
                words: [
                    { thai: "", english: "television" },
                    { thai: "", english: "telephone" },
                    { thai: "", english: "mobile phone" },
                    { thai: "", english: "computer" },
                    { thai: "", english: "internet" },
                    { thai: "", english: "password/code" },
                    { thai: "", english: "message" },
                    { thai: "", english: "picture/photo" },
                    { thai: "", english: "video" },
                    { thai: "", english: "song/music" },
                    { thai: "", english: "newspaper" },
                    { thai: "", english: "magazine" },
                    { thai: "", english: "battery" },
                    { thai: "", english: "screen" },
                    { thai: "", english: "plug" },
                    { thai: "", english: "switch" },
                    { thai: "", english: "electricity" },
                    { thai: "", english: "light bulb" },
                    { thai: "", english: "candle" },
                    { thai: "", english: "flashlight" },
                    { thai: "", english: "camera" },
                    { thai: "", english: "screen (n.)" },
                    { thai: "", english: "speaker" },
                    { thai: "", english: "headphones" },
                    { thai: "", english: "mouse (computer)" },
                    { thai: "", english: "keyboard" },
                    { thai: "", english: "printer" },
                    { thai: "", english: "game" },
                    { thai: "", english: "app" },
                    { thai: "", english: "website" },
                    { thai: "", english: "wifi" },
                    { thai: "", english: "signal" },
                    { thai: "", english: "to download" },
                    { thai: "", english: "to upload" },
                    { thai: "", english: "to turn on" },
                    { thai: "", english: "to turn off" },
                    { thai: "", english: "to charge" },
                    { thai: "", english: "to take a photo" },
                    { thai: "", english: "to record/save" },
                    { thai: "", english: "to delete/erase/subtract" },
                    { thai: "", english: "to copy" },
                    { thai: "", english: "to search" }
                ]
            },
            {
                name: "Entertainment & Sports",
                words: [
                    { thai: "", english: "news" },
                    { thai: "", english: "advertisement" },
                    { thai: "", english: "drama/series" },
                    { thai: "", english: "movie/film" },
                    { thai: "", english: "cartoon" },
                    { thai: "", english: "program/show" },
                    { thai: "", english: "channel" },
                    { thai: "", english: "to sing/cry out" },
                    { thai: "", english: "to dance" },
                    { thai: "", english: "to play" },
                    { thai: "", english: "to win" },
                    { thai: "", english: "to compete" },
                    { thai: "", english: "to compete/race" },
                    { thai: "", english: "sport" },
                    { thai: "", english: "football/soccer" },
                    { thai: "", english: "basketball" },
                    { thai: "", english: "volleyball" },
                    { thai: "", english: "to swim" },
                    { thai: "", english: "to cycle" },
                    { thai: "", english: "to play golf" },
                    { thai: "", english: "boxing" },
                    { thai: "", english: "yoga" },
                    { thai: "", english: "massage" },
                    { thai: "", english: "spa" }
                ]
            },
            {
                name: "Personal Care",
                words: [
                    { thai: "", english: "haircut" },
                    { thai: "", english: "to do hair" },
                    { thai: "", english: "to dye hair" },
                    { thai: "", english: "to shave" },
                    { thai: "", english: "to put on makeup" },
                    { thai: "", english: "to apply lipstick" },
                    { thai: "", english: "perfume" },
                    { thai: "", english: "soap" },
                    { thai: "", english: "shampoo" },
                    { thai: "", english: "cream/lotion" },
                    { thai: "", english: "toothpaste" },
                    { thai: "", english: "toothbrush" },
                    { thai: "", english: "comb" },
                    { thai: "", english: "hair dryer" },
                    { thai: "", english: "razor/shaver" },
                    { thai: "", english: "nail clipper" },
                    { thai: "", english: "to wash" },
                    { thai: "", english: "to repair/fix" },
                    { thai: "", english: "to prepare oneself" },
                    { thai: "", english: "to change/alter" }
                ]
            },
            {
                name: "Household Chores",
                words: [
                    { thai: "", english: "to sweep" },
                    { thai: "", english: "to wipe" },
                    { thai: "", english: "to wash dishes" },
                    { thai: "", english: "to clean" },
                    { thai: "", english: "to tidy room" },
                    { thai: "", english: "to plant/grow" },
                    { thai: "", english: "to water (plants)" },
                    { thai: "", english: "to build/create" },
                    { thai: "", english: "to destroy/break" },
                    { thai: "", english: "to fix/correct" },
                    { thai: "", english: "to improve" },
                    { thai: "", english: "to develop" },
                    { thai: "", english: "to design" },
                    { thai: "", english: "to draw" },
                    { thai: "", english: "to paint/color" }
                ]
            },
            {
                name: "Abstract & Concepts",
                words: [
                    { thai: "", english: "good luck" },
                    { thai: "", english: "bad luck" },
                    { thai: "", english: "dream" },
                    { thai: "", english: "truth/reality" },
                    { thai: "", english: "secret" },
                    { thai: "", english: "problem" },
                    { thai: "", english: "answer" },
                    { thai: "", english: "question" },
                    { thai: "", english: "reason" },
                    { thai: "", english: "idea/thought" },
                    { thai: "", english: "success" },
                    { thai: "", english: "failure" },
                    { thai: "", english: "opportunity/chance" },
                    { thai: "", english: "way/path" },
                    { thai: "", english: "choice/option" },
                    { thai: "", english: "goal/target" },
                    { thai: "", english: "plan" },
                    { thai: "", english: "rule" },
                    { thai: "", english: "law" },
                    { thai: "", english: "right (legal)" },
                    { thai: "", english: "duty/responsibility" },
                    { thai: "", english: "crowded" }
                ]
            },
            {
                name: "Physical Actions",
                words: [
                    { thai: "", english: "to return/give back" },
                    { thai: "", english: "to borrow (general)" },
                    { thai: "", english: "to lend" },
                    { thai: "", english: "to keep/collect" },
                    { thai: "", english: "to throw away" },
                    { thai: "", english: "to find/look for" },
                    { thai: "", english: "to meet/find" },
                    { thai: "", english: "to encounter/meet" },
                    { thai: "", english: "to separate" },
                    { thai: "", english: "to combine/include" },
                    { thai: "", english: "to add/increase" },
                    { thai: "", english: "to reduce/decrease" },
                    { thai: "", english: "to expand" },
                    { thai: "", english: "to shrink/abbreviate" },
                    { thai: "", english: "to pull" },
                    { thai: "", english: "to push" },
                    { thai: "", english: "to lift" },
                    { thai: "", english: "to place/put down" },
                    { thai: "", english: "to hang" },
                    { thai: "", english: "to unwrap/open" },
                    { thai: "", english: "to wrap" },
                    { thai: "", english: "to cut" }
                ]
            },
            {
                name: "Grammar & Particles",
                words: [
                    { thai: "", english: "but" },
                    { thai: "", english: "and" },
                    { thai: "", english: "or" },
                    { thai: "", english: "because" },
                    { thai: "", english: "if" },
                    { thai: "", english: "then/also" },
                    { thai: "", english: "also/too/with" },
                    { thai: "", english: "so/at all/very" },
                    { thai: "", english: "(softener particle)" },
                    { thai: "", english: "(polite particle, male)" },
                    { thai: "", english: "(polite particle, female)" },
                    { thai: "", english: "(question particle, female)" },
                    { thai: "", english: "(yes/no question)" },
                    { thai: "", english: "(urging particle)" },
                    { thai: "", english: "(really?/is that so?)" },
                    { thai: "", english: "I (female)" },
                    { thai: "", english: "I (male)" },
                    { thai: "", english: "you" },
                    { thai: "", english: "he/she/they" },
                    { thai: "", english: "we" },
                    { thai: "", english: "it" },
                    { thai: "", english: "this" },
                    { thai: "", english: "that" },
                    { thai: "", english: "that (over there)" },
                    { thai: "", english: "of/belonging to" },
                    { thai: "", english: "that/which/where" },
                    { thai: "", english: "not/no" },
                    { thai: "", english: "yes/correct" },
                    { thai: "", english: "no/not correct" },
                    { thai: "", english: "enough" },
                    { thai: "", english: "very/much" },
                    { thai: "", english: "little/few" },
                    { thai: "", english: "every/all" },
                    { thai: "", english: "some" },
                    { thai: "", english: "just/only" },
                    { thai: "", english: "oneself/itself" }
                ]
            },
            {
                name: "Common Phrases",
                words: [
                    { thai: "", english: "How are you?" },
                    { thai: "", english: "I'm fine" },
                    { thai: "", english: "Not well/sick" },
                    { thai: "", english: "Long time no see" },
                    { thai: "", english: "Nice to meet you" },
                    { thai: "", english: "Have you eaten?" },
                    { thai: "", english: "Already ate" },
                    { thai: "", english: "Haven't eaten yet" },
                    { thai: "", english: "What's up?" },
                    { thai: "", english: "How's it going?" },
                    { thai: "", english: "See you later" },
                    { thai: "", english: "See you tomorrow" },
                    { thai: "", english: "Good luck!" },
                    { thai: "", english: "Congratulations!" },
                    { thai: "", english: "Happy birthday!" },
                    { thai: "", english: "Best wishes" },
                    { thai: "", english: "Up to you" },
                    { thai: "", english: "Never mind/forget it" },
                    { thai: "", english: "Really?" },
                    { thai: "", english: "No way!" },
                    { thai: "", english: "Of course/certainly" },
                    { thai: "", english: "I understand now" },
                    { thai: "", english: "Wait a moment" },
                    { thai: "", english: "Make yourself at home" },
                    { thai: "", english: "Please (go ahead)" },
                    { thai: "", english: "Sorry about that" },
                    { thai: "", english: "Don't worry" },
                    { thai: "", english: "Be careful" },
                    { thai: "", english: "Are you tired?" },
                    { thai: "", english: "Are you hungry?" },
                    { thai: "", english: "It's very hot" },
                    { thai: "", english: "It's raining" },
                    { thai: "", english: "What would you like?" },
                    { thai: "", english: "Very delicious!" },
                    { thai: "", english: "Is it cool?" },
                    { thai: "", english: "Is it fun?" },
                    { thai: "", english: "It's been so long!" },
                    { thai: "", english: "I miss you" },
                    { thai: "", english: "See you again" },
                    { thai: "", english: "What should I do?" },
                    { thai: "", english: "Don't be shy/Don't hold back" },
                    { thai: "", english: "It's no big deal" },
                    { thai: "", english: "I'm heading home" },
                    { thai: "", english: "See you around" },
                    { thai: "", english: "Take care of yourself" },
                    { thai: "", english: "Rest well" },
                    { thai: "", english: "Get well soon" },
                    { thai: "", english: "Have a safe trip" },
                    { thai: "", english: "Don't forget" },
                    { thai: "", english: "Do you understand?" },
                    { thai: "", english: "Can you say that again?" },
                    { thai: "", english: "It's okay/Never mind" },
                    { thai: "", english: "Alright then/That works" },
                    { thai: "", english: "Are you sure?" },
                    { thai: "", english: "Can do/Possible" }
                ]
            },
            {
                name: "Development & International",
                words: [
                    { thai: "", english: "development" },
                    { thai: "", english: "sustainable development" },
                    { thai: "", english: "sustainability" },
                    { thai: "", english: "United Nations" },
                    { thai: "", english: "organization" },
                    { thai: "", english: "international organization" },
                    { thai: "", english: "goal/target" },
                    { thai: "", english: "policy" },
                    { thai: "", english: "project/program" },
                    { thai: "", english: "cooperation" },
                    { thai: "", english: "assistance/aid" },
                    { thai: "", english: "funding/capital" },
                    { thai: "", english: "budget" },
                    { thai: "", english: "poverty" },
                    { thai: "", english: "inequality" },
                    { thai: "", english: "environment" },
                    { thai: "", english: "climate change" },
                    { thai: "", english: "renewable energy" },
                    { thai: "", english: "clean energy" },
                    { thai: "", english: "education" },
                    { thai: "", english: "public health" },
                    { thai: "", english: "human rights" },
                    { thai: "", english: "equality" },
                    { thai: "", english: "gender equality" },
                    { thai: "", english: "community" },
                    { thai: "", english: "people/citizens" },
                    { thai: "", english: "stakeholder" },
                    { thai: "", english: "civil society" },
                    { thai: "", english: "private sector" },
                    { thai: "", english: "public sector/government" },
                    { thai: "", english: "government" },
                    { thai: "", english: "ministry" },
                    { thai: "", english: "developing country" },
                    { thai: "", english: "developed country" },
                    { thai: "", english: "resources" },
                    { thai: "", english: "natural resources" },
                    { thai: "", english: "clean water" },
                    { thai: "", english: "sanitation" },
                    { thai: "", english: "infrastructure" },
                    { thai: "", english: "meeting/conference" },
                    { thai: "", english: "agreement" },
                    { thai: "", english: "treaty" },
                    { thai: "", english: "negotiation" },
                    { thai: "", english: "indicator" },
                    { thai: "", english: "monitoring" },
                    { thai: "", english: "evaluation" },
                    { thai: "", english: "report" },
                    { thai: "", english: "data/information" },
                    { thai: "", english: "research" },
                    { thai: "", english: "innovation" },
                    { thai: "", english: "technology" },
                    { thai: "", english: "digital" },
                    { thai: "", english: "refugee" },
                    { thai: "", english: "migration" },
                    { thai: "", english: "humanitarian" },
                    { thai: "", english: "disaster" },
                    { thai: "", english: "emergency" },
                    { thai: "", english: "recovery/rehabilitation" },
                    { thai: "", english: "security" },
                    { thai: "", english: "peace" }
                ]
            }
        ];

        // Generate mixed lists from themed lists
        function generateMixedLists() {
            // Collect all words with their theme index for even distribution
            const allWords = [];
            themedLists.forEach((theme, themeIdx) => {
                theme.words.forEach(word => {
                    allWords.push({ ...word, themeIdx });
                });
            });
            
            // Shuffle deterministically using a seeded approach (based on Thai text)
            allWords.sort((a, b) => {
                const hashA = a.thai.split('').reduce((acc, c) => acc + c.charCodeAt(0), 0);
                const hashB = b.thai.split('').reduce((acc, c) => acc + c.charCodeAt(0), 0);
                return hashA - hashB;
            });
            
            // Split into chunks of ~182 words (726 / 4)
            const chunkSize = Math.ceil(allWords.length / 4);
            const mixedLists = [];
            
            for (let i = 0; i < 4; i++) {
                const start = i * chunkSize;
                const end = Math.min(start + chunkSize, allWords.length);
                const words = allWords.slice(start, end).map(({ thai, english }) => ({ thai, english }));
                mixedLists.push({
                    name: "Mixed List " + String.fromCharCode(65 + i) + " (" + words.length + " words)",
                    words
                });
            }
            
            return mixedLists;
        }

        const mixedLists = generateMixedLists();
        
        // Current view mode: 'themed' or 'mixed'
        let viewMode = localStorage.getItem('thaiFlashcardsViewMode') || 'mixed';
        
        // Get active vocabulary lists based on view mode
        function getActiveVocabularyLists() {
            return viewMode === 'themed' ? themedLists : mixedLists;
        }
        
        let vocabularyLists = getActiveVocabularyLists();

        const LEARNING_THRESHOLD = 3;
        const BASE_REVIEW_DAYS = 7; // Base review interval for easily learned words
        const MIN_REVIEW_DAYS = 1;  // Minimum review interval for hard words
        
        // Calculate review interval based on difficulty
        // Words learned easily (low incorrect count, high streak) get longer intervals
        // Words learned with difficulty get shorter intervals
        function getReviewInterval(stats) {
            if (!stats) return BASE_REVIEW_DAYS;
            
            const incorrectCount = stats.incorrect || 0;
            const correctCount = stats.correct || 0;
            const streak = stats.consecutiveCorrect || 0;
            
            // Difficulty factor: higher = harder word
            // Based on ratio of incorrect to total attempts and absolute incorrect count
            const totalAttempts = correctCount + incorrectCount;
            const errorRate = totalAttempts > 0 ? incorrectCount / totalAttempts : 0;
            
            // Ease factor: starts at 1.0, increases with streak, decreases with errors
            // Range roughly 0.3 (very hard) to 2.5 (very easy)
            let easeFactor = 1.0;
            easeFactor += (streak - LEARNING_THRESHOLD) * 0.2; // Bonus for streaks beyond threshold
            easeFactor -= errorRate * 1.5; // Penalty for error rate
            easeFactor -= Math.min(incorrectCount * 0.1, 0.5); // Additional penalty for absolute errors
            easeFactor = Math.max(0.3, Math.min(2.5, easeFactor)); // Clamp
            
            // Calculate interval: base * ease factor
            const interval = BASE_REVIEW_DAYS * easeFactor;
            return Math.max(MIN_REVIEW_DAYS, Math.round(interval * 10) / 10);
        }

        // Utility functions - must be defined before use
        function getCardKey(card) { return card.thai + "|" + card.english; }
        function getListStats(idx) { if (!cardStats[idx]) cardStats[idx] = {}; return cardStats[idx]; }

        let currentListIndex = 0;
        let vocabulary = vocabularyLists[currentListIndex].words;
        let cards = [];
        let currentIndex = 0;
        let isFlipped = false;
        let showThaiFront = localStorage.getItem('thaiFlashcardsThaiFront') !== 'false';
        let autoPlayAudio = localStorage.getItem('thaiFlashcardsAutoPlay') === 'true';
        let currentMode = 'all';
        let cardStats = {};
        let sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
        let sessionState = { cardOrder: [], currentIndex: 0, listIndex: 0, mode: 'all', inProgress: false };
        let favorites = new Set(); // Track favorited card keys
        let darkMode = false;
        
        // Mode-specific state: track cards and position separately for each mode
        let modeState = {
            all: { cards: [], currentIndex: 0 },
            review: { cards: [], currentIndex: 0 }
        };

        // Special list indices (negative to distinguish from vocabulary lists)
        const FAVORITES_LIST = -1;
        const HARDEST_LIST = -2;
        const ALL_CARDS_LIST = -3;

        let touchStartX = 0, touchStartY = 0, currentX = 0, isSwiping = false, lastTouchEnd = 0;

        const flashcard = document.getElementById('flashcard');
        const frontText = document.getElementById('frontText');
        const backText = document.getElementById('backText');
        const frontRomanization = document.getElementById('frontRomanization');
        const backRomanization = document.getElementById('backRomanization');
        const masteryIndicator = document.getElementById('masteryIndicator');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const flipBtn = document.getElementById('flipBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const toggleBtn = document.getElementById('toggleBtn');
        const sentenceBtn = document.getElementById('sentenceBtn');
        const sentenceExample = document.getElementById('sentenceExample');
        const sentenceThai = document.getElementById('sentenceThai');
        const sentenceRoman = document.getElementById('sentenceRoman');
        const sentenceEnglish = document.getElementById('sentenceEnglish');
        const cardCounter = document.getElementById('cardCounter');
        const progressPercent = document.getElementById('progressPercent');
        const progressFill = document.getElementById('progressFill');
        const correctScore = document.getElementById('correctScore');
        const incorrectScore = document.getElementById('incorrectScore');
        const csvFileInput = document.getElementById('csvFileInput');
        const settingsBtn = document.getElementById('settingsBtn');
        const statsBtn = document.getElementById('statsBtn');
        const optionsBtn = document.getElementById('optionsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const statsModal = document.getElementById('statsModal');
        const optionsModal = document.getElementById('optionsModal');
        const resumeModal = document.getElementById('resumeModal');
        const listSelector = document.getElementById('listSelector');
        const listProgressDisplay = document.getElementById('listProgressDisplay');
        const swipeLeft = document.getElementById('swipeLeft');
        const swipeRight = document.getElementById('swipeRight');
        const swipeBarLeft = document.getElementById('swipeBarLeft');
        const swipeBarRight = document.getElementById('swipeBarRight');
        const toast = document.getElementById('toast');
        const modeBtns = document.querySelectorAll('.mode-btn');
        const themeToggle = document.getElementById('themeToggle');
        const romanizationToggle = document.getElementById('romanizationToggle');
        
        // App mode (flashcards vs grammar)
        let currentAppMode = 'flashcards';
        
        // Grammar functions
        function renderGrammarLessonsList() {
            var container = document.getElementById('grammarLessonsList');
            var html = '';
            
            grammarLessons.forEach(function(lesson, index) {
                var isCompleted = lessonProgress[lesson.id];
                var statusClass = isCompleted ? 'completed' : '';
                var statusText = isCompleted ? ' Practice' : 'Start Lesson';
                
                html += '<div class="grammar-lesson-card ' + statusClass + '" data-lesson="' + index + '" data-completed="' + (isCompleted ? 'true' : 'false') + '">' +
                    '<div class="lesson-card-header">' +
                        '<span class="lesson-card-title">' + lesson.title + '</span>' +
                        '<span class="lesson-card-thai">' + lesson.structure + '</span>' +
                    '</div>' +
                    '<div class="lesson-card-desc">' + lesson.description + '</div>' +
                    '<div class="lesson-card-example">' +
                        '<div class="thai">' + lesson.examples[0].thai + '</div>' +
                        '<div class="english">' + lesson.examples[0].english + '</div>' +
                    '</div>' +
                    '<div class="lesson-card-footer">' +
                        '<span class="lesson-card-status ' + statusClass + '">' + (isCompleted ? ' Learned' : '') + '</span>' +
                        '<button class="lesson-card-btn ' + statusClass + '">' + statusText + '</button>' +
                    '</div>' +
                '</div>';
            });
            
            container.innerHTML = html;
            
            // Add click listeners
            document.querySelectorAll('.grammar-lesson-card').forEach(function(card) {
                card.addEventListener('click', function(e) {
                    // Prevent double firing if clicking the button
                    if (e.target.classList.contains('lesson-card-btn')) return;
                    
                    var lessonIndex = parseInt(this.getAttribute('data-lesson'));
                    var isCompleted = this.getAttribute('data-completed') === 'true';
                    
                    if (isCompleted) {
                        // Go straight to practice
                        openGrammarLesson(lessonIndex);
                        currentStepIndex = 4; // Go to build sentence step
                        renderLessonStep();
                    } else {
                        openGrammarLesson(lessonIndex);
                    }
                });
            });
            
            // Button click listeners
            document.querySelectorAll('.lesson-card-btn').forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    var card = this.closest('.grammar-lesson-card');
                    var lessonIndex = parseInt(card.getAttribute('data-lesson'));
                    var isCompleted = card.getAttribute('data-completed') === 'true';
                    
                    if (isCompleted) {
                        // Go straight to build practice
                        currentLessonIndex = lessonIndex;
                        var lesson = grammarLessons[lessonIndex];
                        startPractice(lesson.id, 'build');
                    } else {
                        openGrammarLesson(lessonIndex);
                    }
                });
            });
        }
        
        function openGrammarLesson(index) {
            currentLessonIndex = index;
            currentStepIndex = 0;
            
            document.getElementById('grammarLessonsList').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'block';
            
            renderLessonStep();
        }
        
        function closeGrammarLesson() {
            currentLessonIndex = null;
            currentStepIndex = 0;
            
            document.getElementById('grammarLessonView').style.display = 'none';
            document.getElementById('grammarLessonsList').style.display = 'flex';
            
            renderGrammarLessonsList();
        }
        
        function renderLessonStep() {
            var lesson = grammarLessons[currentLessonIndex];
            var container = document.getElementById('lessonContent');
            var totalSteps = 5; // Structure, Explanation, Examples, Guided Practice, Build Sentences
            
            document.getElementById('lessonProgress').textContent = (currentStepIndex + 1) + ' / ' + totalSteps;
            
            var html = '';
            
            if (currentStepIndex === 0) {
                // Structure overview
                html = '<div class="lesson-step active">' +
                    '<div class="lesson-step-title">Pattern</div>' +
                    '<div class="lesson-structure">' +
                        '<div class="lesson-structure-thai">' + lesson.structure + '</div>' +
                        '<div class="lesson-structure-roman">' + lesson.structureRoman + '</div>' +
                        '<div class="lesson-structure-english">' + lesson.structureEnglish + '</div>' +
                    '</div>' +
                    '<div class="lesson-explanation">' + lesson.description + '</div>' +
                '</div>';
            } else if (currentStepIndex === 1) {
                // Explanation
                html = '<div class="lesson-step active">' +
                    '<div class="lesson-step-title">How it works</div>' +
                    '<div class="lesson-structure">' +
                        '<div class="lesson-structure-thai">' + lesson.structure + '</div>' +
                    '</div>' +
                    '<div class="lesson-explanation">' + lesson.explanation + '</div>' +
                '</div>';
            } else if (currentStepIndex === 2) {
                // Examples
                html = '<div class="lesson-step active">' +
                    '<div class="lesson-step-title">Examples</div>' +
                    '<div class="lesson-examples">';
                
                lesson.examples.forEach(function(ex) {
                    html += '<div class="example-card">' +
                        '<div class="example-thai">' + ex.thai + '</div>' +
                        '<div class="example-roman">' + ex.roman + '</div>' +
                        '<div class="example-english">' + ex.english + '</div>' +
                    '</div>';
                });
                
                html += '</div></div>';
            } else if (currentStepIndex === 3) {
                // Step 4: Fill-in-blank intro (single question as guided practice)
                var hasTemplates = grammarPracticeTemplates[lesson.id];
                
                html = '<div class="lesson-step active">' +
                    '<div class="lesson-step-title">Guided Practice</div>' +
                    '<p style="color: var(--text-secondary); margin-bottom: 16px; text-align: center;">Fill in the grammar words to complete this sentence:</p>';
                
                if (hasTemplates) {
                    // Will be populated by startGuidedFillBlank
                    html += '<div id="guidedFillBlankContainer"></div>';
                } else {
                    html += '<p style="text-align: center; color: var(--text-muted);">No guided practice available for this lesson.</p>';
                }
                
                html += '</div>';
            } else if (currentStepIndex === 4) {
                // Step 5: Build Sentence practice (repeatable)
                var hasTemplates = grammarPracticeTemplates[lesson.id];
                
                html = '<div class="lesson-step active">' +
                    '<div class="lesson-step-title">Build Sentences</div>' +
                    '<div class="lesson-structure" style="margin-bottom: 16px;">' +
                        '<div class="lesson-structure-thai">' + lesson.structure + '</div>' +
                        '<div class="lesson-structure-english">' + lesson.structureEnglish + '</div>' +
                    '</div>';
                
                if (hasTemplates) {
                    html += '<p style="color: var(--text-secondary); margin-bottom: 20px; text-align: center;">Arrange the words to build correct sentences.</p>' +
                        '<div class="practice-start-buttons">' +
                            '<button class="btn-action practice-start-btn" data-mode="build" style="width: 100%;">' +
                                '<strong> Start Practice</strong><br>' +
                                '<small style="opacity: 0.8;">Arrange Thai words in correct order</small>' +
                            '</button>' +
                        '</div>';
                } else {
                    html += '<p style="text-align: center; color: var(--text-muted);">No practice available for this lesson.</p>';
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
            
            // Handle step-specific setup
            if (currentStepIndex === 3 && grammarPracticeTemplates[lesson.id]) {
                // Start guided fill-in-blank
                startGuidedFillBlank(lesson.id);
            }
            
            if (currentStepIndex === 4) {
                document.querySelectorAll('.practice-start-btn').forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        startPractice(lesson.id, 'build');
                    });
                });
            }
            
            // Update nav buttons
            document.getElementById('lessonPrevBtn').disabled = currentStepIndex === 0;
            var totalSteps = 5;
            document.getElementById('lessonNextBtn').textContent = currentStepIndex === totalSteps - 1 ? 'Finish' : 'Next ';
            
            // Disable Next on guided practice step until completed correctly
            if (currentStepIndex === 3 && grammarPracticeTemplates[lesson.id]) {
                document.getElementById('lessonNextBtn').disabled = true;
                window.guidedPracticeCompleted = false;
            } else {
                document.getElementById('lessonNextBtn').disabled = false;
            }
        }
        
        function setupPracticeListeners() {
            var options = document.querySelectorAll('.practice-option');
            var checkBtn = document.getElementById('practiceCheckBtn');
            var selectedIndex = null;
            
            options.forEach(function(opt) {
                opt.addEventListener('click', function() {
                    if (this.classList.contains('correct') || this.classList.contains('incorrect')) return;
                    
                    options.forEach(function(o) { o.classList.remove('selected'); });
                    this.classList.add('selected');
                    selectedIndex = parseInt(this.getAttribute('data-index'));
                    checkBtn.disabled = false;
                });
            });
            
            checkBtn.addEventListener('click', function() {
                if (selectedIndex === null) return;
                
                var selected = document.querySelector('.practice-option.selected');
                var isCorrect = selected.getAttribute('data-correct') === 'true';
                var feedback = document.getElementById('practiceFeedback');
                
                // Show correct/incorrect
                options.forEach(function(opt) {
                    if (opt.getAttribute('data-correct') === 'true') {
                        opt.classList.add('correct');
                    } else if (opt.classList.contains('selected')) {
                        opt.classList.add('incorrect');
                    }
                });
                
                feedback.classList.add('show');
                feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
                
                // Mark lesson as completed
                var lesson = grammarLessons[currentLessonIndex];
                lessonProgress[lesson.id] = true;
                localStorage.setItem('thaiGrammarProgress', JSON.stringify(lessonProgress));
                
                checkBtn.textContent = isCorrect ? ' Correct!' : 'See explanation above';
                checkBtn.disabled = true;
            });
        }
        
        function nextLessonStep() {
            if (currentStepIndex < 4) {
                currentStepIndex++;
                renderLessonStep();
            } else {
                // Mark lesson as completed when finishing
                var lesson = grammarLessons[currentLessonIndex];
                lessonProgress[lesson.id] = true;
                localStorage.setItem('thaiGrammarProgress', JSON.stringify(lessonProgress));
                closeGrammarLesson();
            }
        }
        
        function prevLessonStep() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                renderLessonStep();
            }
        }
        
        // Guided Fill-in-Blank (single question within lesson flow)
        function startGuidedFillBlank(lessonId) {
            var templates = grammarPracticeTemplates[lessonId];
            if (!templates || !templates.fillBlanks.length) return;
            
            // Pick a random fill-blank item
            var item = templates.fillBlanks[Math.floor(Math.random() * templates.fillBlanks.length)];
            var container = document.getElementById('guidedFillBlankContainer');
            
            window.guidedFillItem = item;
            window.guidedFillChecked = false;
            
            // Create sentence with blanks
            var sentenceHtml = item.sentence;
            var blankIndex = 0;
            while (sentenceHtml.indexOf('___') !== -1) {
                sentenceHtml = sentenceHtml.replace('___', '<span class="blank guided-blank" data-index="' + blankIndex + '" data-answer="' + item.blanks[blankIndex] + '"></span>');
                blankIndex++;
            }
            
            // Create word options (correct answers + distractors, shuffled)
            var options = [...item.blanks];
            var distractors = shuffleArray([...templates.distractors]).slice(0, Math.max(3, 6 - item.blanks.length));
            options = shuffleArray([...options, ...distractors]);
            
            var optionsHtml = '';
            options.forEach(function(word) {
                optionsHtml += '<div class="practice-word-option guided-option" data-word="' + word + '">' + word + '</div>';
            });
            
            container.innerHTML = 
                '<div class="practice-question">' +
                    '<div class="practice-english">' + item.english + '</div>' +
                    '<div class="practice-sentence" id="guidedSentence">' + sentenceHtml + '</div>' +
                '</div>' +
                '<div class="practice-word-options" id="guidedOptions">' + optionsHtml + '</div>' +
                '<div class="practice-buttons" id="guidedButtons">' +
                    '<button class="practice-check-btn" id="guidedSubmitBtn" disabled>Check Answer</button>' +
                '</div>' +
                '<div class="practice-result" id="guidedResult" style="display:none;"></div>';
            
            // Add click listeners to word options
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.addEventListener('click', function() {
                    if (!window.guidedFillChecked) {
                        handleGuidedFillSelect(this.getAttribute('data-word'), this);
                    }
                });
            });
            
            // Add click listeners to blanks (to remove filled words)
            document.querySelectorAll('.guided-blank').forEach(function(blank) {
                blank.addEventListener('click', function() {
                    if (!window.guidedFillChecked) {
                        handleGuidedBlankClick(this);
                    }
                });
            });
            
            // Submit button listener
            document.getElementById('guidedSubmitBtn').addEventListener('click', checkGuidedFillAnswer);
        }
        
        function handleGuidedFillSelect(word, optionEl) {
            var blanks = document.querySelectorAll('.guided-blank');
            
            // Find first empty blank
            var targetBlank = null;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    targetBlank = blanks[i];
                    break;
                }
            }
            
            if (!targetBlank) return;
            
            targetBlank.innerHTML = '<span class="filled-word">' + word + '</span>';
            targetBlank.setAttribute('data-filled', word);
            targetBlank.classList.add('filled');
            optionEl.classList.add('used');
            
            updateGuidedSubmitState();
        }
        
        function handleGuidedBlankClick(blank) {
            var filledWord = blank.getAttribute('data-filled');
            if (!filledWord) return;
            
            blank.innerHTML = '';
            blank.removeAttribute('data-filled');
            blank.classList.remove('filled');
            
            var option = document.querySelector('.guided-option[data-word="' + filledWord + '"]');
            if (option) option.classList.remove('used');
            
            updateGuidedSubmitState();
        }
        
        function updateGuidedSubmitState() {
            var blanks = document.querySelectorAll('.guided-blank');
            var allFilled = true;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    allFilled = false;
                    break;
                }
            }
            document.getElementById('guidedSubmitBtn').disabled = !allFilled;
        }
        
        function checkGuidedFillAnswer() {
            var item = window.guidedFillItem;
            var blanks = document.querySelectorAll('.guided-blank');
            
            var userAnswers = [];
            blanks.forEach(function(blank) {
                userAnswers.push(blank.getAttribute('data-filled') || '');
            });
            
            var allCorrect = true;
            for (var i = 0; i < item.blanks.length; i++) {
                if (userAnswers[i] !== item.blanks[i]) {
                    allCorrect = false;
                    break;
                }
            }
            
            window.guidedFillChecked = true;
            
            // Show visual feedback
            blanks.forEach(function(blank, i) {
                if (userAnswers[i] === item.blanks[i]) {
                    blank.classList.add('correct');
                    blank.classList.remove('filled');
                } else {
                    blank.classList.add('incorrect');
                    blank.classList.remove('filled');
                }
            });
            
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.style.pointerEvents = 'none';
            });
            
            var resultEl = document.getElementById('guidedResult');
            var buttonsEl = document.getElementById('guidedButtons');
            
            if (allCorrect) {
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result correct';
                resultEl.innerHTML = ' Correct! Click Next to continue to sentence building.';
                buttonsEl.innerHTML = '';
                
                // Enable the Next button
                window.guidedPracticeCompleted = true;
                document.getElementById('lessonNextBtn').disabled = false;
            } else {
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result incorrect';
                resultEl.innerHTML = ' Not quite right...';
                
                buttonsEl.innerHTML = 
                    '<button class="btn-action" id="guidedTryAgainBtn" style="margin-right: 10px;"> Try Again</button>' +
                    '<button class="btn-flip" id="guidedRevealBtn"> Show Answer</button>';
                
                document.getElementById('guidedTryAgainBtn').addEventListener('click', function() {
                    resetGuidedFillBlank();
                });
                
                document.getElementById('guidedRevealBtn').addEventListener('click', function() {
                    revealGuidedAnswer();
                });
            }
        }
        
        function resetGuidedFillBlank() {
            var blanks = document.querySelectorAll('.guided-blank');
            
            blanks.forEach(function(blank) {
                blank.innerHTML = '';
                blank.removeAttribute('data-filled');
                blank.classList.remove('filled', 'correct', 'incorrect');
            });
            
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.classList.remove('used');
                opt.style.pointerEvents = '';
            });
            
            window.guidedFillChecked = false;
            
            document.getElementById('guidedButtons').innerHTML = 
                '<button class="practice-check-btn" id="guidedSubmitBtn" disabled>Check Answer</button>';
            document.getElementById('guidedSubmitBtn').addEventListener('click', checkGuidedFillAnswer);
            
            document.getElementById('guidedResult').style.display = 'none';
        }
        
        function revealGuidedAnswer() {
            var item = window.guidedFillItem;
            var blanks = document.querySelectorAll('.guided-blank');
            
            // Show the correct answer
            var resultEl = document.getElementById('guidedResult');
            resultEl.className = 'practice-result incorrect';
            resultEl.innerHTML = 'The correct answer is: <strong>' + item.blanks.join(' ... ') + '</strong><br>Now fill it in correctly to continue.';
            
            // Reset blanks so user can try again with the answer visible
            blanks.forEach(function(blank) {
                blank.innerHTML = '';
                blank.removeAttribute('data-filled');
                blank.classList.remove('filled', 'correct', 'incorrect');
            });
            
            // Reset all options
            document.querySelectorAll('.guided-option').forEach(function(opt) {
                opt.classList.remove('used');
                opt.style.pointerEvents = '';
            });
            
            // Reset state but mark that answer was revealed
            window.guidedFillChecked = false;
            window.guidedAnswerRevealed = true;
            
            // Reset buttons
            document.getElementById('guidedButtons').innerHTML = 
                '<button class="practice-check-btn" id="guidedSubmitBtn" disabled>Check Answer</button>';
            document.getElementById('guidedSubmitBtn').addEventListener('click', checkGuidedFillAnswer);
        }
        
        // Practice Mode Functions
        function startPractice(lessonId, mode) {
            currentPracticeLesson = lessonId;
            currentPracticeMode = mode || 'build';
            currentPracticeIndex = 0;
            practiceScore = { correct: 0, total: 0 };
            
            var templates = grammarPracticeTemplates[lessonId];
            if (!templates) {
                showToast('No practice available for this lesson');
                return;
            }
            
            // Only use build mode now
            currentPracticeItems = shuffleArray([...templates.sentenceBuilds]);
            
            // Hide both lessons list and lesson view, show practice view
            document.getElementById('grammarLessonsList').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'none';
            document.getElementById('grammarPracticeView').style.display = 'block';
            
            renderPracticeQuestion();
        }
        
        function shuffleArray(arr) {
            var shuffled = [...arr];
            for (var i = shuffled.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = shuffled[i];
                shuffled[i] = shuffled[j];
                shuffled[j] = temp;
            }
            return shuffled;
        }
        
        function renderPracticeQuestion() {
            var container = document.getElementById('practiceContent');
            var item = currentPracticeItems[currentPracticeIndex];
            var templates = grammarPracticeTemplates[currentPracticeLesson];
            
            document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
            
            if (!item) {
                // Practice complete
                renderPracticeComplete();
                return;
            }
            
            renderBuildQuestion(item, templates);
        }
        
        function renderFillBlankQuestion(item, templates) {
            var container = document.getElementById('practiceContent');
            
            // Reset state
            currentBlankIndex = 0;
            filledBlanks = [];
            window.fillBlankItem = item;
            window.fillBlankChecked = false;
            
            // Create sentence with blanks
            var sentenceHtml = item.sentence;
            var blankIndex = 0;
            while (sentenceHtml.indexOf('___') !== -1) {
                sentenceHtml = sentenceHtml.replace('___', '<span class="blank" data-index="' + blankIndex + '" data-answer="' + item.blanks[blankIndex] + '"></span>');
                blankIndex++;
            }
            
            // Create word options (correct answers + distractors, shuffled)
            var options = [...item.blanks];
            var distractors = shuffleArray([...templates.distractors]).slice(0, Math.max(3, 6 - item.blanks.length));
            options = shuffleArray([...options, ...distractors]);
            
            var optionsHtml = '';
            options.forEach(function(word) {
                optionsHtml += '<div class="practice-word-option" data-word="' + word + '">' + word + '</div>';
            });
            
            container.innerHTML = 
                '<div class="practice-question">' +
                    '<div class="practice-english">' + item.english + '</div>' +
                    '<div class="practice-sentence" id="practiceSentence">' + sentenceHtml + '</div>' +
                '</div>' +
                '<div class="practice-word-options" id="practiceOptions">' + optionsHtml + '</div>' +
                '<div class="practice-buttons" id="practiceButtons">' +
                    '<button class="practice-check-btn" id="fillBlankSubmitBtn" disabled>Check Answer</button>' +
                '</div>' +
                '<div class="practice-result" id="practiceResult" style="display:none;"></div>';
            
            // Add click listeners to word options
            document.querySelectorAll('.practice-word-option').forEach(function(opt) {
                opt.addEventListener('click', function() {
                    if (!window.fillBlankChecked) {
                        handleFillBlankSelect(this.getAttribute('data-word'), this);
                    }
                });
            });
            
            // Add click listeners to blanks (to remove filled words)
            document.querySelectorAll('.practice-sentence .blank').forEach(function(blank) {
                blank.addEventListener('click', function() {
                    if (!window.fillBlankChecked) {
                        handleBlankClick(this);
                    }
                });
            });
            
            // Submit button listener
            document.getElementById('fillBlankSubmitBtn').addEventListener('click', checkFillBlankAnswer);
            
            document.getElementById('practiceNextBtn').style.display = 'none';
        }
        
        var currentBlankIndex = 0;
        var filledBlanks = [];
        
        function handleFillBlankSelect(word, optionEl) {
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Find first empty blank
            var targetBlank = null;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    targetBlank = blanks[i];
                    break;
                }
            }
            
            if (!targetBlank) return; // All blanks filled
            
            // Fill the blank
            targetBlank.innerHTML = '<span class="filled-word">' + word + '</span>';
            targetBlank.setAttribute('data-filled', word);
            targetBlank.classList.add('filled');
            
            // Mark the option as used
            optionEl.classList.add('used');
            
            // Update submit button state
            updateSubmitButtonState();
        }
        
        function handleBlankClick(blank) {
            var filledWord = blank.getAttribute('data-filled');
            if (!filledWord) return;
            
            // Clear the blank
            blank.innerHTML = '';
            blank.removeAttribute('data-filled');
            blank.classList.remove('filled');
            
            // Un-mark the option
            var option = document.querySelector('.practice-word-option[data-word="' + filledWord + '"]');
            if (option) option.classList.remove('used');
            
            // Update submit button state
            updateSubmitButtonState();
        }
        
        function updateSubmitButtonState() {
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            var allFilled = true;
            for (var i = 0; i < blanks.length; i++) {
                if (!blanks[i].hasAttribute('data-filled')) {
                    allFilled = false;
                    break;
                }
            }
            document.getElementById('fillBlankSubmitBtn').disabled = !allFilled;
        }
        
        function checkFillBlankAnswer() {
            var item = window.fillBlankItem;
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Gather user answers
            var userAnswers = [];
            blanks.forEach(function(blank) {
                userAnswers.push(blank.getAttribute('data-filled') || '');
            });
            
            // Check if correct
            var allCorrect = true;
            for (var i = 0; i < item.blanks.length; i++) {
                if (userAnswers[i] !== item.blanks[i]) {
                    allCorrect = false;
                    break;
                }
            }
            
            window.fillBlankChecked = true;
            
            // Show visual feedback on blanks
            blanks.forEach(function(blank, i) {
                if (userAnswers[i] === item.blanks[i]) {
                    blank.classList.add('correct');
                    blank.classList.remove('filled');
                } else {
                    blank.classList.add('incorrect');
                    blank.classList.remove('filled');
                }
            });
            
            // Disable word options
            document.querySelectorAll('.practice-word-option').forEach(function(opt) {
                opt.style.pointerEvents = 'none';
            });
            
            var resultEl = document.getElementById('practiceResult');
            var buttonsEl = document.getElementById('practiceButtons');
            
            if (allCorrect) {
                // Correct!
                practiceScore.total++;
                practiceScore.correct++;
                document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
                
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result correct';
                resultEl.innerHTML = ' Correct!';
                
                buttonsEl.innerHTML = '';
                document.getElementById('practiceNextBtn').style.display = 'block';
            } else {
                // Incorrect - offer try again or reveal
                resultEl.style.display = 'block';
                resultEl.className = 'practice-result incorrect';
                resultEl.innerHTML = ' Not quite right...';
                
                buttonsEl.innerHTML = 
                    '<button class="btn-action" id="tryAgainBtn" style="margin-right: 10px;"> Try Again</button>' +
                    '<button class="btn-flip" id="revealAnswerBtn"> Reveal Answer</button>';
                
                document.getElementById('tryAgainBtn').addEventListener('click', function() {
                    resetFillBlankQuestion();
                });
                
                document.getElementById('revealAnswerBtn').addEventListener('click', function() {
                    revealFillBlankAnswer();
                });
            }
        }
        
        function resetFillBlankQuestion() {
            var item = window.fillBlankItem;
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Clear all blanks
            blanks.forEach(function(blank) {
                blank.innerHTML = '';
                blank.removeAttribute('data-filled');
                blank.classList.remove('filled', 'correct', 'incorrect');
            });
            
            // Reset all options
            document.querySelectorAll('.practice-word-option').forEach(function(opt) {
                opt.classList.remove('used');
                opt.style.pointerEvents = '';
            });
            
            // Reset state
            window.fillBlankChecked = false;
            
            // Reset buttons
            document.getElementById('practiceButtons').innerHTML = 
                '<button class="practice-check-btn" id="fillBlankSubmitBtn" disabled>Check Answer</button>';
            document.getElementById('fillBlankSubmitBtn').addEventListener('click', checkFillBlankAnswer);
            
            // Hide result
            document.getElementById('practiceResult').style.display = 'none';
        }
        
        function revealFillBlankAnswer() {
            var item = window.fillBlankItem;
            var blanks = document.querySelectorAll('.practice-sentence .blank');
            
            // Count as attempted but wrong
            practiceScore.total++;
            document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
            
            // Show correct answers in blanks
            blanks.forEach(function(blank, i) {
                blank.innerHTML = '<span class="filled-word">' + item.blanks[i] + '</span>';
                blank.classList.remove('incorrect', 'filled');
                blank.classList.add('correct');
            });
            
            // Update result
            var resultEl = document.getElementById('practiceResult');
            resultEl.className = 'practice-result incorrect';
            resultEl.innerHTML = 'The correct answer is: <strong>' + item.blanks.join(' ... ') + '</strong>';
            
            // Show next button
            document.getElementById('practiceButtons').innerHTML = '';
            document.getElementById('practiceNextBtn').style.display = 'block';
        }
        
        function renderBuildQuestion(item, templates) {
            var container = document.getElementById('practiceContent');
            
            // Shuffle word order
            var shuffledWords = shuffleArray([...item.words]);
            
            var wordsHtml = '';
            shuffledWords.forEach(function(word, i) {
                wordsHtml += '<div class="build-word-chip" data-word="' + word + '" data-index="' + i + '">' + word + '</div>';
            });
            
            container.innerHTML = 
                '<div class="practice-question">' +
                    '<div class="practice-english">' + item.english + '</div>' +
                '</div>' +
                '<div class="build-target" id="buildTarget">' +
                    '<span class="build-placeholder">Tap words to build the sentence</span>' +
                '</div>' +
                '<div class="build-word-bank" id="buildWordBank">' + wordsHtml + '</div>' +
                '<div class="practice-result" id="practiceResult" style="display:none;"></div>';
            
            // Add click listeners
            document.querySelectorAll('.build-word-chip').forEach(function(chip) {
                chip.addEventListener('click', function() {
                    if (!this.classList.contains('used')) {
                        handleBuildSelect(this);
                    }
                });
            });
            
            document.getElementById('practiceNextBtn').style.display = 'none';
            window.buildItem = item;
        }
        
        function handleBuildSelect(chip) {
            var word = chip.getAttribute('data-word');
            var target = document.getElementById('buildTarget');
            
            // Remove placeholder if present
            var placeholder = target.querySelector('.build-placeholder');
            if (placeholder) placeholder.remove();
            
            // Add word to target
            var wordEl = document.createElement('div');
            wordEl.className = 'build-word';
            wordEl.textContent = word;
            wordEl.setAttribute('data-word', word);
            wordEl.onclick = function() {
                // Remove from target, add back to bank
                this.remove();
                chip.classList.remove('used');
                
                // Show placeholder if empty
                if (target.querySelectorAll('.build-word').length === 0) {
                    target.innerHTML = '<span class="build-placeholder">Tap words to build the sentence</span>';
                }
            };
            target.appendChild(wordEl);
            
            // Mark chip as used
            chip.classList.add('used');
            
            // Check if all words used
            var allUsed = document.querySelectorAll('.build-word-chip:not(.used)').length === 0;
            if (allUsed) {
                checkBuildAnswer();
            }
        }
        
        function checkBuildAnswer() {
            var item = window.buildItem;
            var target = document.getElementById('buildTarget');
            
            // Get answer from visual order in DOM, not from array
            var wordEls = target.querySelectorAll('.build-word');
            var userAnswer = Array.from(wordEls).map(function(el) { return el.getAttribute('data-word'); }).join('');
            var isCorrect = userAnswer === item.correct;
            
            practiceScore.total++;
            if (isCorrect) {
                practiceScore.correct++;
            }
            
            // Show visual feedback on target
            var target = document.getElementById('buildTarget');
            target.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            // Show result
            var resultEl = document.getElementById('practiceResult');
            resultEl.style.display = 'block';
            resultEl.className = 'practice-result clickable ' + (isCorrect ? 'correct' : 'incorrect');
            
            if (isCorrect) {
                resultEl.innerHTML = ' Correct!<div class="tap-hint">Tap to continue</div>';
            } else {
                resultEl.innerHTML = ' Not quite.<div class="practice-correct-answer">Correct: ' + item.correct + '</div><div class="tap-hint">Tap to continue</div>';
            }
            
            // Allow tap on result to advance
            resultEl.onclick = function() {
                nextPracticeQuestion();
            };
            
            document.getElementById('practiceScore').textContent = practiceScore.correct + ' / ' + practiceScore.total;
            document.getElementById('practiceNextBtn').style.display = 'block';
        }
        
        function renderPracticeComplete() {
            var container = document.getElementById('practiceContent');
            var percentage = practiceScore.total > 0 ? Math.round((practiceScore.correct / practiceScore.total) * 100) : 0;
            var emoji = percentage >= 80 ? '' : percentage >= 50 ? '' : '';
            
            container.innerHTML = 
                '<div class="practice-complete">' +
                    '<div class="practice-complete-icon">' + emoji + '</div>' +
                    '<div class="practice-complete-title">Practice Complete!</div>' +
                    '<div class="practice-complete-score">' + practiceScore.correct + ' / ' + practiceScore.total + ' (' + percentage + '%)</div>' +
                    '<div class="practice-complete-buttons">' +
                        '<button class="btn-action" onclick="restartPractice()"> Practice Again</button>' +
                        '<button class="btn-flip" onclick="backToLessons()"> Back to Lessons</button>' +
                    '</div>' +
                '</div>';
            
            document.getElementById('practiceNextBtn').style.display = 'none';
            
            // Mark lesson as completed
            var lesson = grammarLessons[currentLessonIndex];
            lessonProgress[lesson.id] = true;
            localStorage.setItem('thaiGrammarProgress', JSON.stringify(lessonProgress));
        }
        
        function restartPractice() {
            startPractice(currentPracticeLesson, 'build');
        }
        
        function backToLessons() {
            document.getElementById('grammarPracticeView').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'none';
            document.getElementById('grammarLessonsList').style.display = '';
            renderGrammarLessonsList();
        }
        
        function nextPracticeQuestion() {
            currentPracticeIndex++;
            renderPracticeQuestion();
        }
        
        function closePractice() {
            document.getElementById('grammarPracticeView').style.display = 'none';
            document.getElementById('grammarLessonView').style.display = 'block';
            renderLessonStep();
        }

        function switchAppMode(mode) {
            currentAppMode = mode;
            
            // Update buttons
            document.querySelectorAll('.app-mode-btn').forEach(function(btn) {
                btn.classList.toggle('active', btn.getAttribute('data-appmode') === mode);
            });
            
            // Show/hide sections
            var flashcardsSection = document.querySelector('.container');
            var grammarSection = document.getElementById('grammarSection');
            
            // Hide all controls that are only for flashcards
            var flashcardElements = [
                '.top-controls', '.session-controls', '.mode-selector', 
                '.progress-container', '.card-container', '.score-display',
                '.controls', '.action-controls'
            ];
            
            if (mode === 'flashcards') {
                flashcardElements.forEach(function(sel) {
                    var el = document.querySelector(sel);
                    if (el) el.style.display = '';
                });
                grammarSection.style.display = 'none';
            } else {
                flashcardElements.forEach(function(sel) {
                    var el = document.querySelector(sel);
                    if (el) el.style.display = 'none';
                });
                grammarSection.style.display = 'block';
                renderGrammarLessonsList();
            }
        }

        function init() {
            loadProgress();
            loadTheme();
            initOptionsPanel();
            // Set toggle button text based on saved preference
            toggleBtn.textContent = showThaiFront ? ' Thai Front' : ' English Front';
            updateListSelector();
            // Only show resume if cards have actually been swiped (correct or incorrect > 0)
            var hasSwipedCards = sessionState.inProgress && sessionState.cardOrder.length > 0 && 
                                 (sessionStats.correct > 0 || sessionStats.incorrect > 0);
            if (hasSwipedCards) {
                showResumeModal();
            } else {
                // Reset session stats for fresh start
                sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                initializeCards();
                updateCard();
            }
            setupEventListeners();
        }
        
        function loadTheme() {
            const savedTheme = localStorage.getItem('thaiFlashcardsTheme');
            if (savedTheme === 'dark') {
                darkMode = true;
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '';
            } else {
                darkMode = false;
                document.documentElement.removeAttribute('data-theme');
                themeToggle.textContent = '';
            }
        }
        
        function toggleTheme() {
            darkMode = !darkMode;
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '';
                localStorage.setItem('thaiFlashcardsTheme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.textContent = '';
                localStorage.setItem('thaiFlashcardsTheme', 'light');
            }
        }
        
        function switchViewMode(newMode) {
            if (newMode === viewMode) return;
            
            viewMode = newMode;
            localStorage.setItem('thaiFlashcardsViewMode', viewMode);
            
            // Update button states
            document.querySelectorAll('.option-toggle-btn[data-view]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewMode);
            });
            
            // Update vocabulary lists
            vocabularyLists = getActiveVocabularyLists();
            
            // Reset to first list of new view
            currentListIndex = 0;
            vocabulary = vocabularyLists[currentListIndex].words;
            
            // Update UI
            updateListSelector();
            initializeCards();
            updateCard();
            
            showToast(viewMode === 'themed' ? 'Switched to Themed Lists' : 'Switched to Mixed Lists');
        }
        
        function initOptionsPanel() {
            // Initialize romanization toggle
            romanizationToggle.checked = showRomanization;
            romanizationToggle.addEventListener('change', () => {
                showRomanization = romanizationToggle.checked;
                localStorage.setItem('thaiFlashcardsRomanization', showRomanization);
                updateCard();
                showToast(showRomanization ? 'Romanization enabled' : 'Romanization disabled');
            });
            
            // Initialize auto-play toggle
            const autoPlayToggle = document.getElementById('autoPlayToggle');
            autoPlayToggle.checked = autoPlayAudio;
            autoPlayToggle.addEventListener('change', () => {
                autoPlayAudio = autoPlayToggle.checked;
                localStorage.setItem('thaiFlashcardsAutoPlay', autoPlayAudio);
                showToast(autoPlayAudio ? 'Auto-play enabled' : 'Auto-play disabled');
            });
            
            // Initialize view mode buttons
            document.querySelectorAll('.option-toggle-btn[data-view]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewMode);
                btn.addEventListener('click', () => switchViewMode(btn.dataset.view));
            });
            
            // Initialize card direction buttons
            document.querySelectorAll('.option-toggle-btn[data-direction]').forEach(btn => {
                btn.classList.toggle('active', 
                    (btn.dataset.direction === 'thai' && showThaiFront) ||
                    (btn.dataset.direction === 'english' && !showThaiFront)
                );
                btn.addEventListener('click', () => {
                    const newDirection = btn.dataset.direction === 'thai';
                    if (newDirection !== showThaiFront) {
                        showThaiFront = newDirection;
                        localStorage.setItem('thaiFlashcardsThaiFront', showThaiFront);
                        document.querySelectorAll('.option-toggle-btn[data-direction]').forEach(b => {
                            b.classList.toggle('active', 
                                (b.dataset.direction === 'thai' && showThaiFront) ||
                                (b.dataset.direction === 'english' && !showThaiFront)
                            );
                        });
                        toggleBtn.textContent = showThaiFront ? ' Thai Front' : ' English Front';
                        updateCard();
                        showToast(showThaiFront ? 'Thai  English' : 'English  Thai');
                    }
                });
            });
            
            // Options modal open/close
            optionsBtn.addEventListener('click', () => optionsModal.classList.add('open'));
            document.getElementById('closeOptions').addEventListener('click', () => optionsModal.classList.remove('open'));
            optionsModal.addEventListener('click', (e) => {
                if (e.target === optionsModal) optionsModal.classList.remove('open');
            });
            
            // Vocab list modal
            var vocabListModal = document.getElementById('vocabListModal');
            document.getElementById('viewVocabListBtn').addEventListener('click', () => {
                optionsModal.classList.remove('open');
                showVocabList();
            });
            document.getElementById('closeVocabList').addEventListener('click', () => vocabListModal.classList.remove('open'));
            vocabListModal.addEventListener('click', (e) => {
                if (e.target === vocabListModal) vocabListModal.classList.remove('open');
            });
            document.getElementById('vocabListFilter').addEventListener('change', showVocabList);
        }
        
        function getMasteryStatus(card) {
            const key = getCardKey(card);
            
            // Always look for stats in themedLists (the canonical source)
            let stats = null;
            for (let i = 0; i < themedLists.length; i++) {
                if (cardStats[i] && cardStats[i][key]) {
                    stats = cardStats[i][key];
                    break;
                }
            }
            
            if (!stats || (stats.consecutiveCorrect === 0 && stats.incorrect === 0)) {
                return { status: 'new', label: 'New', class: 'mastery-new' };
            }
            
            // Check if struggling: more incorrect than correct, or high incorrect count with no streak
            const isStruggling = stats.incorrect >= 3 && stats.consecutiveCorrect === 0 && stats.incorrect > stats.correct;
            
            if (isStruggling) {
                return { status: 'struggling', label: 'Hard', class: 'mastery-struggling' };
            } else if (stats.consecutiveCorrect >= LEARNING_THRESHOLD) {
                // Check if it's been too long since last review (based on difficulty)
                if (stats.lastReviewed) {
                    const daysSinceReview = (Date.now() - new Date(stats.lastReviewed).getTime()) / (1000 * 60 * 60 * 24);
                    const reviewInterval = getReviewInterval(stats);
                    
                    if (daysSinceReview > reviewInterval) {
                        // Needs review
                        return { 
                            status: 'learning', 
                            label: 'Review', 
                            class: 'mastery-learning',
                            reviewInterval: reviewInterval,
                            daysSinceReview: daysSinceReview
                        };
                    }
                }
                // Show days until review in mastered label
                const reviewInterval = getReviewInterval(stats);
                const daysSinceReview = stats.lastReviewed ? 
                    (Date.now() - new Date(stats.lastReviewed).getTime()) / (1000 * 60 * 60 * 24) : 0;
                const daysUntilReview = Math.max(0, Math.round(reviewInterval - daysSinceReview));
                
                return { 
                    status: 'mastered', 
                    label: 'Learned', 
                    class: 'mastery-mastered',
                    reviewInterval: reviewInterval,
                    daysUntilReview: daysUntilReview
                };
            } else if (stats.consecutiveCorrect === 0) {
                return { status: 'new', label: 'New', class: 'mastery-new' };
            } else {
                // Show progress toward mastery
                const remaining = LEARNING_THRESHOLD - stats.consecutiveCorrect;
                return { 
                    status: 'learning', 
                    label: `Learning (${stats.consecutiveCorrect}/${LEARNING_THRESHOLD})`, 
                    class: 'mastery-learning' 
                };
            }
        }
        
        function getRomanization(thaiText) {
            return romanization[thaiText] || '';
        }
        
        function getCardsForSmartReview(cardList) {
            if (!smartReviewMode) return cardList;
            
            // Helper to get stats for a card (always from themedLists)
            function getCardStatsFor(card) {
                const key = getCardKey(card);
                for (let i = 0; i < themedLists.length; i++) {
                    if (cardStats[i] && cardStats[i][key]) {
                        return cardStats[i][key];
                    }
                }
                return { consecutiveCorrect: 0, incorrect: 0 };
            }
            
            // Sort cards: due cards first, then by difficulty
            return [...cardList].sort((a, b) => {
                const statsA = getCardStatsFor(a);
                const statsB = getCardStatsFor(b);
                
                const masteryA = getMasteryStatus(a);
                const masteryB = getMasteryStatus(b);
                
                // Priority: struggling > new > learning/review > mastered
                const priorityOrder = { 'struggling': 0, 'new': 1, 'learning': 2, 'mastered': 3 };
                const priorityDiff = priorityOrder[masteryA.status] - priorityOrder[masteryB.status];
                if (priorityDiff !== 0) return priorityDiff;
                
                // Within learning/review, prioritize more overdue cards
                if (masteryA.status === 'learning' && masteryA.daysSinceReview && masteryB.daysSinceReview) {
                    const overdueA = masteryA.daysSinceReview - (masteryA.reviewInterval || 7);
                    const overdueB = masteryB.daysSinceReview - (masteryB.reviewInterval || 7);
                    if (overdueA !== overdueB) return overdueB - overdueA; // More overdue first
                }
                
                // Within mastered, prioritize cards closer to needing review
                if (masteryA.status === 'mastered' && masteryA.daysUntilReview !== undefined && masteryB.daysUntilReview !== undefined) {
                    if (masteryA.daysUntilReview !== masteryB.daysUntilReview) {
                        return masteryA.daysUntilReview - masteryB.daysUntilReview; // Sooner review first
                    }
                }
                
                // Within same priority, sort by incorrect count (higher = harder = first)
                return (statsB.incorrect || 0) - (statsA.incorrect || 0);
            });
        }
        
        function updateMilestones(progress) {
            const milestones = document.querySelectorAll('.milestone');
            milestones.forEach(m => {
                const percent = parseInt(m.dataset.percent);
                if (progress >= percent) {
                    m.classList.add('reached');
                } else {
                    m.classList.remove('reached');
                }
            });
        }

        // Custom example sentences for words that don't fit templates well
        const customSentences = {
            // Particles and grammar words
            "": [{ thai: "", roman: "yak bpai dte mi mii wee-laa", english: "Want to go but don't have time" }],
            "": [{ thai: "", roman: "p le me", english: "Father and mother" }],
            "": [{ thai: "", roman: "gaa-fae r chaa", english: "Coffee or tea?" }],
            "": [{ thai: "", roman: "mi bpai pr wa fn dtk", english: "Not going because it's raining" }],
            "": [{ thai: "", roman: "ta wang g maa", english: "If you're free, come" }],
            "": [{ thai: "", roman: "dii g dii", english: "That's fine" }],
            "": [{ thai: "", roman: "bpai dai gan", english: "Go together" }],
            "": [{ thai: "", roman: "mi ru li", english: "Don't know at all" }],
            "": [{ thai: "", roman: "bpai n", english: "I'm going, okay?" }],
            "": [{ thai: "", roman: "kp-kun krp", english: "Thank you (male)" }],
            "": [{ thai: "", roman: "kp-kun k", english: "Thank you (female)" }],
            "": [{ thai: "", roman: "-rai k", english: "What? (female)" }],
            "": [{ thai: "", roman: "bpai mi", english: "Are you going?" }],
            "": [{ thai: "", roman: "bpai s", english: "Go on then!" }],
            "": [{ thai: "", roman: "jing r", english: "Really?" }],
            
            // Pronouns
            "": [{ thai: "...", roman: "chn ch...", english: "My name is..." }],
            "": [{ thai: "", roman: "pm bpen kon tai", english: "I am Thai (male)" }],
            "": [{ thai: "", roman: "kun ch -rai", english: "What's your name?" }],
            "": [{ thai: "", roman: "ko bpai lew", english: "He/she already left" }],
            "": [{ thai: "", roman: "rao bpai gan", english: "Let's go" }],
            "": [{ thai: "", roman: "man -ri", english: "It's delicious" }],
            "": [{ thai: "", roman: "ni -rai", english: "What's this?" }],
            "": [{ thai: "", roman: "nn -rai", english: "What's that?" }],
            "": [{ thai: "", roman: "non ngai", english: "Over there, see?" }],
            
            // Common phrases
            "": [{ thai: "", roman: "s-wt-dii krp", english: "Hello (male)" }],
            "": [{ thai: "", roman: "kp-kun mak", english: "Thank you very much" }],
            "": [{ thai: "", roman: "k-tot n", english: "Sorry about that" }],
            "": [{ thai: "", roman: "mi bpen rai krp", english: "No problem" }],
            "": [{ thai: "", roman: "mi ko-jai krp", english: "I don't understand" }],
            "": [{ thai: "", roman: "put cha cha ni", english: "Please speak slowly" }],
            "": [{ thai: "", roman: "dai li krp", english: "Sure, go ahead" }],
            "": [{ thai: "", roman: "mi ao krp", english: "No thanks" }],
            "": [{ thai: "", roman: "mi ru krp", english: "I don't know" }],
            "": [{ thai: "", roman: "mi mii krp", english: "Don't have any" }],
            "": [{ thai: "", roman: "st lew", english: "Done/finished" }],
            "": [{ thai: "", roman: "dao gn", english: "Wait a moment" }],
            "": [{ thai: "", roman: "dao gn n", english: "Hold on a sec" }],
            
            // Question words
            "": [{ thai: "", roman: "ni -rai", english: "What is this?" }],
            "": [{ thai: "", roman: "tam-mai mi bpai", english: "Why not go?" }],
            "": [{ thai: "", roman: "tam yang-rai", english: "How to do it?" }],
            "": [{ thai: "", roman: "tam yang-ngai", english: "How do you do it?" }],
            "": [{ thai: "", roman: "maa ma-ri", english: "When did you come?" }],
            "": [{ thai: "", roman: "gi bat", english: "How many baht?" }],
            "": [{ thai: "", roman: "krai maa", english: "Who came?" }],
            "": [{ thai: "", roman: "yu ti-ni", english: "Where is it?" }],
            "": [{ thai: "", roman: "chay dai mi krp", english: "Can you help me?" }],
            
            // Time/tense markers
            "": [{ thai: "", roman: "gin lew", english: "Already ate" }],
            "": [{ thai: "", roman: "yang mi st", english: "Not finished yet" }],
            "": [{ thai: "", roman: "gam-lang tam yu", english: "Currently doing it" }],
            "": [{ thai: "", roman: "j bpai prng-ni", english: "Will go tomorrow" }],
            "": [{ thai: "", roman: "ki bpai mi", english: "Have you ever been?" }],
            "": [{ thai: "", roman: "maa dtrong wee-laa", english: "Come on time" }],
            "": [{ thai: "", roman: "maa sai", english: "Come late" }],
            "": [{ thai: "", roman: "bpai bi mi", english: "Do you go often?" }],
            "": [{ thai: "", roman: "maa s-m", english: "Always come" }],
            "": [{ thai: "", roman: "mi ki bpai", english: "Never been" }],
            "": [{ thai: "", roman: "maa tan-tii", english: "Come immediately" }],
            "": [{ thai: "", roman: "ik krng", english: "One more time" }],
            
            // Quantifiers
            "": [{ thai: "", roman: "kng kun", english: "Yours" }],
            "": [{ thai: "", roman: "ti ni", english: "Here" }],
            "": [{ thai: "", roman: "mi ao", english: "Don't want" }],
            "": [{ thai: "", roman: "chi krp", english: "Yes, correct" }],
            "": [{ thai: "", roman: "mi chi krp", english: "No, not correct" }],
            "": [{ thai: "", roman: "p lew", english: "That's enough" }],
            "": [{ thai: "", roman: "kp-kun mak", english: "Thank you very much" }],
            "": [{ thai: "", roman: "ni bpai", english: "Too little" }],
            "": [{ thai: "", roman: "tk wan", english: "Every day" }],
            "": [{ thai: "", roman: "baang krng", english: "Sometimes" }],
            "": [{ thai: "", roman: "ke ni", english: "Just this" }],
            "": [{ thai: "", roman: "tam eeng", english: "Do it yourself" }],
            
            // Tricky verbs
            "": [{ thai: "", roman: "bpen -rai", english: "What's wrong?" }],
            "": [{ thai: "", roman: "mii -rai mi", english: "Anything else?" }],
            "": [{ thai: "", roman: "yu ni", english: "Where are you?" }],
            "": [{ thai: "", roman: "tam -rai", english: "What are you doing?" }],
            "": [{ thai: "", roman: "dai li", english: "Sure, go ahead" }],
            "": [{ thai: "", roman: "ao an ni", english: "I'll take this one" }],
            "": [{ thai: "", roman: "yak gin -rai", english: "What do you want to eat?" }],
            "": [{ thai: "", roman: "dtng bpai lew", english: "Have to go now" }],
            "": [{ thai: "", roman: "chay ni", english: "Help please" }],
            "": [{ thai: "", roman: "lng duu", english: "Try it/let's see" }],
            "": [{ thai: "", roman: "ru lew", english: "I know already" }],
            
            // Shopping/restaurant
            "": [{ thai: "", roman: "raa-kaa to-ri", english: "What's the price?" }],
            "": [{ thai: "", roman: "an ni to-ri", english: "How much is this?" }],
            "": [{ thai: "", roman: "paeng gn bpai krp", english: "Too expensive" }],
            "": [{ thai: "", roman: "lt ni dai mi", english: "Can you discount?" }],
            "": [{ thai: "", roman: "k mee-nuu ni", english: "Menu please" }],
            "": [{ thai: "", roman: "prm sng aa-han", english: "Ready to order" }],
            "": [{ thai: "", roman: "chk bin krp", english: "Check please" }],
            
            // Travel
            "": [{ thai: "", roman: "j bpai ni", english: "Where are you going?" }],
            "": [{ thai: "", roman: "lao sai dtrong ni", english: "Turn left here" }],
            "": [{ thai: "", roman: "lao kwa kang na", english: "Turn right ahead" }],
            "": [{ thai: "", roman: "dtrong bpai li", english: "Go straight" }],
            "": [{ thai: "", roman: "ti ni krp", english: "Here please" }],
            "": [{ thai: "", roman: "dtrong ti nn", english: "Right there" }],
            "": [{ thai: "", roman: "lng taang", english: "I'm lost" }],
            
            // Banking/money
            "": [{ thai: "", roman: "oon ngn hi", english: "Transfer money to" }],
            "": [{ thai: "", roman: "oon ngn dai mi", english: "Can you transfer?" }],
            "": [{ thai: "", roman: "maa fak ngn", english: "Come to deposit" }],
            "": [{ thai: "", roman: "tn ngn ni", english: "Withdraw money" }],
            "": [{ thai: "", roman: "lek ngn ti ni", english: "Where to exchange?" }],
            "": [{ thai: "", roman: "fak kng ni", english: "Leave this with you" }],
            
            // Work
            "": [{ thai: "", roman: "bpai tam-ngaan", english: "Go to work" }],
            "": [{ thai: "", roman: "ngaan yng", english: "Work is busy" }],
            "": [{ thai: "", roman: "mii bpr-chum", english: "Have a meeting" }],
            
            // Abstract
            "": [{ thai: "", roman: "chok dii n", english: "Good luck!" }],
            "": [{ thai: "", roman: "mii bpan-ha mi", english: "Any problems?" }],
            "": [{ thai: "", roman: "ru kam-dtp mi", english: "Know the answer?" }],
            "": [{ thai: "", roman: "mii kam-tam mi", english: "Any questions?" }],
            "": [{ thai: "", roman: "kwaam-kt dii", english: "Good idea" }],
            "": [{ thai: "", roman: "mii pen mi", english: "Have a plan?" }],
            
            // Tech
            "": [{ thai: "", roman: "dtng chat bet", english: "Need to charge" }],
            "": [{ thai: "", roman: "tai rup hi ni", english: "Take a photo please" }],
            "": [{ thai: "", roman: "kn-ha nai guu-gn", english: "Search on Google" }],
            
            // Misc
            "": [{ thai: "", roman: "kon ae-t", english: "Crowded with people" }],
            "": [{ thai: "", roman: "ym ni dai mi", english: "Can I borrow?" }],
            "": [{ thai: "", roman: "gp kng", english: "Put things away" }],
            "": [{ thai: "", roman: "tng k-y", english: "Throw away trash" }],
            "": [{ thai: "", roman: "ha -rai", english: "Looking for what?" }],
            "": [{ thai: "", roman: "j gan n", english: "See you" }],
            "": [{ thai: "", roman: "si -rai", english: "What color?" }],
            "": [{ thai: "", roman: "rt-chat dii", english: "Tastes good" }],
            
            // Common phrases - use them as examples of themselves
            "": [{ thai: "", roman: "kun s-baai dii mi", english: "How are you?" }],
            "": [{ thai: "", roman: "s-baai dii krp", english: "I'm fine (male)" }],
            "": [{ thai: "", roman: "wan-ni mi s-baai", english: "Not feeling well today" }],
            "": [{ thai: "", roman: "mi j gan naan li", english: "It's been so long!" }],
            "": [{ thai: "", roman: "yin-dii ti di ru-jk krp", english: "Nice to meet you" }],
            "": [{ thai: "", roman: "gin kao r yang krp", english: "Have you eaten yet?" }],
            "": [{ thai: "", roman: "gin lew krp", english: "I've already eaten" }],
            "": [{ thai: "", roman: "wa ngai krp", english: "What's up?" }],
            "": [{ thai: "", roman: "lew j gan n", english: "See you later" }],
            "": [{ thai: "", roman: "lew dte kun li", english: "It's up to you" }],
            "": [{ thai: "", roman: "chang man t krp", english: "Forget about it" }],
            "": [{ thai: "", roman: "jing r krp", english: "Really?" }],
            "": [{ thai: "", roman: "ne-nn krp", english: "Of course!" }],
            "": [{ thai: "", roman: "mi dtng hang krp", english: "Don't worry" }],
            "": [{ thai: "", roman: "r-wang day n", english: "Be careful" }],
        };
        
        // Generate example sentence - check custom first, then template
        async function generateExampleSentence() {
            try {
                if (cards.length === 0) return;
                
                const card = cards[currentIndex];
                const thaiWord = card.thai;
                const englishMeaning = card.english;
                
                sentenceExample.classList.add('show');
                
                let sentence;
                
                // Check for custom sentence first
                if (customSentences[thaiWord]) {
                    const customs = customSentences[thaiWord];
                    sentence = { ...customs[Math.floor(Math.random() * customs.length)] };
                } else {
                    sentence = generateFallbackSentence(thaiWord, englishMeaning);
                }
                
                // Store plain Thai for TTS
                currentSentenceThai = sentence.thai.replace(/<[^>]*>/g, '');
                
                // Highlight the word
                if (!sentence.thai.includes('sentence-word-highlight')) {
                    sentence.thai = sentence.thai.replace(
                        new RegExp(`(${thaiWord})`, 'g'), 
                        '<span class="sentence-word-highlight">$1</span>'
                    );
                }
                
                sentenceThai.innerHTML = sentence.thai;
                sentenceRoman.textContent = sentence.roman;
                sentenceEnglish.textContent = sentence.english;
                
                sentenceBtn.disabled = false;
                sentenceBtn.textContent = ' Example';
            } catch (err) {
                console.error('Error:', err);
                sentenceThai.innerHTML = 'Error: ' + err.message;
            }
        }
        
        // Generate a template-based sentence
        function generateFallbackSentence(thaiWord, englishMeaning) {
            const eng = englishMeaning.toLowerCase();
            const roman = romanization[thaiWord] || '';
            
            let templates = [];
            
            // === VERBS (start with "to ") ===
            if (eng.startsWith('to ')) {
                const verb = eng.replace('to ', '');
                
                // Financial/transaction verbs
                if (eng.match(/to (transfer|pay|deposit|withdraw|send|receive|borrow|lend|owe|spend|save|invest)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} ngn`, english: `${verb} money` },
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}red` },
                    ];
                }
                // Communication verbs
                else if (eng.match(/to (say|speak|talk|tell|ask|answer|call|read|write|listen|hear)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} paa-sa tai`, english: `${verb} Thai` },
                        { thai: `${thaiWord}`, roman: `${roman} dai mi`, english: `Can you ${verb}?` },
                        { thai: `${thaiWord}`, roman: `${roman} ik tii`, english: `${verb} again` },
                    ];
                }
                // Movement verbs
                else if (eng.match(/to (go|come|walk|run|drive|ride|fly|return|arrive|leave|enter|exit)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} ni`, english: `Where are you ${verb}ing?` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                        { thai: `${thaiWord}`, roman: `j ${roman}`, english: `Will ${verb}` },
                    ];
                }
                // Eating/drinking verbs
                else if (eng.match(/to (eat|drink|taste|cook|order|serve)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} -rai`, english: `What to ${verb}?` },
                        { thai: `${thaiWord}`, roman: `yak ${roman}`, english: `Want to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                    ];
                }
                // Looking/seeing verbs
                else if (eng.match(/to (see|look|watch|find|search|check)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} -rai`, english: `${verb} what?` },
                        { thai: `${thaiWord}`, roman: `lng ${roman}`, english: `Try to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} ni`, english: `${verb} please` },
                    ];
                }
                // Work/action verbs
                else if (eng.match(/to (work|do|make|use|open|close|start|stop|finish|try|help|wait|sit|stand|sleep|wake)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                        { thai: `${thaiWord}`, roman: `gam-lang ${roman}`, english: `${verb}ing now` },
                    ];
                }
                // Buying/selling verbs
                else if (eng.match(/to (buy|sell|rent|book|reserve|order)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `yak ${roman}`, english: `Want to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} ti ni`, english: `Where to ${verb}?` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}` },
                    ];
                }
                // Cleaning verbs
                else if (eng.match(/to (wash|clean|sweep|wipe|iron|sew|fold)/)) {
                    templates = [
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}ed` },
                        { thai: `${thaiWord}`, roman: `chay ${roman}`, english: `Help ${verb}` },
                    ];
                }
                // Default verb templates
                else {
                    templates = [
                        { thai: `${thaiWord}`, roman: `${roman} dai mi`, english: `Can you ${verb}?` },
                        { thai: `${thaiWord}`, roman: `dtng ${roman}`, english: `Have to ${verb}` },
                        { thai: `${thaiWord}`, roman: `${roman} lew`, english: `Already ${verb}ed` },
                        { thai: `${thaiWord}`, roman: `gam-lang ${roman}`, english: `${verb}ing now` },
                    ];
                }
            }
            // === TASTE/TEXTURE adjectives ===
            else if (eng.match(/^(spicy|sweet|sour|salty|bitter|bland|delicious|crispy|soft|hard|sticky|rotten|fresh|smelly|fragrant)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} mi`, english: `Is it ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} gn bpai`, english: `Too ${englishMeaning}` },
                ];
            }
            // === SIZE/PHYSICAL adjectives ===
            else if (eng.match(/^(big|small|tall|short|long|wide|thick|thin|heavy|light|fat|skinny)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} gn bpai`, english: `Too ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                ];
            }
            // === FEELING/STATE adjectives ===
            else if (eng.match(/^(happy|sad|tired|hungry|thirsty|sick|angry|afraid|busy|bored|excited|worried|sleepy|full|drunk)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} mi`, english: `Are you ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `ru-sk ${roman}`, english: `Feel ${englishMeaning}` },
                ];
            }
            // === QUALITY adjectives ===
            else if (eng.match(/^(good|bad|beautiful|ugly|clean|dirty|new|old|fast|slow|easy|difficult|expensive|cheap|hot|cold|safe|dangerous|quiet|loud|far|near|early|late|free|same|different|important|correct|wrong)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} mak`, english: `Very ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} mi`, english: `Is it ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `mi ${roman}`, english: `Not ${englishMeaning}` },
                ];
            }
            // === FOOD items ===
            else if (eng.match(/(rice|egg|milk|bread|meat|pork|beef|shrimp|crab|fish|chicken|soup|noodle|curry|salad|fruit|vegetable|mango|banana|orange|apple|coconut|durian|watermelon|papaya|sugar|salt|pepper|sauce|oil)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `gin ${roman}`, english: `Eat ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} -ri`, english: `${englishMeaning} is delicious` },
                    { thai: `${thaiWord}`, roman: `k ${roman}`, english: `${englishMeaning} please` },
                ];
            }
            // === DRINKS ===
            else if (eng.match(/(water|tea|coffee|beer|wine|juice|milk|soda|ice)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `dm ${roman}`, english: `Drink ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `k ${roman}`, english: `${englishMeaning} please` },
                    { thai: `${thaiWord}`, roman: `ao ${roman}`, english: `I'll have ${englishMeaning}` },
                ];
            }
            // === ANIMALS ===
            else if (eng.match(/(dog|cat|bird|fish|elephant|monkey|snake|cow|pig|chicken|duck|horse|tiger|lion|bear|mouse|rat|frog|ant|mosquito|butterfly|spider|lizard)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `hn ${roman}`, english: `I see a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} na-rk`, english: `The ${englishMeaning} is cute` },
                    { thai: `${thaiWord}`, roman: `glua ${roman}`, english: `Afraid of ${englishMeaning}s` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}s` },
                ];
            }
            // === FAMILY ===
            else if (eng.match(/(father|mother|dad|mom|parent|brother|sister|son|daughter|child|baby|husband|wife|grandfather|grandmother|grandpa|grandma|uncle|aunt|cousin|nephew|niece|grandchild)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} yu ni`, english: `Where is ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `rk ${roman}`, english: `I love ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `kt-tng ${roman}`, english: `I miss ${englishMeaning}` },
                ];
            }
            // === PEOPLE/PROFESSIONS ===
            else if (eng.match(/(friend|teacher|student|doctor|nurse|police|driver|worker|boss|customer|tourist|monk|person|people|man|woman|boy|girl)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} maa lew`, english: `The ${englishMeaning} arrived` },
                    { thai: `${thaiWord}`, roman: `bpen ${roman}`, english: `I'm a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `ru-jk ${roman}`, english: `I know the ${englishMeaning}` },
                ];
            }
            // === BODY PARTS ===
            else if (eng.match(/(head|hair|face|eye|ear|nose|mouth|tooth|tongue|neck|shoulder|arm|hand|finger|leg|foot|knee|back|stomach|heart|skin|bone|blood)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} jp`, english: `My ${englishMeaning} hurts` },
                    { thai: `${thaiWord}`, roman: `lang ${roman}`, english: `Wash your ${englishMeaning}` },
                ];
            }
            // === PLACES/BUILDINGS ===
            else if (eng.match(/(house|home|room|hotel|restaurant|shop|store|market|hospital|school|bank|office|temple|airport|station|bathroom|kitchen|bedroom)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `bpai ${roman}`, english: `Go to the ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} yu ni`, english: `Where is the ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `yu ${roman}`, english: `At the ${englishMeaning}` },
                ];
            }
            // === NATURE/OUTDOORS ===
            else if (eng.match(/(tree|flower|grass|leaf|mountain|river|sea|ocean|beach|island|forest|jungle|rain|sun|moon|star|sky|cloud|wind|fire)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} say`, english: `The ${englishMeaning} is beautiful` },
                    { thai: `${thaiWord}`, roman: `hn ${roman}`, english: `I see the ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like the ${englishMeaning}` },
                ];
            }
            // === TRANSPORT ===
            else if (eng.match(/(car|bus|train|plane|boat|bicycle|motorcycle|taxi|truck)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `kp ${roman}`, english: `Drive a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `nng ${roman}`, english: `Take a ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} maa lew`, english: `The ${englishMeaning} is here` },
                ];
            }
            // === CLOTHING ===
            else if (eng.match(/(shirt|pants|dress|skirt|shoes|hat|socks|jacket|coat|underwear|glasses|watch|bag|belt)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `si ${roman}`, english: `Wear ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `s ${roman}`, english: `Buy ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `${roman} say`, english: `Nice ${englishMeaning}` },
                ];
            }
            // === TIME WORDS ===
            else if (eng.match(/(today|tomorrow|yesterday|now|later|morning|afternoon|evening|night|day|week|month|year|hour|minute|time)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} bpai ni`, english: `Where are you going ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `j gan ${roman}`, english: `See you ${englishMeaning}` },
                ];
            }
            // === COLORS ===
            else if (eng.match(/(red|blue|green|yellow|white|black|pink|orange|purple|gray|brown)/) || thaiWord.startsWith('')) {
                templates = [
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `sa ${roman}`, english: `${englishMeaning} shirt` },
                    { thai: `${thaiWord}`, roman: `mii ${roman} mi`, english: `Do you have ${englishMeaning}?` },
                ];
            }
            // === NUMBERS ===
            else if (eng.match(/^(one|two|three|four|five|six|seven|eight|nine|ten|zero|hundred|thousand|million|first|second|third)$/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `k ${roman}`, english: `${englishMeaning} please` },
                    { thai: `${thaiWord}`, roman: `mii ${roman}`, english: `There are ${englishMeaning}` },
                ];
            }
            // === QUESTION WORDS ===
            else if (eng.match(/^(what|where|when|who|why|how|which)/)) {
                templates = [
                    { thai: `${thaiWord}`, roman: `${roman} k`, english: `${englishMeaning}? (polite)` },
                ];
            }
            // === DEFAULT - generic useful patterns ===
            else {
                templates = [
                    { thai: `${thaiWord}`, roman: `mii ${roman} mi`, english: `Is there ${englishMeaning}?` },
                    { thai: `${thaiWord}`, roman: `dtng-gaan ${roman}`, english: `I need ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `chp ${roman}`, english: `I like ${englishMeaning}` },
                    { thai: `${thaiWord}`, roman: `ni k ${roman}`, english: `This is ${englishMeaning}` },
                ];
            }
            
            // Pick a random template
            const template = templates[Math.floor(Math.random() * templates.length)];
            
            // Highlight the target word
            template.thai = template.thai.replace(
                new RegExp(`(${thaiWord})`, 'g'), 
                '<span class="sentence-word-highlight">$1</span>'
            );
            
            return template;
        }
        
        // Hide sentence example when changing cards
        function hideSentenceExample() {
            sentenceExample.classList.remove('show');
        }

        function setupEventListeners() {
            // App mode toggle
            document.querySelectorAll('.app-mode-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    switchAppMode(this.getAttribute('data-appmode'));
                });
            });
            
            // Grammar navigation
            document.getElementById('grammarBackBtn').addEventListener('click', closeGrammarLesson);
            document.getElementById('lessonPrevBtn').addEventListener('click', prevLessonStep);
            document.getElementById('lessonNextBtn').addEventListener('click', nextLessonStep);
            
            // Practice navigation
            document.getElementById('practiceBackBtn').addEventListener('click', closePractice);
            document.getElementById('practiceNextBtn').addEventListener('click', nextPracticeQuestion);
            
            flashcard.addEventListener('click', () => { if (!isSwiping) flipCard(); });
            flashcard.addEventListener('touchstart', handleTouchStart, { passive: false });
            flashcard.addEventListener('touchmove', handleTouchMove, { passive: false });
            flashcard.addEventListener('touchend', handleTouchEnd);

            flipBtn.addEventListener('click', flipCard);
            prevBtn.addEventListener('click', prevCard);
            nextBtn.addEventListener('click', nextCard);
            shuffleBtn.addEventListener('click', shuffleCards);
            toggleBtn.addEventListener('click', toggleLanguage);
            sentenceBtn.addEventListener('click', generateExampleSentence);
            document.getElementById('sentenceSpeakBtn').addEventListener('click', speakSentence);

            document.getElementById('restartBtn').addEventListener('click', startFresh);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            settingsBtn.addEventListener('click', () => settingsModal.classList.add('open'));
            statsBtn.addEventListener('click', () => { updateStatsModal(); statsModal.classList.add('open'); });
            document.getElementById('closeSettings').addEventListener('click', () => settingsModal.classList.remove('open'));
            document.getElementById('closeStats').addEventListener('click', () => statsModal.classList.remove('open'));

            document.getElementById('startFreshBtn').addEventListener('click', () => { resumeModal.classList.remove('open'); startFresh(); });
            document.getElementById('resumeSessionBtn').addEventListener('click', () => { resumeModal.classList.remove('open'); resumeSession(); });
            
            // Completion modal handlers
            document.getElementById('closeCompletion').addEventListener('click', () => document.getElementById('completionModal').classList.remove('open'));
            document.getElementById('restartListBtn').addEventListener('click', () => {
                document.getElementById('completionModal').classList.remove('open');
                startFresh();
            });
            document.getElementById('reviewHardestBtn').addEventListener('click', () => {
                document.getElementById('completionModal').classList.remove('open');
                sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                listSelector.value = HARDEST_LIST;
                switchList(HARDEST_LIST);
            });

            csvFileInput.addEventListener('change', handleFileUpload);
            listSelector.addEventListener('change', (e) => switchList(parseInt(e.target.value)));
            document.getElementById('exportBtn').addEventListener('click', exportProgress);
            document.getElementById('resetBtn').addEventListener('click', resetProgress);

            modeBtns.forEach(btn => btn.addEventListener('click', () => switchMode(btn.dataset.mode)));
            document.addEventListener('keydown', handleKeyboard);
            
            // Favorite button
            document.getElementById('favoriteBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite();
            });
            
            // Audio button
            document.getElementById('audioBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                speakThai();
            });

            document.addEventListener('touchend', (e) => {
                const now = Date.now();
                if (now - lastTouchEnd < 300) e.preventDefault();
                lastTouchEnd = now;
            }, false);

            window.addEventListener('click', (e) => {
                if (e.target === settingsModal) settingsModal.classList.remove('open');
                if (e.target === statsModal) statsModal.classList.remove('open');
                // Don't allow closing resume modal by clicking outside - user must choose
                if (e.target.id === 'completionModal') e.target.classList.remove('open');
            });
        }

        function handleTouchStart(e) {
            if (e.touches.length > 1) return;
            touchStartX = currentX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            isSwiping = false;
        }

        function handleTouchMove(e) {
            if (!touchStartX) return;
            currentX = e.touches[0].clientX;
            const diffX = currentX - touchStartX;
            const diffY = e.touches[0].clientY - touchStartY;

            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 10) {
                e.preventDefault();
                isSwiping = true;
                flashcard.classList.add('swiping');
                flashcard.style.transform = "translateX(" + diffX + "px) rotateY(" + (isFlipped ? 180 : 0) + "deg)";

                const intensity = Math.min(Math.abs(diffX) / 100, 1);

                if (diffX > 30) {
                    swipeRight.classList.add('visible');
                    swipeBarRight.classList.add('visible');
                    swipeBarRight.style.opacity = intensity;
                    swipeLeft.classList.remove('visible');
                    swipeBarLeft.classList.remove('visible');
                } else if (diffX < -30) {
                    swipeLeft.classList.add('visible');
                    swipeBarLeft.classList.add('visible');
                    swipeBarLeft.style.opacity = intensity;
                    swipeRight.classList.remove('visible');
                    swipeBarRight.classList.remove('visible');
                } else {
                    swipeLeft.classList.remove('visible');
                    swipeRight.classList.remove('visible');
                    swipeBarLeft.classList.remove('visible');
                    swipeBarRight.classList.remove('visible');
                }
            }
        }

        function handleTouchEnd() {
            if (!touchStartX) return;
            const diffX = currentX - touchStartX;

            swipeLeft.classList.remove('visible');
            swipeRight.classList.remove('visible');
            swipeBarLeft.classList.remove('visible');
            swipeBarRight.classList.remove('visible');
            swipeBarLeft.style.opacity = '';
            swipeBarRight.style.opacity = '';
            flashcard.classList.remove('swiping');
            
            // Clear inline transform style - let CSS class handle the flip state
            flashcard.style.transform = '';

            if (Math.abs(diffX) > 100) {
                // If card is flipped, first unflip it instantly before moving to next
                if (isFlipped) {
                    flashcard.style.transition = 'none';
                    flashcard.classList.remove('flipped');
                    isFlipped = false;
                    // Force reflow
                    flashcard.offsetHeight;
                    flashcard.style.transition = '';
                }
                diffX > 0 ? markCorrect() : markIncorrect();
            }

            touchStartX = currentX = 0;
            setTimeout(() => { isSwiping = false; }, 100);
        }

        function handleKeyboard(e) {
            if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); flipCard(); }
            else if (e.key === 'ArrowRight') { e.preventDefault(); markCorrect(); }
            else if (e.key === 'ArrowLeft') { e.preventDefault(); markIncorrect(); }
        }

        function initializeCards() {
            if (currentMode === 'review') {
                // Filter to cards that are NOT yet learned
                cards = vocabulary.filter(c => {
                    const key = getCardKey(c);
                    // Find stats from themedLists
                    let stat = null;
                    for (let i = 0; i < themedLists.length; i++) {
                        if (cardStats[i] && cardStats[i][key]) {
                            stat = cardStats[i][key];
                            break;
                        }
                    }
                    return !stat || !stat.consecutiveCorrect || stat.consecutiveCorrect < LEARNING_THRESHOLD;
                });
                if (cards.length === 0) {
                    showToast('All cards in this list are learned!');
                    currentMode = 'all';
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
                    cards = [...vocabulary];
                }
                // Shuffle unlearned cards
                cards.sort(() => Math.random() - 0.5);
            } else {
                // Apply smart review sorting if enabled, then shuffle within priority groups
                let cardList = [...vocabulary];
                if (smartReviewMode) {
                    cardList = getCardsForSmartReview(cardList);
                } else {
                    cardList.sort(() => Math.random() - 0.5);
                }
                cards = cardList;
            }
            currentIndex = 0;
            // Sync modeState
            modeState[currentMode].cards = [...cards];
            modeState[currentMode].currentIndex = currentIndex;
            saveSessionState();
        }
        
        function initializeCardsPreservePosition(oldCard) {
            // Save current state before switching
            const oldMode = currentMode === 'review' ? 'all' : 'review'; // The mode we're coming FROM
            
            if (currentMode === 'review') {
                // Filter to cards that are NOT yet learned (consecutiveCorrect < LEARNING_THRESHOLD)
                const unlearnedCards = vocabulary.filter(c => {
                    const key = getCardKey(c);
                    // Find which themed list this card belongs to and get stats from there
                    let stat = null;
                    for (let i = 0; i < themedLists.length; i++) {
                        if (cardStats[i] && cardStats[i][key]) {
                            stat = cardStats[i][key];
                            break;
                        }
                    }
                    return !stat || !stat.consecutiveCorrect || stat.consecutiveCorrect < LEARNING_THRESHOLD;
                });
                
                if (unlearnedCards.length === 0) {
                    showToast('All cards in this list are learned!');
                    currentMode = 'all';
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
                    return;
                }
                
                // Save "all" mode state before switching
                modeState.all.cards = [...cards];
                modeState.all.currentIndex = currentIndex;
                
                // Always shuffle unlearned cards fresh when entering review mode
                cards = unlearnedCards.sort(() => Math.random() - 0.5);
                currentIndex = 0;
                
                modeState.review.cards = [...cards];
                modeState.review.currentIndex = currentIndex;
            } else {
                // Switching to "All Cards"
                // Save review mode state before switching
                modeState.review.cards = [...cards];
                modeState.review.currentIndex = currentIndex;
                
                // Restore "all" mode state if we have it
                if (modeState.all.cards.length > 0) {
                    cards = modeState.all.cards;
                    currentIndex = modeState.all.currentIndex;
                } else {
                    // First time or need to initialize
                    let cardList = [...vocabulary];
                    if (smartReviewMode) {
                        cardList = getCardsForSmartReview(cardList);
                    } else {
                        cardList.sort(() => Math.random() - 0.5);
                    }
                    cards = cardList;
                    currentIndex = 0;
                }
                modeState.all.cards = [...cards];
                modeState.all.currentIndex = currentIndex;
            }
            
            saveSessionState();
        }

        function getListProgress(idx) {
            const list = vocabularyLists[idx];
            let learned = 0, reviewed = 0, totalCorrect = 0, totalIncorrect = 0;
            list.words.forEach(c => {
                const key = getCardKey(c);
                // Find stats from themedLists (canonical source)
                let s = null;
                for (let i = 0; i < themedLists.length; i++) {
                    if (cardStats[i] && cardStats[i][key]) {
                        s = cardStats[i][key];
                        break;
                    }
                }
                if (s) {
                    reviewed++;
                    totalCorrect += s.correct || 0;
                    totalIncorrect += s.incorrect || 0;
                    if (s.consecutiveCorrect >= LEARNING_THRESHOLD) learned++;
                }
            });
            return { total: list.words.length, learned, reviewed, learnedPercent: Math.round((learned / list.words.length) * 100), totalCorrect, totalIncorrect };
        }

        function updateCard() {
            if (!cards.length) { 
                // Show friendly empty state based on current list/mode
                let icon, title, text;
                
                if (currentListIndex === FAVORITES_LIST) {
                    icon = '';
                    title = 'No Favorites Yet';
                    text = 'Tap the  on any card to add it to your favorites.';
                } else if (currentListIndex === HARDEST_LIST) {
                    icon = '';
                    title = 'No Hard Cards';
                    text = "You haven't gotten any cards wrong yet. Keep practicing!";
                } else if (currentMode === 'review') {
                    icon = '';
                    title = 'Nothing to Review';
                    text = "You haven't marked any cards as incorrect. Great job!";
                } else {
                    icon = '';
                    title = 'No Cards';
                    text = 'This list is empty.';
                }
                
                frontText.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-state-icon">' + icon + '</div>' +
                    '<div class="empty-state-title">' + title + '</div>' +
                    '<div class="empty-state-text">' + text + '</div>' +
                '</div>';
                backText.innerHTML = frontText.innerHTML;
                frontRomanization.textContent = '';
                backRomanization.textContent = '';
                masteryIndicator.style.display = 'none';
                
                cardCounter.textContent = 'Card 0 of 0';
                progressPercent.textContent = '0%';
                progressFill.style.width = '0%';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                
                return; 
            }
            const card = cards[currentIndex];
            frontText.textContent = showThaiFront ? card.thai : card.english;
            backText.textContent = showThaiFront ? card.english : card.thai;
            applyFontSize(frontText);
            applyFontSize(backText);
            
            // Update romanization
            const thaiRoman = getRomanization(card.thai);
            if (showRomanization && thaiRoman) {
                frontRomanization.textContent = showThaiFront ? thaiRoman : '';
                backRomanization.textContent = showThaiFront ? '' : thaiRoman;
                frontRomanization.style.display = showThaiFront ? 'block' : 'none';
                backRomanization.style.display = showThaiFront ? 'none' : 'block';
            } else {
                frontRomanization.style.display = 'none';
                backRomanization.style.display = 'none';
            }
            
            // Update mastery indicator
            const mastery = getMasteryStatus(card);
            masteryIndicator.textContent = mastery.label;
            masteryIndicator.className = 'mastery-indicator ' + mastery.class;
            masteryIndicator.style.display = 'block';

            const progress = ((currentIndex + 1) / cards.length) * 100;
            cardCounter.textContent = "Card " + (currentIndex + 1) + " of " + cards.length;
            progressPercent.textContent = Math.round(progress) + "%";
            progressFill.style.width = progress + "%";
            updateMilestones(progress);
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === cards.length - 1;
            
            // Update favorite button
            const isFav = favorites.has(getCardKey(card));
            const favBtn = document.getElementById('favoriteBtn');
            favBtn.textContent = isFav ? '' : '';
            favBtn.classList.toggle('active', isFav);
            
            updateScoreDisplay();
            
            // Auto-play audio if enabled and showing Thai first
            // Only auto-play if this was a deliberate card change (not initial load or mode switch)
            if (autoPlayAudio && showThaiFront && cards.length > 0 && window.shouldAutoPlay) {
                window.shouldAutoPlay = false; // Reset flag
                const textToSpeak = card.thai;
                // Cancel any pending speech first
                if (pendingSpeechTimeout) {
                    clearTimeout(pendingSpeechTimeout);
                }
                pendingSpeechTimeout = setTimeout(() => {
                    pendingSpeechTimeout = null;
                    speakThai(textToSpeak);
                }, 400);
            }
        }

        function applyFontSize(el) {
            const len = el.textContent.length;
            el.className = 'card-text' + (len > 40 ? ' xtiny' : len > 25 ? ' tiny' : len > 18 ? ' small' : len > 10 ? ' medium' : '');
        }

        function flipCard() { isFlipped = !isFlipped; flashcard.classList.toggle('flipped'); }
        
        function nextCard() { 
            if (currentIndex < cards.length - 1) { 
                // First flip back if needed (without animation)
                if (isFlipped) { 
                    flashcard.style.transition = 'none';
                    flashcard.classList.remove('flipped'); 
                    isFlipped = false;
                    // Force reflow then restore transition
                    flashcard.offsetHeight;
                    flashcard.style.transition = '';
                } 
                currentIndex++; 
                // Sync modeState
                modeState[currentMode].currentIndex = currentIndex;
                hideSentenceExample();
                window.shouldAutoPlay = true; // Enable auto-play for this card change
                updateCard(); 
                saveSessionState(); 
            } 
        }
        
        function prevCard() { 
            if (currentIndex > 0) { 
                if (isFlipped) { 
                    flashcard.style.transition = 'none';
                    flashcard.classList.remove('flipped'); 
                    isFlipped = false;
                    flashcard.offsetHeight;
                    flashcard.style.transition = '';
                } 
                currentIndex--; 
                // Sync modeState
                modeState[currentMode].currentIndex = currentIndex;
                hideSentenceExample();
                window.shouldAutoPlay = true; // Enable auto-play for this card change
                updateCard(); 
                saveSessionState(); 
            } 
        }
        function shuffleCards() { 
            sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
            hideSentenceExample();
            initializeCards(); 
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; } 
            updateCard(); 
            showToast('Cards shuffled!'); 
        }
        function toggleLanguage() { 
            showThaiFront = !showThaiFront; 
            localStorage.setItem('thaiFlashcardsThaiFront', showThaiFront);
            toggleBtn.textContent = " " + (showThaiFront ? "Thai" : "English") + " Front"; 
            // Sync options panel buttons
            document.querySelectorAll('.option-toggle-btn[data-direction]').forEach(btn => {
                btn.classList.toggle('active', 
                    (btn.dataset.direction === 'thai' && showThaiFront) ||
                    (btn.dataset.direction === 'english' && !showThaiFront)
                );
            });
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; } 
            updateCard(); 
            saveProgress(); 
        }
        
        function toggleFavorite() {
            if (!cards.length) return;
            const card = cards[currentIndex];
            const key = getCardKey(card);
            
            if (favorites.has(key)) {
                favorites.delete(key);
                showToast('Removed from favorites');
            } else {
                favorites.add(key);
                showToast('Added to favorites ');
            }
            
            updateCard();
            updateListSelector();
            saveProgress();
        }
        
        // Track pending speech timeout
        let pendingSpeechTimeout = null;
        let thaiVoice = null;
        
        // Pre-load Thai voice
        function loadThaiVoice() {
            const voices = speechSynthesis.getVoices();
            thaiVoice = voices.find(v => v.lang === 'th-TH') || 
                        voices.find(v => v.lang.startsWith('th'));
        }
        
        // Load voices when available
        if ('speechSynthesis' in window) {
            loadThaiVoice();
            speechSynthesis.onvoiceschanged = loadThaiVoice;
        }
        
        function speakThai(textToSpeak) {
            // Get text immediately if not provided
            const thaiText = textToSpeak || (cards.length > 0 ? cards[currentIndex].thai : null);
            if (!thaiText) return;
            
            if (!('speechSynthesis' in window)) return;
            
            // Cancel any pending speech timeout
            if (pendingSpeechTimeout) {
                clearTimeout(pendingSpeechTimeout);
                pendingSpeechTimeout = null;
            }
            
            // Cancel ongoing speech
            speechSynthesis.cancel();
            
            // Try to reload voice if not found
            if (!thaiVoice) {
                loadThaiVoice();
            }
            
            // Don't play if no Thai voice - would sound wrong
            if (!thaiVoice) {
                showToast('Thai voice not available');
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(thaiText);
            utterance.lang = 'th-TH';
            utterance.rate = 0.8;
            utterance.voice = thaiVoice;
            
            const audioBtn = document.getElementById('audioBtn');
            
            utterance.onstart = () => {
                if (audioBtn) audioBtn.classList.add('speaking');
            };
            
            utterance.onend = () => {
                if (audioBtn) audioBtn.classList.remove('speaking');
            };
            
            utterance.onerror = () => {
                if (audioBtn) audioBtn.classList.remove('speaking');
            };
            
            speechSynthesis.speak(utterance);
        }
        
        // Store current sentence Thai text for speaking
        let currentSentenceThai = '';
        
        function speakSentence() {
            if (!currentSentenceThai) return;
            
            if (!('speechSynthesis' in window)) return;
            
            speechSynthesis.cancel();
            
            // Try to reload voice if not found
            if (!thaiVoice) {
                loadThaiVoice();
            }
            
            // Don't play if no Thai voice
            if (!thaiVoice) {
                showToast('Thai voice not available');
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(currentSentenceThai);
            utterance.lang = 'th-TH';
            utterance.rate = 0.75;
            utterance.voice = thaiVoice;
            
            const speakBtn = document.getElementById('sentenceSpeakBtn');
            
            utterance.onstart = () => {
                if (speakBtn) speakBtn.textContent = '';
            };
            
            utterance.onend = () => {
                if (speakBtn) speakBtn.textContent = '';
            };
            
            utterance.onerror = () => {
                if (speakBtn) speakBtn.textContent = '';
            };
            
            speechSynthesis.speak(utterance);
        }

        // Sound effects using Web Audio API
        let audioContext = null;
        
        function playTone(frequency, duration, type = 'sine', volume = 0.1) {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                // Soft attack and longer, gentler release
                const now = audioContext.currentTime;
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(volume, now + 0.02); // Quick fade in
                gainNode.gain.setValueAtTime(volume, now + duration * 0.3); // Hold
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration); // Gentle fade out
                
                oscillator.start(now);
                oscillator.stop(now + duration);
            } catch (e) {
                // Audio not supported, silently fail
            }
        }
        
        function playCorrectSound() {
            playTone(523, 0.25, 'sine', 0.06); // C5 - longer, softer
            setTimeout(() => playTone(659, 0.3, 'sine', 0.06), 80); // E5 - longer fade
        }
        
        function playIncorrectSound() {
            playTone(180, 0.35, 'sine', 0.12); // Lower tone, louder for mobile
        }
        
        function markCorrect() {
            if (!cards.length) return;
            const card = cards[currentIndex];
            const key = getCardKey(card);
            
            // Flash animation and sound
            flashcard.classList.add('success-flash');
            setTimeout(() => flashcard.classList.remove('success-flash'), 400);
            playCorrectSound();
            
            // Find which list this card belongs to and update stats there
            const originalListIdx = findCardOriginalList(card);
            const stats = getListStats(originalListIdx);
            
            if (!stats[key]) stats[key] = { correct: 0, incorrect: 0, consecutiveCorrect: 0, lastReviewed: null };
            stats[key].correct++;
            stats[key].consecutiveCorrect++;
            stats[key].lastReviewed = new Date().toISOString();
            sessionStats.correct++;
            
            // If card just became learned and we're in review mode, remove it from deck
            if (stats[key].consecutiveCorrect === LEARNING_THRESHOLD) {
                showToast(' Word learned!', 'success');
                if (currentMode === 'review') {
                    // Remove this card from the review deck
                    cards.splice(currentIndex, 1);
                    // Adjust index if we removed the last card
                    if (currentIndex >= cards.length && cards.length > 0) {
                        currentIndex = cards.length - 1;
                    }
                    if (cards.length === 0) {
                        showToast(' All cards learned!', 'success');
                        showCompletionModal();
                        return;
                    }
                    updateCard();
                    updateScoreDisplay();
                    saveProgress();
                    return;
                }
            }
            
            updateScoreDisplay();
            saveProgress();
            
            if (currentIndex < cards.length - 1) {
                nextCard();
            } else {
                showCompletionModal();
            }
        }

        function markIncorrect() {
            if (!cards.length) return;
            const card = cards[currentIndex];
            const key = getCardKey(card);
            
            // Flash animation and sound
            flashcard.classList.add('error-flash');
            setTimeout(() => flashcard.classList.remove('error-flash'), 400);
            playIncorrectSound();
            
            // Find which list this card belongs to and update stats there
            const originalListIdx = findCardOriginalList(card);
            const stats = getListStats(originalListIdx);
            
            if (!stats[key]) stats[key] = { correct: 0, incorrect: 0, consecutiveCorrect: 0, lastReviewed: null };
            stats[key].incorrect++;
            stats[key].consecutiveCorrect = 0;
            stats[key].lastReviewed = new Date().toISOString();
            sessionStats.incorrect++;
            updateScoreDisplay();
            saveProgress();
            
            if (currentIndex < cards.length - 1) {
                nextCard();
            } else {
                showCompletionModal();
            }
        }
        
        function findCardOriginalList(card) {
            const key = getCardKey(card);
            // Always search themedLists (the canonical source) for card stats
            for (let i = 0; i < themedLists.length; i++) {
                if (themedLists[i].words.some(c => getCardKey(c) === key)) {
                    return i;
                }
            }
            return 0; // Default to first list if not found
        }
        
        function showCompletionModal() {
            sessionState.inProgress = false;
            saveSessionState();
            
            const total = sessionStats.correct + sessionStats.incorrect;
            const accuracy = total > 0 ? Math.round((sessionStats.correct / total) * 100) : 0;
            
            document.getElementById('completionTotal').textContent = total;
            document.getElementById('completionCorrect').textContent = sessionStats.correct;
            document.getElementById('completionIncorrect').textContent = sessionStats.incorrect;
            document.getElementById('completionAccuracy').textContent = accuracy + "%";
            
            document.getElementById('completionModal').classList.add('open');
        }

        function updateScoreDisplay() {
            // Show session stats (not all-time stats)
            correctScore.textContent = sessionStats.correct;
            incorrectScore.textContent = sessionStats.incorrect;
            
            // Update list progress display
            if (currentListIndex >= 0) {
                const p = getListProgress(currentListIndex);
                listProgressDisplay.textContent = p.learned + " of " + p.total + " learned (" + p.learnedPercent + "%)";
            } else if (currentListIndex === FAVORITES_LIST) {
                listProgressDisplay.textContent = favorites.size + " favorites";
            } else if (currentListIndex === HARDEST_LIST) {
                listProgressDisplay.textContent = cards.length + " hardest cards";
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === mode));
            // Don't reset position - keep current index if possible
            const oldIndex = currentIndex;
            const oldCard = cards[currentIndex];
            initializeCardsPreservePosition(oldCard);
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
            updateCard();
            saveProgress();
        }

        function switchList(idx) {
            const oldCard = cards.length > 0 ? cards[currentIndex] : null;
            currentListIndex = idx;
            
            // Reset session stats for new list
            sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
            correctScore.textContent = '0';
            incorrectScore.textContent = '0';
            
            // Reset mode-specific state when switching lists
            modeState = {
                all: { cards: [], currentIndex: 0 },
                review: { cards: [], currentIndex: 0 }
            };
            
            // Reset to "All Cards" mode
            currentMode = 'all';
            modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
            
            if (idx === FAVORITES_LIST) {
                vocabulary = getFavoriteCards();
                if (vocabulary.length === 0) {
                    // Don't redirect, just show empty state
                    cards = [];
                    currentIndex = 0;
                    if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                    updateCard();
                    saveProgress();
                    return;
                }
            } else if (idx === HARDEST_LIST) {
                const hardest = getHardestCards();
                vocabulary = hardest.map(h => h.card);
                if (vocabulary.length === 0) {
                    // Don't redirect, just show empty state
                    cards = [];
                    currentIndex = 0;
                    if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                    updateCard();
                    saveProgress();
                    return;
                }
            } else if (idx === ALL_CARDS_LIST) {
                // Combine all words from all themed lists
                vocabulary = themedLists.reduce((all, list) => all.concat(list.words), []);
            } else {
                vocabulary = vocabularyLists[idx].words;
            }
            
            // Initialize fresh for new list
            initializeCards();
            modeState.all.cards = [...cards];
            modeState.all.currentIndex = currentIndex;
            if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
            updateCard();
            saveProgress();
        }

        function updateListSelector() {
            listSelector.innerHTML = '';
            
            // Add Favorites option
            const favOption = document.createElement('option');
            favOption.value = FAVORITES_LIST;
            favOption.textContent = " Favorites (" + favorites.size + " words)";
            listSelector.appendChild(favOption);
            
            // Add Hardest Cards option
            const hardOption = document.createElement('option');
            hardOption.value = HARDEST_LIST;
            const hardestCount = getHardestCards().length;
            hardOption.textContent = " Hardest Cards (" + hardestCount + " words)";
            listSelector.appendChild(hardOption);
            
            // Add All Cards option
            const allOption = document.createElement('option');
            allOption.value = ALL_CARDS_LIST;
            const totalWords = themedLists.reduce((sum, list) => sum + list.words.length, 0);
            allOption.textContent = " All Cards (" + totalWords + " words)";
            listSelector.appendChild(allOption);
            
            // Add separator
            const separator = document.createElement('option');
            separator.disabled = true;
            separator.textContent = '';
            listSelector.appendChild(separator);
            
            // Add vocabulary lists
            vocabularyLists.forEach((l, i) => {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = l.name + " (" + l.words.length + " words)";
                listSelector.appendChild(option);
            });
            
            listSelector.value = currentListIndex;
        }
        
        function getHardestCards() {
            // Get all cards with incorrect counts across all themed lists
            const allCardsWithStats = [];
            
            themedLists.forEach((list, listIdx) => {
                list.words.forEach(card => {
                    const key = getCardKey(card);
                    const stats = cardStats[listIdx]?.[key];
                    if (stats && stats.incorrect > 0) {
                        allCardsWithStats.push({
                            card,
                            incorrect: stats.incorrect,
                            listIdx
                        });
                    }
                });
            });
            
            // Sort by incorrect count (highest first) and take top 30
            allCardsWithStats.sort((a, b) => b.incorrect - a.incorrect);
            return allCardsWithStats.slice(0, 30);
        }
        
        function getFavoriteCards() {
            const favCards = [];
            vocabularyLists.forEach(list => {
                list.words.forEach(card => {
                    if (favorites.has(getCardKey(card))) {
                        favCards.push(card);
                    }
                });
            });
            return favCards;
        }

        function saveSessionState() {
            sessionState = { cardOrder: cards.map(getCardKey), currentIndex, listIndex: currentListIndex, mode: currentMode, inProgress: currentIndex < cards.length - 1 && cards.length > 0 };
            localStorage.setItem('thaiFlashcardsSession', JSON.stringify(sessionState));
        }

        function showResumeModal() {
            document.getElementById('resumeListName').textContent = vocabularyLists[sessionState.listIndex]?.name || 'Unknown';
            document.getElementById('resumeProgress').textContent = "Card " + (sessionState.currentIndex + 1) + " of " + sessionState.cardOrder.length;
            document.getElementById('resumeCorrect').textContent = sessionStats.correct;
            document.getElementById('resumeIncorrect').textContent = sessionStats.incorrect;
            resumeModal.classList.add('open');
        }

        function startFresh() {
            try {
                // Refresh vocabularyLists in case view mode changed
                vocabularyLists = getActiveVocabularyLists();
                sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                initializeCards();
                if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                updateCard();
                updateSessionScoreDisplay();
                showToast('Started fresh session!');
            } catch (err) {
                console.error('Start fresh error:', err);
            }
        }
        
        function updateSessionScoreDisplay() {
            correctScore.textContent = sessionStats.correct;
            incorrectScore.textContent = sessionStats.incorrect;
        }

        function resumeSession() {
            try {
                // Refresh vocabularyLists in case view mode changed
                vocabularyLists = getActiveVocabularyLists();
                
                if (sessionState.cardOrder && sessionState.cardOrder.length > 0) {
                    // Validate list index
                    if (sessionState.listIndex >= 0 && sessionState.listIndex < vocabularyLists.length) {
                        currentListIndex = sessionState.listIndex;
                    } else {
                        currentListIndex = 0;
                    }
                    
                    vocabulary = vocabularyLists[currentListIndex].words;
                    listSelector.value = currentListIndex;
                    currentMode = sessionState.mode || 'all';
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === currentMode));
                    const map = new Map(vocabulary.map(c => [getCardKey(c), c]));
                    cards = sessionState.cardOrder.map(k => map.get(k)).filter(Boolean);
                    
                    if (cards.length === 0) {
                        startFresh();
                        return;
                    }
                    
                    currentIndex = Math.min(sessionState.currentIndex || 0, cards.length - 1);
                    if (isFlipped) { flashcard.classList.remove('flipped'); isFlipped = false; }
                    updateCard();
                    showToast('Session resumed!');
                } else {
                    startFresh();
                }
            } catch (err) {
                console.error('Resume error:', err);
                startFresh();
            }
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const lines = ev.target.result.split('\n').filter(l => l.trim());
                const newCards = [];
                for (let i = 1; i < lines.length; i++) {
                    const m = lines[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
                    if (m?.length >= 2) {
                        const thai = m[0].replace(/^"|"$/g, '').trim();
                        const english = m[1].replace(/^"|"$/g, '').trim();
                        if (thai && english) newCards.push({ thai, english });
                    }
                }
                if (!newCards.length) { showToast('No valid cards found'); return; }
                const existing = new Set(vocabulary.map(c => c.thai.toLowerCase() + '|' + c.english.toLowerCase()));
                const unique = newCards.filter(c => !existing.has(c.thai.toLowerCase() + '|' + c.english.toLowerCase()));
                if (!unique.length) { showToast('All cards are duplicates'); csvFileInput.value = ''; return; }
                vocabulary.push(...unique);
                initializeCards();
                updateCard();
                saveProgress();
                showToast("Imported " + unique.length + " new cards!");
                csvFileInput.value = '';
            };
            reader.readAsText(file);
        }

        function updateStatsModal() {
            document.getElementById('sessionCorrect').textContent = sessionStats.correct;
            document.getElementById('sessionIncorrect').textContent = sessionStats.incorrect;
            var cp = getListProgress(currentListIndex);
            document.getElementById('currentListStats').innerHTML = 
                '<div class="list-stat-item">' +
                    '<div class="list-stat-header"><span class="list-stat-name">' + vocabularyLists[currentListIndex].name + '</span><span class="list-stat-percent">' + cp.learnedPercent + '%</span></div>' +
                    '<div class="list-stat-bar"><div class="list-stat-bar-fill" style="width:' + cp.learnedPercent + '%"></div></div>' +
                    '<div class="list-stat-details">' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + cp.learned + '/' + cp.total + '</span><span>Learned</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + cp.reviewed + '</span><span>Reviewed</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value score-correct">' + cp.totalCorrect + '</span><span>Correct</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value score-incorrect">' + cp.totalIncorrect + '</span><span>Wrong</span></div>' +
                    '</div>' +
                '</div>';
            document.getElementById('allListsStats').innerHTML = vocabularyLists.map(function(l, i) {
                var p = getListProgress(i);
                return '<div class="list-stat-item">' +
                    '<div class="list-stat-header"><span class="list-stat-name">' + l.name + '</span><span class="list-stat-percent">' + p.learnedPercent + '%</span></div>' +
                    '<div class="list-stat-bar"><div class="list-stat-bar-fill" style="width:' + p.learnedPercent + '%"></div></div>' +
                    '<div class="list-stat-details">' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + p.learned + '/' + p.total + '</span><span>Learned</span></div>' +
                        '<div class="stat-detail-item"><span class="stat-detail-value">' + p.reviewed + '</span><span>Reviewed</span></div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }
        
        function showVocabList() {
            var vocabListModal = document.getElementById('vocabListModal');
            var container = document.getElementById('vocabListContainer');
            var filter = document.getElementById('vocabListFilter').value;
            
            // Get words to display
            var words = [];
            if (filter === 'current') {
                words = vocabulary.map(function(w) { return w; });
            } else {
                // All words from all themed lists
                themedLists.forEach(function(list) {
                    list.words.forEach(function(w) {
                        words.push(w);
                    });
                });
            }
            
            // Sort alphabetically by Thai
            words.sort(function(a, b) {
                return a.thai.localeCompare(b.thai, 'th');
            });
            
            // Build HTML
            var html = '';
            words.forEach(function(word) {
                var mastery = getMasteryStatus(word);
                var statusClass = mastery.status;
                var roman = getRomanization(word.thai) || '';
                
                html += '<div class="vocab-list-item">' +
                    '<div class="vocab-status ' + statusClass + '"></div>' +
                    '<div class="vocab-thai">' + word.thai + '</div>' +
                    '<div class="vocab-english">' + word.english + '</div>' +
                    (roman ? '<div class="vocab-roman">' + roman + '</div>' : '') +
                '</div>';
            });
            
            container.innerHTML = html;
            vocabListModal.classList.add('open');
        }

        function exportProgress() {
            try {
                var data = { 
                    version: 1, 
                    exportDate: new Date().toISOString(), 
                    cardStats: cardStats, 
                    sessionStats: sessionStats, 
                    currentListIndex: currentListIndex, 
                    showThaiFront: showThaiFront, 
                    currentMode: currentMode, 
                    favorites: Array.from(favorites) 
                };
                var blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'thai-flashcards-progress-' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast('Progress exported!');
            } catch (e) {
                console.error('Export failed:', e);
                showToast('Export failed: ' + e.message);
            }
        }

        function resetProgress() {
            // Show custom confirmation by changing button temporarily
            var resetBtn = document.getElementById('resetBtn');
            if (resetBtn.dataset.confirming === 'true') {
                // Second click - do the reset
                resetBtn.dataset.confirming = 'false';
                resetBtn.textContent = ' Reset All Progress';
                
                try {
                    // Clear all app localStorage keys
                    localStorage.removeItem('thaiFlashcardsProgress');
                    localStorage.removeItem('thaiFlashcardsSession');
                    localStorage.removeItem('thaiFlashcardsRomanization');
                    localStorage.removeItem('thaiFlashcardsSmartReview');
                    localStorage.removeItem('thaiFlashcardsThaiFront');
                    localStorage.removeItem('thaiFlashcardsViewMode');
                    localStorage.removeItem('thaiGrammarProgress');
                    
                    // Reset all in-memory state
                    cardStats = {};
                    sessionStats = { correct: 0, incorrect: 0, cardsReviewed: 0 };
                    sessionState = { cardOrder: [], currentIndex: 0, listIndex: 0, mode: 'all', inProgress: false };
                    favorites = new Set();
                    currentMode = 'all';
                    showRomanization = false;
                    smartReviewMode = false;
                    showThaiFront = true;
                    lessonProgress = {};
                    
                    // Reset UI
                    currentListIndex = 0;
                    vocabulary = vocabularyLists[0].words;
                    listSelector.value = 0;
                    updateListSelector();
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === 'all'));
                    toggleBtn.textContent = ' Thai Front';
                    
                    // Reinitialize
                    initializeCards();
                    updateCard();
                    
                    // Close modal and show confirmation
                    settingsModal.classList.remove('open');
                    showToast('All progress reset!', 'success');
                    
                } catch (e) {
                    console.error('Reset failed:', e);
                    showToast('Reset failed: ' + e.message);
                }
            } else {
                // First click - ask for confirmation
                resetBtn.dataset.confirming = 'true';
                resetBtn.textContent = ' Click again to confirm reset';
                resetBtn.style.background = '#ef4444';
                resetBtn.style.color = 'white';
                
                // Reset button state after 3 seconds if not clicked
                setTimeout(function() {
                    if (resetBtn.dataset.confirming === 'true') {
                        resetBtn.dataset.confirming = 'false';
                        resetBtn.textContent = ' Reset All Progress';
                        resetBtn.style.background = '';
                        resetBtn.style.color = '';
                    }
                }, 3000);
            }
        }

        function saveProgress() {
            localStorage.setItem('thaiFlashcardsProgress', JSON.stringify({ 
                cardStats, 
                sessionStats, 
                currentListIndex, 
                showThaiFront, 
                currentMode, 
                favorites: Array.from(favorites),
                lastSaved: new Date().toISOString() 
            }));
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('thaiFlashcardsProgress');
                if (saved) {
                    const d = JSON.parse(saved);
                    cardStats = d.cardStats || {};
                    sessionStats = d.sessionStats || { correct: 0, incorrect: 0, cardsReviewed: 0 };
                    currentListIndex = d.currentListIndex || 0;
                    showThaiFront = d.showThaiFront !== undefined ? d.showThaiFront : true;
                    currentMode = d.currentMode || 'all';
                    favorites = new Set(d.favorites || []);
                    toggleBtn.textContent = " " + (showThaiFront ? "Thai" : "English") + " Front";
                    modeBtns.forEach(b => b.classList.toggle('active', b.dataset.mode === currentMode));
                }
                const sess = localStorage.getItem('thaiFlashcardsSession');
                if (sess) sessionState = JSON.parse(sess);
            } catch (e) { console.error(e); }
        }

        function showToast(msg, variant = '') {
            toast.textContent = msg;
            toast.className = 'toast show' + (variant ? ' ' + variant : '');
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.className = 'toast', 300);
            }, 2000);
        }

        init();
    </script>
</body>
</html>
